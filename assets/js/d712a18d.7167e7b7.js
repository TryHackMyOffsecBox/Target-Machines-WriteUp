"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[9015],{46170:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Xuanji/Unit-8/34","title":"\u5185\u5b58\u9a6c\u5206\u6790 - java01 - nacos","description":"1","source":"@site/docs/Xuanji/Unit-8/34.md","sourceDirName":"Xuanji/Unit-8","slug":"/Xuanji/Unit-8/34","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-8/34","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Xuanji/Unit-8/34.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Xuanji_Sidebar","previous":{"title":"\u7b2c\u4e03\u7ae0 \u5e38\u89c1\u653b\u51fb\u4e8b\u4ef6\u5206\u6790 - \u9493\u9c7c\u90ae\u4ef6","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-7/52"},"next":{"title":"\u7b2c\u4e5d\u7ae0 - blueteam \u7684\u5c0f\u5fc3\u601d","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-9/40"}}');var s=a(74848),r=a(28453);const c={},o="\u5185\u5b58\u9a6c\u5206\u6790 - java01 - nacos",i={},l=[{value:"1",id:"1",level:2},{value:"2",id:"2",level:2},{value:"3",id:"3",level:2},{value:"4",id:"4",level:2},{value:"5",id:"5",level:2}];function d(n){const e={admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u5185\u5b58\u9a6c\u5206\u6790---java01---nacos",children:"\u5185\u5b58\u9a6c\u5206\u6790 - java01 - nacos"})}),"\n",(0,s.jsx)(e.h2,{id:"1",children:"1"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"nacos \u7528\u6237\u5bc6\u7801\u7684\u5bc6\u6587\u503c\u4f5c\u4e3a flag \u63d0\u4ea4 flag{\u5bc6\u6587 }"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd0\u884c ",(0,s.jsx)(e.code,{children:"history"})," \u67e5\u8be2\u547d\u4ee4\u5386\u53f2\uff0c\u770b\u5230\u4ee5\u4e0b\u8bb0\u5f55"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"226  vim /etc/systemd/system/nacos.service\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u67e5\u770b ",(0,s.jsx)(e.code,{children:"nacos"})," \u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plaintext",metastring:'title="/etc/systemd/system/nacos.service"',children:'[Unit]\nDescription=nacos\nAfter=network.target\n\n[Service]\nType=forking\nLimitNOFILE=infinity\nEnvironment="JAVA_HOME=/usr/java/jdk1.8.0_202/"\nExecStart=/var/local/autorun_nacos.sh\n#ExecReloa=/var/local/nacos/bin/shutdown.sh\n#ExecStop=/var/local/nacos/bin/shutdown.sh\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u7ee7\u7eed\u8ddf\u8e2a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",metastring:'title="/var/local/autorun_nacos.sh"',children:"#!/bin/bash\n\n\nrm -rf /var/local/nacos\ncd /var/local/ && unzip nacos-server-2.0.1.zip\ncd /var/local/nacos/bin/ && ./startup.sh -m standalone\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5c1d\u8bd5\u542f\u52a8\u670d\u52a1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"(remote) root@vulntarget:/root# systemctl restart nacos\n(remote) root@vulntarget:/root# systemctl status nacos\n\u25cf nacos.service - nacos\n     Loaded: loaded (/etc/systemd/system/nacos.service; enabled; vendor preset: enabled)\n     Active: active (running) since Tue 2024-10-15 10:16:57 UTC; 2s ago\n    Process: 1455 ExecStart=/var/local/autorun_nacos.sh (code=exited, status=0/SUCCESS)\n      Tasks: 10 (limit: 2253)\n     Memory: 170.1M\n     CGroup: /system.slice/nacos.service\n             \u2514\u25001492 /usr/java/jdk1.8.0_202//bin/java -Xms512m -Xmx512m -Xmn256m -Dnacos.standalone=true -Dnacos.member.list= -Djava.ext.dirs=/usr/java/jdk1.8.0_202//jre/lib/ext:/usr/java/jdk1.8.0_202//lib/ex>\n\nOct 15 10:16:56 vulntarget autorun_nacos.sh[1468]:   inflating: nacos/conf/schema.sql\nOct 15 10:16:56 vulntarget autorun_nacos.sh[1468]:   inflating: nacos/LICENSE\nOct 15 10:16:56 vulntarget autorun_nacos.sh[1468]:   inflating: nacos/nacos_config_export_20231206050259.zip\nOct 15 10:16:56 vulntarget autorun_nacos.sh[1468]:   inflating: nacos/NOTICE\nOct 15 10:16:56 vulntarget autorun_nacos.sh[1468]:    creating: nacos/target/\nOct 15 10:16:57 vulntarget autorun_nacos.sh[1468]:   inflating: nacos/target/nacos-server.jar\nOct 15 10:16:57 vulntarget autorun_nacos.sh[1473]: /usr/java/jdk1.8.0_202//bin/java  -Xms512m -Xmx512m -Xmn256m -Dnacos.standalone=true -Dnacos.member.list= -Djava.ext.dirs=/usr/java/jdk1.8.0_202//jre/lib/ex>\nOct 15 10:16:57 vulntarget autorun_nacos.sh[1473]: nacos is starting with standalone\nOct 15 10:16:57 vulntarget autorun_nacos.sh[1473]: nacos is starting\uff0cyou can check the /var/local/nacos/logs/start.out\nOct 15 10:16:57 vulntarget systemd[1]: Started nacos.\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6210\u529f\u8bbf\u95ee\u5230 Nacos \u670d\u52a1"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"img",src:a(3941).A+"",width:"2559",height:"1371"})}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Nacos \u6570\u636e\u5e93\u914d\u7f6e\u6587\u4ef6\u4e2d\u5bfb\u627e\u7528\u6237\u5bc6\u7801\u90e8\u5206"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"(remote) root@vulntarget:/var/local/nacos/conf# cat nacos-mysql.sql | grep password\n        `password` varchar(500) NOT NULL,\nINSERT INTO users (username, password, enabled) VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', TRUE);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5373\u53ef\u786e\u8ba4\u7b54\u6848"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"2",children:"2"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"shiro \u7684 key \u4e3a\u591a\u5c11 shiro \u7684 key \u8bf7\u8bb0\u5f55\u4e0b\u6765 \uff08\u8bf7\u8bb0\u5f55\u4e0b\u6765\uff0c\u4f1a\u6709\u7528\uff09"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Nacos \u7684\u76ee\u5f55\u4e0b\uff0c\u5b58\u5728\u6709\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u7684\u5907\u4efd\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"(remote) root@vulntarget:/var/local/nacos# ls -lh\ntotal 52K\ndrwxr-sr-x 4 root staff 4.0K Oct 15 10:17 bin\ndrwxr-sr-x 2 root staff 4.0K Jan  1  1970 conf\ndrwxr-sr-x 7 root staff 4.0K Oct 15 10:17 data\n-rw-r--r-- 1 root staff  17K Jan  1  1970 LICENSE\ndrwxr-sr-x 2 root staff 4.0K Oct 15 10:17 logs\n-rw-r--r-- 1 root staff 4.4K Dec  6  2023 nacos_config_export_20231206050259.zip\n-rw-r--r-- 1 root staff 1.3K Jan  1  1970 NOTICE\ndrwxr-sr-x 2 root staff 4.0K Jan  1  1970 target\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u67e5\u770b\u5907\u4efd\u6587\u4ef6\u7684\u5185\u5bb9"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"(remote) root@vulntarget:/var/local/nacos# unzip -l nacos_config_export_20231206050259.zip\nArchive:  nacos_config_export_20231206050259.zip\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n      152  2023-12-06 05:02   DEFAULT_GROUP/GATEWAY\n     3686  2023-12-06 05:02   DEFAULT_GROUP/ADMIN_CONFIG\n     3243  2023-12-06 05:02   DEFAULT_GROUP/ADMIN_API\n---------                     -------\n     7081                     3 files\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u5176\u4e2d\u7684\u6587\u4ef6\u89e3\u538b\u51fa\u6765\uff0c\u5728\u5176\u4e2d ",(0,s.jsx)(e.code,{children:"ADMIN_CONFIG"})," \u6587\u4ef6\u4e2d\u627e\u5230 shiro \u914d\u7f6e\u6587\u4ef6"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plaintext",metastring:'title="ADMIN_CONFIG"',children:"#\u6743\u9650\u8ba4\u8bc1\nshiro:\n  enabled: true\n  set-login-uri: /login\n  key: KduO0i+zUIMcNNJnsZwU9Q==\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5373\u53ef\u786e\u8ba4\u7b54\u6848"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{KduO0i+zUIMcNNJnsZwU9Q==}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"3",children:"3"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9776\u673a\u5185\u6838\u7248\u672c\u4e3a flag{}"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u501f\u52a9 ",(0,s.jsx)(e.code,{children:"uname"})," \u67e5\u770b\u5185\u6838\u7248\u672c\u4fe1\u606f"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"(remote) root@vulntarget:/tmp/DEFAULT_GROUP# uname -r\n5.4.0-164-generic\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5373\u53ef\u5f97\u5230\u7b54\u6848"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{5.4.0-164-generic}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"4",children:"4"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u5c1d\u8bd5\u5e94\u6025\u5206\u6790\uff0c\u8fd0\u884c get_flag \u7136\u540e\u5c1d\u8bd5 check_flag \u901a\u8fc7\u540e\u63d0\u4ea4"}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsx)(e.p,{children:"\u6b64\u9898\u5df2\u4e0b\u67b6"})}),"\n",(0,s.jsx)(e.p,{children:"\u627e\u4e00\u4e0b\u7a0b\u5e8f\u7684\u4f4d\u7f6e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'(remote) root@vulntarget:/root# find / -name "get_flag"\n/home/vulntarget/get_flag\n\n(remote) root@vulntarget:/home/vulntarget# ls -lh\ntotal 19M\n-rwxrwxrwx 1 vulntarget vulntarget 9.3M Oct 13  2023 check_flag\n-rwxrwxrwx 1 vulntarget vulntarget 9.3M Oct 13  2023 get_flag\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u6839\u636e\u6307\u7eb9\u4fe1\u606f\uff0c\u786e\u8ba4\u4e3a ",(0,s.jsx)(e.code,{children:"pyinstaller"})," \u6253\u5305\u7684 Python \u9879\u76ee\uff0c\u63d0\u53d6\u5176 pyc \u6587\u4ef6\u5e76\u53cd\u7f16\u8bd1\u5f97\u5230"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'title="get_flag"',children:'#!/usr/bin/env python\n# visit https://tool.lu/pyc/ for more information\n# Version: Python 3.8\n\nimport time\nimport hashlib\nimport subprocess\n\n\ndef Get_FLag():\n    current_time = str(int(time.time()))\n    hash_object = hashlib.md5(current_time.encode())\n    hash_hex = hash_object.hexdigest()\n    print(f"""[+] current time: {time.ctime()}""")\n    print("[-] flag{" + hash_hex + "}")\n\n\ndef Get_flag():\n    part1 = "vuln"\n    part2 = "tar"\n    part3 = "get-m-01"\n    text = part1 + part2 + part3\n    hash_object = hashlib.md5(text.encode())\n    hash_hex = hash_object.hexdigest()\n    print("[+] flag{" + hash_hex + "}")\n\n\ndef Check_process():\n    keyword = "nacos"\n    command = f"""ps aux | grep \\\'{keyword}\\\'"""\n    output = subprocess.getoutput(command)\n    if "nacos-server" in output:\n        print("[+] info nacos \u7a0b\u5e8f\u5b58\u5728...")\n        return True\n    None("[-] ERROR")\n    return False\n\n\ndef Check_User():\n    keyword = "adrla7IBSf"\n    command = f"""cat /etc/passwd | grep \\\'{keyword}\\\'"""\n    output = subprocess.getoutput(command)\n    if "adrla7IBSfTZQ" in output:\n        print("[-] ERROR")\n        return False\n    None("[+] info \u540e\u95e8\u7528\u6237\u5df2\u6e05\u9664...")\n    return True\n\n\ndef Check_flag():\n    if Check_User() and Check_process():\n        Get_flag()\n    else:\n        Get_FLag()\n\n\nif __name__ == "__main__":\n    Check_flag()\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'title="check_flag"',children:"# Visit https://www.lddgo.net/string/pyc-compile-decompile for more information\n# Version : Python 3.8\n\nimport re\nimport hashlib\n\ndef Get_flag():\n    part1 = 'vuln'\n    part2 = 'tar'\n    part3 = 'get-m-01'\n    text = part1 + part2 + part3\n    hash_object = hashlib.md5(text.encode())\n    hash_hex = hash_object.hexdigest()\n    flag = 'flag{' + hash_hex + '}'\n    return flag\n\n\ndef check():\n    pass\n# WARNING: Decompyle incomplete\n\nif __name__ == '__main__':\n    check()\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5\u53ca"}),"\n",(0,s.jsxs)(e.p,{children:["\u90a3\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u53ea\u9700\u8981\u5728 ",(0,s.jsx)(e.code,{children:"/etc/passwd"})," \u4e2d\u5220\u9664 ",(0,s.jsx)(e.code,{children:"bt"})," \u540e\u95e8\u7528\u6237\uff0c\u5e76\u4fdd\u8bc1 ",(0,s.jsx)(e.code,{children:"nacos"})," \u670d\u52a1\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u5373\u53ef"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"(remote) root@vulntarget:/home/vulntarget# nano /etc/passwd\n(remote) root@vulntarget:/home/vulntarget# ./get_flag\n[+] info \u540e\u95e8\u7528\u6237\u5df2\u6e05\u9664...\n[+] info nacos \u7a0b\u5e8f\u5b58\u5728...\n[+] flag{6c3742aaf26a6dea7fe9d7731de59517}\n(remote) root@vulntarget:/home/vulntarget# ./check_flag\n[+] please input your flag: lag{6c3742aaf26a6dea7fe9d7731^C\n(remote) root@vulntarget:/home/vulntarget# ./check_flag\n[+] please input your flag: flag{6c3742aaf26a6dea7fe9d7731de59517}\n[+] \u606d\u559c\uff0c\u5f53\u524d\u673a\u5668\u5e94\u6025\u6210\u529f\uff01\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5373\u53ef\u5f97\u5230 flag"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-flag",children:"flag{6c3742aaf26a6dea7fe9d7731de59517}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"5",children:"5"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u5c1d\u8bd5\u4fee\u590d nacos \u5e76\u4e14\u81ea\u884c\u7528 poc \u6d4b\u8bd5\u662f\u5426\u6210\u529f \u6b64\u9898\u65e0 flag"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u6f0f\u6d1e\u70b9\u5b58\u5728\u4e8e ",(0,s.jsx)(e.code,{children:"nacos"})," \u7684\u9ed8\u8ba4\u5bc6\u7801\uff0c",(0,s.jsx)(e.code,{children:"shiro"})," \u670d\u52a1\u5b58\u5728\u6709\u53cd\u5e8f\u5217\u5316\u70b9"]}),"\n",(0,s.jsxs)(e.p,{children:["\u53ea\u9700\u8981\u5c06 ",(0,s.jsx)(e.code,{children:"nacos"})," \u7684\u7528\u6237\u5bc6\u7801\u8fdb\u884c\u4fee\u6539\uff0c\u5e76\u5bf9 ",(0,s.jsx)(e.code,{children:"shiro"})," \u7684 key \u8fdb\u884c\u4fee\u6539\u5373\u53ef"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},3941:(n,e,a)=>{a.d(e,{A:()=>t});const t=a.p+"assets/images/image_20241019-181904-35aa3e488af9df0a3078664f585e7c38.png"},28453:(n,e,a)=>{a.d(e,{R:()=>c,x:()=>o});var t=a(96540);const s={},r=t.createContext(s);function c(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);