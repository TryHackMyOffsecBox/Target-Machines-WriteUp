"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[7644],{94153:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"HackTheBox/Challenges/Reversing/Simple Encryptor/index","title":"Simple Encryptor","description":"Difficulty: VERY EASY","source":"@site/docs/HackTheBox/Challenges/Reversing/Simple Encryptor/index.md","sourceDirName":"HackTheBox/Challenges/Reversing/Simple Encryptor","slug":"/HackTheBox/Challenges/Reversing/Simple Encryptor/","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Challenges/Reversing/Simple Encryptor/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/HackTheBox/Challenges/Reversing/Simple Encryptor/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"HackTheBox_Sidebar","previous":{"title":"RAuth","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Challenges/Reversing/RAuth/"},"next":{"title":"Snakecode","permalink":"/Target-Machines-WriteUp/docs/HackTheBox/Challenges/Reversing/Snakecode/"}}');var t=r(74848),i=r(28453);const a={},c="Simple Encryptor",l={},o=[];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"simple-encryptor",children:"Simple Encryptor"})}),"\n",(0,t.jsxs)(n.admonition,{title:"CHALLENGE DESCRIPTION",type:"note",children:[(0,t.jsx)(n.p,{children:"Difficulty: VERY EASY"}),(0,t.jsx)(n.p,{children:"On our regular checkups of our secret flag storage server we found out that we were hit by ransomware! The original flag data is nowhere to be found, but luckily we not only have the encrypted file but also the encryption program itself."}),(0,t.jsx)(n.p,{children:"\u5728\u6211\u4eec\u5bf9\u79d8\u5bc6\u65d7\u5e1c\u5b58\u50a8\u670d\u52a1\u5668\u7684\u4f8b\u884c\u68c0\u67e5\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u670d\u52a1\u5668\u906d\u5230\u4e86\u52d2\u7d22\u8f6f\u4ef6\u7684\u653b\u51fb\uff01\u539f\u59cb\u65d7\u5e1c\u6570\u636e\u5df2\u7ecf\u65e0\u5904\u53ef\u5bfb\uff0c\u4f46\u5e78\u8fd0\u7684\u662f\uff0c\u6211\u4eec\u4e0d\u4ec5\u6709\u52a0\u5bc6\u6587\u4ef6\uff0c\u8fd8\u6709\u52a0\u5bc6\u7a0b\u5e8f\u672c\u8eab\u3002"})]}),"\n",(0,t.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u5148\u5c1d\u8bd5\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"IDA"})," \u8fdb\u884c\u53cd\u7f16\u8bd1"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-c",children:'int __fastcall main(int argc, const char **argv, const char **envp)\n{\n    char v3; // al\n    char v5; // [rsp+7h] [rbp-39h]\n    unsigned int seed[2]; // [rsp+8h] [rbp-38h] BYREF\n    __int64 i; // [rsp+10h] [rbp-30h]\n    FILE *stream; // [rsp+18h] [rbp-28h]\n    size_t size; // [rsp+20h] [rbp-20h]\n    void *ptr; // [rsp+28h] [rbp-18h]\n    FILE *s; // [rsp+30h] [rbp-10h]\n    unsigned __int64 v12; // [rsp+38h] [rbp-8h]\n\n    v12 = __readfsqword(0x28u);\n\n    // \u6587\u4ef6\u5185\u5bb9\u8bfb\u53d6\n    stream = fopen("flag", "rb"); // \u5efa\u7acb flag \u6587\u4ef6\u7684\u6307\u9488\uff0cread byte\n    fseek(stream, 0LL, 2);\n    size = ftell(stream);\n    fseek(stream, 0LL, 0);\n    ptr = malloc(size);\n    fread(ptr, size, 1uLL, stream);\n    fclose(stream);\n\n    // \u968f\u673a\u5316\u521d\u59cb\u5316\n    seed[0] = time(0LL);\n    srand(seed[0]);\n\n    // \u52a0\u5bc6\n    for (i = 0LL; i < (__int64)size; ++i )\n    {\n        *((_BYTE *)ptr + i) ^= rand();\n        v3 = rand();\n        v5 = *((_BYTE *)ptr + i);\n        seed[1] = v3 & 7;\n        *((_BYTE *)ptr + i) = __ROL1__(v5, v3 & 7);\n    }\n\n    // \u6587\u4ef6\u5199\u5165\u6307\u9488\n    s = fopen("flag.enc", "wb");\n    // \u5199\u5165\u968f\u673a\u5316\u79cd\u5b50\n    fwrite(seed, 1uLL, 4uLL, s);\n    // \u5199\u5165\u52a0\u5bc6\u540e\u6587\u4ef6\u5185\u5bb9\n    fwrite(ptr, 1uLL, size, s);\n    fclose(s);\n\n    return 0;\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u90a3\u4e48\u9898\u76ee\u5df2\u7ecf\u63d0\u4f9b\u4e86 ",(0,t.jsx)(n.code,{children:"flag.enc"})," \u6587\u4ef6\u7684\u524d\u63d0\u4e0b\uff0c\u5c06\u52a0\u5bc6\u8fc7\u7a0b\u53cd\u5411\u5904\u7406\u4e3a\u89e3\u5bc6\u8fc7\u7a0b\u5373\u53ef"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\nunsigned char ror(unsigned char val, int shift) {\n    shift %= 8;\n    return (val>> shift) | ((val << (8 - shift)) & 0xFF);\n}\n\nint main() {\n    FILE *f = fopen("flag.enc", "rb");\n    unsigned int seed;\n    fread(&seed, 4, 1, f);\n    srand(seed);\n\n    fseek(f, 0, SEEK_END);\n    long size = ftell(f) - 4;\n    fseek(f, 4, SEEK_SET);\n\n    unsigned char *data = malloc(size);\n    fread(data, 1, size, f);\n    fclose(f);\n\n    for (long i = 0; i < size; i++) {\n        int r1 = rand();\n        int r2 = rand();\n        data[i] = ror(data[i], r2 & 7);\n        data[i] ^= r1 & 0xFF;\n    }\n\n    FILE *out = fopen("flag.dec", "wb");\n    fwrite(data, 1, size, out);\n    fclose(out);\n    free(data);\n    return 0;\n}\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"Linux \u7cfb\u7edf\u548c Windows \u7cfb\u7edf\u7684\u968f\u673a\u6570\u7b97\u6cd5\u4e0d\u4e00\u81f4\uff0c\u8fd9\u91cc\u9898\u76ee\u73af\u5883\u4e3a Linux \u7cfb\u7edf\uff0c\u9700\u8981\u4f7f\u7528 Linux \u7cfb\u7edf\u6267\u884c\u89e3\u5bc6\u811a\u672c"})}),"\n",(0,t.jsx)(n.p,{children:"\u7f16\u8bd1\u89e3\u5bc6\u811a\u672c\u4e4b\u540e\u6267\u884c\u5373\u53ef"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~/tmp]\n\u2514\u2500$ gcc solve.c -o solve\n\n\u250c\u2500\u2500(randark \u327f kali)-[~/tmp]\n\u2514\u2500$ ./solve\n\n\u250c\u2500\u2500(randark \u327f kali)-[~/tmp]\n\u2514\u2500$ cat flag.dec\nHTB{vRy_s1MplE_F1LE3nCryp0r}\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5373\u53ef\u5f97\u5230\u7b54\u6848"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-flag",children:"HTB{vRy_s1MplE_F1LE3nCryp0r}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>c});var s=r(96540);const t={},i=s.createContext(t);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);