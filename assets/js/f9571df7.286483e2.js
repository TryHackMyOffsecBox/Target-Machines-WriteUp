"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[3222],{74750:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Independent-Environment/RedLabs/AllLabs/StorageAccount14/index","title":"Storage Account 14 - Minting SAS URI","description":"Minting SAS URI","source":"@site/docs/Independent-Environment/RedLabs/AllLabs/StorageAccount14/index.md","sourceDirName":"Independent-Environment/RedLabs/AllLabs/StorageAccount14","slug":"/Independent-Environment/RedLabs/AllLabs/StorageAccount14/","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/RedLabs/AllLabs/StorageAccount14/","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Independent-Environment/RedLabs/AllLabs/StorageAccount14/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"Independent_Environment_Sidebar","previous":{"title":"Storage Account 02 - Subdomain Enumeration","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/RedLabs/AllLabs/StorageAccount02/"},"next":{"title":"Storage Account 17 - Enumerate Blob Name","permalink":"/Target-Machines-WriteUp/docs/Independent-Environment/RedLabs/AllLabs/StorageAccount17/"}}');var r=s(74848),o=s(28453);const a={},i="Storage Account 14 - Minting SAS URI",c={},d=[];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"storage-account-14---minting-sas-uri",children:"Storage Account 14 - Minting SAS URI"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Minting SAS URI"}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario"})}),(0,r.jsx)(n.p,{children:"Storage accounts can be accessed through various methods, and one of them is by using the SAS URL. Make use of the SAS URL provided to find the flag."}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Overview"})}),(0,r.jsx)(n.p,{children:"What is SAS URL (Shared Access Signature URL)?"}),(0,r.jsx)(n.p,{children:"A SAS URL (Shared Access Signature URL) is a URL that contains a shared access signature token. It allows secure access to specific resources within an Azure storage account for a limited period, without requiring the account key. SAS URLs provide us with a way to grant granular access permissions to clients or applications without exposing the storage account keys."}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Hint"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Access resources without exposing keys"}),"\n"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Impact"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Once a SAS URL is leaked, we lose control over who can access the resource during the validity period of the SAS token. Revoking access is not possible on the leaked URL, which can be distributed or accessed by multiple parties. Here, the user can generate the SAS token for the storage account with the required permissions over a REST API request."}),"\n"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Reference"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction",children:"Storage Blob Docs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/rest/api/azure/",children:"Azure REST API Docs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview",children:"Shared Access Signature"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview",children:"Azure Storage Explorer"})}),"\n"]})]}),"\n",(0,r.jsx)(n.p,{children:"\u9898\u76ee\u7ed9\u51fa\u7684\u662f SASURL \u94fe\u63a5\uff0c\u4f7f\u7528 Microsoft Azure Storage Explorer \u5de5\u5177\u8fdb\u884c\u8fde\u63a5"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://azure.microsoft.com/zh-cn/products/storage/storage-explorer",children:"Azure \u5b58\u50a8\u8d44\u6e90\u7ba1\u7406\u5668 - \u4e91\u5b58\u50a8\u7ba1\u7406 | Microsoft Azure"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(14947).A+"",width:"1965",height:"1329"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 SASURL \u94fe\u63a5\u8fdb\u884c\u8fde\u63a5\u5230 Blob \u5bb9\u5668"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(23049).A+"",width:"1965",height:"1329"})}),"\n",(0,r.jsx)(n.p,{children:"\u5373\u53ef\u83b7\u5f97\u51ed\u636e"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(65838).A+"",width:"1965",height:"1329"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728 Microsoft Azure Storage Explorer \u5de5\u5177\u4e2d\u8fdb\u884c\u8fde\u63a5"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(76969).A+"",width:"1965",height:"1329"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f46\u662f\u4f1a\u51fa\u73b0\u63d0\u793a\uff0c\u6743\u9650\u4e0d\u8db3"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(85666).A+"",width:"1965",height:"1329"})}),"\n",(0,r.jsx)(n.p,{children:"\u9644\u4e0a\u5b8c\u6574\u7684Powershell\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u5b98\u7f51\u4e0a\u7684\u6709\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u6307\u4ee4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:"Connect-AzAccount -Credential\n$access = Get-AzAccessToken -ResourceUrl \"https://management.azure.com/\"\n$Token  = [System.Net.NetworkCredential]::new(\"\", $access.Token).Password\n\n# \u5217\u51fa\u5bb9\u5668\n$SubscriptionID = (Get-AzSubscription).Id\n$StorageAccount = Get-AzStorageAccount\n$ResourceGroupName = $StorageAccount.ResourceGroupName\n$StorageAccountName = $StorageAccount.StorageAccountName\n$Token = (Get-AzAccessToken).Token\n\n$URI = \"https://management.azure.com/subscriptions/$SubscriptionID/resourceGroups/$ResourceGroupName/providers/Microsoft.Storage/storageAccounts/$StorageAccountName/blobServices/default/containers?api-version=2022-09-01&`$include=deleted\"\n\n$RequestParams = @{\nMethod = 'GET'\nUri = $URI\nHeaders = @{\n'Authorization' = \"Bearer $Token\"\n}\nContentType = \"application/json\"\n}\n\n(Invoke-RestMethod @RequestParams).value\n\n# \u751f\u6210 SAS Token\n\n$Token  = [System.Net.NetworkCredential]::new(\"\", $access.Token).Password\n$URI = \"https://management.azure.com/subscriptions/$SubscriptionID/resourceGroups/$ResourceGroupName/providers/Microsoft.Storage/storageAccounts/$StorageAccountName/ListServiceSas?api-version=2022-09-01\"\n$RequestParams = @{\nMethod = 'POST'\nUri = $URI\nHeaders = @{\n'Authorization' = \"Bearer $Token\"\n}\nContentType = \"application/json\"\n}\n\n$body = \"\n{\n'canonicalizedResource': '/blob/$StorageAccountName/<ContainerName>',\n'signedResource': 'c',\n'signedPermission': 'rl',\n'signedExpiry': '2026-05-24T11:32:48.8457197Z'\n}\n\"\n\n(Invoke-RestMethod @RequestParams -Body $body | ConvertTo-Json)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u8fc7\u7a0b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:'PS C:\\Users\\Randark> Connect-AzAccount -Credential\n# \u8fd9\u91cc\u4f1a\u542f\u52a8\u6d4f\u89c8\u5668\uff0c\u767b\u9646\u5373\u53ef\n\nPS C:\\Users\\Randark> $access = Get-AzAccessToken -ResourceUrl "https://management.azure.com/"\nPS C:\\Users\\Randark> $Token  = [System.Net.NetworkCredential]::new("", $access.Token).Password\nPS C:\\Users\\Randark>\nPS C:\\Users\\Randark> $URI = "https://management.azure.com/subscriptions/$SubscriptionID/resourceGroups/$ResourceGroupName/providers/Microsoft.Storage/storageAccounts/$StorageAccountName/blobServices/default/containers?api-version=2022-09-01&`$include=deleted"\nPS C:\\Users\\Randark>\nPS C:\\Users\\Randark> $RequestParams = @{\n>>   Method = \'GET\'\n>>   Uri = $URI\n>>   Headers = @{ Authorization = "Bearer $Token" }\n>>   ContentType = "application/json"\n>> }\nPS C:\\Users\\Randark>\nPS C:\\Users\\Randark> (Invoke-RestMethod @RequestParams).value\n\nid         : /subscriptions/d51882bb-f3df-4079-a476-d561f0464d00/resourceGroups/AS-SA-020126-pooledLab-tbfozm736/providers/Microsoft.Storage/storageAccounts/askjwbnh736/blobServices/default/co\n             ntainers/asevtcfq736\nname       : asevtcfq736\ntype       : Microsoft.Storage/storageAccounts/blobServices/containers\netag       : "0x8DE4A03FAC8BB3F"\nproperties : @{immutableStorageWithVersioning=; deleted=False; remainingRetentionDays=0; defaultEncryptionScope=$account-encryption-key; denyEncryptionScopeOverride=False; publicAccess=None; l\n             easeStatus=Unlocked; leaseState=Available; lastModifiedTime=2026/1/2 13:36:48; hasImmutabilityPolicy=False; hasLegalHold=False}\n\nid         : /subscriptions/d51882bb-f3df-4079-a476-d561f0464d00/resourceGroups/AS-SA-020126-pooledLab-tbfozm736/providers/Microsoft.Storage/storageAccounts/askjwbnh736/blobServices/default/co\n             ntainers/askjwbnh736\nname       : askjwbnh736\ntype       : Microsoft.Storage/storageAccounts/blobServices/containers\netag       : "0x8DE4A03FA090D09"\nproperties : @{immutableStorageWithVersioning=; deleted=False; remainingRetentionDays=0; defaultEncryptionScope=$account-encryption-key; denyEncryptionScopeOverride=False; publicAccess=None; l\n             easeStatus=Unlocked; leaseState=Available; lastModifiedTime=2026/1/2 13:36:47; hasImmutabilityPolicy=False; hasLegalHold=False}\n\n# \u8bf7\u6c42\u9488\u5bf9\u6307\u5b9a\u5bb9\u5668\u7684 SAS Token\nPS C:\\Users\\Randark> $Token  = [System.Net.NetworkCredential]::new("", $access.Token).Password\nPS C:\\Users\\Randark> $URI = "https://management.azure.com/subscriptions/$SubscriptionID/resourceGroups/$ResourceGroupName/providers/Microsoft.Storage/storageAccounts/$StorageAccountName/ListServiceSas?api-version=2022-09-01"\nPS C:\\Users\\Randark>\nPS C:\\Users\\Randark> $RequestParams = @{\n>> Method = \'POST\'\n>> Uri = $URI\n>> Headers = @{\n>> \'Authorization\' = "Bearer $Token"\n>> }\n>> ContentType = "application/json"\n>> }\n# \u9700\u8981\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 asevtcfq736 \u6539\u4e3a\u5b9e\u9645\u7684\u5bb9\u5668\u540d\nPS C:\\Users\\Randark> $body = "\n>> {\n>> \'canonicalizedResource\': \'/blob/$StorageAccountName/asevtcfq736\',\n>> \'signedResource\': \'c\',\n>> \'signedPermission\': \'rl\',\n>> \'signedExpiry\': \'2026-05-24T11:32:48.8457197Z\'\n>> }\n>> "\nPS C:\\Users\\Randark> (Invoke-RestMethod @RequestParams -Body $body | ConvertTo-Json)\n{\n  "serviceSasToken": "sv=2015-04-05&sr=c&st=2026-01-02T14%3A41%3A14.3632132Z&se=2026-05-24T11%3A32%3A48.8457197Z&sp=rl&sig=I2baSfytHPeSVLhqDxlZtLMv5o%2BYj2AV8fIRDMKRj7w%3D"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u6700\u7ec8\u62fc\u63a5\u8d77\u6765 SASURL \u8bbf\u95ee\u5373\u53ef"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$SASURL = 'https://<STORAGEACCOUNTNAME>.blob.core.windows.net/<CONTAINERNAME>?<SASTOKEN>' \n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(16307).A+"",width:"1965",height:"1329"})}),"\n",(0,r.jsx)(n.admonition,{title:"Flags",type:"info",children:(0,r.jsxs)(t,{children:[(0,r.jsx)("summary",{children:" What is the flag value? "}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"asevtcfq736\n"})})]})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},14947:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image_20260118-211854-1f45c6e7ebcda4ade080ff1d437eac69.png"},23049:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image_20260119-211947-9bf8b7dbabdd2b58937c9d5e041f8362.png"},65838:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image_20260120-212053-c81899a5cd52738f0976ed3dd812398f.png"},76969:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image_20260125-212556-8b4f875dca100ee9b33a2d02ff32b21b.png"},85666:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image_20260128-212804-c92ba1c93124dbc3ba65912cfabbf0df.png"},16307:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image_20260147-224704-213377db1abe42d8effa50ea946d1c98.png"},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>i});var t=s(96540);const r={},o=t.createContext(r);function a(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);