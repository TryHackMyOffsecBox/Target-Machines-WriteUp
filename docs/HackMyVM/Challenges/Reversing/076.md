# Reversing - 076

:::note

created by || kerszi

â²ï¸ Release Date // 2024-07-05

ğŸ’€ Solvers // 1

ğŸ§© Type // rev

:::

å°†äºŒè¿›åˆ¶æ–‡ä»¶æ‹–è¿› IDA è¿›è¡Œåç¼–è¯‘åˆ†æï¼Œé¦–å…ˆå…ˆçœ‹å…¥å£å‡½æ•°

```c
int __fastcall main(int argc, const char **argv, const char **envp)
{
  int v3; // edx
  int v4; // ecx
  int v5; // r8d
  int v6; // r9d
  int v7; // edx
  int v8; // ecx
  int v9; // r8d
  int v10; // r9d
  char v12[40]; // [rsp+0h] [rbp-30h] BYREF
  unsigned __int64 v13; // [rsp+28h] [rbp-8h]

  v13 = __readfsqword(0x28u);
  generate_random_numbers(argc, argv, envp);
  printf((unsigned int)"Enter the flag :", (_DWORD)argv, v3, v4, v5, v6, v12[0]);
  _isoc99_scanf((unsigned int)"%32s", (unsigned int)v12, v7, v8, v9, v10, v12[0]);
  if ((unsigned int)xor_and_check(v12) )
    puts(&unk_4B70CF);
  else
    puts(&unk_4B70E0);
  return 0;
}
```

åœ¨å…¶ä¸­å®šä½åˆ°å…³é”®éƒ¨åˆ†

```c
printf((unsigned int)"Enter the flag :", (_DWORD)argv, v3, v4, v5, v6, v12[0]);
_isoc99_scanf((unsigned int)"%32s", (unsigned int)v12, v7, v8, v9, v10, v12[0]);
if ((unsigned int)xor_and_check(v12) )
  puts(&unk_4B70CF);
else
  puts(&unk_4B70E0);
```

å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºåœ¨ä½¿ç”¨ `_isoc99_scanf` å‡½æ•°è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶å‚¨å­˜ä¸º `v12` å˜é‡ä¹‹åï¼Œå°†å­—ç¬¦ä¸²ä¼ å…¥äº† `xor_and_check` å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›ï¼ŒæŸ¥çœ‹ `xor_and_check` å‡½æ•°çš„é€»è¾‘

```c
__int64 __fastcall xor_and_check(__int64 a1)
{
  int i; // [rsp+14h] [rbp-4h]

  for (i = 0; i <= 31; ++i)
  {
    if ((FLAG[i] ^ numbers[i]) != *(unsigned __int8 *)(i + a1) )
      return 0LL;
  }
  return 1LL;
}
```

ç»“åˆä¸Šä¸‹æ–‡é€»è¾‘ï¼Œç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²å‚¨å­˜ä¸º `a1` å˜é‡ï¼Œç„¶åå†é€ä½ä¸ `FLAG[i] ^ numbers[i]` çš„è¿ç®—ç»“æœè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœç»“æœä¸ä¸€è‡´çš„è¯å°±è¿”å› `0LL` çŠ¶æ€ç ï¼Œä¹Ÿå°±æ˜¯ç­”æ¡ˆé”™è¯¯ã€‚é‚£ä¹ˆé—®é¢˜å°±å¾ˆæ˜æ˜¾äº†ï¼Œéœ€è¦å¯¹ `FLAG[i] ^ numbers[i]` çš„ç»“æœè¿›è¡Œæå–

å¯¹ FLAG å˜é‡è¿›è¡ŒæŸ¥çœ‹

```c
unsigned char FLAG[128] = {
    0x2F, 0x00, 0x00, 0x00, 0x8B, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x8C, 0x00, 0x00, 0x00, 0x2F, 0x00, 0x00, 0x00, 0x99, 0x00, 0x00, 0x00,
    0x4D, 0x00, 0x00, 0x00, 0xA2, 0x00, 0x00, 0x00, 0xE5, 0x00, 0x00, 0x00, 0xF9, 0x00, 0x00, 0x00,
    0x93, 0x00, 0x00, 0x00, 0x95, 0x00, 0x00, 0x00, 0xA7, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00,
    0x11, 0x00, 0x00, 0x00, 0x9D, 0x00, 0x00, 0x00, 0x1A, 0x00, 0x00, 0x00, 0x8D, 0x00, 0x00, 0x00,
    0x76, 0x00, 0x00, 0x00, 0x8A, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00,
    0x05, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x67, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00,
    0x6C, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x8A, 0x00, 0x00, 0x00, 0xE7, 0x00, 0x00, 0x00
};
```

ä½†æ˜¯å¯¹äº `numbers[]` æ•°ç»„ï¼Œå¯¹å…¶è¿›è¡Œè·Ÿè¸ªï¼Œå¾—åˆ°

```c
.bss:00000000004E83C0 numbers         dd 20h dup(?)           ; DATA XREF: generate_random_numbers+3Eâ†‘o
.bss:00000000004E83C0                                         ; print_numbers+31â†‘o ...
```

è·Ÿè¸ª `generate_random_numbers` å‡½æ•°

```c
_DWORD *generate_random_numbers()
{
  _DWORD *result; // rax
  int v1; // ecx
  int i; // [rsp+Ch] [rbp-4h]

  result = (_DWORD *)srandom(0LL);
  for (i = 0; i <= 31; ++i)
  {
    v1 = (int)rand() % 256;
    result = numbers;
    numbers[i] = v1;
  }
  return result;
}
```

ç¨‹åºä½¿ç”¨ `srandom` å‡½æ•°è¿›è¡Œäº†éšæœºæ•°ç§å­çš„åˆå§‹åŒ–ï¼Œç„¶åé€ä½ä½¿ç”¨ `rand` å‡½æ•°å¯¹ `numbers[]` æ•°ç»„è¿›è¡Œäº†åˆå§‹åŒ–ã€‚

ç”±äºåç¼–è¯‘çš„ `srandom` å‡½æ•°ä¸ C æ ‡å‡†ä¸­çš„ `srand` å‡½æ•°å‡½æ•°è¡¨ç°ä¸Šä¸ä¸€è‡´ï¼Œæ‰€ä»¥é‡‡ç”¨åŠ¨æ€è°ƒè¯•çš„æ–¹å¼è¿›è¡Œæ•°æ®æå–

![img](img/image_20240745-234546.png)

è·å–åˆ°`numbers[]`æ•°ç»„çš„æ•°æ®ä¹‹åï¼Œå°±å¯ä»¥ç¼–å†™è„šæœ¬è¿›è¡Œè§£ç 

```c
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

unsigned char FLAG[128] = {
    0x2F, 0x00, 0x00, 0x00, 0x8B, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x8C, 0x00, 0x00, 0x00, 0x2F, 0x00, 0x00, 0x00, 0x99, 0x00, 0x00, 0x00,
    0x4D, 0x00, 0x00, 0x00, 0xA2, 0x00, 0x00, 0x00, 0xE5, 0x00, 0x00, 0x00, 0xF9, 0x00, 0x00, 0x00,
    0x93, 0x00, 0x00, 0x00, 0x95, 0x00, 0x00, 0x00, 0xA7, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00,
    0x11, 0x00, 0x00, 0x00, 0x9D, 0x00, 0x00, 0x00, 0x1A, 0x00, 0x00, 0x00, 0x8D, 0x00, 0x00, 0x00,
    0x76, 0x00, 0x00, 0x00, 0x8A, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00,
    0x05, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x67, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00,
    0x6C, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x8A, 0x00, 0x00, 0x00, 0xE7, 0x00, 0x00, 0x00};

unsigned char numbers[128] = {
    0x67, 0x00, 0x00, 0x00, 0xC6, 0x00, 0x00, 0x00, 0x69, 0x00, 0x00, 0x00, 0x73, 0x00, 0x00, 0x00, 
    0x51, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x4A, 0x00, 0x00, 0x00, 0xEC, 0x00, 0x00, 0x00, 
    0x29, 0x00, 0x00, 0x00, 0xCD, 0x00, 0x00, 0x00, 0xBA, 0x00, 0x00, 0x00, 0xAB, 0x00, 0x00, 0x00, 
    0xF2, 0x00, 0x00, 0x00, 0xFB, 0x00, 0x00, 0x00, 0xE3, 0x00, 0x00, 0x00, 0x46, 0x00, 0x00, 0x00, 
    0x7C, 0x00, 0x00, 0x00, 0xC2, 0x00, 0x00, 0x00, 0x54, 0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00, 
    0x1B, 0x00, 0x00, 0x00, 0xE8, 0x00, 0x00, 0x00, 0xE7, 0x00, 0x00, 0x00, 0x8D, 0x00, 0x00, 0x00, 
    0x76, 0x00, 0x00, 0x00, 0x5A, 0x00, 0x00, 0x00, 0x2E, 0x00, 0x00, 0x00, 0x63, 0x00, 0x00, 0x00, 
    0x33, 0x00, 0x00, 0x00, 0x9F, 0x00, 0x00, 0x00, 0xC9, 0x00, 0x00, 0x00, 0x9A, 0x00, 0x00, 0x00
};

int main()
{
    for (int i = 0; i < 128; ++i)
    {
        printf("%c", numbers[i] ^ FLAG[i]);
    }
    return 0;
}
// HMV{Pseudo_RanD0m_Numbers_In__C}
```

æˆ–è€…ï¼Œå¯ä»¥åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨`Shift + F2`æ‰“å¼€è„šæœ¬çª—å£ï¼Œä½¿ç”¨è„šæœ¬è¿›è¡Œè®¡ç®—

```python
FLAG_addr = get_name_ea_simple("FLAG")
numbers_addr = get_name_ea_simple("numbers")

for i in range(0,128):
    flag_value = get_wide_byte(FLAG_addr + i)
    number_value = get_wide_byte(numbers_addr + i)
    res_value = flag_value ^ number_value
    print(chr(res_value), end="")
```

![img](img/image_20240756-235645.png)
